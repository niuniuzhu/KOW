!function(d,a,D){D.un,D.uns;var n=D.static,f=D.class,A=D.getset,o=(D.__newvec,laya.maths.Bezier),r=laya.resource.Bitmap,s=laya.utils.Browser,O=(laya.display.css.CacheStyle,laya.filters.ColorFilter),U=laya.utils.ColorUtils,h=D.Config,b=laya.resource.Context,_=laya.display.cmd.DrawCanvasCmd,l=laya.display.cmd.DrawImageCmd,u=(laya.events.Event,laya.display.cmd.FillTextCmd),t=laya.filters.Filter,W=laya.utils.FontInfo,c=laya.display.Graphics,E=laya.resource.HTMLCanvas,e=(laya.utils.HTMLChar,laya.resource.HTMLImage),S=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),i=laya.display.Node,g=laya.maths.Point,L=laya.utils.Pool,M=laya.maths.Rectangle,x=laya.renders.Render,m=laya.renders.RenderSprite,R=laya.resource.Resource,p=laya.display.cmd.RestoreCmd,T=laya.display.cmd.RotateCmd,v=laya.utils.RunDriver,P=laya.display.cmd.SaveCmd,C=laya.display.cmd.ScaleCmd,B=laya.display.Sprite,y=(laya.display.SpriteConst,laya.display.css.SpriteStyle,laya.display.Stage),I=laya.utils.Stat,N=laya.utils.StringKey,F=laya.system.System,w=laya.display.Text,V=laya.resource.Texture,G=laya.display.cmd.TransformCmd,X=laya.display.cmd.TranslateCmd,k=laya.utils.VectorGraphManager;laya.utils.WordText;D.interface("laya.webgl.submit.ISubmit"),D.interface("laya.webgl.canvas.save.ISaveData");var z=function(){function s(){}f(s,"laya.webgl.canvas.save.SaveBase");var t=s.prototype;return D.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._dataObj[this._valueName]=this._value,(s.POOL[s.POOL._length++]=this)._newSubmit&&(t._curSubmit=At.RENDERBASE)},s._createArray=function(){var t=[];return t._length=0,t},s._init=function(){var t=s._namemap={};return t[1]="ALPHA",t[2]="fillStyle",t[8]="font",t[256]="lineWidth",t[512]="strokeStyle",t[8192]="_mergeID",t[1024]=t[2048]=t[4096]=[],t[16384]="textBaseline",t[32768]="textAlign",t[65536]="_nBlendType",t[1048576]="shader",t[2097152]="filters",t[8388608]="_colorFiler",t},s.save=function(t,e,i,r){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var _=s.POOL,a=0<_._length?_[--_._length]:new s;a._value=i[a._valueName=s._namemap[e]],a._dataObj=i,a._newSubmit=r;var n=t._save;n[n._length++]=a}},s.POOL=laya.webgl.canvas.save.SaveBase._createArray(),s._namemap=s._init(),s}(),Y=function(){function r(t,e){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this.ref=1,this._cacheID=0,this.clipMatDir=[99999999,0,0,99999999],this.clipMatPos=[0,0],this.defines=new jt,this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.color=null,this.colorAdd=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=r._cache[this._cacheID],0<t&&!this._inClassCache&&(this._inClassCache=r._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}f(r,"laya.webgl.shader.d2.value.Value2D");var t=r.prototype;return t.setValue=function(t){},t._ShaderWithCompile=function(){return he.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,ce.create,this._attribLocation)},t.upload=function(){var t=bt;bt.worldMatrix4===bt.TEMPMAT4_ARRAY||this.defines.addInt(128),this.mmat=t.worldMatrix4,bt.matWVP&&(this.defines.addInt(2048),this.u_MvpMatrix=bt.matWVP.elements);var e=he.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();e._shaderValueWidth!==t.width||e._shaderValueHeight!==t.height?(this.size[0]=t.width,this.size[1]=t.height,e._shaderValueWidth=t.width,e._shaderValueHeight=t.height,e.upload(this,null)):e.upload(this,e._params2dQuick2||e._make2dQuick2())},t.setFilters=function(t){if(this.filters=t)for(var e,i=t.length,r=0;r<i;r++)(e=t[r])&&(this.defines.add(e.type),e.action.setValue(this))},t.clear=function(){this.defines._value=this.subID+(mt.shaderHighPrecision?1024:0)},t.release=function(){--this.ref<1&&(this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this),this.clear(),this.filters=null,this.ref=1)},r._initone=function(t,e){r._typeClass[t]=e,r._cache[t]=[],r._cache[t]._length=0},r.__init__=function(){r._initone(4,zt),r._initone(512,Xt),r._initone(1,kt),r._initone(9,kt)},r.create=function(t,e){var i=r._cache[t|e];return i._length?i[--i._length]:new r._typeClass[t|e](e)},r._cache=[],r._typeClass=[],r.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r}(),H=function(){function t(){this.ib=null,this.vb=null;mt.mainContext;this.ib=ae.create(35048),this.vb=ne.create(8)}f(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var e=t.prototype;return e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},e.reset=function(){this.vb.clear(),this.ib.clear()},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),Z=(function(){function o(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(16,!0)}f(o,"laya.layagl.cmdNative.ScaleCmdNative");var t=o.prototype;t.recover=function(){L.recover("ScaleCmd",this)},A(0,t,"cmdID",function(){return"Scale"}),A(0,t,"scaleX",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"scaleY",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"pivotX",function(){return this._paramData._float32Data[2]},function(t){this._paramData._float32Data[2]=t,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"pivotY",function(){return this._paramData._float32Data[3]},function(t){this._paramData._float32Data[3]=t,j.syncBufferToRenderThread(this._paramData)}),o.create=function(t,e,i,r){var _=L.getItemByClass("ScaleCmd",o),a=_._graphicsCmdEncoder=this._commandEncoder,n=_._paramData._float32Data;n[0]=t,n[1]=e,n[2]=i,n[3]=r;var s=_._paramData.getPtrID();return j.syncBufferToRenderThread(_._paramData),a.setGlobalValueEx(Nt.GLOBALVALUE_MATRIX32,12,s,0),j.syncBufferToRenderThread(a),_},o.ID="Scale"}(),function(){function _(){this._clipInfoID=-1,this._globalClipMatrix=new S,this._clipRect=new M}f(_,"laya.webgl.canvas.save.SaveClipRect");var t=_.prototype;return D.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._globalClipMatrix.copyTo(t._globalClipMatrix),this._clipRect.clone(t._clipRect),t._clipInfoID=this._clipInfoID,_.POOL[_.POOL._length++]=this},_.save=function(t){if(131072!=(131072&t._saveMark._saveuse)){t._saveMark._saveuse|=131072;var e=_.POOL,i=0<e._length?e[--e._length]:new _;t._globalClipMatrix.copyTo(i._globalClipMatrix),t._clipRect.clone(i._clipRect),i._clipInfoID=t._clipInfoID;var r=t._save;r[r._length++]=i}},_.POOL=z._createArray(),_}()),j=(function(){function n(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(8,!0)}f(n,"laya.layagl.cmdNative.TranslateCmdNative");var t=n.prototype;t.recover=function(){L.recover("TranslateCmd",this)},A(0,t,"ty",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"cmdID",function(){return"Translate"}),A(0,t,"tx",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,j.syncBufferToRenderThread(this._paramData)}),n.create=function(t,e){var i=L.getItemByClass("TranslateCmd",n),r=i._graphicsCmdEncoder=this._commandEncoder,_=i._paramData._float32Data;_[0]=t,_[1]=e;var a=i._paramData.getPtrID();return j.syncBufferToRenderThread(i._paramData),r.setGlobalValueEx(Nt.GLOBALVALUE_MATRIX32,9,a,0),j.syncBufferToRenderThread(r),i},n.ID="Translate"}(),function(){function t(){}f(t,"laya.layagl.LayaGL");var e=t.prototype;return e.createCommandEncoder=function(t,e,i){return void 0===t&&(t=128),void 0===e&&(e=64),void 0===i&&(i=!1),new Ct(this,t,e,i)},e.beginCommandEncoding=function(t){},e.endCommandEncoding=function(){},e.calcMatrixFromScaleSkewRotation=function(t,e,i,r,_,a,n,s,o,h,l,u){},e.setGLTemplate=function(t,e){},e.setEndGLTemplate=function(t,e){},e.matrix4x4Multiply=function(t,e,i){},e.evaluateClipDatasRealTime=function(t,e,i,r){},t.getFrameCount=function(){return 0},t.syncBufferToRenderThread=function(t,e){void 0===e&&(e=0)},t.createArrayBufferRef=function(t,e,i){},t.createArrayBufferRefs=function(t,e,i,r){},t.EXECUTE_JS_THREAD_BUFFER=0,t.EXECUTE_RENDER_THREAD_BUFFER=1,t.EXECUTE_COPY_TO_RENDER=2,t.EXECUTE_COPY_TO_RENDER3D=3,t.VALUE_OPERATE_ADD=0,t.VALUE_OPERATE_SUB=1,t.VALUE_OPERATE_MUL=2,t.VALUE_OPERATE_DIV=3,t.VALUE_OPERATE_M2_MUL=4,t.VALUE_OPERATE_M3_MUL=5,t.VALUE_OPERATE_M4_MUL=6,t.VALUE_OPERATE_M32_MUL=7,t.VALUE_OPERATE_SET=8,t.VALUE_OPERATE_M32_TRANSLATE=9,t.VALUE_OPERATE_M32_SCALE=10,t.VALUE_OPERATE_M32_ROTATE=11,t.VALUE_OPERATE_M32_SCALE_PIVOT=12,t.VALUE_OPERATE_M32_ROTATE_PIVOT=13,t.VALUE_OPERATE_M32_TRANSFORM_PIVOT=14,t.VALUE_OPERATE_BYTE4_COLOR_MUL=15,t.ARRAY_BUFFER_TYPE_DATA=0,t.ARRAY_BUFFER_TYPE_CMD=1,t.ARRAY_BUFFER_REF_REFERENCE=0,t.ARRAY_BUFFER_REF_COPY=1,t.UPLOAD_SHADER_UNIFORM_TYPE_ID=0,t.UPLOAD_SHADER_UNIFORM_TYPE_DATA=1,t.instance=null,t}()),Q=function(){function t(t,e,i){this.atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,void(this._used=0)===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._cells=null,this._rowInfo=null,this.atlasID=i,this._init(t,e)}f(t,"laya.webgl.text.AtlasGrid");var e=t.prototype;return e.addRect=function(t,e,i,r){return!!this._get(e,i,r)&&(this._fill(r.x,r.y,e,i,t),this._texCount++,!0)},e._release=function(){this._cells=null,this._rowInfo=null},e._init=function(t,e){return this._width=t,this._height=e,this._release(),0!=this._width&&(this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=new Uint8Array(this._height),this._used=0,this._clear(),!0)},e._get=function(t,e,i){if(t>this._width||e>this._height)return!1;for(var r=-1,_=-1,a=this._width,n=this._height,s=this._cells,o=0;o<n;o++)if(!(this._rowInfo[o]<t))for(var h=0;h<a;){var l=3*(o*a+h);if(0!=s[l]||s[l+1]<t||s[l+2]<e)h+=s[l+1];else{r=h,_=o;for(var u=0;u<t;u++)if(s[3*u+l+2]<e){r=-1;break}if(!(r<0))return i.x=r,i.y=_,!0;h+=s[l+1]}}return!1},e._fill=function(t,e,i,r,_){var a=this._width,n=this._height;this._check(t+i<=a&&e+r<=n);for(var s=e;s<r+e;++s){this._check(this._rowInfo[s]>=i),this._rowInfo[s]-=i;for(var o=0;o<i;o++){var h=3*(t+s*a+o);this._check(0==this._cells[h]),this._cells[h]=_,this._cells[h+1]=i,this._cells[h+2]=r}}if(0<t)for(s=0;s<r;++s){var l=0;for(o=t-1;0<=o&&0==this._cells[3*((e+s)*a+o)];--o,++l);for(o=l;0<o;--o)this._cells[3*((e+s)*a+t-o)+1]=o,this._check(0<o)}if(0<e)for(o=t;o<t+i;++o){for(l=0,s=e-1;0<=s&&0==this._cells[3*(o+s*a)];--s,l++);for(s=l;0<s;--s)this._cells[3*(o+(e-s)*a)+2]=s,this._check(0<s)}this._used+=i*r/(this._width*this._height)},e._check=function(t){0==t&&console.log("xtexMerger 错误啦")},e._clear=function(){for(var t=this._texCount=0;t<this._height;t++)this._rowInfo[t]=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var r=3*(e*this._width+i);this._cells[r]=0,this._cells[r+1]=this._width-i,this._cells[r+2]=this._width-e}},t}(),K=function(){function e(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new ne(t,35048),e?this._vb._resizeBuffer(e,!1):h.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(65536*t,!1),this._ib=new ae,i&&this._ib._resizeBuffer(i,!1)}f(e,"laya.webgl.utils.Mesh2D");var t=e.prototype;return t.cloneWithNewVB=function(){var t=new e(this._stride,0,0);return t._ib=this._ib,t._quadNum=this._quadNum,t._attribInfo=this._attribInfo,t},t.cloneWithNewVBIB=function(){var t=new e(this._stride,0,0);return t._attribInfo=this._attribInfo,t},t.getVBW=function(){return this._vb.setNeedUpload(),this._vb},t.getVBR=function(){return this._vb},t.getIBR=function(){return this._ib},t.getIBW=function(){return this._ib.setNeedUpload(),this._ib},t.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,r=0,_=0;_<t;_++)e[i++]=r,e[i++]=r+2,e[i++]=r+1,e[i++]=r,e[i++]=r+3,e[i++]=r+2,r+=4;this._ib.setNeedUpload()},t.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},t.configVAO=function(t){if(!this._applied){this._applied=!0,this._vao||(this._vao=new Kt),this._vao.bind(),this._vb._bindForVAO(),this._ib.setNeedUpload(),this._ib._bind_uploadForVAO();for(var e=this._attribInfo.length/3,i=0,r=0;r<e;r++){var _=this._attribInfo[i+1],a=this._attribInfo[i],n=this._attribInfo[i+2];t.enableVertexAttribArray(r),t.vertexAttribPointer(r,_,a,!1,this._stride,n),i+=3}this._vao.unBind()}},t.useMesh=function(t){this._applied||this.configVAO(t),this._vao.bind(),this._vb.bind(),this._ib._bind_upload()||this._ib.bind(),this._vb._bind_upload()||this._vb.bind()},t.getEleNum=function(){return this._ib.getBuffer().byteLength/2},t.releaseMesh=function(){},t.destroy=function(){},t.clearVB=function(){this._vb.clear()},e._gvaoid=0,e}(),q=function(){function i(t){this._color=null,this.setValue(t)}f(i,"laya.webgl.canvas.DrawStyle");var t=i.prototype;return t.setValue=function(t){this._color=t?t instanceof laya.utils.ColorUtils?t:U.create(t):U.create("#000000")},t.reset=function(){this._color=U.create("#000000")},t.toInt=function(){return this._color.numColor},t.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.ColorUtils&&this._color.numColor===t.numColor},t.toColorStr=function(){return this._color.strColor},i.create=function(t){if(t){var e=t instanceof laya.utils.ColorUtils?t:U.create(t);return e._drawStyle||(e._drawStyle=new i(t))}return i.DEFAULT},n(i,["DEFAULT",function(){return this.DEFAULT=new i("#000000")}]),i}(),J=function(){function y(){this.fontSizeInfo={},this.charRender=null,this.mapFont={},this.fontID=0,this.mapColor=[],this.colorID=0,this.fontScaleX=1,this.fontScaleY=1,this._curStrPos=0,this.bmpData32=null,this.lastFont=null,this.fontSizeW=0,this.fontSizeH=0,this.fontSizeOffX=0,this.fontSizeOffY=0,this.renderPerChar=!0,this.textureMem=0,this.fontStr=null,this.textAtlases=[],this.isoTextures=[],this.tmpAtlasPos=new g;var t=!1,e=D.MiniAdpter;e&&e.systemInfo&&e.systemInfo.system&&(t="ios 10.1.1"===e.systemInfo.system.toLowerCase()),s.onMiniGame&&!t&&(y.isWan1Wan=!0),s.onLimixiu&&(y.isWan1Wan=!0),this.charRender=x.isConchApp?new qt:new Qt(y.atlasWidth,y.atlasWidth,y.scaleFontWithCtx,!y.isWan1Wan,!1),y.textRenderInst=this,D.textRender=this,y.atlasWidth2=y.atlasWidth*y.atlasWidth}f(y,"laya.webgl.text.TextRender");var t=y.prototype;return t.setFont=function(t){if(this.lastFont!=t){this.lastFont=t;var e=this.getFontSizeInfo(t._family),i=e>>24,r=e>>16&255,_=e>>8&255,a=255&e,n=t._size/y.standardFontSize;this.fontSizeOffX=Math.ceil(i*n),this.fontSizeOffY=Math.ceil(r*n),this.fontSizeW=Math.ceil(_*n),this.fontSizeH=Math.ceil(a*n),this.fontStr=t._font.replace("italic","")}},t.getNextChar=function(t){var e=t.length,i=this._curStrPos;if(e<=i)return null;for(var r=i,_=0;r<e;r++){var a=t.charCodeAt(r);if(a>>>11==27){if(1==_)break;_=1,r++}else if(65038===a||65039===a);else if(8205==a)_=2;else if(0==_)_=1;else if(1==_)break}return this._curStrPos=r,t.substring(i,r)},t.filltext=function(t,e,i,r,_,a,n,s,o,h){if(void 0===h&&(h=0),!(e.length<=0)){var l=W.Parse(_),u=0;switch(o){case"center":u=b.ENUM_TEXTALIGN_CENTER;break;case"right":u=b.ENUM_TEXTALIGN_RIGHT}this._fast_filltext(t,e,null,i,r,l,a,n,s,u,h)}},t.fillWords=function(t,e,i,r,_,a,n,s){if(e&&!(e.length<=0)){var o=W.Parse(_);this._fast_filltext(t,null,e,i,r,o,a,n,s,0,0)}},t._fast_filltext=function(t,e,i,r,_,a,n,s,o,h,l){if(void 0===l&&(l=0),!(e&&e.length<1||i&&i.length<1)){if(o<0&&(o=0),this.setFont(a),this.fontScaleX=this.fontScaleY=1,y.scaleFontWithCtx){var u=1,c=1;if(c=x.isConchApp?(u=t._curMat.getScaleX(),t._curMat.getScaleY()):(u=t.getMatScaleX(),t.getMatScaleY()),u<1e-4||c<.1)return;1<u&&(this.fontScaleX=u),1<c&&(this.fontScaleY=c)}a._italic&&(t._italicDeg=13);var f=e,d=!i&&e instanceof laya.utils.WordText,A=e,E=!!i,m=d?f.pageChars:[],R=0;switch(d?(A=f._text,(R=f.width)<0&&(R=f.width=this.charRender.getWidth(this.fontStr,A))):R=A?this.charRender.getWidth(this.fontStr,A):0,h){case b.ENUM_TEXTALIGN_CENTER:r-=R/2;break;case b.ENUM_TEXTALIGN_RIGHT:r-=R}f&&m&&this.hasFreedText(m)&&(m=f.pageChars=[]);var p=null,T=this.renderPerChar=!d||y.forceSplitRender||E;if(!m||m.length<1)if(T){var v,D=0,P=0;for(this._curStrPos=0;;){if(E){var C=i[this._curStrPos++];C?(v=C.char,D=C.x,P=C.y):v=null}else v=this.getNextChar(A);if(!v)break;if(!(p=this.getCharRenderInfo(v,a,n,s,o,!1)))break;if(p.isSpace);else{var g=m[p.tex.id];g||(m[p.tex.id]=g=[]),x.isConchApp?g.push({ri:p,x:D,y:P,w:p.bmpWidth/this.fontScaleX,h:p.bmpHeight/this.fontScaleY}):g.push({ri:p,x:D+1/this.fontScaleX,y:P+1/this.fontScaleY,w:(p.bmpWidth-2)/this.fontScaleX,h:(p.bmpHeight-2)/this.fontScaleY}),D+=p.width}}}else{var M=y.noAtlas||R*this.fontScaleX>y.atlasWidth;p=this.getCharRenderInfo(A,a,n,s,o,M),x.isConchApp?m[0]=[{ri:p,x:0,y:0,w:p.bmpWidth/this.fontScaleX,h:p.bmpHeight/this.fontScaleY}]:m[0]=[{ri:p,x:1/this.fontScaleX,y:1/this.fontScaleY,w:(p.bmpWidth-2)/this.fontScaleX,h:(p.bmpHeight-2)/this.fontScaleY}]}this._drawResortedWords(t,r,_,m),t._italicDeg=0}},t._drawResortedWords=function(t,e,i,r){var _=t._charSubmitCache&&t._charSubmitCache._enbale;for(var a in r){var n=r[a],s=n.length;if(!(s<=0))for(var o=0;o<s;o++){var h=n[o],l=h.ri;l.isSpace||(l.touch(),t.drawTexAlign=!0,x.isConchApp?t._drawTextureM(l.tex.texture,e+h.x-l.orix,i+h.y-l.oriy,h.w,h.h,null,1,l.uv):t._inner_drawTexture(l.tex.texture,l.tex.texture.bitmap.id,e+h.x-l.orix,i+h.y-l.oriy,h.w,h.h,null,l.uv,1,_),t.touches&&t.touches.push(l))}}},t.hasFreedText=function(t){for(var e in t)for(var i=t[e],r=0,_=i.length;r<_;r++){var a=i[r].ri;if(a.deleted||a.tex.__destroyed)return!0}return!1},t.getCharRenderInfo=function(t,e,i,r,_,a){void 0===a&&(a=!1);var n=this.mapFont[e._family];null==n&&(this.mapFont[e._family]=n=this.fontID++);var s=t+"_"+n+"_"+e._size+"_"+i;0<_&&(s+="_"+r+_),e._bold&&(s+="P"),1==this.fontScaleX&&1==this.fontScaleY||(s+=(20*this.fontScaleX|0)+"_"+(20*this.fontScaleY|0));var o=0,h=this.textAtlases.length,l=null,u=null;if(!a)for(o=0;o<h;o++)if(l=(u=this.textAtlases[o]).charMaps[s])return l.touch(),l;l=new ht,this.charRender.scale(this.fontScaleX,this.fontScaleY),l.char=t,l.height=e._size;var c=e._size/3|0,f=null,d=Math.ceil(this.charRender.getWidth(this.fontStr,t)*this.fontScaleX);if(d>this.charRender.canvasWidth&&(this.charRender.canvasWidth=Math.min(2048,d+2*c)),a){f=this.charRender.getCharBmp(t,this.fontStr,_,i,r,l,c,c,c,c,null);var A=_e.getTextTexture(f.width,f.height);A.addChar(f,0,0,l.uv),l.tex=A,l.orix=c,l.oriy=c,A.ri=l,this.isoTextures.push(A)}else{var E=t.length,m=1*_,R=Math.ceil((this.fontSizeW+2*m)*this.fontScaleX),p=Math.ceil((this.fontSizeH+2*m)*this.fontScaleY);y.imgdtRect[0]=(c-this.fontSizeOffX-m)*this.fontScaleX|0,y.imgdtRect[1]=(c-this.fontSizeOffY-m)*this.fontScaleY|0,this.renderPerChar||1==E?(y.imgdtRect[2]=Math.max(d,R),y.imgdtRect[3]=Math.max(d,p)):(y.imgdtRect[2]=-1,y.imgdtRect[3]=p),f=this.charRender.getCharBmp(t,this.fontStr,_,i,r,l,c,c,c,c,y.imgdtRect),u=this.addBmpData(f,l),l.oriy=y.isWan1Wan?l.orix=c:(l.orix=this.fontSizeOffX+m,this.fontSizeOffY+m),u.charMaps[s]=l}return l},t.addBmpData=function(t,e){for(var i=t.width,r=t.height,_=this.textAtlases.length,a=null,n=!1,s=0;s<_&&!(n=(a=this.textAtlases[s]).getAEmpty(i,r,this.tmpAtlasPos));s++);if(!n){if(a=new Ut,this.textAtlases.push(a),!(n=a.getAEmpty(i,r,this.tmpAtlasPos)))throw"err1";this.cleanAtlases()}return n&&(a.texture.addChar(t,this.tmpAtlasPos.x,this.tmpAtlasPos.y,e.uv),e.tex=a.texture),a},t.GC=function(t){for(var e=0,i=this.textAtlases.length,r=0,_=y.destroyAtlasDt,a=0,n=-1,s=0,o=null,h=null;e<i;e++){if(o=(h=this.textAtlases[e]).texture){o.curUsedCovRate,a+=o.curUsedCovRateAtlas;var l=h.usedRate-o.curUsedCovRateAtlas;s<l&&(s=l,n=e)}_<(r=I.loopCount-h.texture.lastTouchTm)&&(y.showLog&&console.log(h.texture.id),h.destroy(),this.textAtlases[e]=this.textAtlases[i-1],i--,e--)}for(this.textAtlases.length=i,i=this.isoTextures.length,e=0;e<i;e++)o=this.isoTextures[e],r=I.loopCount-o.lastTouchTm,y.destroyUnusedTextureDt<r&&(o.ri.deleted=!0,o.ri.tex=null,o.destroy(),this.isoTextures[e]=this.isoTextures[i-1],i--,e--);var u=1<this.textAtlases.length&&2<=this.textAtlases.length-a;(y.atlasWidth*y.atlasWidth*4*this.textAtlases.length>y.cleanMem||u||y.simClean)&&(y.simClean=!1,y.showLog&&console.log("清理使用率低的贴图。总使用率:",a,":",this.textAtlases.length,"最差贴图:"+n),0<=n&&((h=this.textAtlases[n]).destroy(),this.textAtlases[n]=this.textAtlases[this.textAtlases.length-1],this.textAtlases.length=this.textAtlases.length-1)),_e.clean()},t.cleanAtlases=function(){},t.getCharBmp=function(t){},t.checkBmpLine=function(t,e,i,r){this.bmpData32.buffer!=t.data.buffer&&(this.bmpData32=new Uint32Array(t.data.buffer));for(var _=t.width*e+i,a=i;a<r;a++)if(0!=this.bmpData32[_++])return!0;return!1},t.updateBbx=function(t,e,i){void 0===i&&(i=!1);var r=t.width,_=t.height,a=0,n=e[1],s=0,o=n;if(this.checkBmpLine(t,n,0,r))for(;;){if(n<=(o=(n+s)/2|0)+1){e[1]=o;break}this.checkBmpLine(t,o,0,r)?n=o:s=o}if(e[3]>_)e[3]=_;else if(o=n=e[3],s=_,this.checkBmpLine(t,n,0,r))for(;;){if((o=(n+s)/2|0)-1<=n){e[3]=o;break}this.checkBmpLine(t,o,0,r)?n=o:s=o}if(!i){var h=e[0],l=r*e[1];for(o=e[1];o<e[3];o++){for(a=0;a<h;a++)if(0!=this.bmpData32[l+a]){h=a;break}l+=r}e[0]=h;var u=e[2];for(l=r*e[1],o=e[1];o<e[3];o++){for(a=u;a<r;a++)if(0!=this.bmpData32[l+a]){u=a;break}l+=r}e[2]=u}},t.getFontSizeInfo=function(t){var e=this.fontSizeInfo[t];if(null!=e)return e;var i="bold "+y.standardFontSize+"px "+t;if(y.isWan1Wan){this.fontSizeW=1.5*this.charRender.getWidth(i,"国"),this.fontSizeH=1.5*y.standardFontSize;var r=this.fontSizeW<<8|this.fontSizeH;return this.fontSizeInfo[t]=r}y.pixelBBX[0]=y.standardFontSize/2,y.pixelBBX[1]=y.standardFontSize/2,y.pixelBBX[2]=y.standardFontSize,y.pixelBBX[3]=y.standardFontSize;var _=16,a=16;this.charRender.scale(1,1),y.tmpRI.height=y.standardFontSize;var n=this.charRender.getCharBmp("g",i,0,"red",null,y.tmpRI,_,a,16,16);x.isConchApp&&(n.data=new Uint8ClampedArray(n.data)),this.bmpData32=new Uint32Array(n.data.buffer),this.updateBbx(n,y.pixelBBX,!1),n=this.charRender.getCharBmp("国",i,0,"red",null,y.tmpRI,a,a,16,16),x.isConchApp&&(n.data=new Uint8ClampedArray(n.data)),this.bmpData32=new Uint32Array(n.data.buffer),y.pixelBBX[2]<_+y.tmpRI.width&&(y.pixelBBX[2]=_+y.tmpRI.width),this.updateBbx(n,y.pixelBBX,!1),x.isConchApp&&(a=_=0);var s=Math.max(_-y.pixelBBX[0],0)<<24|Math.max(a-y.pixelBBX[1],0)<<16|y.pixelBBX[2]-y.pixelBBX[0]<<8|y.pixelBBX[3]-y.pixelBBX[1];return this.fontSizeInfo[t]=s},t.printDbgInfo=function(){for(var t in console.log("图集个数:"+this.textAtlases.length+",每个图集大小:"+y.atlasWidth+"x"+y.atlasWidth," 用canvas:",y.isWan1Wan),console.log("图集占用空间:"+y.atlasWidth*y.atlasWidth*4/1024/1024*this.textAtlases.length+"M"),console.log("缓存用到的字体:"),this.mapFont){var e=this.getFontSizeInfo(t),i=e>>24,r=e>>16&255,_=e>>8&255,a=255&e;console.log("    "+t," off:",i,r," size:",_,a)}var n=0;console.log("缓存数据:");var s=0,o=0;this.textAtlases.forEach(function(t){var e=t.texture.id,i=I.loopCount-t.texture.lastTouchTm,r=0<i?i+"帧以前":"当前帧";for(var _ in s+=t.texture.curUsedCovRate,o+=t.texture.curUsedCovRateAtlas,console.log("--图集(id:"+e+",当前使用率:"+(1e3*t.texture.curUsedCovRate|0)+"‰","当前图集使用率:",(100*t.texture.curUsedCovRateAtlas|0)+"%","图集使用率:",100*t.usedRate|0,"%, 使用于:"+r+")--:"),t.charMaps){var a=t.charMaps[_];console.log("     off:",a.orix,a.oriy," bmp宽高:",a.bmpWidth,a.bmpHeight,"无效:",a.deleted,"touchdt:",I.loopCount-a.touchTick,"位置:",a.uv[0]*y.atlasWidth|0,a.uv[1]*y.atlasWidth|0,"字符:",a.char,"key:",_),n++}}),console.log("独立贴图文字("+this.isoTextures.length+"个):"),this.isoTextures.forEach(function(t){console.log("    size:",t._texW,t._texH,"touch间隔:",I.loopCount-t.lastTouchTm,"char:",t.ri.char)}),console.log("总缓存:",n,"总使用率:",s,"总当前图集使用率:",o)},t.showAtlas=function(t,i,e,r,_,a){if(!this.textAtlases[t])return console.log("没有这个图集"),null;var n=new B,s=this.textAtlases[t].texture,o={width:y.atlasWidth,height:y.atlasWidth,sourceWidth:y.atlasWidth,sourceHeight:y.atlasWidth,offsetX:0,offsetY:0,getIsReady:function(){return!0},_addReference:function(){},_removeReference:function(){},_getSource:function(){return s._getSource()},bitmap:{id:s.id},_uv:V.DEF_UV};return n.size=function(t,e){return this.width=t,this.height=e,n.graphics.clear(),n.graphics.drawRect(0,0,n.width,n.height,i),n.graphics.drawTexture(o,0,0,n.width,n.height),this},n.graphics.drawRect(0,0,_,a,i),n.graphics.drawTexture(o,0,0,_,a),n.pos(e,r),D.stage.addChild(n),n},t.filltext_native=function(t,e,i,r,_,a,n,s,o,h,l){if(void 0===l&&(l=0),!(e&&e.length<=0||i&&i.length<1)){var u=W.Parse(a),c=0;switch(h){case"center":c=b.ENUM_TEXTALIGN_CENTER;break;case"right":c=b.ENUM_TEXTALIGN_RIGHT}return this._fast_filltext(t,e,i,r,_,u,n,s,o,c,l)}},y.useOldCharBook=!1,y.atlasWidth=2048,y.noAtlas=!1,y.forceSplitRender=!1,y.forceWholeRender=!1,y.scaleFontWithCtx=!0,y.standardFontSize=32,y.destroyAtlasDt=10,y.checkCleanTextureDt=2e3,y.destroyUnusedTextureDt=3e3,y.cleanMem=104857600,y.isWan1Wan=!1,y.showLog=!1,y.debugUV=!1,y.atlasWidth2=4194304,y.textRenderInst=null,y.simClean=!1,n(y,["tmpRI",function(){return this.tmpRI=new ht},"pixelBBX",function(){return this.pixelBBX=[0,0,0,0]},"imgdtRect",function(){return this.imgdtRect=[0,0,0,0]}]),y}(),$=function(){function n(){this._commandEncoder=null}f(n,"laya.layagl.ConchGraphicsAdpt");var t=n.prototype;return t._createData=function(){this._commandEncoder=j.instance.createCommandEncoder(128,64,!0)},t._clearData=function(){this._commandEncoder&&this._commandEncoder.clearEncoding()},t._destroyData=function(){this._commandEncoder&&(this._commandEncoder.clearEncoding(),this._commandEncoder=null)},n.__init__=function(){var t,e,i=c.prototype,r=n.prototype,_=["_createData","_clearData","_destroyData"],a=0;for(t=_.length,a=0;a<t;a++)i[e=_[a]]=r[e]},n}(),tt=(function(){function o(){}f(o,"laya.webgl.utils.MatirxArray"),o.ArrayMul=function(t,e,i){if(t)if(e)for(var r=NaN,_=NaN,a=NaN,n=NaN,s=0;s<4;s++)r=t[s],_=t[s+4],a=t[s+8],n=t[s+12],i[s]=r*e[0]+_*e[1]+a*e[2]+n*e[3],i[s+4]=r*e[4]+_*e[5]+a*e[6]+n*e[7],i[s+8]=r*e[8]+_*e[9]+a*e[10]+n*e[11],i[s+12]=r*e[12]+_*e[13]+a*e[14]+n*e[15];else o.copyArray(t,i);else o.copyArray(e,i)},o.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]}}(),function(){function s(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(12,!0)}f(s,"laya.layagl.cmdNative.RotateCmdNative");var t=s.prototype;t.recover=function(){L.recover("RotateCmd",this)},A(0,t,"cmdID",function(){return"Rotate"}),A(0,t,"angle",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"pivotX",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"pivotY",function(){return this._paramData._float32Data[2]},function(t){this._paramData._float32Data[2]=t,j.syncBufferToRenderThread(this._paramData)}),s.create=function(t,e,i){var r=L.getItemByClass("RotateCmd",s),_=r._graphicsCmdEncoder=this._commandEncoder,a=r._paramData._float32Data;a[0]=t,a[1]=e,a[2]=i;var n=r._paramData.getPtrID();return j.syncBufferToRenderThread(r._paramData),_.setGlobalValueEx(Nt.GLOBALVALUE_MATRIX32,13,n,0),j.syncBufferToRenderThread(_),r},s.ID="Rotate"}(),function(){function i(){this._graphicsCmdEncoder=null}f(i,"laya.layagl.cmdNative.SaveCmdNative");var t=i.prototype;t.recover=function(){L.recover("SaveCmd",this)},A(0,t,"cmdID",function(){return"Save"}),i.create=function(){var t=L.getItemByClass("SaveCmd",i),e=t._graphicsCmdEncoder=this._commandEncoder;return e.save(),j.syncBufferToRenderThread(e),t},i.ID="Save"}(),function(){function t(){}return f(t,"laya.webgl.VertexArrayObject"),t}()(function(){var _={};function u(t,e){var i;_[t]=!0,void 0!==e&&(i=e,d.console&&d.console.error&&d.console.error(i))}var i=function t(e){var i=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(var r=0;r<this.attribs.length;r++){var _=new t.VertexAttrib(i);this.attribs[r]=_}this.maxAttrib=0};(i.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=t.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var r=function(r){var e,i,o=this;this.gl=r,i=(e=r).getError,e.getError=function(){for(;(t=i.apply(e))!=e.NO_ERROR&&(_[t]=!0),t!=e.NO_ERROR;);for(var t in _)if(_[t])return delete _[t],parseInt(t);return e.NO_ERROR};var h=this.original={getParameter:r.getParameter,enableVertexAttribArray:r.enableVertexAttribArray,disableVertexAttribArray:r.disableVertexAttribArray,bindBuffer:r.bindBuffer,getVertexAttrib:r.getVertexAttrib,vertexAttribPointer:r.vertexAttribPointer};r.getParameter=function(t){return t==o.VERTEX_ARRAY_BINDING_OES?o.currentVertexArrayObject==o.defaultVertexArrayObject?null:o.currentVertexArrayObject:h.getParameter.apply(this,arguments)},r.enableVertexAttribArray=function(t){var e=o.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!0,h.enableVertexAttribArray.apply(this,arguments)},r.disableVertexAttribArray=function(t){var e=o.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!1,h.disableVertexAttribArray.apply(this,arguments)},r.bindBuffer=function(t,e){switch(t){case r.ARRAY_BUFFER:o.currentArrayBuffer=e;break;case r.ELEMENT_ARRAY_BUFFER:o.currentVertexArrayObject.elementArrayBuffer=e}return h.bindBuffer.apply(this,arguments)},r.getVertexAttrib=function(t,e){var i=o.currentVertexArrayObject.attribs[t];switch(e){case r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return i.buffer;case r.VERTEX_ATTRIB_ARRAY_ENABLED:return i.enabled;case r.VERTEX_ATTRIB_ARRAY_SIZE:return i.size;case r.VERTEX_ATTRIB_ARRAY_STRIDE:return i.stride;case r.VERTEX_ATTRIB_ARRAY_TYPE:return i.type;case r.VERTEX_ATTRIB_ARRAY_NORMALIZED:return i.normalized;default:return h.getVertexAttrib.apply(this,arguments)}},r.vertexAttribPointer=function(t,e,i,r,_,a){var n=o.currentVertexArrayObject;n.maxAttrib=Math.max(n.maxAttrib,t);var s=n.attribs[t];return s.buffer=o.currentArrayBuffer,s.size=e,s.type=i,s.normalized=r,s.stride=_,s.offset=a,s.recache(),h.vertexAttribPointer.apply(this,arguments)},r.instrumentExtension&&r.instrumentExtension(this,"OES_vertex_array_object"),r.canvas&&r.canvas.addEventListener&&r.canvas.addEventListener("webglcontextrestored",function(){var t;t="OESVertexArrayObject emulation library context restored",d.console&&d.console.log&&d.console.log(t),o.reset_()},!0),this.reset_()};r.prototype.VERTEX_ARRAY_BINDING_OES=34229,r.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;var e=this.gl;this.maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new i(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},r.prototype.createVertexArrayOES=function(){var t=new i(this);return this.vertexArrayObjects.push(t),t},r.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject==t&&this.bindVertexArrayOES(null)},r.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof i&&t.hasBeenBound&&t.ext==this)},r.prototype.bindVertexArrayOES=function(t){var e=this.gl;if(!t||t.isAlive){var i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var _=this.currentVertexArrayObject;if(r!=_){r&&_.elementArrayBuffer==r.elementArrayBuffer||i.bindBuffer.call(e,e.ELEMENT_ARRAY_BUFFER,_.elementArrayBuffer);for(var a=this.currentArrayBuffer,n=Math.max(r?r.maxAttrib:0,_.maxAttrib),s=0;s<=n;s++){var o=_.attribs[s],h=r?r.attribs[s]:null;if(r&&o.enabled==h.enabled||(o.enabled?i.enableVertexAttribArray.call(e,s):i.disableVertexAttribArray.call(e,s)),o.enabled){var l=!1;r&&o.buffer==h.buffer||(a!=o.buffer&&(i.bindBuffer.call(e,e.ARRAY_BUFFER,o.buffer),a=o.buffer),l=!0),(l||o.cached!=h.cached)&&i.vertexAttribPointer.call(e,s,o.size,o.type,o.normalized,o.stride,o.offset)}}this.currentArrayBuffer!=a&&i.bindBuffer.call(e,e.ARRAY_BUFFER,this.currentArrayBuffer)}}else u(e.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject")},d._setupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var i=t.getExtension;t.getExtension=function(t){var e=i.call(this,t);return e||("OES_vertex_array_object"!==t?null:(this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new r(this)),this.__OESVertexArrayObject))}},d._forceSetupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var i=t.getExtension;t.getExtension=function(t){if("OES_vertex_array_object"===t)return this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new r(this)),this.__OESVertexArrayObject;var e=i.call(this,t);return e||null}}}()),function(){function r(){}f(r,"laya.webgl.text.ArabicReshaper");var t=r.prototype;t.characterMapContains=function(t){for(var e=0;e<r.charsMap.length;++e)if(r.charsMap[e][0]===t)return!0;return!1},t.getCharRep=function(t){for(var e=0;e<r.charsMap.length;++e)if(r.charsMap[e][0]===t)return r.charsMap[e];return!1},t.getCombCharRep=function(t,e){for(var i=0;i<r.combCharsMap.length;++i)if(r.combCharsMap[i][0][0]===t&&r.combCharsMap[i][0][1]===e)return r.combCharsMap[i];return!1},t.isTransparent=function(t){for(var e=0;e<r.transChars.length;++e)if(r.transChars[e]===t)return!0;return!1},t.getOriginalCharsFromCode=function(t){var e=0;for(e=0;e<r.charsMap.length;++e)if(-1<r.charsMap[e].indexOf(t))return String.fromCharCode(r.charsMap[e][0]);for(e=0;e<r.combCharsMap.length;++e)if(-1<r.combCharsMap[e].indexOf(t))return String.fromCharCode(r.combCharsMap[e][0][0])+String.fromCharCode(r.combCharsMap[e][0][1]);return String.fromCharCode(t)},t.convertArabic=function(t){for(var e,i,r="",_=0;_<t.length;++_){var a=t.charCodeAt(_);if(this.characterMapContains(a)){for(var n=null,s=null,o=_-1,h=_+1;0<=o&&this.isTransparent(t.charCodeAt(o));--o);for((!(e=!!(n=0<=o?t.charCodeAt(o):null)&&this.getCharRep(n))||null==e[2]&&null==e[3])&&(n=null);h<t.length&&this.isTransparent(t.charCodeAt(h));++h);if((!(e=!!(s=h<t.length?t.charCodeAt(h):null)&&this.getCharRep(s))||null==e[3]&&null==e[4])&&(s=null),1604===a&&null!=s&&(1570===s||1571===s||1573===s||1575===s)){i=this.getCombCharRep(a,s),r+=null!=n?String.fromCharCode(i[4]):String.fromCharCode(i[1]),++_;continue}if(e=this.getCharRep(a),null!=n&&null!=s&&null!=e[3]){r+=String.fromCharCode(e[3]);continue}if(null!=n&&null!=e[4]){r+=String.fromCharCode(e[4]);continue}if(null!=s&&null!=e[2]){r+=String.fromCharCode(e[2]);continue}r+=String.fromCharCode(e[1])}else r+=String.fromCharCode(a)}return r},t.convertArabicBack=function(t){var e="",i=0,r=0;for(r=0;r<t.length;++r)i=t.charCodeAt(r),e+=this.getOriginalCharsFromCode(i);return e},n(r,["charsMap",function(){return this.charsMap=[[1569,65152,null,null,null],[1570,65153,null,null,65154],[1571,65155,null,null,65156],[1572,65157,null,null,65158],[1573,65159,null,null,65160],[1574,65161,65163,65164,65162],[1575,65165,null,null,65166],[1576,65167,65169,65170,65168],[1577,65171,null,null,65172],[1578,65173,65175,65176,65174],[1579,65177,65179,65180,65178],[1580,65181,65183,65184,65182],[1581,65185,65187,65188,65186],[1582,65189,65191,65192,65190],[1583,65193,null,null,65194],[1584,65195,null,null,65196],[1585,65197,null,null,65198],[1586,65199,null,null,65200],[1587,65201,65203,65204,65202],[1588,65205,65207,65208,65206],[1589,65209,65211,65212,65210],[1590,65213,65215,65216,65214],[1591,65217,65219,65220,65218],[1592,65221,65223,65224,65222],[1593,65225,65227,65228,65226],[1594,65229,65231,65232,65230],[1600,1600,1600,1600,1600],[1601,65233,65235,65236,65234],[1602,65237,65239,65240,65238],[1603,65241,65243,65244,65242],[1604,65245,65247,65248,65246],[1605,65249,65251,65252,65250],[1606,65253,65255,65256,65254],[1607,65257,65259,65260,65258],[1608,65261,null,null,65262],[1609,65263,null,null,65264],[1610,65265,65267,65268,65266],[1662,64342,64344,64345,64343],[1740,64508,64510,64511,64509],[1670,64378,64380,64381,64379],[1705,64398,64400,64401,64399],[1711,64402,64404,64405,64403],[1688,64394,null,null,64395]]},"combCharsMap",function(){return this.combCharsMap=[[[1604,1570],65269,null,null,65270],[[1604,1571],65271,null,null,65272],[[1604,1573],65273,null,null,65274],[[1604,1575],65275,null,null,65276]]},"transChars",function(){return this.transChars=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}])}(),function(){function d(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._pos=null,this._rectNum=0,this._vbSize=0,this.vbBuffer=null}f(d,"laya.layagl.cmdNative.DrawTexturesCmdNative");var t=d.prototype;t.recover=function(){this._texture=null,this._pos=null,L.recover("DrawTexturesCmd",this)},A(0,t,"cmdID",function(){return"DrawTextures"}),A(0,t,"texture",function(){return this._texture},function(t){this._texture=t;for(var e=this._texture.bitmap.width,i=this._texture.bitmap.height,r=this._texture.uv,_=this.vbBuffer._float32Data,a=this.vbBuffer._int32Data,n=0,s=0;s<this._rectNum;s++){var o=this.pos[2*s],h=this.pos[2*s+1];_[n++]=o,_[n++]=h,_[n++]=r[0],_[n++]=r[1],a[n++]=4294967295,a[n++]=4294967295,_[n++]=o+e,_[n++]=h,_[n++]=r[2],_[n++]=r[3],a[n++]=4294967295,a[n++]=4294967295,_[n++]=o+e,_[n++]=h+i,_[n++]=r[4],_[n++]=r[5],a[n++]=4294967295,a[n++]=4294967295,_[n++]=o,_[n++]=h+i,_[n++]=r[6],_[n++]=r[7],a[n++]=4294967295,a[n++]=4294967295}var l=this._paramData._int32Data;l[d._PARAM_TEXLOCATION_POS_]=33984,l[d._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id,j.syncBufferToRenderThread(this.vbBuffer),j.syncBufferToRenderThread(this._paramData)}),A(0,t,"pos",function(){return this._pos},function(t){this._pos=t;var e=this._pos.length/2,i=this._texture.bitmap.width,r=this._texture.bitmap.height,_=this._texture.uv;(!this.vbBuffer||this.vbBuffer.getByteLength()<24*e*4)&&(this.vbBuffer=new ParamData(24*e*4,!0)),this._vbSize=24*e*4,this._rectNum=e;for(var a=this.vbBuffer._float32Data,n=this.vbBuffer._int32Data,s=0,o=0;o<e;o++){var h=this.pos[2*o],l=this.pos[2*o+1];a[s++]=h,a[s++]=l,a[s++]=_[0],a[s++]=_[1],n[s++]=4294967295,n[s++]=4294967295,a[s++]=h+i,a[s++]=l,a[s++]=_[2],a[s++]=_[3],n[s++]=4294967295,n[s++]=4294967295,a[s++]=h+i,a[s++]=l+r,a[s++]=_[4],a[s++]=_[5],n[s++]=4294967295,n[s++]=4294967295,a[s++]=h,a[s++]=l+r,a[s++]=_[6],a[s++]=_[7],n[s++]=4294967295,n[s++]=4294967295}this._paramData._float32Data;var u=this._paramData._int32Data;u[d._PARAM_RECT_NUM_POS_]=this._rectNum,u[d._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),u[d._PARAM_VB_SIZE_POS_]=this._vbSize,j.syncBufferToRenderThread(this.vbBuffer),j.syncBufferToRenderThread(this._paramData)}),d.create=function(t,e){var i=L.getItemByClass("DrawTexturesCmd",d);i._graphicsCmdEncoder=this._commandEncoder,d._DRAW_TEXTURES_CMD_ENCODER_||((d._DRAW_TEXTURES_CMD_ENCODER_=j.instance.createCommandEncoder(124,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),d._DRAW_TEXTURES_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),d._DRAW_TEXTURES_CMD_ENCODER_.useVDO(Nt.VDO_MESHQUADTEXTURE),d._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),d._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),d._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),d._DRAW_TEXTURES_CMD_ENCODER_.uniformTextureByParamData(d._PARAM_UNIFORMLOCATION_POS_,4*d._PARAM_TEXLOCATION_POS_,4*d._PARAM_TEXTURE_POS_),d._DRAW_TEXTURES_CMD_ENCODER_.setRectMeshExByParamData(4*d._PARAM_RECT_NUM_POS_,4*d._PARAM_VB_POS_,4*d._PARAM_VB_SIZE_POS_,4*d._PARAM_VB_OFFSET_POS_),d._DRAW_TEXTURES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),d._DRAW_TEXTURES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(d._DRAW_TEXTURES_CMD_ENCODER_)),i._paramData||(i._paramData=new ParamData(28,!0)),i._texture=t,i._pos=e;var r=t.bitmap.width,_=t.bitmap.height,a=t.uv,n=e.length/2;(!i.vbBuffer||i.vbBuffer.getByteLength()<24*n*4)&&(i.vbBuffer=new ParamData(24*n*4,!0)),i._vbSize=24*n*4,i._rectNum=n;for(var s=i.vbBuffer._float32Data,o=i.vbBuffer._int32Data,h=0,l=0;l<n;l++){var u=e[2*l],c=e[2*l+1];s[h++]=u,s[h++]=c,s[h++]=a[0],s[h++]=a[1],o[h++]=4294967295,o[h++]=4294967295,s[h++]=u+r,s[h++]=c,s[h++]=a[2],s[h++]=a[3],o[h++]=4294967295,o[h++]=4294967295,s[h++]=u+r,s[h++]=c+_,s[h++]=a[4],s[h++]=a[5],o[h++]=4294967295,o[h++]=4294967295,s[h++]=u,s[h++]=c+_,s[h++]=a[6],s[h++]=a[7],o[h++]=4294967295,o[h++]=4294967295}i._paramData._float32Data;var f=i._paramData._int32Data;return f[d._PARAM_UNIFORMLOCATION_POS_]=3,f[d._PARAM_TEXLOCATION_POS_]=33984,f[d._PARAM_TEXTURE_POS_]=t.bitmap._glTexture.id,f[d._PARAM_RECT_NUM_POS_]=i._rectNum,f[d._PARAM_VB_POS_]=i.vbBuffer.getPtrID(),f[d._PARAM_VB_SIZE_POS_]=i._vbSize,f[d._PARAM_VB_OFFSET_POS_]=0,j.syncBufferToRenderThread(i.vbBuffer),j.syncBufferToRenderThread(i._paramData),i._graphicsCmdEncoder.useCommandEncoder(d._DRAW_TEXTURES_CMD_ENCODER_.getPtrID(),i._paramData.getPtrID(),-1),j.syncBufferToRenderThread(i._graphicsCmdEncoder),i},d.ID="DrawTextures",d._DRAW_TEXTURES_CMD_ENCODER_=null,d._PARAM_UNIFORMLOCATION_POS_=0,d._PARAM_TEXLOCATION_POS_=1,d._PARAM_TEXTURE_POS_=2,d._PARAM_RECT_NUM_POS_=3,d._PARAM_VB_POS_=4,d._PARAM_VB_SIZE_POS_=5,d._PARAM_VB_OFFSET_POS_=6}(),function(){function r(){this._saveuse=0}f(r,"laya.webgl.canvas.save.SaveMark");var t=r.prototype;return D.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!0},t.restore=function(t){t._saveMark=this._preSaveMark,r.POOL[r.POOL._length++]=this},r.Create=function(t){var e=r.POOL,i=0<e._length?e[--e._length]:new r;return i._saveuse=0,i._preSaveMark=t._saveMark,t._saveMark=i},r.POOL=z._createArray(),r}()),et=(function(){function y(){this._graphicsCmdEncoder=null,this._paramData=null,this._texture=null,this._x=NaN,this._y=NaN,this._vertices=null,this._uvs=null,this._indices=null,this._matrix=null,this._alpha=NaN,this._color=null,this._blendMode=null,this.vbBuffer=null,this._vbSize=NaN,this.ibBuffer=null,this._ibSize=NaN,this._verticesNum=NaN,this._ibNum=NaN,this._blend_src=0,this._blend_dest=0}f(y,"laya.layagl.cmdNative.DrawTrianglesCmdNative");var t=y.prototype;t.recover=function(){this._texture=null,this._vertices=null,this._uvs=null,this._indices=null,this._matrix=null,L.recover("DrawTrianglesCmd",this)},t._setBlendMode=function(t){switch(t){case"normal":this._blend_src=1,this._blend_dest=771;break;case"add":this._blend_src=1,this._blend_dest=772;break;case"multiply":this._blend_src=774,this._blend_dest=771;break;case"screen":case"light":this._blend_src=1,this._blend_dest=1;break;case"overlay":this._blend_src=1,this._blend_dest=769;break;case"destination-out":this._blend_src=0,this._blend_dest=0;break;case"mask":this._blend_src=0,this._blend_dest=770;break;default:alert("_setBlendMode Unknown type")}},t._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},A(0,t,"vertices",function(){return this._vertices},function(t){this._vertices=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._verticesNum;r++)e[i++]=this._x+t[2*r],e[i++]=this._y+t[2*r+1],i++,i++,i++,i++;j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"cmdID",function(){return"DrawTriangles"}),A(0,t,"matrix",function(){return this._matrix},function(t){this._matrix=t;var e=this._paramData._float32Data;e[y._PARAM_MATRIX_POS_]=t.a,e[y._PARAM_MATRIX_POS_+1]=t.b,e[y._PARAM_MATRIX_POS_+2]=t.c,e[y._PARAM_MATRIX_POS_+3]=t.d,e[y._PARAM_MATRIX_POS_+4]=t.tx,e[y._PARAM_MATRIX_POS_+5]=t.ty,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"texture",function(){return this._texture},function(t){t&&t.url&&(this._texture=t,this._paramData._int32Data[y._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id,j.syncBufferToRenderThread(this._paramData))}),A(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._verticesNum;r++)i++,e[i++]=t+this.vertices[2*r+1],i++,i++,i++,i++;j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._verticesNum;r++)e[i++]=t+this.vertices[2*r],i++,i++,i++,i++,i++;j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"alpha",function(){return this._alpha},function(t){this._alpha=t}),A(0,t,"uvs",function(){return this._uvs},function(t){this._uvs=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._verticesNum;r++)i++,i++,e[i++]=t[2*r],e[i++]=t[2*r+1],i++,i++;j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"indices",function(){return this._indices},function(t){this._indices=t;for(var e=this.ibBuffer._int16Data,i=0,r=0;r<this._ibNum;r++)e[i++]=t[r];j.syncBufferToRenderThread(this.ibBuffer)}),A(0,t,"color",function(){return this._color},function(t){this._color=t}),A(0,t,"blendMode",function(){return this._blendMode},function(t){this._blendMode=t}),y.create=function(t,e,i,r,_,a,n,s,o,h){var l=L.getItemByClass("DrawTrianglesCmd",y);l._graphicsCmdEncoder=this._commandEncoder,y._DRAW_TRIANGLES_CMD_ENCODER_||((y._DRAW_TRIANGLES_CMD_ENCODER_=j.instance.createCommandEncoder(152,32,!0)).save(),y._DRAW_TRIANGLES_CMD_ENCODER_.blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),y._DRAW_TRIANGLES_CMD_ENCODER_.blendFuncByParamData(4*y._PARAM_BLEND_SRC_POS_,4*y._PARAM_BLEND_DEST_POS_),y._DRAW_TRIANGLES_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),y._DRAW_TRIANGLES_CMD_ENCODER_.useVDO(Nt.VDO_MESHQUADTEXTURE),y._DRAW_TRIANGLES_CMD_ENCODER_.setGlobalValueByParamData(Nt.GLOBALVALUE_MATRIX32,7,4*y._PARAM_MATRIX_POS_),y._DRAW_TRIANGLES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),y._DRAW_TRIANGLES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),y._DRAW_TRIANGLES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),y._DRAW_TRIANGLES_CMD_ENCODER_.uniformTextureByParamData(4*y._PARAM_UNIFORMLOCATION_POS_,4*y._PARAM_TEXLOCATION_POS_,4*y._PARAM_TEXTURE_POS_),y._DRAW_TRIANGLES_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_VB_POS_,4*y._PARAM_VB_OFFSET_POS_,4*y._PARAM_VB_SIZE_POS_,4*y._PARAM_IB_POS_,4*y._PARAM_IB_OFFSET_POS_,4*y._PARAM_IB_SIZE_POS_,4*y._PARAM_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_TRIANGLES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_TRIANGLES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),y._DRAW_TRIANGLES_CMD_ENCODER_.restore(),j.syncBufferToRenderThread(y._DRAW_TRIANGLES_CMD_ENCODER_)),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_||((y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_=j.instance.createCommandEncoder(152,32,!0)).save(),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.blendFuncByParamData(4*y._PARAM_BLEND_SRC_POS_,4*y._PARAM_BLEND_DEST_POS_),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.addShaderMacro(Nt.SHADER_MACRO_COLOR_FILTER),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setGlobalValueByParamData(Nt.GLOBALVALUE_COLORFILTER_COLOR,8,4*y._PARAM_FILTER_COLOR_POS_),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setGlobalValueByParamData(Nt.GLOBALVALUE_COLORFILTER_ALPHA,8,4*y._PARAM_FILTER_ALPHA_POS_),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.useVDO(Nt.VDO_MESHQUADTEXTURE),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setGlobalValueByParamData(Nt.GLOBALVALUE_MATRIX32,7,4*y._PARAM_MATRIX_POS_),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformTextureByParamData(4*y._PARAM_UNIFORMLOCATION_POS_,4*y._PARAM_TEXLOCATION_POS_,4*y._PARAM_TEXTURE_POS_),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_VB_POS_,4*y._PARAM_VB_OFFSET_POS_,4*y._PARAM_VB_SIZE_POS_,4*y._PARAM_IB_POS_,4*y._PARAM_IB_OFFSET_POS_,4*y._PARAM_IB_SIZE_POS_,4*y._PARAM_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.restore(),j.syncBufferToRenderThread(y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_)),l._paramData||(l._paramData=new ParamData(152,!0)),l._texture=t,l._x=e,l._y=i,l._vertices=r,l._uvs=_,l._indices=a,l._matrix=n||new S,l._alpha=s,l._color=o,l._blendMode=h;var u=new O,c=U.create(o);u.color(c.arrColor[0],c.arrColor[1],c.arrColor[2],c.arrColor[3]),l._verticesNum=l._vertices.length/2;var f=l._verticesNum;(!l.vbBuffer||l.vbBuffer.getByteLength()<24*f*3)&&(l.vbBuffer=new ParamData(24*f*3,!0)),l._vbSize=24*f*3;var d=l.vbBuffer._float32Data,A=l.vbBuffer._int32Data,E=4294967295;s&&(E=l._mixRGBandAlpha(E,s));for(var m=0,R=0;R<l._verticesNum;R++)d[m++]=e/l._matrix.a+r[2*R],d[m++]=i/l._matrix.d+r[2*R+1],d[m++]=_[2*R],d[m++]=_[2*R+1],A[m++]=E,A[m++]=4294967295;l._ibNum=a.length;var p=l._ibNum;(!l.ibBuffer||l.ibBuffer.getByteLength()<2*p)&&(l.ibBuffer=new ParamData(2*p,!0,!0)),l._ibSize=2*p;for(var T=l.ibBuffer._int16Data,v=0,D=0;D<l._ibNum;D++)T[v++]=a[D];var P=l._paramData._float32Data,C=l._paramData._int32Data;if(C[y._PARAM_UNIFORMLOCATION_POS_]=3,C[y._PARAM_TEXLOCATION_POS_]=33984,C[y._PARAM_TEXTURE_POS_]=t.bitmap._glTexture.id,C[y._PARAM_VB_POS_]=l.vbBuffer.getPtrID(),C[y._PARAM_VB_SIZE_POS_]=l._vbSize,C[y._PARAM_IB_POS_]=l.ibBuffer.getPtrID(),C[y._PARAM_IB_SIZE_POS_]=l._ibSize,C[y._PARAM_VB_OFFSET_POS_]=0,C[y._PARAM_IB_OFFSET_POS_]=0,C[y._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,P[y._PARAM_MATRIX_POS_]=l._matrix.a,P[y._PARAM_MATRIX_POS_+1]=l._matrix.b,P[y._PARAM_MATRIX_POS_+2]=l._matrix.c,P[y._PARAM_MATRIX_POS_+3]=l._matrix.d,P[y._PARAM_MATRIX_POS_+4]=l._matrix.tx,P[y._PARAM_MATRIX_POS_+5]=l._matrix.ty,C[y._PARAM_BLEND_DEST_POS_]=h?(l._setBlendMode(h),C[y._PARAM_BLEND_SRC_POS_]=l._blend_src,l._blend_dest):C[y._PARAM_BLEND_SRC_POS_]=-1,o){m=y._PARAM_FILTER_COLOR_POS_;var g=u._mat;P[m++]=g[0],P[m++]=g[1],P[m++]=g[2],P[m++]=g[3],P[m++]=g[4],P[m++]=g[5],P[m++]=g[6],P[m++]=g[7],P[m++]=g[8],P[m++]=g[9],P[m++]=g[10],P[m++]=g[11],P[m++]=g[12],P[m++]=g[13],P[m++]=g[14],P[m++]=g[15],m=y._PARAM_FILTER_ALPHA_POS_;var M=u._alpha;P[m++]=255*M[0],P[m++]=255*M[1],P[m++]=255*M[2],P[m++]=255*M[3]}return j.syncBufferToRenderThread(l.vbBuffer),j.syncBufferToRenderThread(l.ibBuffer),j.syncBufferToRenderThread(l._paramData),o?l._graphicsCmdEncoder.useCommandEncoder(y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.getPtrID(),l._paramData.getPtrID(),-1):l._graphicsCmdEncoder.useCommandEncoder(y._DRAW_TRIANGLES_CMD_ENCODER_.getPtrID(),l._paramData.getPtrID(),-1),j.syncBufferToRenderThread(l._graphicsCmdEncoder),l},y.ID="DrawTriangles",y._DRAW_TRIANGLES_CMD_ENCODER_=null,y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_=null,y._PARAM_UNIFORMLOCATION_POS_=0,y._PARAM_TEXLOCATION_POS_=1,y._PARAM_TEXTURE_POS_=2,y._PARAM_VB_POS_=3,y._PARAM_VB_SIZE_POS_=4,y._PARAM_IB_POS_=5,y._PARAM_IB_SIZE_POS_=6,y._PARAM_VB_OFFSET_POS_=7,y._PARAM_IB_OFFSET_POS_=8,y._PARAM_INDEX_ELEMENT_OFFSET_POS_=9,y._PARAM_BLEND_SRC_POS_=10,y._PARAM_BLEND_DEST_POS_=11,y._PARAM_MATRIX_POS_=12,y._PARAM_FILTER_COLOR_POS_=18,y._PARAM_FILTER_ALPHA_POS_=34}(),function(){function e(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}f(e,"laya.webgl.shader.ShaderDefinesBase");var t=e.prototype;return t.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},t.addInt=function(t){return this._value|=t,this._value},t.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},t.isDefine=function(t){return(this._value&t)===t},t.getValue=function(){return this._value},t.setValue=function(t){this._value=t},t.toNameDic=function(){var t=this._int2nameMap[this._value];return t||e._toText(this._value,this._int2name,this._int2nameMap)},e._reg=function(t,e,i,r){r[i[t]=e]=t},e._toText=function(t,e,i){var r=i[t];if(r)return r;for(var _={},a=1,n=0;n<32&&!(t<(a=1<<n));n++)if(t&a){var s=e[a];s&&(_[s]="")}return i[t]=_},e._toInt=function(t,e){for(var i=t.split("."),r=0,_=0,a=i.length;_<a;_++){var n=e[i[_]];if(!n)throw new Error("Defines to int err:"+t+"/"+i[_]);r|=n}return r},e}()),it=function(){function i(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}f(i,"laya.webgl.utils.ShaderNode");var t=i.prototype;return t.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},t.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},t.toscript=function(t,e){return this._toscript(t,e,++i.__id)},t._toscript=function(r,_,a){if(this.childs.length<1&&!this.text)return _;_.length;if(this.condition){var t=!!this.condition.call(r);if(2===this.conditionType&&(t=!t),!t)return _}if(this.text&&_.push(this.text),0<this.childs.length&&this.childs.forEach(function(t,e,i){t._toscript(r,_,a)}),0<this.includefiles.length&&0<this.useFuns.length)for(var e,i=0,n=this.includefiles.length;i<n;i++)this.includefiles[i].curUseID!=a&&0<(e=this.includefiles[i].file.getFunsScript(this.useFuns)).length&&(this.includefiles[i].curUseID=a,_[0]=e+_[0]);return _},i.__id=1,i}(),rt=(function(){function y(){this._graphicsCmdEncoder=null,this._graphicsCmdEncoder_lines=null,this._paramData=null,this._x=NaN,this._y=NaN,this._points=null,this._fillColor=null,this._lineColor=null,this._lineWidth=NaN,this._isConvexPolygon=!1,this._vid=0,this._vertNum=0,this._line_vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this.line_ibBuffer=null,this.line_vbBuffer=null,this._ibSize=0,this._vbSize=0,this._line_ibSize=0,this._line_vbSize=0,this._cmdCurrentPos=0,this._linePoints=[],this._line_vbArray=[],this._line_ibArray=[]}f(y,"laya.layagl.cmdNative.DrawPolyCmdNative");var t=y.prototype;t.recover=function(){this._points=null,this._fillColor=null,this._lineColor=null,this._linePoints.length=0,this._line_vbArray.length=0,this._line_ibArray.length=0,L.recover("DrawPolyCmd",this)},A(0,t,"lineColor",function(){return this._lineColor},function(t){if(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=y._DRAW_POLY_LINES_CMD_ENCODER_.getPtrID(),j.syncBufferToRenderThread(this._graphicsCmdEncoder),this._lineColor=t,this._lineColor&&this.line_vbBuffer){for(var e=U.create(this._lineColor).numColor,i=this.line_vbBuffer._int32Data,r=0,_=0;_<this._line_vertNum;_++)r++,r++,i[r++]=e;j.syncBufferToRenderThread(this.line_vbBuffer)}}),A(0,t,"points",function(){return this._points},function(t){this._points=t,this._vertNum=t.length/2;var e=this._vertNum,i=dt.earcut(t,null,2);if(0<i.length){(!this.ibBuffer||this.ibBuffer.getByteLength()<2*i.length)&&(this.ibBuffer=new ParamData(2*i.length,!0,!0)),this._ibSize=2*i.length;for(var r=this.ibBuffer._int16Data,_=0,a=0;a<i.length;a++)r[_++]=i[a]}(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*e*4,!0)),this._vbSize=3*this._vertNum*4;for(var n=U.create(this._fillColor).numColor,s=this.vbBuffer._float32Data,o=this.vbBuffer._int32Data,h=0,l=0;l<this._vertNum;l++)s[h++]=this._points[2*l]+this._x,s[h++]=this._points[2*l+1]+this._y,o[h++]=n;var u=this._paramData._int32Data;if(u[y._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),u[y._PARAM_IB_POS_]=this.ibBuffer.getPtrID(),u[y._PARAM_VB_SIZE_POS_]=this._vbSize,u[y._PARAM_IB_SIZE_POS_]=this._ibSize,j.syncBufferToRenderThread(this.vbBuffer),j.syncBufferToRenderThread(this.ibBuffer),j.syncBufferToRenderThread(this._paramData),this.lineColor){var c;for(this._linePoints.length=0,this._line_ibArray.length=0,l=this._line_vbArray.length=0;l<t.length;l++)this._linePoints.push(t[l]);this._linePoints.push(t[0]),this._linePoints.push(t[1]),yt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,c=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(c-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;var f=this.line_ibBuffer._int16Data;for(a=_=0;a<3*(this._line_vertNum-2);a++)f[_++]=this._line_ibArray[a];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*c*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var d=U.create(this._lineColor).numColor,A=this.line_vbBuffer._float32Data,E=this.line_vbBuffer._int32Data;for(l=h=0;l<this._line_vertNum;l++)A[h++]=this._line_vbArray[2*l]+this._x,A[h++]=this._line_vbArray[2*l+1]+this._y,E[h++]=d;(u=this._paramData._int32Data)[y._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),u[y._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),u[y._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,u[y._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,j.syncBufferToRenderThread(this.line_vbBuffer),j.syncBufferToRenderThread(this.line_ibBuffer)}}),A(0,t,"cmdID",function(){return"DrawPoly"}),A(0,t,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t;for(var e=U.create(this._fillColor).numColor,i=this.vbBuffer._int32Data,r=0,_=0;_<this._vertNum;_++)r++,r++,i[r++]=e;j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)e[i++]=this._points[2*r]+this._x,i++,i++;if(this._lineColor){var _=this.line_vbBuffer._float32Data;for(r=i=0;r<this._line_vertNum;r++)_[i++]=this._line_vbArray[2*r]+this._x,i++,i++;j.syncBufferToRenderThread(this.line_vbBuffer)}j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"isConvexPolygon",function(){return this._isConvexPolygon},function(t){this._isConvexPolygon=t}),A(0,t,"vid",function(){return this._vid},function(t){this._vid=t}),A(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)i++,e[i++]=this._points[2*r+1]+this._y,i++;if(this._lineColor){var _=this.line_vbBuffer._float32Data;for(r=i=0;r<this._line_vertNum;r++)i++,_[i++]=this._line_vbArray[2*r+1]+this._y,i++;j.syncBufferToRenderThread(this.line_vbBuffer)}j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"lineWidth",function(){return this._lineWidth},function(t){this.lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=y._DRAW_POLY_LINES_CMD_ENCODER_.getPtrID(),j.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=t,this._linePoints.length=0,this._line_ibArray.length=0;for(var e=this._line_vbArray.length=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),yt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);var i=this.line_vbBuffer._float32Data,r=0;for(e=0;e<this._line_vertNum;e++)i[r++]=this._line_vbArray[2*e]+this._x,i[r++]=this._line_vbArray[2*e+1]+this._y,r++;j.syncBufferToRenderThread(this.line_vbBuffer)}),y.create=function(t,e,i,r,_,a,n,s){var o=L.getItemByClass("DrawPolyCmd",y);o._graphicsCmdEncoder=this._commandEncoder,y._DRAW_POLY_CMD_ENCODER_||((y._DRAW_POLY_CMD_ENCODER_=j.instance.createCommandEncoder(168,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),y._DRAW_POLY_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWVG),y._DRAW_POLY_CMD_ENCODER_.useVDO(Nt.VDO_MESHVG),y._DRAW_POLY_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),y._DRAW_POLY_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),y._DRAW_POLY_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),y._DRAW_POLY_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_VB_POS_,4*y._PARAM_VB_OFFSET_POS_,4*y._PARAM_VB_SIZE_POS_,4*y._PARAM_IB_POS_,4*y._PARAM_IB_OFFSET_POS_,4*y._PARAM_IB_SIZE_POS_,4*y._PARAM_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_POLY_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_POLY_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(y._DRAW_POLY_CMD_ENCODER_)),y._DRAW_POLY_LINES_CMD_ENCODER_||((y._DRAW_POLY_LINES_CMD_ENCODER_=j.instance.createCommandEncoder(244,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),y._DRAW_POLY_LINES_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWVG),y._DRAW_POLY_LINES_CMD_ENCODER_.useVDO(Nt.VDO_MESHVG),y._DRAW_POLY_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),y._DRAW_POLY_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),y._DRAW_POLY_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),y._DRAW_POLY_LINES_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_VB_POS_,4*y._PARAM_VB_OFFSET_POS_,4*y._PARAM_VB_SIZE_POS_,4*y._PARAM_IB_POS_,4*y._PARAM_IB_OFFSET_POS_,4*y._PARAM_IB_SIZE_POS_,4*y._PARAM_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),y._DRAW_POLY_LINES_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_LINE_VB_POS_,4*y._PARAM_LINE_VB_OFFSET_POS_,4*y._PARAM_LINE_VB_SIZE_POS_,4*y._PARAM_LINE_IB_POS_,4*y._PARAM_LINE_VB_OFFSET_POS_,4*y._PARAM_LINE_IB_SIZE_POS_,4*y._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(y._DRAW_POLY_LINES_CMD_ENCODER_)),o._paramData||(o._paramData=new ParamData(68,!0)),o._x=t,o._y=e,o._points=i,o._fillColor=r,o._lineColor=_,o._lineWidth=a,o._isConvexPolygon=n,o._vertNum=i.length/2;var h=o._vertNum,l=dt.earcut(i,null,2);if(0<l.length){(!o.ibBuffer||o.ibBuffer.getByteLength()<2*l.length)&&(o.ibBuffer=new ParamData(2*l.length,!0,!0)),o._ibSize=2*l.length;for(var u=o.ibBuffer._int16Data,c=0,f=0;f<l.length;f++)u[c++]=l[f]}var d=U.create(r).numColor;(!o.vbBuffer||o.vbBuffer.getByteLength()<3*o._vertNum*4)&&(o.vbBuffer=new ParamData(3*h*4,!0)),o._vbSize=3*o._vertNum*4;for(var A=o.vbBuffer._float32Data,E=o.vbBuffer._int32Data,m=0,R=0;R<o._vertNum;R++)A[m++]=i[2*R]+t,A[m++]=i[2*R+1]+e,E[m++]=d;for(R=0;R<i.length;R++)o._linePoints.push(i[R]);if(o._linePoints.push(i[0]),o._linePoints.push(i[1]),_){yt.createLine2(o._linePoints,o._line_ibArray,a,0,o._line_vbArray,!1),o._line_vertNum=o._linePoints.length;var p=o._line_vertNum;(!o.line_ibBuffer||o.line_ibBuffer.getByteLength()<3*(o._line_vertNum-2)*2)&&(o.line_ibBuffer=new ParamData(3*(p-2)*2,!0,!0)),o._line_ibSize=3*(o._line_vertNum-2)*2;var T=o.line_ibBuffer._int16Data;for(f=c=0;f<3*(o._line_vertNum-2);f++)T[c++]=o._line_ibArray[f];(!o.line_vbBuffer||o.line_vbBuffer.getByteLength()<3*o._line_vertNum*4)&&(o.line_vbBuffer=new ParamData(3*p*4,!0)),o._line_vbSize=3*o._line_vertNum*4;var v=U.create(_),D=v.numColor,P=o.line_vbBuffer._float32Data,C=o.line_vbBuffer._int32Data;for(R=m=0;R<o._line_vertNum;R++)P[m++]=o._line_vbArray[2*R]+t,P[m++]=o._line_vbArray[2*R+1]+e,C[m++]=D}else{o._lineWidth=1;for(yt.createLine2(o._linePoints,o._line_ibArray,o._lineWidth,0,o._line_vbArray,!1),o._line_vertNum=o._linePoints.length,p=o._line_vertNum,(!o.line_ibBuffer||o.line_ibBuffer.getByteLength()<3*(o._line_vertNum-2)*2)&&(o.line_ibBuffer=new ParamData(3*(p-2)*2,!0,!0)),o._line_ibSize=3*(o._line_vertNum-2)*2,T=o.line_ibBuffer._int16Data,f=c=0;f<3*(o._line_vertNum-2);f++)T[c++]=o._line_ibArray[f];for((!o.line_vbBuffer||o.line_vbBuffer.getByteLength()<3*o._line_vertNum*4)&&(o.line_vbBuffer=new ParamData(3*p*4,!0)),o._line_vbSize=3*o._line_vertNum*4,D=(v=U.create("#ffffff")).numColor,P=o.line_vbBuffer._float32Data,C=o.line_vbBuffer._int32Data,R=m=0;R<o._line_vertNum;R++)P[m++]=o._line_vbArray[2*R]+t,P[m++]=o._line_vbArray[2*R+1]+e,C[m++]=D}var g=o._paramData._float32Data,M=o._paramData._int32Data;return M[0]=1,M[1]=32,null==o.ibBuffer?null:(M[y._PARAM_VB_POS_]=o.vbBuffer.getPtrID(),M[y._PARAM_IB_POS_]=o.ibBuffer.getPtrID(),M[y._PARAM_VB_SIZE_POS_]=o._vbSize,M[y._PARAM_IB_SIZE_POS_]=o._ibSize,M[y._PARAM_VB_OFFSET_POS_]=0,M[y._PARAM_IB_OFFSET_POS_]=0,M[y._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,g[y._PARAM_ISCONVEXT_POS_]=n,j.syncBufferToRenderThread(o.vbBuffer),j.syncBufferToRenderThread(o.ibBuffer),M[y._PARAM_LINE_VB_POS_]=o.line_vbBuffer.getPtrID(),M[y._PARAM_LINE_IB_POS_]=o.line_ibBuffer.getPtrID(),M[y._PARAM_LINE_VB_SIZE_POS_]=o._line_vbSize,M[y._PARAM_LINE_IB_SIZE_POS_]=o._line_ibSize,M[y._PARAM_LINE_VB_OFFSET_POS_]=0,M[y._PARAM_LINE_IB_OFFSET_POS_]=0,M[y._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,j.syncBufferToRenderThread(o.line_vbBuffer),j.syncBufferToRenderThread(o.line_ibBuffer),j.syncBufferToRenderThread(o._paramData),o._cmdCurrentPos=_?o._graphicsCmdEncoder.useCommandEncoder(y._DRAW_POLY_LINES_CMD_ENCODER_.getPtrID(),o._paramData.getPtrID(),-1):o._graphicsCmdEncoder.useCommandEncoder(y._DRAW_POLY_CMD_ENCODER_.getPtrID(),o._paramData.getPtrID(),-1),j.syncBufferToRenderThread(o._graphicsCmdEncoder),o)},y.ID="DrawPoly",y._DRAW_POLY_CMD_ENCODER_=null,y._DRAW_POLY_LINES_CMD_ENCODER_=null,y._PARAM_VB_POS_=2,y._PARAM_IB_POS_=3,y._PARAM_VB_SIZE_POS_=4,y._PARAM_IB_SIZE_POS_=5,y._PARAM_LINE_VB_POS_=6,y._PARAM_LINE_IB_POS_=7,y._PARAM_LINE_VB_SIZE_POS_=8,y._PARAM_LINE_IB_SIZE_POS_=9,y._PARAM_ISCONVEXT_POS_=10,y._PARAM_VB_OFFSET_POS_=11,y._PARAM_IB_OFFSET_POS_=12,y._PARAM_LINE_VB_OFFSET_POS_=13,y._PARAM_LINE_IB_OFFSET_POS_=14,y._PARAM_INDEX_ELEMENT_OFFSET_POS_=15,y._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=16}(),function(){function t(){}f(t,"laya.webgl.shader.ShaderValue")}(),function(){function t(){}f(t,"laya.webgl.resource.ICharRender");var e=t.prototype;return e.getWidth=function(t,e){return 0},e.scale=function(t,e){},e.getCharBmp=function(t,e,i,r,_,a,n,s,o,h,l){return null},A(0,e,"canvasWidth",function(){return 0},function(t){}),t}()),_t=function(){function t(){}return f(t,"laya.layagl.LayaGLRunner"),t.uploadShaderUniforms=function(t,e,i,r){for(var _=i._data,a=e.getArrayData(),n=0,s=0,o=a.length;s<o;s++){var h=a[s];if(r||-1!==h.textureID){var l=_[h.dataOffset];null!=l&&(n+=h.fun.call(h.caller,h,l))}}return n},t.uploadCustomUniform=function(t,e,i,r){var _=0,a=e[i];return a&&null!=r&&(_+=a.fun.call(a.caller,a,r)),_},t.uploadShaderUniformsForNative=function(t,e,i){var r=0;0<=i._runtimeCopyValues.length&&(r=1);var _=i._data;return t.uploadShaderUniforms(e,_,r)},t}(),at=function(){function n(t,e,i){this.pages=[],this.fontFamily=null,this._slotW=0,this._gridW=0,this._gridNum=0,this._baseSize=0,this._lastSz=0,this._spaceWidthMap=[],this._minScoreID=-1,this._selectedSizeIdx=0,this.margin_left=0,this.margin_top=0,this.margin_bottom=0,this.margin_right=0,this.gcCnt=0,this._textureWidth=wt.textureWidth,this.fontFamily=t,this.margin_top=this.margin_left=this.margin_right=this.margin_bottom=i,this._baseSize=Math.floor(e/wt.gridSize)*wt.gridSize,this._selectedSizeIdx=e-this._baseSize|0,this._slotW=Math.ceil(e/wt.gridSize)*wt.gridSize,this._gridW=Math.floor(this._textureWidth/this._slotW),this._gridW<=0&&(console.error("文字太大,需要修改texture大小"),this._gridW=1),this._gridNum=this._gridW*this._gridW,console.log("gridInfo:slotW="+this._slotW+",gridw="+this._gridW+",gridNum="+this._gridNum+",textureW="+this._textureWidth)}f(n,"laya.webgl.resource.CharPages");var t=n.prototype;return t.getWidth=function(t){return n.charRender.getWidth(wt._curFont,t)},t.selectSize=function(t,e){this._selectedSizeIdx=e-this._baseSize|0},t.getSpaceChar=function(t){if(this._spaceWidthMap[this._selectedSizeIdx])return this._spaceWidthMap[this._selectedSizeIdx];var e=new ht;return(this._spaceWidthMap[this._selectedSizeIdx]=e).width=this.getWidth(" "),e.isSpace=!0,e},t.getChar=function(t,e,i,r,_,a,n,s){if(" "===t)return this.getSpaceChar(n);var o,h=0<e?t+"_"+e+_:t;h+=r,a&&(h+="B"),s&&(h+=s);for(var l=0,u=this.pages.length;l<u;l++){var c=this.pages[l].charMaps[this._selectedSizeIdx];if(c&&(o=c.get(h)))return n&&o.touch(),o}if(!(o=this._getASlot()))return null;var f=o.tex.charMaps[this._selectedSizeIdx];!f&&(f=o.tex.charMaps[this._selectedSizeIdx]=new Map),f.set(h,o),n&&o.touch(),o.height=i;var d=this.getCharBmp(t,wt._curFont,e,r,_,o),A=Math.floor(o.pos/this._gridW),E=o.pos%this._gridW*this._slotW,m=A*this._slotW,R=this._textureWidth,p=E/R,T=m/R,v=(E+d.width)/R,D=(m+d.height)/R,P=o.uv;return P[0]=p,P[1]=T,P[2]=v,P[3]=T,P[4]=v,P[5]=D,P[6]=p,P[7]=D,o.tex.addChar(d,E,m),o},t._getASlot=function(){for(var t,e,i=this.pages.length,r=0;r<i;r++)if(e=(t=this.pages[r]).findAGrid())return e;return t=wt.trash.getAPage(this._gridNum),this.pages.push(t),(e=t.findAGrid())||console.error("_getASlot error!"),e},t.getAllPageScore=function(){for(var t=0,e=this.pages.length,i=I.loopCount,r=0,_=1e4;t<e;t++){var a=this.pages[t];a._scoreTick==i?r+=a._score:a._score=0,a._score<_&&(_=a._score,this._minScoreID=t)}return r},t.removeLRU=function(){if(this._gridNum*this.pages.length-this.getAllPageScore()>=this._gridNum){if(0<=this._minScoreID){var t=this.pages[this._minScoreID];console.log("remove fontpage: delpageid="+this._minScoreID+", total="+this.pages.length+",gcCnt:"+(this.gcCnt+1));var e=t._score;t.printDebugInfo(),wt.trash.discardPage(t),this.pages[this._minScoreID]=this.pages[this.pages.length-1],this.pages.pop();for(var i=I.loopCount,r=0,_=this.pages.length;r<_&&0<e;r++){t=this.pages[r],console.log("clean page "+r),e-=t.removeOld(i)}}return this.gcCnt++,!0}return!1},t.getCharBmp=function(t,e,i,r,_,a){return n.charRender.getCharBmp(t,e,i,r,_,a,this.margin_left,this.margin_top,this.margin_right,this.margin_bottom)},t.printPagesInfo=function(){console.log("拥有页数: ",this.pages.length),console.log("基本大小:",this._baseSize),console.log("格子宽度:",this._slotW),console.log("每行格子数:",this._gridW),console.log("贴图大小:",this._textureWidth),console.log("    边界:",this.margin_left,this.margin_top),console.log("得分最少页:",this._minScoreID),console.log("  GC次数:",this.gcCnt),console.log(" -------页信息-------"),this.pages.forEach(function(t){t.printDebugInfo(!0)}),console.log(" -----页信息结束-------")},n.getBmpSize=function(t){return 1.5*t},n.charRender=null,n}(),nt=(function(){function l(){this._graphicsCmdEncoder=null,this._paramData=null,this._paramID=null,this._x=NaN,this._y=NaN,this._radius=NaN,this._startAngle=NaN,this._endAngle=NaN,this._fillColor=null,this._lineColor=null,this._lineWidth=NaN,this._vertNum=0,this._line_vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this.line_ibBuffer=null,this.line_vbBuffer=null,this._ibSize=0,this._vbSize=0,this._line_ibSize=0,this._line_vbSize=0,this._cmdCurrentPos=0,this._points=[],this._linePoints=[],this._line_vbArray=[],this._line_ibArray=[]}f(l,"laya.layagl.cmdNative.DrawPieCmdNative");var t=l.prototype;t._arc=function(t,e,i,r,_,a,n){void 0===a&&(a=!1),void 0===n&&(n=!0);var s=[];s.push(0),s.push(0);var o,h=0,l=0,u=0,c=0,f=0,d=0,A=0,E=0;if(l=_-r,a)if(Math.abs(l)>=2*Math.PI)l=2*-Math.PI;else for(;0<l;)l-=2*Math.PI;else if(Math.abs(l)>=2*Math.PI)l=2*Math.PI;else for(;l<0;)l+=2*Math.PI;o=l/(E=i<101?Math.max(10,l*i/5):i<201?Math.max(10,l*i/20):Math.max(10,l*i/40))/2,u=Math.abs(4/3*(1-Math.cos(o))/Math.sin(o)),a&&(u=-u);var m=0,R=0;for(A=0;A<=E;A++)h=r+l*(A/E),c=Math.cos(h),d=e+Math.sin(h)*i,(f=t+c*i)==m&&d==R||(s.push(f),s.push(d)),m=f,R=d;return c=Math.cos(_),d=e+Math.sin(_)*i,(f=t+c*i)==m&&d==R||(s.push(f),s.push(d)),s},t._setData=function(t,e,i,r,_,a){this._vertNum=r.length/2;var n=this._vertNum,s=this._vertNum-2;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*s*2)&&(this.ibBuffer=new ParamData(3*s*2,!0,!0)),this._ibSize=3*s*2;for(var o=this.ibBuffer._int16Data,h=0,l=0;l<s;l++)o[h++]=0,o[h++]=l+1+0,o[h++]=l+2+0;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*n*4,!0)),this._vbSize=3*this._vertNum*4;for(var u=U.create(i).numColor,c=this.vbBuffer._float32Data,f=this.vbBuffer._int32Data,d=0,A=0;A<this._vertNum;A++)c[d++]=r[2*A]+t,c[d++]=r[2*A+1]+e,f[d++]=u;var E=0;for(this._linePoints.length=0,this._line_ibArray.length=0,A=this._line_vbArray.length=0;A<r.length;A++)this._linePoints.push(r[A]);if(this._linePoints.push(r[0]),this._linePoints.push(r[1]),_){yt.createLine2(this._linePoints,this._line_ibArray,a,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,E=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(E-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var m=this.line_ibBuffer._int16Data,R=h=0;R<3*(this._line_vertNum-2);R++)m[h++]=this._line_ibArray[R];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*E*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var p=U.create(_),T=p.numColor,v=this.line_vbBuffer._float32Data,D=this.line_vbBuffer._int32Data;for(A=d=0;A<this._line_vertNum;A++)v[d++]=this._line_vbArray[2*A]+this._x,v[d++]=this._line_vbArray[2*A+1]+this._y,D[d++]=T}else{this._lineWidth=1;for(yt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,E=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(E-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2,m=this.line_ibBuffer._int16Data,R=h=0;R<3*(this._line_vertNum-2);R++)m[h++]=this._line_ibArray[R];for((!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*E*4,!0)),this._line_vbSize=3*this._line_vertNum*4,T=(p=U.create("#FFFFFF")).numColor,v=this.line_vbBuffer._float32Data,D=this.line_vbBuffer._int32Data,A=d=0;A<this._line_vertNum;A++)v[d++]=this._line_vbArray[2*A]+this._x,v[d++]=this._line_vbArray[2*A+1]+this._y,D[d++]=T}},t._saveToParamData=function(){this._paramData._float32Data;var t=this._paramData._int32Data;t[0]=1,t[1]=32,t[l._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),t[l._PARAM_IB_POS_]=this.ibBuffer.getPtrID(),t[l._PARAM_VB_SIZE_POS_]=this._vbSize,t[l._PARAM_IB_SIZE_POS_]=this._ibSize,t[l._PARAM_VB_OFFSET_POS_]=0,t[l._PARAM_IB_OFFSET_POS_]=0,t[l._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,j.syncBufferToRenderThread(this.vbBuffer),j.syncBufferToRenderThread(this.ibBuffer),t[l._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),t[l._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),t[l._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,t[l._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,t[l._PARAM_LINE_VB_OFFSET_POS_]=0,t[l._PARAM_LINE_IB_OFFSET_POS_]=0,t[l._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,j.syncBufferToRenderThread(this.line_vbBuffer),j.syncBufferToRenderThread(this.line_ibBuffer)},t.recover=function(){this._fillColor=null,this._lineColor=null,this._points.length=0,this._linePoints.length=0,this._line_vbArray.length=0,this._line_ibArray.length=0,L.recover("DrawPieCmd",this)},A(0,t,"lineColor",function(){return this._lineColor},function(t){!this._lineColor&&this._lineWidth&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=l._DRAW_PIE_LINES_CMD_ENCODER_.getPtrID(),j.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineColor=t,this._linePoints.length=0,this._line_ibArray.length=0;for(var e=this._line_vbArray.length=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),yt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var i=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var r=this.line_ibBuffer._int16Data,_=0,a=0;a<3*(this._line_vertNum-2);a++)r[_++]=this._line_ibArray[a];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*i*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var n=U.create(t).numColor,s=this.line_vbBuffer._float32Data,o=this.line_vbBuffer._int32Data,h=0;for(e=0;e<this._line_vertNum;e++)s[h++]=this._line_vbArray[2*e]+this._x,s[h++]=this._line_vbArray[2*e+1]+this._y,o[h++]=n;j.syncBufferToRenderThread(this.line_ibBuffer),j.syncBufferToRenderThread(this.line_vbBuffer)}),A(0,t,"startAngle",function(){return 180*this._startAngle/Math.PI},function(t){this._startAngle=t*Math.PI/180,this._points=this._arc(0,0,this._radius,t*Math.PI/180,this._endAngle),this._setData(this._x,this._y,this._fillColor,this._points,this._lineColor,this._lineWidth),this._saveToParamData(),j.syncBufferToRenderThread(this._paramData)}),A(0,t,"cmdID",function(){return"DrawPie"}),A(0,t,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t;for(var e=U.create(this._fillColor).numColor,i=this.vbBuffer._int32Data,r=0,_=0;_<this._vertNum;_++)r++,r++,i[r++]=e;j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)e[i++]=this._points[2*r]+this._x,i++,i++;if(this._lineColor){var _=this.line_vbBuffer._float32Data;for(r=i=0;r<this._line_vertNum;r++)_[i++]=this._line_vbArray[2*r]+this._x,i++,i++;j.syncBufferToRenderThread(this.line_vbBuffer)}j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)i++,e[i++]=this._points[2*r+1]+this._y,i++;if(this._lineColor){var _=this.line_vbBuffer._float32Data;for(r=i=0;r<this._line_vertNum;r++)i++,_[i++]=this._line_vbArray[2*r+1]+this._y,i++;j.syncBufferToRenderThread(this.line_vbBuffer)}j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"radius",function(){return this._radius},function(t){this._points=this._arc(0,0,t,this._startAngle,this._endAngle),this._setData(this._x,this._y,this._fillColor,this._points,this._lineColor,this._lineWidth),this._saveToParamData(),j.syncBufferToRenderThread(this._paramData)}),A(0,t,"endAngle",function(){return 180*this._endAngle/Math.PI},function(t){this._endAngle=t*Math.PI/180,this._points=this._arc(0,0,this._radius,this._startAngle,t*Math.PI/180),this._setData(this._x,this._y,this._fillColor,this._points,this._lineColor,this._lineWidth),this._saveToParamData(),j.syncBufferToRenderThread(this._paramData)}),A(0,t,"lineWidth",function(){return this._lineWidth},function(t){this.lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=l._DRAW_PIE_LINES_CMD_ENCODER_.getPtrID(),j.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=t,this._linePoints.length=0,this._line_ibArray.length=0;for(var e=this._line_vbArray.length=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),yt.createLine2(this._linePoints,this._line_ibArray,t,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var i=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var r=this.line_ibBuffer._int16Data,_=0,a=0;a<3*(this._line_vertNum-2);a++)r[_++]=this._line_ibArray[a];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*i*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var n=U.create(this.lineColor).numColor,s=this.line_vbBuffer._float32Data,o=this.line_vbBuffer._int32Data,h=0;for(e=0;e<this._line_vertNum;e++)s[h++]=this._line_vbArray[2*e]+this._x,s[h++]=this._line_vbArray[2*e+1]+this._y,o[h++]=n;j.syncBufferToRenderThread(this.line_ibBuffer),j.syncBufferToRenderThread(this.line_vbBuffer)}),l.create=function(t,e,i,r,_,a,n,s,o){var h=L.getItemByClass("DrawPieCmd",l);return h._graphicsCmdEncoder=this._commandEncoder,l._DRAW_PIE_LINES_CMD_ENCODER_||((l._DRAW_PIE_LINES_CMD_ENCODER_=j.instance.createCommandEncoder(244,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),l._DRAW_PIE_LINES_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWVG),l._DRAW_PIE_LINES_CMD_ENCODER_.useVDO(Nt.VDO_MESHVG),l._DRAW_PIE_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),l._DRAW_PIE_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),l._DRAW_PIE_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),l._DRAW_PIE_LINES_CMD_ENCODER_.setMeshExByParamData(4*l._PARAM_VB_POS_,4*l._PARAM_VB_OFFSET_POS_,4*l._PARAM_VB_SIZE_POS_,4*l._PARAM_IB_POS_,4*l._PARAM_IB_OFFSET_POS_,4*l._PARAM_IB_SIZE_POS_,4*l._PARAM_INDEX_ELEMENT_OFFSET_POS_),l._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),l._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),l._DRAW_PIE_LINES_CMD_ENCODER_.setMeshExByParamData(4*l._PARAM_LINE_VB_POS_,4*l._PARAM_LINE_VB_OFFSET_POS_,4*l._PARAM_LINE_VB_SIZE_POS_,4*l._PARAM_LINE_IB_POS_,4*l._PARAM_LINE_IB_OFFSET_POS_,4*l._PARAM_LINE_IB_SIZE_POS_,4*l._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),l._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),l._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(l._DRAW_PIE_LINES_CMD_ENCODER_)),l._DRAW_PIE_CMD_ENCODER_||((l._DRAW_PIE_CMD_ENCODER_=j.instance.createCommandEncoder(168,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),l._DRAW_PIE_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWVG),l._DRAW_PIE_CMD_ENCODER_.useVDO(Nt.VDO_MESHVG),l._DRAW_PIE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),l._DRAW_PIE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),l._DRAW_PIE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),l._DRAW_PIE_CMD_ENCODER_.setMeshExByParamData(4*l._PARAM_VB_POS_,4*l._PARAM_VB_OFFSET_POS_,4*l._PARAM_VB_SIZE_POS_,4*l._PARAM_IB_POS_,4*l._PARAM_IB_OFFSET_POS_,4*l._PARAM_IB_SIZE_POS_,4*l._PARAM_INDEX_ELEMENT_OFFSET_POS_),l._DRAW_PIE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),l._DRAW_PIE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(l._DRAW_PIE_CMD_ENCODER_)),h._paramData||(h._paramData=new ParamData(64,!0)),h._x=t,h._y=e,h._radius=i,h._startAngle=r,h._endAngle=_,h._fillColor=a,h._lineColor=n,h._lineWidth=s,h._points=h._arc(0,0,i,r,_),h._setData(t,e,a,h._points,n,s),h._saveToParamData(),j.syncBufferToRenderThread(h._paramData),h._cmdCurrentPos=n?h._graphicsCmdEncoder.useCommandEncoder(l._DRAW_PIE_LINES_CMD_ENCODER_.getPtrID(),h._paramData.getPtrID(),-1):h._graphicsCmdEncoder.useCommandEncoder(l._DRAW_PIE_CMD_ENCODER_.getPtrID(),h._paramData.getPtrID(),-1),j.syncBufferToRenderThread(h._graphicsCmdEncoder),h},l.ID="DrawPie",l._DRAW_PIE_CMD_ENCODER_=null,l._DRAW_PIE_LINES_CMD_ENCODER_=null,l._PARAM_VB_POS_=2,l._PARAM_IB_POS_=3,l._PARAM_LINE_VB_POS_=4,l._PARAM_LINE_IB_POS_=5,l._PARAM_VB_SIZE_POS_=6,l._PARAM_IB_SIZE_POS_=7,l._PARAM_LINE_VB_SIZE_POS_=8,l._PARAM_LINE_IB_SIZE_POS_=9,l._PARAM_VB_OFFSET_POS_=10,l._PARAM_IB_OFFSET_POS_=11,l._PARAM_LINE_VB_OFFSET_POS_=12,l._PARAM_LINE_IB_OFFSET_POS_=13,l._PARAM_INDEX_ELEMENT_OFFSET_POS_=14,l._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=15}(),function(){function t(){this._nativeVertexArrayObject=null,this._bindedIndexBuffer=null,this._nativeVertexArrayObject=j.instance.createVertexArray()}f(t,"laya.webgl.BufferStateBase");var e=t.prototype;return e.bind=function(){t._curBindedBufferState!==this&&(j.instance.bindVertexArray(this._nativeVertexArrayObject),t._curBindedBufferState=this)},e.unBind=function(){if(t._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";j.instance.bindVertexArray(null),t._curBindedBufferState=null},e.bindForNative=function(){j.instance.bindVertexArray(this._nativeVertexArrayObject),t._curBindedBufferState=this},e.unBindForNative=function(){j.instance.bindVertexArray(null),t._curBindedBufferState=null},e.destroy=function(){j.instance.deleteVertexArray(this._nativeVertexArrayObject)},t._curBindedBufferState=null,t}()),st=(function(){function m(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._x=NaN,this._y=NaN,this._width=NaN,this._height=NaN,this._fillColor=null,this._lineColor=null,this._lineWidth=NaN,this._line_vertNum=0,this._cmdCurrentPos=0,this._linePoints=[],this._line_ibArray=[],this._line_vbArray=[]}f(m,"laya.layagl.cmdNative.DrawRectCmdNative");var t=m.prototype;t.recover=function(){this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0,this._graphicsCmdEncoder=null,L.recover("DrawRectCmd",this)},A(0,t,"lineColor",function(){return this._lineColor},function(t){this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=m._DRAW_RECT_LINE_CMD_ENCODER_.getPtrID(),j.syncBufferToRenderThread(this._graphicsCmdEncoder),this._lineColor=t;for(var e=this._paramData._int32Data,i=U.create(t).numColor,r=m._PARAM_LINE_VB_POS_,_=0;_<this._line_vertNum;_++)r++,r++,e[r++]=i;j.syncBufferToRenderThread(this._paramData)}),A(0,t,"cmdID",function(){return"DrawRect"}),A(0,t,"fillColor",function(){return this._fillColor},function(t){if("string"==typeof(this._fillColor=t)){var e=U.create(this._fillColor).numColor,i=this._paramData._int32Data;i[m._PARAM_VB_POS_+4]=e,i[m._PARAM_VB_POS_+10]=e,i[m._PARAM_VB_POS_+16]=e,i[m._PARAM_VB_POS_+22]=e}else(i=this._paramData._int32Data)[m._PARAM_VB_POS_+4]=t,i[m._PARAM_VB_POS_+10]=t,i[m._PARAM_VB_POS_+16]=t,i[m._PARAM_VB_POS_+22]=t;j.syncBufferToRenderThread(this._paramData)}),A(0,t,"width",function(){return this._width},function(t){this._width=t;var e=this._paramData._float32Data;if(e[m._PARAM_VB_POS_+6]=this._x+this._width,e[m._PARAM_VB_POS_+12]=this._x+this._width,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[2]=this._x+this._width,this._linePoints[4]=this._x+this._width,yt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;for(var i=m._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)e[i++]=this._line_vbArray[2*r],e[i++]=this._line_vbArray[2*r+1],i++}j.syncBufferToRenderThread(this._paramData)}),A(0,t,"x",function(){return this._x},function(t){this._x=t;var e=this._paramData._float32Data;if(e[m._PARAM_VB_POS_]=this._x,e[m._PARAM_VB_POS_+6]=this._x+this._width,e[m._PARAM_VB_POS_+12]=this._x+this._width,e[m._PARAM_VB_POS_+18]=this._x,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[0]=this._x,this._linePoints[2]=this._x+this._width,this._linePoints[4]=this._x+this._width,this._linePoints[6]=this._x,this._linePoints[8]=this._x,yt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var i=m._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)e[i++]=this._line_vbArray[2*r],e[i++]=this._line_vbArray[2*r+1],i++}j.syncBufferToRenderThread(this._paramData)}),A(0,t,"y",function(){return this._y},function(t){this._y=t;var e=this._paramData._float32Data;if(e[m._PARAM_VB_POS_+1]=this._y,e[m._PARAM_VB_POS_+7]=this._y,e[m._PARAM_VB_POS_+13]=this._y+this._height,e[m._PARAM_VB_POS_+19]=this._y+this._height,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[1]=this._y,this._linePoints[3]=this._y,this._linePoints[5]=this._y+this._height,this._linePoints[7]=this._y+this._height,this._linePoints[9]=this._y-this._lineWidth/2,yt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var i=m._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)e[i++]=this._line_vbArray[2*r],e[i++]=this._line_vbArray[2*r+1],i++}j.syncBufferToRenderThread(this._paramData)}),A(0,t,"height",function(){return this._height},function(t){this._height=t;var e=this._paramData._float32Data;if(e[m._PARAM_VB_POS_+13]=this._y+this._height,e[m._PARAM_VB_POS_+19]=this._y+this._height,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[5]=this._y+this._height,this._linePoints[7]=this._y+this._height,yt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var i=m._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)e[i++]=this._line_vbArray[2*r],e[i++]=this._line_vbArray[2*r+1],i++}j.syncBufferToRenderThread(this._paramData)}),A(0,t,"lineWidth",function(){return this._lineWidth},function(t){this.lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=m._DRAW_RECT_LINE_CMD_ENCODER_.getPtrID(),j.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=t,this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[9]=this._y-this._lineWidth/2,yt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;for(var e=this._paramData._float32Data,i=m._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)e[i++]=this._line_vbArray[2*r],e[i++]=this._line_vbArray[2*r+1],i++;j.syncBufferToRenderThread(this._paramData)}),m.create=function(t,e,i,r,_,a,n){var s=L.getItemByClass("DrawRectCmd",m);s._graphicsCmdEncoder=this._commandEncoder,m._DRAW_RECT_LINE_CMD_ENCODER_||((m._DRAW_RECT_LINE_CMD_ENCODER_=j.instance.createCommandEncoder(300,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),m._DRAW_RECT_LINE_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),m._DRAW_RECT_LINE_CMD_ENCODER_.useVDO(Nt.VDO_MESHQUADTEXTURE),m._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),m._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),m._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),m._DRAW_RECT_LINE_CMD_ENCODER_.setRectMeshByParamData(4*m._PARAM_RECT_NUM_POS_,4*m._PARAM_VB_POS_,4*m._PARAM_VB_SIZE_POS_),m._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),m._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),m._DRAW_RECT_LINE_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWVG),m._DRAW_RECT_LINE_CMD_ENCODER_.useVDO(Nt.VDO_MESHVG),m._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),m._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),m._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),m._DRAW_RECT_LINE_CMD_ENCODER_.setMeshByParamData(4*m._PARAM_LINE_VB_POS_,4*m._PARAM_LINE_VB_OFFSET_POS_,4*m._PARAM_LINE_VB_SIZE_POS_,4*m._PARAM_LINE_IB_POS_,4*m._PARAM_LINE_IB_OFFSET_POS_,4*m._PARAM_LINE_IB_SIZE_POS_,4*m._PARAM_LINE_IBELEMENT_OFFSET_POS_),m._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),m._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(m._DRAW_RECT_LINE_CMD_ENCODER_)),m._DRAW_RECT_CMD_ENCODER_||((m._DRAW_RECT_CMD_ENCODER_=j.instance.createCommandEncoder(152,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),m._DRAW_RECT_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),m._DRAW_RECT_CMD_ENCODER_.useVDO(Nt.VDO_MESHQUADTEXTURE),m._DRAW_RECT_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),m._DRAW_RECT_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),m._DRAW_RECT_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),m._DRAW_RECT_CMD_ENCODER_.setRectMeshByParamData(4*m._PARAM_RECT_NUM_POS_,4*m._PARAM_VB_POS_,4*m._PARAM_VB_SIZE_POS_),m._DRAW_RECT_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),m._DRAW_RECT_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(m._DRAW_RECT_CMD_ENCODER_)),s._paramData||(s._paramData=new ParamData(292,!0)),s._x=t,s._y=e,s._width=i,s._height=r,s._fillColor=_,s._lineColor=a,s._lineWidth=n;var o=U.create(_).numColor,h=s._paramData._float32Data,l=s._paramData._int32Data;l[m._PARAM_RECT_NUM_POS_]=1,l[m._PARAM_VB_SIZE_POS_]=96;var u=m._PARAM_VB_POS_;if(h[u++]=t,h[u++]=e,h[u++]=0,h[u++]=0,l[u++]=o,h[u++]=4294967295,h[u++]=t+i,h[u++]=e,h[u++]=0,h[u++]=0,l[u++]=o,h[u++]=4294967295,h[u++]=t+i,h[u++]=e+r,h[u++]=0,h[u++]=0,l[u++]=o,h[u++]=4294967295,h[u++]=t,h[u++]=e+r,h[u++]=0,h[u++]=0,l[u++]=o,h[u++]=4294967295,s._linePoints.push(t),s._linePoints.push(e),s._linePoints.push(t+i),s._linePoints.push(e),s._linePoints.push(t+i),s._linePoints.push(e+r),s._linePoints.push(t),s._linePoints.push(e+r),s._linePoints.push(t),s._linePoints.push(e-n/2),a){yt.createLine2(s._linePoints,s._line_ibArray,n,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,l[m._PARAM_LINE_VB_SIZE_POS_]=120;var c=U.create(a),f=c.numColor;u=m._PARAM_LINE_VB_POS_;for(var d=0;d<s._line_vertNum;d++)h[u++]=s._line_vbArray[2*d],h[u++]=s._line_vbArray[2*d+1],l[u++]=f;l[m._PARAM_LINE_IB_SIZE_POS_]=2*s._line_ibArray.length;var A=s._paramData._int16Data;u=2*m._PARAM_LINE_IB_POS_;for(var E=0;E<s._line_ibArray.length;E++)A[u++]=s._line_ibArray[E]}else{s._lineWidth=1;for(yt.createLine2(s._linePoints,s._line_ibArray,s._lineWidth,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,l[m._PARAM_LINE_VB_SIZE_POS_]=120,f=(c=U.create("#ffffff")).numColor,u=m._PARAM_LINE_VB_POS_,d=0;d<s._line_vertNum;d++)h[u++]=s._line_vbArray[2*d],h[u++]=s._line_vbArray[2*d+1],l[u++]=f;for(l[m._PARAM_LINE_IB_SIZE_POS_]=2*s._line_ibArray.length,A=s._paramData._int16Data,u=2*m._PARAM_LINE_IB_POS_,E=0;E<s._line_ibArray.length;E++)A[u++]=s._line_ibArray[E]}return l[m._PARAM_LINE_VB_OFFSET_POS_]=0,l[m._PARAM_LINE_IB_OFFSET_POS_]=0,l[m._PARAM_LINE_IBELEMENT_OFFSET_POS_]=0,j.syncBufferToRenderThread(s._paramData),s._cmdCurrentPos=a?s._graphicsCmdEncoder.useCommandEncoder(m._DRAW_RECT_LINE_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1):s._graphicsCmdEncoder.useCommandEncoder(m._DRAW_RECT_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1),j.syncBufferToRenderThread(s._graphicsCmdEncoder),s},m.ID="DrawRect",m._DRAW_RECT_CMD_ENCODER_=null,m._DRAW_RECT_LINE_CMD_ENCODER_=null,m._PARAM_RECT_NUM_POS_=0,m._PARAM_VB_SIZE_POS_=1,m._PARAM_VB_POS_=2,m._PARAM_LINE_VB_SIZE_POS_=26,m._PARAM_LINE_VB_POS_=27,m._PARAM_LINE_IB_SIZE_POS_=57,m._PARAM_LINE_IB_POS_=58,m._PARAM_LINE_VB_OFFSET_POS_=70,m._PARAM_LINE_IB_OFFSET_POS_=71,m._PARAM_LINE_IBELEMENT_OFFSET_POS_=72}(),function(){function R(t,e,i,r){var _=this;function a(t){var e=[],i=new it(e);return _._compileToTree(i,t.split("\n"),0,e,r),i}var n=s.now();this._VS=a(t),this._PS=a(e),this._nameMap=i,2<s.now()-n&&console.log("ShaderCompile use time:"+(s.now()-n)+"  size:"+t.length+"/"+e.length)}f(R,"laya.webgl.utils.ShaderCompile");var t=R.prototype;return t._compileToTree=function(t,e,i,r,_){var a,n,s,o,h,l,u,c=0,f=0,d=0,A=0;for(f=i;f<e.length;f++)if(!((s=e[f]).length<1)&&0!==(c=s.indexOf("//"))){if(0<=c&&(s=s.substr(0,c)),a=u||new it(r),u=null,a.text=s,a.noCompile=!0,0<=(c=s.indexOf("#"))){for(o="#",A=c+1,d=s.length;A<d;A++){var E=s.charAt(A);if(" "===E||"\t"===E||"?"===E)break;o+=E}switch(a.name=o){case"#ifdef":case"#ifndef":if(a.src=s,a.noCompile=null!=s.match(/[!&|()=<>]/),a.noCompile?console.log("function():Boolean{return "+s.substr(c+a.name.length)+"}"):(l=s.replace(/^\s*/,"").split(/\s+/),a.setCondition(l[1],"#ifdef"===o?1:2),a.text="//"+a.text),a.setParent(t),t=a,_)for(l=s.substr(A).split(R._splitToWordExps3),A=0;A<l.length;A++)(s=l[A]).length&&(_[s]=!0);continue;case"#if":if(a.src=s,a.noCompile=!0,a.setParent(t),t=a,_)for(l=s.substr(A).split(R._splitToWordExps3),A=0;A<l.length;A++)(s=l[A]).length&&"defined"!=s&&(_[s]=!0);continue;case"#else":a.src=s,n=(t=t.parent).childs[t.childs.length-1],a.noCompile=n.noCompile,a.noCompile||(a.condition=n.condition,a.conditionType=1==n.conditionType?2:1,a.text="//"+a.text+" "+n.text+" "+a.conditionType),a.setParent(t),t=a;continue;case"#endif":n=(t=t.parent).childs[t.childs.length-1],a.noCompile=n.noCompile,a.noCompile||(a.text="//"+a.text),a.setParent(t);continue;case"#include":l=R.splitToWords(s,null);var m=R.includes[l[1]];if(!m)throw"ShaderCompile error no this include file:"+l[1];if((c=l[0].indexOf("?"))<0){a.setParent(t),s=m.getWith("with"==l[2]?l[3]:null),this._compileToTree(a,s.split("\n"),0,r,_),a.text="";continue}a.setCondition(l[0].substr(c+1),1),a.text=m.getWith("with"==l[2]?l[3]:null);break;case"#import":h=(l=R.splitToWords(s,null))[1],r.push({node:a,file:R.includes[h],ofs:a.text.length});continue}}else{if((n=t.childs[t.childs.length-1])&&!n.name){0<r.length&&R.splitToWords(s,n),u=a,n.text+="\n"+s;continue}0<r.length&&R.splitToWords(s,a)}a.setParent(t)}},t.createShader=function(t,e,i,r){var _={},a="";if(t)for(var n in t)a+="#define "+n+"\n",_[n]=!0;var s=this._VS.toscript(_,[]),o=this._PS.toscript(_,[]);return(i||he.create)(a+s.join("\n"),a+o.join("\n"),e,this._nameMap,r)},R._parseOne=function(t,e,i,r,_,a){var n={type:R.shaderParamsMap[i[r+1]],name:i[r+2],size:isNaN(parseInt(i[r+3]))?1:parseInt(i[r+3])};return a&&("attribute"==_?t.push(n):e.push(n)),":"==i[r+3]&&(n.type=i[r+4],r+=2),r+=2},R.addInclude=function(t,e){if(!e||0===e.length)throw new Error("add shader include file err:"+t);if(R.includes[t])throw new Error("add shader include file err, has add:"+t);R.includes[t]=new gt(e)},R.preGetParams=function(t,e){var i=[t,e],r={},_=[],a=[],n={},s=[];r.attributes=_,r.uniforms=a,r.defines=n;for(var o=0,h=0,l=0;l<2;l++){i[l]=i[l].replace(R._removeAnnotation,"");var u,c=i[l].match(R._reg);for(o=0,h=c.length;o<h;o++){var f=c[o];if("attribute"==f||"uniform"==f)o=R._parseOne(_,a,c,o,f,!0);else{if("#define"==f){s[f=c[++o]]=1;continue}if("#ifdef"==f){n[u=c[++o]]=n[u]||[];for(o++;o<h;o++)if("attribute"==(f=c[o])||"uniform"==f)o=R._parseOne(_,a,c,o,f,s[u]);else if("#else"==f)for(o++;o<h;o++)if("attribute"==(f=c[o])||"uniform"==f)o=R._parseOne(_,a,c,o,f,!s[u]);else if("#endif"==f)break}}}}return r},R.splitToWords=function(t,e){for(var i,r,_=[],a=-1,n=0,s=t.length;n<s;n++)if(i=t.charAt(n),0<=" \t=+-*/&%!<>()'\",;".indexOf(i)){if(0<=a&&1<n-a&&(r=t.substr(a,n-a),_.push(r)),'"'==i||"'"==i){var o=t.indexOf(i,n+1);if(o<0)throw"Sharder err:"+t;_.push(t.substr(n+1,o-n-1)),n=o,a=-1;continue}"("==i&&e&&0<_.length&&(r=_[_.length-1]+";","vec4;main;".indexOf(r)<0&&(e.useFuns+=r)),a=-1}else a<0&&(a=n);return a<s&&1<s-a&&(r=t.substr(a,s-a),_.push(r)),_},R.IFDEF_NO=0,R.IFDEF_YES=1,R.IFDEF_ELSE=2,R.IFDEF_PARENT=3,R._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),R._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),R._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),R.includes={},n(R,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),R}()),ot=(function(){function o(){this._graphicsCmdEncoder=null,this._index=0,this._text=null,this._x=NaN,this._y=NaN,this._font=null,this._color=null,this._textAlign=null,this._draw_texture_cmd_encoder_=j.instance.createCommandEncoder(64,32,!0)}f(o,"laya.layagl.cmdNative.FillTextCmdNative");var t=o.prototype;t.createFillText=function(l,t,e,i,r,_,a){U.create(_).numColor;var n={};n._curMat=new S,n._italicDeg=0,n._drawTextureUseColor=4294967295,n.fillStyle=_,n._fillColor=4294967295,n.setFillColor=function(t){n._fillColor=t},n.getFillColor=function(){return n._fillColor},n.mixRGBandAlpha=function(t){return t},n._drawTextureM=function(t,e,i,r,_,a,n,s){l.blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),l.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),l.useVDO(Nt.VDO_MESHQUADTEXTURE),l.uniformEx(Nt.GLOBALVALUE_VIEWS,0),l.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),l.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),l.uniformTexture(3,33984,t.bitmap._glTexture);var o=new Float32Array([e,i,s[0],s[1],0,0,e+r,i,s[2],s[3],0,0,e+r,i+_,s[4],s[5],0,0,e,i+_,s[6],s[7],0,0]),h=new Int32Array(o.buffer);h[4]=h[10]=h[16]=h[22]=4294967295,h[5]=h[11]=h[17]=h[23]=4294967295,l.setRectMesh(1,o,o.length),l.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),l.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(l)},o.cbook.filltext_native(n,t,null,e,i,r,_,null,0,a)},t.recover=function(){this._graphicsCmdEncoder=null,L.recover("FillTextCmd",this)},A(0,t,"text",function(){return this._text},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._text=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),j.syncBufferToRenderThread(e)}),A(0,t,"cmdID",function(){return"FillText"}),A(0,t,"font",function(){return this._font},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._font=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),j.syncBufferToRenderThread(e)}),A(0,t,"color",function(){return this._color},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._color=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),j.syncBufferToRenderThread(e)}),A(0,t,"textAlign",function(){return this._textAlign},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._textAlign=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),j.syncBufferToRenderThread(e)}),A(0,t,"x",function(){return this._x},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._x=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),j.syncBufferToRenderThread(e)}),A(0,t,"y",function(){return this._y},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._y=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),j.syncBufferToRenderThread(e)}),o.create=function(t,e,i,r,_,a){o.cbook||new Error("Error:charbook not create!");var n=L.getItemByClass("FillTextCmd",o),s=n._graphicsCmdEncoder=this._commandEncoder;return n._text=t,n._x=e,n._y=i,n._font=r,n._color=_,n._textAlign=a,n._draw_texture_cmd_encoder_.clearEncoding(),n.createFillText(n._draw_texture_cmd_encoder_,t,e,i,r,_,a),j.syncBufferToRenderThread(n._draw_texture_cmd_encoder_),s.useCommandEncoder(n._draw_texture_cmd_encoder_.getPtrID(),-1,-1),j.syncBufferToRenderThread(s),n},o.ID="FillText",n(o,["cbook",function(){return this.cbook=D.textRender}])}(),function(){function a(){}f(a,"laya.webgl.WebGLContext");var t=a.prototype;return t.getContextAttributes=function(){return null},t.isContextLost=function(){},t.getSupportedExtensions=function(){return null},t.getExtension=function(t){return null},t.activeTexture=function(t){},t.attachShader=function(t,e){},t.bindAttribLocation=function(t,e,i){},t.bindBuffer=function(t,e){},t.bindFramebuffer=function(t,e){},t.bindRenderbuffer=function(t,e){},t.bindTexture=function(t,e){},t.useTexture=function(t){},t.blendColor=function(t,e,i,r){},t.blendEquation=function(t){},t.blendEquationSeparate=function(t,e){},t.blendFunc=function(t,e){},t.blendFuncSeparate=function(t,e,i,r){},t.bufferData=function(t,e,i){},t.bufferSubData=function(t,e,i){},t.checkFramebufferStatus=function(t){return null},t.clear=function(t){},t.clearColor=function(t,e,i,r){},t.clearDepth=function(t){},t.clearStencil=function(t){},t.colorMask=function(t,e,i,r){},t.compileShader=function(t){},t.copyTexImage2D=function(t,e,i,r,_,a,n,s){},t.copyTexSubImage2D=function(t,e,i,r,_,a,n,s){},t.createBuffer=function(){},t.createFramebuffer=function(){},t.createProgram=function(){},t.createRenderbuffer=function(){},t.createShader=function(t){},t.createTexture=function(){return null},t.cullFace=function(t){},t.deleteBuffer=function(t){},t.deleteFramebuffer=function(t){},t.deleteProgram=function(t){},t.deleteRenderbuffer=function(t){},t.deleteShader=function(t){},t.deleteTexture=function(t){},t.depthFunc=function(t){},t.depthMask=function(t){},t.depthRange=function(t,e){},t.detachShader=function(t,e){},t.disable=function(t){},t.disableVertexAttribArray=function(t){},t.drawArrays=function(t,e,i){},t.drawElements=function(t,e,i,r){},t.enable=function(t){},t.enableVertexAttribArray=function(t){},t.finish=function(){},t.flush=function(){},t.framebufferRenderbuffer=function(t,e,i,r){},t.framebufferTexture2D=function(t,e,i,r,_){},t.frontFace=function(t){return null},t.generateMipmap=function(t){return null},t.getActiveAttrib=function(t,e){return null},t.getActiveUniform=function(t,e){return null},t.getAttribLocation=function(t,e){return 0},t.getParameter=function(t){return null},t.getBufferParameter=function(t,e){return null},t.getError=function(){return null},t.getFramebufferAttachmentParameter=function(t,e,i){},t.getProgramParameter=function(t,e){return 0},t.getProgramInfoLog=function(t){return null},t.getRenderbufferParameter=function(t,e){return null},t.getShaderPrecisionFormat=function(t){return null},t.getShaderParameter=function(t,e){},t.getShaderInfoLog=function(t){return null},t.getShaderSource=function(t){return null},t.getTexParameter=function(t,e){},t.getUniform=function(t,e){},t.getUniformLocation=function(t,e){return null},t.getVertexAttrib=function(t,e){return null},t.getVertexAttribOffset=function(t,e){return null},t.hint=function(t,e){},t.isBuffer=function(t){},t.isEnabled=function(t){},t.isFramebuffer=function(t){},t.isProgram=function(t){},t.isRenderbuffer=function(t){},t.isShader=function(t){},t.isTexture=function(t){},t.lineWidth=function(t){},t.linkProgram=function(t){},t.pixelStorei=function(t,e){},t.polygonOffset=function(t,e){},t.readPixels=function(t,e,i,r,_,a,n){},t.renderbufferStorage=function(t,e,i,r){},t.sampleCoverage=function(t,e){},t.scissor=function(t,e,i,r){},t.shaderSource=function(t,e){},t.stencilFunc=function(t,e,i){},t.stencilFuncSeparate=function(t,e,i,r){},t.stencilMask=function(t){},t.stencilMaskSeparate=function(t,e){},t.stencilOp=function(t,e,i){},t.stencilOpSeparate=function(t,e,i,r){},t.texImage2D=function(t){},t.texParameterf=function(t,e,i){},t.texParameteri=function(t,e,i){},t.texSubImage2D=function(t){},t.uniform1f=function(t,e){},t.uniform1fv=function(t,e){},t.uniform1i=function(t,e){},t.uniform1iv=function(t,e){},t.uniform2f=function(t,e,i){},t.uniform2fv=function(t,e){},t.uniform2i=function(t,e,i){},t.uniform2iv=function(t,e){},t.uniform3f=function(t,e,i,r){},t.uniform3fv=function(t,e){},t.uniform3i=function(t,e,i,r){},t.uniform3iv=function(t,e){},t.uniform4f=function(t,e,i,r,_){},t.uniform4fv=function(t,e){},t.uniform4i=function(t,e,i,r,_){},t.uniform4iv=function(t,e){},t.uniformMatrix2fv=function(t,e,i){},t.uniformMatrix3fv=function(t,e,i){},t.uniformMatrix4fv=function(t,e,i){},t.useProgram=function(t){},t.validateProgram=function(t){},t.vertexAttrib1f=function(t,e){},t.vertexAttrib1fv=function(t,e){},t.vertexAttrib2f=function(t,e,i){},t.vertexAttrib2fv=function(t,e){},t.vertexAttrib3f=function(t,e,i,r){},t.vertexAttrib3fv=function(t,e){},t.vertexAttrib4f=function(t,e,i,r,_){},t.vertexAttrib4fv=function(t,e){},t.vertexAttribPointer=function(t,e,i,r,_,a){},t.viewport=function(t,e,i,r){},t.configureBackBuffer=function(t,e,i,r,_){void 0===r&&(r=!0),void 0===_&&(_=!1)},t.compressedTexImage2D=function(t){},t.createVertexArray=function(){throw"not implemented"},t.bindVertexArray=function(t){throw"not implemented"},t.deleteVertexArray=function(t){throw"not implemented"},t.isVertexArray=function(t){throw"not implemented"},a.__init__=function(t){if(a.__init_native(),laya.webgl.WebGLContext._checkExtensions(t),!mt._isWebGL2){d._setupVertexArrayObject&&(s.onMiniGame||s.onLimixiu?d._forceSetupVertexArrayObject(t):d._setupVertexArrayObject(t));var e=(t.rawgl||t).getExtension("OES_vertex_array_object");if(e){console.log("EXT:webgl support OES_vertex_array_object！");var i=t;i.createVertexArray=function(){return e.createVertexArrayOES()},i.bindVertexArray=function(t){e.bindVertexArrayOES(t)},i.deleteVertexArray=function(t){e.deleteVertexArrayOES(t)},i.isVertexArray=function(t){e.isVertexArrayOES(t)}}}},a._getExtension=function(t,e){var i=a._extentionVendorPrefixes;for(var r in i){var _=t.getExtension(i[r]+e);if(_)return _}return null},a._checkExtensions=function(t){return a._extTextureFilterAnisotropic=a._getExtension(t,"EXT_texture_filter_anisotropic"),a._compressedTextureS3tc=a._getExtension(t,"WEBGL_compressed_texture_s3tc"),a._compressedTexturePvrtc=a._getExtension(t,"WEBGL_compressed_texture_pvrtc"),a._compressedTextureEtc1=a._getExtension(t,"WEBGL_compressed_texture_etc1"),null},a.__init_native=function(){if(x.isConchApp){var t=a;t.useProgram=t.useProgramForNative,t.activeTexture=t.activeTextureForNative,t.bindTexture=t.bindTextureForNative,t.bindVertexArray=t.bindVertexArrayForNative,t.setDepthTest=t.setDepthTestForNative,t.setDepthMask=t.setDepthMaskForNative,t.setDepthFunc=t.setDepthFuncForNative,t.setBlend=t.setBlendForNative,t.setBlendFunc=t.setBlendFuncForNative,t.setCullFace=t.setCullFaceForNative,t.setFrontFace=t.setFrontFaceForNative,t._checkExtensions(s.window.LayaGLContext.instance)}},a.useProgram=function(t,e){return a._useProgram!==e&&(t.useProgram(e),a._useProgram=e,!0)},a.setDepthTest=function(t,e){e!==a._depthTest&&((a._depthTest=e)?t.enable(2929):t.disable(2929))},a.setDepthMask=function(t,e){e!==a._depthMask&&(a._depthMask=e,t.depthMask(e))},a.setDepthFunc=function(t,e){e!==a._depthFunc&&(a._depthFunc=e,t.depthFunc(e))},a.setBlend=function(t,e){e!==a._blend&&((a._blend=e)?t.enable(3042):t.disable(3042))},a.setBlendFunc=function(t,e,i){(e!==a._sFactor||i!==a._dFactor)&&(a._sFactor=e,a._dFactor=i,t.blendFunc(e,i))},a.setCullFace=function(t,e){e!==a._cullFace&&((a._cullFace=e)?t.enable(2884):t.disable(2884))},a.setFrontFace=function(t,e){e!==a._frontFace&&(a._frontFace=e,t.frontFace(e))},a.activeTexture=function(t,e){a._activedTextureID!==e&&(t.activeTexture(e),a._activedTextureID=e)},a.bindTexture=function(t,e,i){a._activeTextures[a._activedTextureID-33984]!==i&&(t.bindTexture(e,i),a._activeTextures[a._activedTextureID-33984]=i)},a.useProgramForNative=function(t,e){return t.useProgram(e),!0},a.setDepthTestForNative=function(t,e){e?t.enable(2929):t.disable(2929)},a.setDepthMaskForNative=function(t,e){t.depthMask(e)},a.setDepthFuncForNative=function(t,e){t.depthFunc(e)},a.setBlendForNative=function(t,e){e?t.enable(3042):t.disable(3042)},a.setBlendFuncForNative=function(t,e,i){t.blendFunc(e,i)},a.setCullFaceForNative=function(t,e){e?t.enable(2884):t.disable(2884)},a.setFrontFaceForNative=function(t,e){t.frontFace(e)},a.activeTextureForNative=function(t,e){t.activeTexture(e)},a.bindTextureForNative=function(t,e,i){t.bindTexture(e,i)},a.bindVertexArrayForNative=function(t,e){t.bindVertexArray(e)},a.DEPTH_BUFFER_BIT=256,a.STENCIL_BUFFER_BIT=1024,a.COLOR_BUFFER_BIT=16384,a.POINTS=0,a.LINES=1,a.LINE_LOOP=2,a.LINE_STRIP=3,a.TRIANGLES=4,a.TRIANGLE_STRIP=5,a.TRIANGLE_FAN=6,a.ZERO=0,a.ONE=1,a.SRC_COLOR=768,a.ONE_MINUS_SRC_COLOR=769,a.SRC_ALPHA=770,a.ONE_MINUS_SRC_ALPHA=771,a.DST_ALPHA=772,a.ONE_MINUS_DST_ALPHA=773,a.DST_COLOR=774,a.ONE_MINUS_DST_COLOR=775,a.SRC_ALPHA_SATURATE=776,a.FUNC_ADD=32774,a.BLEND_EQUATION=32777,a.BLEND_EQUATION_RGB=32777,a.BLEND_EQUATION_ALPHA=34877,a.FUNC_SUBTRACT=32778,a.FUNC_REVERSE_SUBTRACT=32779,a.BLEND_DST_RGB=32968,a.BLEND_SRC_RGB=32969,a.BLEND_DST_ALPHA=32970,a.BLEND_SRC_ALPHA=32971,a.CONSTANT_COLOR=32769,a.ONE_MINUS_CONSTANT_COLOR=32770,a.CONSTANT_ALPHA=32771,a.ONE_MINUS_CONSTANT_ALPHA=32772,a.BLEND_COLOR=32773,a.ARRAY_BUFFER=34962,a.ELEMENT_ARRAY_BUFFER=34963,a.ARRAY_BUFFER_BINDING=34964,a.ELEMENT_ARRAY_BUFFER_BINDING=34965,a.STREAM_DRAW=35040,a.STATIC_DRAW=35044,a.DYNAMIC_DRAW=35048,a.BUFFER_SIZE=34660,a.BUFFER_USAGE=34661,a.CURRENT_VERTEX_ATTRIB=34342,a.FRONT=1028,a.BACK=1029,a.CULL_FACE=2884,a.FRONT_AND_BACK=1032,a.BLEND=3042,a.DITHER=3024,a.STENCIL_TEST=2960,a.DEPTH_TEST=2929,a.SCISSOR_TEST=3089,a.POLYGON_OFFSET_FILL=32823,a.SAMPLE_ALPHA_TO_COVERAGE=32926,a.SAMPLE_COVERAGE=32928,a.NO_ERROR=0,a.INVALID_ENUM=1280,a.INVALID_VALUE=1281,a.INVALID_OPERATION=1282,a.OUT_OF_MEMORY=1285,a.CW=2304,a.CCW=2305,a.LINE_WIDTH=2849,a.ALIASED_POINT_SIZE_RANGE=33901,a.ALIASED_LINE_WIDTH_RANGE=33902,a.CULL_FACE_MODE=2885,a.FRONT_FACE=2886,a.DEPTH_RANGE=2928,a.DEPTH_WRITEMASK=2930,a.DEPTH_CLEAR_VALUE=2931,a.DEPTH_FUNC=2932,a.STENCIL_CLEAR_VALUE=2961,a.STENCIL_FUNC=2962,a.STENCIL_FAIL=2964,a.STENCIL_PASS_DEPTH_FAIL=2965,a.STENCIL_PASS_DEPTH_PASS=2966,a.STENCIL_REF=2967,a.STENCIL_VALUE_MASK=2963,a.STENCIL_WRITEMASK=2968,a.STENCIL_BACK_FUNC=34816,a.STENCIL_BACK_FAIL=34817,a.STENCIL_BACK_PASS_DEPTH_FAIL=34818,a.STENCIL_BACK_PASS_DEPTH_PASS=34819,a.STENCIL_BACK_REF=36003,a.STENCIL_BACK_VALUE_MASK=36004,a.STENCIL_BACK_WRITEMASK=36005,a.VIEWPORT=2978,a.SCISSOR_BOX=3088,a.COLOR_CLEAR_VALUE=3106,a.COLOR_WRITEMASK=3107,a.UNPACK_ALIGNMENT=3317,a.PACK_ALIGNMENT=3333,a.MAX_TEXTURE_SIZE=3379,a.MAX_VIEWPORT_DIMS=3386,a.SUBPIXEL_BITS=3408,a.RED_BITS=3410,a.GREEN_BITS=3411,a.BLUE_BITS=3412,a.ALPHA_BITS=3413,a.DEPTH_BITS=3414,a.STENCIL_BITS=3415,a.POLYGON_OFFSET_UNITS=10752,a.POLYGON_OFFSET_FACTOR=32824,a.TEXTURE_BINDING_2D=32873,a.SAMPLE_BUFFERS=32936,a.SAMPLES=32937,a.SAMPLE_COVERAGE_VALUE=32938,a.SAMPLE_COVERAGE_INVERT=32939,a.NUM_COMPRESSED_TEXTURE_FORMATS=34466,a.COMPRESSED_TEXTURE_FORMATS=34467,a.DONT_CARE=4352,a.FASTEST=4353,a.NICEST=4354,a.GENERATE_MIPMAP_HINT=33170,a.BYTE=5120,a.UNSIGNED_BYTE=5121,a.SHORT=5122,a.UNSIGNED_SHORT=5123,a.INT=5124,a.UNSIGNED_INT=5125,a.FLOAT=5126,a.DEPTH_COMPONENT=6402,a.ALPHA=6406,a.RGB=6407,a.RGBA=6408,a.LUMINANCE=6409,a.LUMINANCE_ALPHA=6410,a.UNSIGNED_SHORT_4_4_4_4=32819,a.UNSIGNED_SHORT_5_5_5_1=32820,a.UNSIGNED_SHORT_5_6_5=33635,a.FRAGMENT_SHADER=35632,a.VERTEX_SHADER=35633,a.MAX_VERTEX_ATTRIBS=34921,a.MAX_VERTEX_UNIFORM_VECTORS=36347,a.MAX_VARYING_VECTORS=36348,a.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,a.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,a.MAX_TEXTURE_IMAGE_UNITS=34930,a.MAX_FRAGMENT_UNIFORM_VECTORS=36349,a.SHADER_TYPE=35663,a.DELETE_STATUS=35712,a.LINK_STATUS=35714,a.VALIDATE_STATUS=35715,a.ATTACHED_SHADERS=35717,a.ACTIVE_UNIFORMS=35718,a.ACTIVE_ATTRIBUTES=35721,a.SHADING_LANGUAGE_VERSION=35724,a.CURRENT_PROGRAM=35725,a.NEVER=512,a.LESS=513,a.EQUAL=514,a.LEQUAL=515,a.GREATER=516,a.NOTEQUAL=517,a.GEQUAL=518,a.ALWAYS=519,a.KEEP=7680,a.REPLACE=7681,a.INCR=7682,a.DECR=7683,a.INVERT=5386,a.INCR_WRAP=34055,a.DECR_WRAP=34056,a.VENDOR=7936,a.RENDERER=7937,a.VERSION=7938,a.NEAREST=9728,a.LINEAR=9729,a.NEAREST_MIPMAP_NEAREST=9984,a.LINEAR_MIPMAP_NEAREST=9985,a.NEAREST_MIPMAP_LINEAR=9986,a.LINEAR_MIPMAP_LINEAR=9987,a.TEXTURE_MAG_FILTER=10240,a.TEXTURE_MIN_FILTER=10241,a.TEXTURE_WRAP_S=10242,a.TEXTURE_WRAP_T=10243,a.TEXTURE_2D=3553,a.TEXTURE_3D=32879,a.TEXTURE=5890,a.TEXTURE_CUBE_MAP=34067,a.TEXTURE_BINDING_CUBE_MAP=34068,a.TEXTURE_CUBE_MAP_POSITIVE_X=34069,a.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,a.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,a.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,a.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,a.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,a.MAX_CUBE_MAP_TEXTURE_SIZE=34076,a.TEXTURE0=33984,a.TEXTURE1=33985,a.TEXTURE2=33986,a.TEXTURE3=33987,a.TEXTURE4=33988,a.TEXTURE5=33989,a.TEXTURE6=33990,a.TEXTURE7=33991,a.TEXTURE8=33992,a.TEXTURE9=33993,a.TEXTURE10=33994,a.TEXTURE11=33995,a.TEXTURE12=33996,a.TEXTURE13=33997,a.TEXTURE14=33998,a.TEXTURE15=33999,a.TEXTURE16=34e3,a.TEXTURE17=34001,a.TEXTURE18=34002,a.TEXTURE19=34003,a.TEXTURE20=34004,a.TEXTURE21=34005,a.TEXTURE22=34006,a.TEXTURE23=34007,a.TEXTURE24=34008,a.TEXTURE25=34009,a.TEXTURE26=34010,a.TEXTURE27=34011,a.TEXTURE28=34012,a.TEXTURE29=34013,a.TEXTURE30=34014,a.TEXTURE31=34015,a.ACTIVE_TEXTURE=34016,a.REPEAT=10497,a.CLAMP_TO_EDGE=33071,a.MIRRORED_REPEAT=33648,a.FLOAT_VEC2=35664,a.FLOAT_VEC3=35665,a.FLOAT_VEC4=35666,a.INT_VEC2=35667,a.INT_VEC3=35668,a.INT_VEC4=35669,a.BOOL=35670,a.BOOL_VEC2=35671,a.BOOL_VEC3=35672,a.BOOL_VEC4=35673,a.FLOAT_MAT2=35674,a.FLOAT_MAT3=35675,a.FLOAT_MAT4=35676,a.SAMPLER_2D=35678,a.SAMPLER_CUBE=35680,a.VERTEX_ATTRIB_ARRAY_ENABLED=34338,a.VERTEX_ATTRIB_ARRAY_SIZE=34339,a.VERTEX_ATTRIB_ARRAY_STRIDE=34340,a.VERTEX_ATTRIB_ARRAY_TYPE=34341,a.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,a.VERTEX_ATTRIB_ARRAY_POINTER=34373,a.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,a.COMPILE_STATUS=35713,a.LOW_FLOAT=36336,a.MEDIUM_FLOAT=36337,a.HIGH_FLOAT=36338,a.LOW_INT=36339,a.MEDIUM_INT=36340,a.HIGH_INT=36341,a.FRAMEBUFFER=36160,a.RENDERBUFFER=36161,a.RGBA4=32854,a.RGB5_A1=32855,a.RGB565=36194,a.DEPTH_COMPONENT16=33189,a.STENCIL_INDEX=6401,a.STENCIL_INDEX8=36168,a.DEPTH_STENCIL=34041,a.RENDERBUFFER_WIDTH=36162,a.RENDERBUFFER_HEIGHT=36163,a.RENDERBUFFER_INTERNAL_FORMAT=36164,a.RENDERBUFFER_RED_SIZE=36176,a.RENDERBUFFER_GREEN_SIZE=36177,a.RENDERBUFFER_BLUE_SIZE=36178,a.RENDERBUFFER_ALPHA_SIZE=36179,a.RENDERBUFFER_DEPTH_SIZE=36180,a.RENDERBUFFER_STENCIL_SIZE=36181,a.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,a.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,a.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,a.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,a.COLOR_ATTACHMENT0=36064,a.DEPTH_ATTACHMENT=36096,a.STENCIL_ATTACHMENT=36128,a.DEPTH_STENCIL_ATTACHMENT=33306,a.NONE=0,a.FRAMEBUFFER_COMPLETE=36053,a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,a.FRAMEBUFFER_UNSUPPORTED=36061,a.FRAMEBUFFER_BINDING=36006,a.RENDERBUFFER_BINDING=36007,a.MAX_RENDERBUFFER_SIZE=34024,a.INVALID_FRAMEBUFFER_OPERATION=1286,a.UNPACK_FLIP_Y_WEBGL=37440,a.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,a.CONTEXT_LOST_WEBGL=37442,a.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,a.BROWSER_DEFAULT_WEBGL=37444,a._extTextureFilterAnisotropic=null,a._compressedTextureS3tc=null,a._compressedTexturePvrtc=null,a._compressedTextureEtc1=null,a._glTextureIDs=[33984,33985,33986,33987,33988,33989,33990,33991],a._useProgram=null,a._depthTest=!0,a._depthMask=!0,a._blend=!1,a._cullFace=!1,a._activedTextureID=33984,n(a,["_extentionVendorPrefixes",function(){return this._extentionVendorPrefixes=["","WEBKIT_","MOZ_"]},"_activeTextures",function(){return this._activeTextures=new Array(8)},"_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),a}()),ht=(function(){function o(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(16,!0)}f(o,"laya.layagl.cmdNative.ClipRectCmdNative");var t=o.prototype;t.recover=function(){L.recover("ClipRectCmd",this)},A(0,t,"cmdID",function(){return"ClipRect"}),A(0,t,"width",function(){return 0},function(t){}),A(0,t,"x",function(){return 0},function(t){}),A(0,t,"y",function(){return 0},function(t){}),A(0,t,"height",function(){return 0},function(t){}),o.create=function(t,e,i,r){var _=L.getItemByClass("ClipRectCmd",o);_._graphicsCmdEncoder=this._commandEncoder;var a=_._graphicsCmdEncoder,n=_._paramData._float32Data;n[0]=t,n[1]=e,n[2]=i,n[3]=r;var s=_._paramData.getPtrID();return j.syncBufferToRenderThread(_._paramData),a.setClipValueEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,Nt.GLOBALVALUE_CLIP_MAT_POS,Nt.GLOBALVALUE_MATRIX32,s),j.syncBufferToRenderThread(a),_},o.ID="ClipRect"}(),function(){function d(){this._graphicsCmdEncoder=null,this._paramData=null,this._x=0,this._y=0,this._points=[],this._lineColor=null,this._lineWidth=NaN,this.lastOriX=0,this.lastOriY=0,this.tArray=[],this._vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this._ibSize=0,this._vbSize=0,this._ibArray=[],this._vbArray=[]}f(d,"laya.layagl.cmdNative.DrawCurvesCmdNative");var t=d.prototype;t._getPoints=function(t){var e=[];this._points.push(t[0]),this._points.push(t[1]);for(var i=2,r=t.length;i<r;)this._quadraticCurveTo(e,t[i++],t[i++],t[i++],t[i++]);return e},t._quadraticCurveTo=function(t,e,i,r,_){var a=o.I;0==this.tArray.length?(this.lastOriX=this._points[0],this.lastOriY=this._points[1]):(this.lastOriX=this.tArray[this.tArray.length-2],this.lastOriY=this.tArray[this.tArray.length-1]),this.tArray=a.getBezierPoints([this.lastOriX,this.lastOriY,e,i,r,_],30,2);for(var n=2,s=this.tArray.length;n<s;n++)t.push(this.tArray[n])},t.recover=function(){this._lineColor=null,this._points.length=0,this.tArray.length=0,this._ibArray.length=0,this._vbArray.length=0,L.recover("DrawCurvesCmd",this)},A(0,t,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t;for(var e=U.create(this._lineColor).numColor,i=this.vbBuffer._int32Data,r=0,_=0;_<this._vertNum;_++)r++,r++,i[r++]=e;j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"points",function(){return this._points},function(t){this._points.length=0,this.lastOriX=0,this.lastOriY=0,this._points=this._getPoints(t),this._ibArray.length=0,this._vbArray.length=0,yt.createLine2(this._points,this._ibArray,this.lineWidth,0,this._vbArray,!1);var e=U.create(this._lineColor).numColor;this._vertNum=this._points.length;var i=this._vertNum;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*i*4,!0)),this._vbSize=3*this._vertNum*4;for(var r=this.vbBuffer._float32Data,_=this.vbBuffer._int32Data,a=0,n=0;n<this._vertNum;n++)r[a++]=this._vbArray[2*n]+this.x,r[a++]=this._vbArray[2*n+1]+this.y,_[a++]=e;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*(this._vertNum-2)*2)&&(this.ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._ibSize=3*(this._vertNum-2)*2;for(var s=this.ibBuffer._int16Data,o=0;o<3*(this._vertNum-2);o++)s[o]=this._ibArray[o];(_=this._paramData._int32Data)[d._PARAM_VB_SIZE_POS_]=this._vbSize,_[d._PARAM_IB_SIZE_POS_]=this._ibSize,j.syncBufferToRenderThread(this.ibBuffer),j.syncBufferToRenderThread(this.vbBuffer),j.syncBufferToRenderThread(this._paramData)}),A(0,t,"cmdID",function(){return"DrawCurves"}),A(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)e[i++]=this._vbArray[2*r]+this._x,i++,i++;j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)i++,e[i++]=this._vbArray[2*r+1]+this._y,i++;j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t,this._ibArray.length=0,this._vbArray.length=0,yt.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)e[i++]=this._vbArray[2*r]+this.x,e[i++]=this._vbArray[2*r+1]+this.y,i++;j.syncBufferToRenderThread(this.vbBuffer)}),d.create=function(t,e,i,r,_){var a=L.getItemByClass("DrawCurvesCmd",d);a._graphicsCmdEncoder=this._commandEncoder,d._DRAW_CURVES_CMD_ENCODER_||((d._DRAW_CURVES_CMD_ENCODER_=j.instance.createCommandEncoder(152,32,!0)).useProgramEx(Nt.PROGRAMEX_DRAWVG),d._DRAW_CURVES_CMD_ENCODER_.useVDO(Nt.VDO_MESHVG),d._DRAW_CURVES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),d._DRAW_CURVES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),d._DRAW_CURVES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),d._DRAW_CURVES_CMD_ENCODER_.setMeshExByParamData(4*d._PARAM_VB_POS_,4*d._PARAM_VB_OFFSET_POS_,4*d._PARAM_VB_SIZE_POS_,4*d._PARAM_IB_POS_,4*d._PARAM_IB_OFFSET_POS_,4*d._PARAM_IB_SIZE_POS_,4*d._PARAM_INDEX_ELEMENT_OFFSET_POS_),d._DRAW_CURVES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),d._DRAW_CURVES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(d._DRAW_CURVES_CMD_ENCODER_)),a._paramData||(a._paramData=new ParamData(32,!0)),a._x=t,a._y=e,a._lineColor=r,a._lineWidth=_,a._points=a._getPoints(i),yt.createLine2(a._points,a._ibArray,_,0,a._vbArray,!1);var n=U.create(r).numColor;a._vertNum=a._points.length;var s=a._vertNum;(!a.vbBuffer||a.vbBuffer.getByteLength()<3*a._vertNum*4)&&(a.vbBuffer=new ParamData(3*s*4,!0)),a._vbSize=3*a._vertNum*4;for(var o=a.vbBuffer._float32Data,h=a.vbBuffer._int32Data,l=0,u=0;u<a._vertNum;u++)o[l++]=a._vbArray[2*u]+t,o[l++]=a._vbArray[2*u+1]+e,h[l++]=n;(!a.ibBuffer||a.ibBuffer.getByteLength()<3*(a._vertNum-2)*2)&&(a.ibBuffer=new ParamData(3*(s-2)*2,!0,!0)),a._ibSize=3*(a._vertNum-2)*2;for(var c=a.ibBuffer._int16Data,f=0;f<3*(a._vertNum-2);f++)c[f]=a._ibArray[f];a._paramData._float32Data;return(h=a._paramData._int32Data)[0]=1,h[d._PARAM_VB_POS_]=a.vbBuffer.getPtrID(),h[d._PARAM_IB_POS_]=a.ibBuffer.getPtrID(),h[d._PARAM_VB_SIZE_POS_]=a._vbSize,h[d._PARAM_IB_SIZE_POS_]=a._ibSize,h[d._PARAM_VB_OFFSET_POS_]=0,h[d._PARAM_IB_OFFSET_POS_]=0,h[d._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,j.syncBufferToRenderThread(a.vbBuffer),j.syncBufferToRenderThread(a.ibBuffer),j.syncBufferToRenderThread(a._paramData),a._graphicsCmdEncoder.useCommandEncoder(d._DRAW_CURVES_CMD_ENCODER_.getPtrID(),a._paramData.getPtrID(),-1),j.syncBufferToRenderThread(a._graphicsCmdEncoder),a},d.ID="DrawCurves",d._DRAW_CURVES_CMD_ENCODER_=null,d._PARAM_VB_POS_=1,d._PARAM_IB_POS_=2,d._PARAM_VB_SIZE_POS_=3,d._PARAM_IB_SIZE_POS_=4,d._PARAM_VB_OFFSET_POS_=5,d._PARAM_IB_OFFSET_POS_=6,d._PARAM_INDEX_ELEMENT_OFFSET_POS_=7}(),function(){function t(){this.char="",this.tex=null,this.deleted=!1,this.pos=0,this.width=0,this.height=0,this.bmpWidth=0,this.bmpHeight=0,this.orix=0,this.oriy=0,this.touchTick=0,this.isSpace=!1,this.uv=new Array(8)}return f(t,"laya.webgl.resource.CharRenderInfo"),t.prototype.touch=function(){var t=I.loopCount;this.touchTick!=t&&this.tex.touchRect(this,t),this.touchTick=t},t}()),lt=function(){function c(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=NaN,this._y=NaN,this._width=NaN,this._height=NaN}f(c,"laya.layagl.cmdNative.DrawCanvasCmdNative");var t=c.prototype;return t.recover=function(){this._graphicsCmdEncoder=null,L.recover("DrawCanvasCmd",this)},A(0,t,"cmdID",function(){return"DrawCanvas"}),A(0,t,"y",function(){return this._y},function(t){this._y=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_+1]=this._y,e[c._PARAM_VB_POS_+7]=this._y,e[c._PARAM_VB_POS_+13]=this._y+this._height,e[c._PARAM_VB_POS_+19]=this._y+this._height,e[c._PARAM_CLIP_SIZE+1]=t+16,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"texture",function(){return this._texture},function(t){this._texture=t,this._paramData._int32Data[c._PARAM_TEXTURE_POS_]=this._texture._getSource().id;var e=this._paramData._float32Data,i=le.flipyuv;e[c._PARAM_VB_POS_+2]=i[0],e[c._PARAM_VB_POS_+3]=i[1],e[c._PARAM_VB_POS_+8]=i[2],e[c._PARAM_VB_POS_+9]=i[3],e[c._PARAM_VB_POS_+14]=i[4],e[c._PARAM_VB_POS_+15]=i[5],e[c._PARAM_VB_POS_+20]=i[6],e[c._PARAM_VB_POS_+21]=i[7],j.syncBufferToRenderThread(this._paramData)}),A(0,t,"width",function(){return this._width},function(t){this._width=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_]=this._x,e[c._PARAM_VB_POS_+6]=this._x+this._width,e[c._PARAM_VB_POS_+12]=this._x+this._width,e[c._PARAM_VB_POS_+18]=this._x,e[c._PARAM_CLIP_SIZE+2]=t-32,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"x",function(){return this._x},function(t){this._x=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_]=this._x,e[c._PARAM_VB_POS_+6]=this._x+this._width,e[c._PARAM_VB_POS_+12]=this._x+this._width,e[c._PARAM_VB_POS_+18]=this._x,e[c._PARAM_CLIP_SIZE]=t+16,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"height",function(){return this._height},function(t){this._height=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_+1]=this._y,e[c._PARAM_VB_POS_+7]=this._y,e[c._PARAM_VB_POS_+13]=this._y+this._height,e[c._PARAM_VB_POS_+19]=this._y+this._height,e[c._PARAM_CLIP_SIZE+3]=t-32,j.syncBufferToRenderThread(this._paramData)}),c.create=function(t,e,i,r,_){var a=L.getItemByClass("DrawCanvasCmd",c);a._graphicsCmdEncoder=this._commandEncoder,c.createCommandEncoder(),a._paramData||(a._paramData=new ParamData(132,!0)),a._texture=t,a._x=e,a._y=i,a._width=r,a._height=_,c.setParamData(a._paramData,t,e,i,r,_);var n=c._DRAW_CANVAS_CMD_ENCODER_.getPtrID(),s=a._paramData.getPtrID();return a._graphicsCmdEncoder.useCommandEncoder(n,s,-1),j.syncBufferToRenderThread(a._graphicsCmdEncoder),a},c.createCommandEncoder=function(){c._DRAW_CANVAS_CMD_ENCODER_||((c._DRAW_CANVAS_CMD_ENCODER_=j.instance.createCommandEncoder(172,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),c._DRAW_CANVAS_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),c._DRAW_CANVAS_CMD_ENCODER_.useVDO(Nt.VDO_MESHQUADTEXTURE),c._DRAW_CANVAS_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),c._DRAW_CANVAS_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),c._DRAW_CANVAS_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),c._DRAW_CANVAS_CMD_ENCODER_.uniformTextureByParamData(0,4,4*c._PARAM_TEXTURE_POS_),c._DRAW_CANVAS_CMD_ENCODER_.setRectMeshByParamData(12,4*c._PARAM_VB_POS_,16),c._DRAW_CANVAS_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),c._DRAW_CANVAS_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(c._DRAW_CANVAS_CMD_ENCODER_))},c.setParamData=function(t,e,i,r,_,a){var n=t._float32Data,s=t._int32Data;s[0]=3,s[1]=33984,s[c._PARAM_TEXTURE_POS_]=e._getSource().id,s[3]=1,s[4]=96;var o=0!=_?_:e.width,h=0!=a?a:e.height,l=le.flipyuv,u=c._PARAM_VB_POS_;n[u++]=i,n[u++]=r,n[u++]=l[0],n[u++]=l[1],s[u++]=4294967295,s[u++]=4294967295,n[u++]=i+o,n[u++]=r,n[u++]=l[2],n[u++]=l[3],s[u++]=4294967295,s[u++]=4294967295,n[u++]=i+o,n[u++]=r+h,n[u++]=l[4],n[u++]=l[5],s[u++]=4294967295,s[u++]=4294967295,n[u++]=i,n[u++]=r+h,n[u++]=l[6],n[u++]=l[7],s[u++]=4294967295,s[u++]=4294967295,n[c._PARAM_CLIP_SIZE]=i+16,n[c._PARAM_CLIP_SIZE+1]=r+16,n[c._PARAM_CLIP_SIZE+2]=_-32,n[c._PARAM_CLIP_SIZE+3]=a-32,j.syncBufferToRenderThread(t)},c.ID="DrawCanvas",c._DRAW_CANVAS_CMD_ENCODER_=null,c._PARAM_TEXTURE_POS_=2,c._PARAM_VB_POS_=5,c._PARAM_CLIP_SIZE=29,c}(),ut=function(){function _(){this._mat=new S}f(_,"laya.webgl.canvas.save.SaveTranslate");var t=_.prototype;return D.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._mat.copyTo(t._curMat),_.POOL[_.POOL._length++]=this},_.save=function(t){var e=_.POOL,i=0<e._length?e[--e._length]:new _;t._curMat.copyTo(i._mat);var r=t._save;r[r._length++]=i},_.POOL=z._createArray(),_}(),ct=(function(){function s(){this._graphicsCmdEncoder=null,this._matrix=null,this._paramData=new ParamData(32,!0)}f(s,"laya.layagl.cmdNative.TransformCmdNative");var t=s.prototype;t.recover=function(){this._matrix=null,L.recover("TransformCmd",this)},A(0,t,"cmdID",function(){return"Transform"}),A(0,t,"matrix",function(){return this._matrix},function(t){this._matrix=t;var e=this._paramData._float32Data;e[0]=this._matrix.a,e[1]=this._matrix.b,e[2]=this._matrix.c,e[3]=this._matrix.d,e[4]=this._matrix.tx,e[5]=this._matrix.ty,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"pivotX",function(){return this._paramData._float32Data[6]},function(t){this._paramData._float32Data[6]=t,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"pivotY",function(){return this._paramData._float32Data[7]},function(t){this._paramData._float32Data[7]=t,j.syncBufferToRenderThread(this._paramData)}),s.create=function(t,e,i){var r=L.getItemByClass("TransformCmd",s),_=r._graphicsCmdEncoder=this._commandEncoder,a=r._paramData._float32Data;a[0]=t.a,a[1]=t.b,a[2]=t.c,a[3]=t.d,a[4]=t.tx,a[5]=t.ty,a[6]=e,a[7]=i,r._matrix=t;var n=r._paramData.getPtrID();return j.syncBufferToRenderThread(r._paramData),_.setGlobalValueEx(Nt.GLOBALVALUE_MATRIX32,14,n,0),j.syncBufferToRenderThread(_),r},s.ID="Transform"}(),function(){function t(){}return f(t,"laya.layagl.ConchCmdReplace"),t.__init__=function(){var t,e=laya.display.cmd,i=laya.layagl.cmdNative;for(t in e)i[t+"Native"]&&(e[t].create=i[t+"Native"].create)},t}()),ft=function(){function n(){this._mesh=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this._ref=1,this.srcRT=null,this._key=new Lt}f(n,"laya.webgl.submit.SubmitTarget");var t=n.prototype;return D.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){var t=mt.mainContext;this._mesh.useMesh(t);var e=this.srcRT;return e&&(this.shaderValue.texture=e._getSource(),this.shaderValue.upload(),this.blend(),I.renderBatch++,I.trianglesFaces+=this._numEle/3,mt.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},t.blend=function(){if(Rt.activeBlendFunction!==Rt.fns[this.blendType]){var t=mt.mainContext;t.enable(3042),Rt.fns[this.blendType](t),Rt.activeBlendFunction=Rt.fns[this.blendType]}},t.getRenderType=function(){return 0},t.releaseRender=function(){if(--this._ref<1){var t=n.POOL;t[t._length++]=this}},t.reUse=function(t,e){return this._startIdx=e,this._ref++,e},n.create=function(t,e,i,r){var _=n.POOL._length?n.POOL[--n.POOL._length]:new n;if(_._mesh=e,_.srcRT=r,_._startIdx=e.indexNum*Et.BYTES_PIDX,_._ref=1,_._key.clear(),_._numEle=0,_.blendType=t._nBlendType,_._key.blendShader=_.blendType,_.shaderValue=i,_.shaderValue.setValue(t._shader2D),t._colorFiler){var a=t._colorFiler;i.defines.add(a.type),i.colorMat=a._mat,i.colorAlpha=a._alpha}return _},n.POOL=((n.POOL=[])._length=0,n.POOL),n}(),dt=function(){function A(){}return f(A,"laya.webgl.shapes.Earcut"),A.earcut=function(t,e,i){i=i||2;var r,_,a,n,s,o,h,l=e&&e.length,u=l?e[0]*i:t.length,c=A.linkedList(t,0,u,i,!0),f=[];if(!c)return f;if(l&&(c=A.eliminateHoles(t,e,c,i)),t.length>80*i){r=a=t[0],_=n=t[1];for(var d=i;d<u;d+=i)(s=t[d])<r&&(r=s),(o=t[d+1])<_&&(_=o),a<s&&(a=s),n<o&&(n=o);h=0!==(h=Math.max(a-r,n-_))?1/h:0}return A.earcutLinked(c,f,i,r,_,h),f},A.linkedList=function(t,e,i,r,_){var a,n;if(_===0<A.signedArea(t,e,i,r))for(a=e;a<i;a+=r)n=A.insertNode(a,t[a],t[a+1],n);else for(a=i-r;e<=a;a-=r)n=A.insertNode(a,t[a],t[a+1],n);return n&&A.equals(n,n.next)&&(A.removeNode(n),n=n.next),n},A.filterPoints=function(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!A.equals(r,r.next)&&0!==A.area(r.prev,r,r.next))r=r.next;else{if(A.removeNode(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e},A.earcutLinked=function(t,e,i,r,_,a,n){if(t){!n&&a&&A.indexCurve(t,r,_,a);for(var s,o,h=t;t.prev!==t.next;)if(s=t.prev,o=t.next,a?A.isEarHashed(t,r,_,a):A.isEar(t))e.push(s.i/i),e.push(t.i/i),e.push(o.i/i),A.removeNode(t),t=o.next,h=o.next;else if((t=o)===h){n?1===n?(t=A.cureLocalIntersections(t,e,i),A.earcutLinked(t,e,i,r,_,a,2)):2===n&&A.splitEarcut(t,e,i,r,_,a):A.earcutLinked(A.filterPoints(t,null),e,i,r,_,a,1);break}}},A.isEar=function(t){var e=t.prev,i=t,r=t.next;if(0<=A.area(e,i,r))return!1;for(var _=t.next.next;_!==t.prev;){if(A.pointInTriangle(e.x,e.y,i.x,i.y,r.x,r.y,_.x,_.y)&&0<=A.area(_.prev,_,_.next))return!1;_=_.next}return!0},A.isEarHashed=function(t,e,i,r){var _=t.prev,a=t,n=t.next;if(0<=A.area(_,a,n))return!1;for(var s=_.x<a.x?_.x<n.x?_.x:n.x:a.x<n.x?a.x:n.x,o=_.y<a.y?_.y<n.y?_.y:n.y:a.y<n.y?a.y:n.y,h=_.x>a.x?_.x>n.x?_.x:n.x:a.x>n.x?a.x:n.x,l=_.y>a.y?_.y>n.y?_.y:n.y:a.y>n.y?a.y:n.y,u=A.zOrder(s,o,e,i,r),c=A.zOrder(h,l,e,i,r),f=t.nextZ;f&&f.z<=c;){if(f!==t.prev&&f!==t.next&&A.pointInTriangle(_.x,_.y,a.x,a.y,n.x,n.y,f.x,f.y)&&0<=A.area(f.prev,f,f.next))return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=u;){if(f!==t.prev&&f!==t.next&&A.pointInTriangle(_.x,_.y,a.x,a.y,n.x,n.y,f.x,f.y)&&0<=A.area(f.prev,f,f.next))return!1;f=f.prevZ}return!0},A.cureLocalIntersections=function(t,e,i){var r=t;do{var _=r.prev,a=r.next.next;!A.equals(_,a)&&A.intersects(_,r,r.next,a)&&A.locallyInside(_,a)&&A.locallyInside(a,_)&&(e.push(_.i/i),e.push(r.i/i),e.push(a.i/i),A.removeNode(r),A.removeNode(r.next),r=t=a),r=r.next}while(r!==t);return r},A.splitEarcut=function(t,e,i,r,_,a){var n=t;do{for(var s=n.next.next;s!==n.prev;){if(n.i!==s.i&&A.isValidDiagonal(n,s)){var o=A.splitPolygon(n,s);return n=A.filterPoints(n,n.next),o=A.filterPoints(o,o.next),A.earcutLinked(n,e,i,r,_,a),void A.earcutLinked(o,e,i,r,_,a)}s=s.next}n=n.next}while(n!==t)},A.eliminateHoles=function(t,e,i,r){var _,a,n,s,o,h=[];for(_=0,a=e.length;_<a;_++)n=e[_]*r,s=_<a-1?e[_+1]*r:t.length,(o=A.linkedList(t,n,s,r,!1))===o.next&&(o.steiner=!0),h.push(A.getLeftmost(o));for(h.sort(A.compareX),_=0;_<h.length;_++)A.eliminateHole(h[_],i),i=A.filterPoints(i,i.next);return i},A.compareX=function(t,e){return t.x-e.x},A.eliminateHole=function(t,e){if(e=A.findHoleBridge(t,e)){var i=A.splitPolygon(e,t);A.filterPoints(i,i.next)}},A.findHoleBridge=function(t,e){var i,r=e,_=t.x,a=t.y,n=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=_&&n<s){if((n=s)===_){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(_===n)return i.prev;var o,h=i,l=i.x,u=i.y,c=1/0;for(r=i.next;r!==h;)_>=r.x&&r.x>=l&&_!==r.x&&A.pointInTriangle(a<u?_:n,a,l,u,a<u?n:_,a,r.x,r.y)&&((o=Math.abs(a-r.y)/(_-r.x))<c||o===c&&r.x>i.x)&&A.locallyInside(r,t)&&(i=r,c=o),r=r.next;return i},A.indexCurve=function(t,e,i,r){for(var _=t;null===_.z&&(_.z=A.zOrder(_.x,_.y,e,i,r)),_.prevZ=_.prev,_.nextZ=_.next,(_=_.next)!==t;);_.prevZ.nextZ=null,_.prevZ=null,A.sortLinked(_)},A.sortLinked=function(t){var e,i,r,_,a,n,s,o,h=1;do{for(i=t,a=t=null,n=0;i;){for(n++,r=i,e=s=0;e<h&&(s++,r=r.nextZ);e++);for(o=h;0<s||0<o&&r;)0!==s&&(0===o||!r||i.z<=r.z)?(i=(_=i).nextZ,s--):(r=(_=r).nextZ,o--),a?a.nextZ=_:t=_,_.prevZ=a,a=_;i=r}a.nextZ=null,h*=2}while(1<n);return t},A.zOrder=function(t,e,i,r,_){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*_)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*_)|e<<8))|e<<4))|e<<2))|e<<1))<<1},A.getLeftmost=function(t){for(var e=t,i=t;e.x<i.x&&(i=e),(e=e.next)!==t;);return i},A.pointInTriangle=function(t,e,i,r,_,a,n,s){return 0<=(_-n)*(e-s)-(t-n)*(a-s)&&0<=(t-n)*(r-s)-(i-n)*(e-s)&&0<=(i-n)*(a-s)-(_-n)*(r-s)},A.isValidDiagonal=function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!A.intersectsPolygon(t,e)&&A.locallyInside(t,e)&&A.locallyInside(e,t)&&A.middleInside(t,e)},A.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},A.equals=function(t,e){return t.x===e.x&&t.y===e.y},A.intersects=function(t,e,i,r){return!!(A.equals(t,e)&&A.equals(i,r)||A.equals(t,r)&&A.equals(i,e))||0<A.area(t,e,i)!=0<A.area(t,e,r)&&0<A.area(i,r,t)!=0<A.area(i,r,e)},A.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&A.intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1},A.locallyInside=function(t,e){return A.area(t.prev,t,t.next)<0?0<=A.area(t,e,t.next)&&0<=A.area(t,t.prev,e):A.area(t,e,t.prev)<0||A.area(t,t.next,e)<0},A.middleInside=function(t,e){for(var i=t,r=!1,_=(t.x+e.x)/2,a=(t.y+e.y)/2;i.y>a!=i.next.y>a&&i.next.y!==i.y&&_<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),(i=i.next)!==t;);return r},A.splitPolygon=function(t,e){var i=new Mt(t.i,t.x,t.y),r=new Mt(e.i,e.x,e.y),_=t.next,a=e.prev;return(t.next=e).prev=t,(i.next=_).prev=i,(r.next=i).prev=r,(a.next=r).prev=a,r},A.insertNode=function(t,e,i,r){var _=new Mt(t,e,i);return r?(_.next=r.next,(_.prev=r).next.prev=_,r.next=_):(_.prev=_).next=_,_},A.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},A.signedArea=function(t,e,i,r){for(var _=0,a=e,n=i-r;a<i;a+=r)_+=(t[n]-t[a])*(t[a+1]+t[n+1]),n=a;return _},A}(),At=(function(){function r(){this._paramData=new ParamData(4,!0)}f(r,"laya.layagl.cmdNative.AlphaCmdNative");var t=r.prototype;t.recover=function(){L.recover("AlphaCmd",this)},t.run=function(t,e,i){t.alpha(this._alpha)},A(0,t,"cmdID",function(){return"Alpha"}),A(0,t,"alpha",function(){return this._alpha},function(t){t=(t=1<t?1:t)<0?0:t;var e=16777215;e|=255*(this._alpha=t)<<24,this._paramData._int32Data[0]=e,j.syncBufferToRenderThread(this._paramData)}),r.create=function(t){var e=L.getItemByClass("AlphaCmd",r),i=e._graphicsCmdEncoder=this._commandEncoder;return e.alpha=t,i.setGlobalValueEx(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,15,e._paramData.getPtrID(),0),j.syncBufferToRenderThread(i),e},r.ID="Alpha"}(),function(){function n(t){this.clipInfoID=-1,this._numEle=0,this._ref=1,this._key=new Lt,void 0===t&&(t=1e4),this._renderType=t,this._id=++n.ID}f(n,"laya.webgl.submit.Submit");var t=n.prototype;return D.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.getID=function(){return this._id},t.releaseRender=function(){n.RENDERBASE!=this&&--this._ref<1&&((n.POOL[n._poolSize++]=this).shaderValue.release(),this.shaderValue=null,this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},t.getRenderType=function(){return this._renderType},t.renderSubmit=function(){if(0===this._numEle||!this._mesh||0==this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t._getSource();if(!e)return 1;this.shaderValue.texture=e}var i=mt.mainContext;return this._mesh.useMesh(i),this.shaderValue.upload(),Rt.activeBlendFunction!==this._blendFn&&(ot.setBlend(i,!0),this._blendFn(i),Rt.activeBlendFunction=this._blendFn),i.drawElements(4,this._numEle,5123,this._startIdx),I.renderBatch++,I.trianglesFaces+=this._numEle/3,1},t._cloneInit=function(t,e,i,r){t._ref=1,t._mesh=i,t._id=this._id,t._key.copyFrom(this._key),t._parent=this,t._blendFn=this._blendFn,t._renderType=this._renderType,t._startIdx=r*Et.BYTES_PIDX,t._numEle=this._numEle,t.shaderValue=this.shaderValue,this.shaderValue.ref++,this._ref++},t.clone=function(t,e,i){return null},t.reUse=function(t,e){return 0},t.toString=function(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key},n.__init__=function(){var t=n.RENDERBASE=new n(-1);t.shaderValue=new Y(0,0),t.shaderValue.ALPHA=1,t._ref=4294967295},n.create=function(t,e,i){var r=n._poolSize?n.POOL[--n._poolSize]:new n;r._ref=1,r._mesh=e,r._key.clear(),r._startIdx=e.indexNum*Et.BYTES_PIDX,r._numEle=0;var _=t._nBlendType;r._blendFn=t._targets?Rt.targetFns[_]:Rt.fns[_],r.shaderValue=i,r.shaderValue.setValue(t._shader2D);var a=t._shader2D.filters;return a&&r.shaderValue.setFilters(a),r},n.createShape=function(t,e,i,r){var _=n._poolSize?n.POOL[--n._poolSize]:new n;_._mesh=e,_._numEle=i,_._startIdx=2*e.indexNum,_._ref=1,_.shaderValue=r,_.shaderValue.setValue(t._shader2D);var a=t._nBlendType;return _._key.blendShader=a,_._blendFn=t._targets?Rt.targetFns[a]:Rt.fns[a],_},n.TYPE_2D=1e4,n.TYPE_CANVAS=10003,n.TYPE_CMDSETRT=10004,n.TYPE_CUSTOM=10005,n.TYPE_BLURRT=10006,n.TYPE_CMDDESTORYPRERT=10007,n.TYPE_DISABLESTENCIL=10008,n.TYPE_OTHERIBVB=10009,n.TYPE_PRIMITIVE=10010,n.TYPE_RT=10011,n.TYPE_BLUR_RT=10012,n.TYPE_TARGET=10013,n.TYPE_CHANGE_VALUE=10014,n.TYPE_SHAPE=10015,n.TYPE_TEXTURE=10016,n.TYPE_FILLTEXTURE=10017,n.KEY_ONCE=-1,n.KEY_FILLRECT=1,n.KEY_DRAWTEXTURE=2,n.KEY_VG=3,n.KEY_TRIANGLES=4,n.RENDERBASE=null,n.ID=1,n.preRender=null,n._poolSize=0,n.POOL=[],n}()),Et=function(){function t(){}return f(t,"laya.webgl.utils.CONST3D2D"),t.BYTES_PE=4,t.BYTES_PIDX=2,t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,t}(),mt=function(){function n(){}return f(n,"laya.webgl.WebGL"),n._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},n._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},n._uint16ArraySlice=function(t){var e,i=arguments,r=0,_=0;if(0===i.length)for(r=this.length,e=new Uint16Array(r),_=0;_<r;_++)e[_]=this[_];else if(2===i.length){var a=i[0],n=i[1];if(a<n)for(r=n-a,e=new Uint16Array(r),_=a;_<n;_++)e[_-a]=this[_];else e=new Uint16Array(0)}return e},n._nativeRender_enable=function(){n.isNativeRender_enable||(n.isNativeRender_enable=!0,e.create=function(t,e){var i=new ue(t,e,1,!1,!1);return i.wrapModeU=1,i.wrapModeV=1,i},ot.__init_native(),bt.width=s.window.innerWidth,bt.height=s.window.innerHeight,v.measureText=function(t,e){return d.conchTextCanvas.font=e,d.conchTextCanvas.measureText(t)},v.enableNative=function(){_t.uploadShaderUniforms=_t.uploadShaderUniformsForNative;var t=y;t.prototype.repaint=t.prototype.repaintForNative,t.prototype.render=t.prototype.renderToNative;var e=nt;if(e.prototype.bind=nt.prototype.bindForNative,e.prototype.unBind=nt.prototype.unBindForNative,x.isConchApp){Ct=d.GLCommandEncoder,j=d.LayaGLContext;var i=d.CanvasRenderingContext.prototype,r=vt.prototype;vt=d.CanvasRenderingContext,i.drawImage=r.drawImage,i.drawTexture=r.drawTexture,i.fillText=r.fillText,i.save=r.save,i.restore=r.restore,i.translate=r.translate,i.scale=r.scale,i.rotate=r.rotate,i.transform=r.transform,i.beginRT=r.beginRT,i.endRT=r.endRT,i.drawCanvas=r.drawCanvas,i.drawTarget=r.drawTarget,i._$get_asBitmap=r._$get_asBitmap,i._$set_asBitmap=r._$set_asBitmap,i.toBase64=r.toBase64,i.getImageData=r.getImageData,A(0,i,"asBitmap",i._$get_asBitmap,i._$set_asBitmap),xt.rewriteProperties()}re.init(),Nt.__init__()},v.clear=function(t){var e=U.create(t).arrColor,i=j.instance;e&&i.clearColor(e[0],e[1],e[2],e[3]),i.clear(17664)},v.drawToCanvas=function(t,e,i,r,_,a){var n=new E(!0);n.size(i,r);var s=n.getContext("2d");s.asBitmap=!0;var o=j.instance.createCommandEncoder(128,64,!1);o.beginEncoding(),o.clearEncoding();var h=j.instance,l=h.getCurrentContext();h.setCurrentContext(s),s.beginRT(),h.save();var u=re._tempFloatArrayMatrix;return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=_,u[5]=a,h.setGlobalValue(Nt.GLOBALVALUE_MATRIX32,8,u),t.writeBlockToNative(),h.restore(),h.setCurrentContext(l),h.commitContextToGPU(s),s.endRT(),o.endEncoding(),h.useCommandEncoder(o.getPtrID(),-1,0),n},E.prototype.getTexture=function(){return this._texture||(this._texture=this.context._targets,this._texture.uv=le.flipyuv,this._texture.bitmap=this._texture),this._texture})},n._webglRender_enable=function(){x.isWebGL||(x.isWebGL=!0,v.initRender=function(t,e,i){var r=j.instance=laya.webgl.WebGL.mainContext=function(t){var e,i=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];h.useWebGL2||i.shift();for(var r=0;r<i.length;r++){try{e=t.getContext(i[r],{stencil:h.isStencil,alpha:h.isAlpha,antialias:h.isAntialias,premultipliedAlpha:h.premultipliedAlpha,preserveDrawingBuffer:h.preserveDrawingBuffer})}catch(t){}if(e)return"webgl2"===i[r]&&(laya.webgl.WebGL._isWebGL2=!0),new j,e}return null}(x._mainCanvas.source);if(!r)return!1;t.size(e,i),ot.__init__(r),Gt.__init__(),At.__init__();var _=new Gt;x._context=_,t._setContext(_),laya.webgl.WebGL.shaderHighPrecision=!1;try{var a=r.getShaderPrecisionFormat(35632,36338);n.shaderHighPrecision=!!a.precision}catch(t){}return j.instance=r,F.__init__(),jt.__init__(),Y.__init__(),Pt.__init__(),$t.__int__(r),Rt._init_(r),!0},e.create=function(t,e){var i=new ue(t,e,1,!1,!1);return i.wrapModeU=1,i.wrapModeV=1,i},v.createRenderSprite=function(t,e){return new Wt(t,e)},v.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},v.clear=function(t){Gt.set2DRenderConfig(),bt.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=x.context,i=0==e._submits._length||h.preserveDrawingBuffer?U.create(t).arrColor:D.stage._wgColor;i&&e.clearBG(i[0],i[1],i[2],i[3]),bt.clear()},v.drawToCanvas=function(t,e,i,r,_,a){_-=t.x,a-=t.y,_|=0,a|=0,i|=0,r|=0;var n=new Gt;n.size(i,r),n.asBitmap=!0,n._targets.start(),m.renders[e]._fun(t,n,_,a),n.flush(),n._targets.end(),n._targets.restore();var s=n._targets.getData(0,0,i,r);n.destroy();for(var o=new ImageData(i,r),h=4*i,l=(new Uint8Array(h),o.data),u=r-1,c=u*h,f=0;0<=u;u--)l.set(s.subarray(f,f+h),c),c-=h,f+=h;var d=new E(!0);return d.size(i,r),d.getContext("2d").putImageData(o,0,0),d},v.getTexturePixels=function(t,e,i,r,_){var a=0,n=0,s=0,o=t.bitmap,h=o.width,l=o.height;if(h<e+r&&(r-=e+r-h),l<i+_&&(_-=i+_-l),r<=0||_<=0)return null;var u=4*r,c=null;try{c=o.getPixels()}catch(t){}if(c){if(0==e&&0==i&&r==h&&_==l)return c;var f=new Uint8Array(r*_*4);for(n=(i+_-1)*(u=4*h)+(a=4*e),s=_-1;0<=s;s--)f.set(T.slice(n,n+4*r),a),a+=u,n-=u;return f}var d=new Gt;d.size(r,_),d.asBitmap=!0;var A=null;if(0!=e||0!=i||r!=h||_!=l){var E=(A=t.uv.concat())[0],m=A[1],R=(A[2]-E)/h,p=(A[7]-m)/l;A=[E+e*R,m+i*p,E+(e+r)*R,m+i*p,E+(e+r)*R,m+(i+_)*p,E+e*R,m+(i+_)*p]}d._drawTextureM(t,0,0,r,_,null,1,A),d._targets.start(),d.flush(),d._targets.end(),d._targets.restore();var T=d._targets.getData(0,0,r,_);for(d.destroy(),f=new Uint8Array(r*_*4),a=0,n=(_-1)*u,s=_-1;0<=s;s--)f.set(T.slice(n,n+u),a),a+=u,n-=u;return f},t._filter=function(t,e,i,r){var _=e,a=this._next;if(a){var n=t.filters,s=n.length;if(1==s&&32==n[0].type)return e.save(),e.setColorFilter(n[0]),a._fun.call(a,t,e,i,r),void e.restore();var o,h=Y.create(1,0),l=g.TEMP,u=_._curMat,c=S.create();u.copyTo(c);var f=0,d=0,A=null,E=t._cacheStyle.filterCache||null;if(E&&0==t.getRepaint()){if((t._cacheStyle.hasGlowFilter||!1)&&(f=50,d=25),(o=t.getBounds()).width<=0||o.height<=0)return;o.width+=f,o.height+=f,l.x=o.x*c.a+o.y*c.c,l.y=o.y*c.d+o.x*c.b,o.x=l.x,o.y=l.y,l.x=o.width*c.a+o.height*c.c,l.y=o.height*c.d+o.width*c.b,o.width=l.x,o.height=l.y}else{t._isHaveGlowFilter()&&(f=50,d=25),(o=new M).copyFrom(t.getSelfBounds()),o.x+=t.x,o.y+=t.y,o.x-=t.pivotX+4,o.y-=t.pivotY+4;var m=o.x,R=o.y;if(o.width+=f+8,o.height+=f+8,l.x=o.x*c.a+o.y*c.c,l.y=o.y*c.d+o.x*c.b,o.x=l.x,o.y=l.y,l.x=o.width*c.a+o.height*c.c,l.y=o.height*c.d+o.width*c.b,o.width=l.x,o.height=l.y,o.width<=0||o.height<=0)return;E&&St.releaseRT(E),A=St.getRT(o.width,o.height);var p=E=St.getRT(o.width,o.height);t._getCacheStyle().filterCache=E,_.pushRT(),_.useRT(A);var T=t.x-m+d,v=t.y-R+d;a._fun.call(a,t,e,T,v),_.useRT(p);for(var D=0;D<s;D++){0!=D&&(_.useRT(A),_.drawTarget(p,0,0,o.width,o.height,S.TEMP.identity(),h,null,Rt.TOINT.overlay),_.useRT(p));var P=n[D];switch(P.type){case 16:case 8:P._glRender&&P._glRender.render(A,e,o.width,o.height,P);break;case 32:_.setColorFilter(P),_.drawTarget(A,0,0,o.width,o.height,S.EMPTY.identity(),Y.create(1,0)),_.setColorFilter(null)}}_.popRT()}if(i=i-d-t.x,r=r-d-t.y,l.setTo(i,r),c.transformPoint(l),i=l.x+o.x,r=l.y+o.y,_._drawRenderTexture(E,i,r,o.width,o.height,S.TEMP.identity(),1,le.defuv),A){var C=Vt.create([A],function(t){t.destroy()},this);A=null,e.addRenderObject(C)}c.destroy()}},E.prototype.getTexture=function(){if(!this._texture){var t=new ue;t.loadImageSource(this.source),this._texture=new V(t)}return this._texture},Float32Array.prototype.slice||(Float32Array.prototype.slice=n._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=n._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=n._uint8ArraySlice))},n.enable=function(){return s.__init__(),!!s._supportWebGL&&(x.isConchApp?n._nativeRender_enable():n._webglRender_enable(),!0)},n.onStageResize=function(t,e){null!=n.mainContext&&(n.mainContext.viewport(0,0,t,e),bt.width=t,bt.height=e)},n.mainContext=null,n.shaderHighPrecision=!1,n._isWebGL2=!1,n.isNativeRender_enable=!1,n}(),Rt=function(){function e(){}return f(e,"laya.webgl.canvas.BlendMode"),e._init_=function(t){e.fns=[e.BlendNormal,e.BlendAdd,e.BlendMultiply,e.BlendScreen,e.BlendOverlay,e.BlendLight,e.BlendMask,e.BlendDestinationOut],e.targetFns=[e.BlendNormalTarget,e.BlendAddTarget,e.BlendMultiplyTarget,e.BlendScreenTarget,e.BlendOverlayTarget,e.BlendLightTarget,e.BlendMask,e.BlendDestinationOut]},e.BlendNormal=function(t){ot.setBlendFunc(t,1,771)},e.BlendAdd=function(t){ot.setBlendFunc(t,1,772)},e.BlendMultiply=function(t){ot.setBlendFunc(t,774,771)},e.BlendScreen=function(t){ot.setBlendFunc(t,1,1)},e.BlendOverlay=function(t){ot.setBlendFunc(t,1,769)},e.BlendLight=function(t){ot.setBlendFunc(t,1,1)},e.BlendNormalTarget=function(t){ot.setBlendFunc(t,1,771)},e.BlendAddTarget=function(t){ot.setBlendFunc(t,1,772)},e.BlendMultiplyTarget=function(t){ot.setBlendFunc(t,774,771)},e.BlendScreenTarget=function(t){ot.setBlendFunc(t,1,1)},e.BlendOverlayTarget=function(t){ot.setBlendFunc(t,1,769)},e.BlendLightTarget=function(t){ot.setBlendFunc(t,1,1)},e.BlendMask=function(t){ot.setBlendFunc(t,0,770)},e.BlendDestinationOut=function(t){ot.setBlendFunc(t,0,0)},e.activeBlendFunction=null,e.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],e.TOINT={normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1},e.NORMAL="normal",e.ADD="add",e.MULTIPLY="multiply",e.SCREEN="screen",e.OVERLAY="overlay",e.LIGHT="light",e.MASK="mask",e.DESTINATIONOUT="destination-out",e.LIGHTER="lighter",e.fns=[],e.targetFns=[],e}(),pt=function(){var r;function t(){this._lastOriX=0,this._lastOriY=0,this.paths=[],this._curPath=null}f(t,"laya.webgl.canvas.Path");var e=t.prototype;return e.beginPath=function(t){this.paths.length=1,this._curPath=this.paths[0]=new r,this._curPath.convex=t},e.closePath=function(){this._curPath.loop=!0},e.newPath=function(){this._curPath=new r,this.paths.push(this._curPath)},e.addPoint=function(t,e){this._curPath.path.push(t,e)},e.push=function(t,e){this._curPath?0<this._curPath.path.length&&(this._curPath=new r,this.paths.push(this._curPath)):(this._curPath=new r,this.paths.push(this._curPath));var i=this._curPath;i.path=t.slice(),i.convex=e},e.reset=function(){this.paths.length=0},t.__init$=function(){r=function(){function t(){this.path=[],this.loop=!1,this.convex=!1}return f(t,""),t}()},t}(),Tt=function(){function t(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,this._glBuffer=j.instance.createBuffer()}f(t,"laya.webgl.utils.Buffer");var e=t.prototype;return e._bindForVAO=function(){},e.bind=function(){return!1},e.destroy=function(){this._glBuffer&&(j.instance.deleteBuffer(this._glBuffer),this._glBuffer=null)},A(0,e,"bufferUsage",function(){return this._bufferUsage}),t._bindedVertexBuffer=null,t._bindedIndexBuffer=null,t}(),vt=function(){function t(){this._customCmds=null,this._targets=null,this._width=0,this._height=0,this._cmdEncoder=null}f(t,"laya.layagl.LayaGLRenderingContext");var e=t.prototype;return e.drawTexture=function(t,e,i,r,_){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===_&&(_=0),this.drawImage(t,e,i,r,_)},e.drawImage=function(t,e,i,r,_){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===_&&(_=0),this._customCmds.push(l.create.call(this,t,e,i,r,_))},e.fillText=function(t,e,i,r,_,a){this._customCmds.push(u.create.call(this,t,e,i,r||w.defaultFontStr(),_,a))},e.save=function(){this._customCmds.push(P.create.call(this))},e.restore=function(){this._customCmds.push(p.create.call(this))},e.translate=function(t,e){this._customCmds.push(X.create.call(this,t,e))},e.rotate=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._customCmds.push(T.create.call(this,t,e,i))},e.scale=function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0),this._customCmds.push(C.create.call(this,t,e,i,r))},e.transform=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._customCmds.push(G.create.call(this,t,e,i))},e.beginRT=function(){le.pushRT(),this._targets.start(),this.clear()},e.clear=function(){},e.endRT=function(){le.popRT()},e.drawCanvas=function(t,e,i){var r=t.context._targets;this._customCmds.push(_.create.call(this,r,e,i,r.width,r.height))},e.drawTarget=function(t,e,i,r,_,a){var n=new ArrayBuffer(96),s=new Int32Array(n),o=new Float32Array(n),h=0!=_?_:e.width,l=0!=a?a:e.height,u=le.flipyuv,c=0;o[c++]=i,o[c++]=r,o[c++]=u[0],o[c++]=u[1],s[c++]=4294967295,s[c++]=4294967295,o[c++]=i+h,o[c++]=r,o[c++]=u[2],o[c++]=u[3],s[c++]=4294967295,s[c++]=4294967295,o[c++]=i+h,o[c++]=r+l,o[c++]=u[4],o[c++]=u[5],s[c++]=4294967295,s[c++]=4294967295,o[c++]=i,o[c++]=r+l,o[c++]=u[6],o[c++]=u[7],s[c++]=4294967295,s[c++]=4294967295,t.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),t.useVDO(Nt.VDO_MESHQUADTEXTURE),t.uniformEx(Nt.GLOBALVALUE_VIEWS,0),t.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),t.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),t.uniformTexture(0,33984,e._getSource()),t.setRectMesh(1,n),t.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),t.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15)},e.getImageData=function(t,e,i,r,_){var a=this._targets.sourceWidth,n=this._targets.sourceHeight;if(!(t<0||e<0||i<0||r<0||a<i||n<r)){this._cmdEncoder||(this._cmdEncoder=j.instance.createCommandEncoder(128,64,!1));var s=j.instance;this._cmdEncoder.beginEncoding(),this._cmdEncoder.clearEncoding(),le.pushRT(),this._targets.start(),s.readPixelsAsync(t,e,i,r,6408,5121,function(t){_(t)}),this.endRT(),this._cmdEncoder.endEncoding(),s.useCommandEncoder(this._cmdEncoder.getPtrID(),-1,0)}},e.toBase64=function(i,r,_){var a=this._targets.sourceWidth,n=this._targets.sourceHeight;this.getImageData(0,0,a,n,function(t){var e=conchToBase64(i,r,t,a,n);_(e)})},A(0,e,"asBitmap",function(){return!this._targets},function(t){if(t){if(this._targets||(this._targets=new le(this._width,this._height,1,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets=null}),t}(),Dt=(function(){function s(){this._draw_texture_cmd_encoder_=j.instance.createCommandEncoder(64,32,!0)}f(s,"laya.layagl.cmdNative.FillWordsCmdNative");var t=s.prototype;t.createFillText=function(l,t,e,i,r,_){U.create(_).numColor;var a={};a._curMat=new S,a._italicDeg=0,a._drawTextureUseColor=4294967295,a.fillStyle=_,a._fillColor=4294967295,a.setFillColor=function(t){a._fillColor=t},a.getFillColor=function(){return a._fillColor},a.mixRGBandAlpha=function(t){return t},a._drawTextureM=function(t,e,i,r,_,a,n,s){l.blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),l.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),l.useVDO(Nt.VDO_MESHQUADTEXTURE),l.uniformEx(Nt.GLOBALVALUE_VIEWS,0),l.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),l.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),l.uniformTexture(3,33984,t.bitmap._glTexture);var o=new Float32Array([e,i,s[0],s[1],0,0,e+r,i,s[2],s[3],0,0,e+r,i+_,s[4],s[5],0,0,e,i+_,s[6],s[7],0,0]),h=new Int32Array(o.buffer);h[4]=h[10]=h[16]=h[22]=4294967295,h[5]=h[11]=h[17]=h[23]=4294967295,l.setRectMesh(1,o,o.length),l.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),l.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(l)},s.cbook.filltext_native(a,null,t,e,i,r,_,null,0,null)},t.recover=function(){this._graphicsCmdEncoder=null,this.words=null,L.recover("FillWordsCmd",this)},A(0,t,"cmdID",function(){return"FillWords"}),s.create=function(t,e,i,r,_){s.cbook||new Error("Error:charbook not create!");var a=L.getItemByClass("FillWordsCmd",s),n=a._graphicsCmdEncoder=this._commandEncoder;return a.words=t,a.x=e,a.y=i,a.font=r,a.color=_,a._draw_texture_cmd_encoder_.clearEncoding(),a.createFillText(a._draw_texture_cmd_encoder_,t,e,i,r,_),j.syncBufferToRenderThread(a._draw_texture_cmd_encoder_),n.useCommandEncoder(a._draw_texture_cmd_encoder_.getPtrID(),-1,-1),j.syncBufferToRenderThread(n),a},s.ID="FillWords",n(s,["cbook",function(){return this.cbook=D.textRender}])}(),function(){function a(){this._matrix=new S}f(a,"laya.webgl.canvas.save.SaveTransform");var t=a.prototype;return D.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat=this._savematrix,a.POOL[a.POOL._length++]=this},a.save=function(t){var e=t._saveMark;if(2048!=(2048&e._saveuse)){e._saveuse|=2048;var i=a.POOL,r=0<i._length?i[--i._length]:new a;r._savematrix=t._curMat,t._curMat=t._curMat.copyTo(r._matrix);var _=t._save;_[_._length++]=r}},a.POOL=z._createArray(),a}()),Pt=(function(){function T(){this._graphicsCmdEncoder=null,this._paramData=null,this._graphicsCmdEncoder_fill=null,this._paramData_fill=null,this._x=NaN,this._y=NaN,this._paths=null,this._brush=null,this._pen=null,this._vertNum=0,this._startOriX=0,this._startOriY=0,this._lastOriX=0,this._lastOriY=0,this.SEGNUM=32,this.lines_ibBuffer=null,this.lines_vbBuffer=null,this._lines_ibSize=0,this._lines_vbSize=0,this.fill_ibBuffer=null,this.fill_vbBuffer=null,this._fill_ibSize=0,this._fill_vbSize=0,this._cmdCurrentPos=0,this._points=[],this._lines_ibArray=[],this._lines_vbArray=[],this._fill_ibArray=[],this._fill_vbArray=[]}f(T,"laya.layagl.cmdNative.DrawPathCmdNative");var t=T.prototype;t._arcTo=function(t){var e=t[1],i=t[2],r=t[3],_=t[4],a=t[5],n=0,s=0,o=0,h=this._lastOriX-e,l=this._lastOriY-i,u=Math.sqrt(h*h+l*l);if(!(u<=1e-6)){var c=h/u,f=l/u,d=r-e,A=_-i,E=d*d+A*A,m=Math.sqrt(E);if(!(m<=1e-6)){var R=d/m,p=A/m,T=c+R,v=f+p,D=Math.sqrt(T*T+v*v);if(!(D<=1e-6)){var P=T/D,C=v/D,g=Math.acos(P*c+C*f),M=Math.PI/2-g,y=(u=a/Math.tan(M))*c+e,O=u*f+i,S=Math.sqrt(u*u+a*a),b=e+P*S,L=i+C*S,x=0,B=0;if(0<=c*p-f*R){var I=2*M/this.SEGNUM;x=Math.sin(I),B=Math.cos(I)}else I=2*-M/this.SEGNUM,x=Math.sin(I),B=Math.cos(I);var N=this._lastOriX,F=this._lastOriY,w=y-b,V=O-L;for(n=0;n<this.SEGNUM;n++){var U=w*B+V*x,W=-w*x+V*B;s=U+b,o=W+L,(.1<Math.abs(N-s)||.1<Math.abs(F-o))&&(this._points.push(s),this._points.push(o)),w=U,V=W}}}}},t.recover=function(){this._paths=null,this._brush=null,this._pen=null,this._points.length=0,this._lines_ibArray.length=0,this._lines_vbArray.length=0,this._fill_ibArray.length=0,this._fill_vbArray.length=0,L.recover("DrawPathCmd",this)},A(0,t,"cmdID",function(){return"DrawPath"}),A(0,t,"paths",function(){return this._paths},function(t){this._paths=t}),A(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.lines_vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)e[i++]=this._lines_vbArray[2*r]+t,i++,i++;j.syncBufferToRenderThread(this.lines_vbBuffer)}),A(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.lines_vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)i++,e[i++]=this._lines_vbArray[2*r+1]+t,i++;j.syncBufferToRenderThread(this.lines_vbBuffer)}),A(0,t,"brush",function(){return this._brush},function(t){this._brush||(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=T._DRAW_LINES_FILL_CMD_ENCODER_.getPtrID(),j.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._brush=t;var e=this._vertNum,i=dt.earcut(this._points,null,2);if(0<i.length){(!this.fill_ibBuffer||this.fill_ibBuffer.getByteLength()<2*i.length)&&(this.fill_ibBuffer=new ParamData(2*i.length,!0,!0)),this._fill_ibSize=2*i.length;for(var r=this.fill_ibBuffer._int16Data,_=0,a=0;a<i.length;a++)r[_++]=i[a]}var n=U.create(t.fillStyle).numColor;(!this.fill_vbBuffer||this.fill_vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.fill_vbBuffer=new ParamData(3*e*4,!0)),this._fill_vbSize=3*this._vertNum*4;for(var s=this.fill_vbBuffer._float32Data,o=this.fill_vbBuffer._int32Data,h=0,l=0;l<this._vertNum;l++)s[h++]=this._points[2*l]+this.x,s[h++]=this._points[2*l+1]+this.y,o[h++]=n;var u=this._paramData._int32Data;u[T._PARAM_FILL_VB_POS_]=this.fill_vbBuffer.getPtrID(),u[T._PARAM_FILL_IB_POS_]=this.fill_ibBuffer.getPtrID(),u[T._PARAM_FILL_VB_SIZE_POS_]=this._fill_vbSize,u[T._PARAM_FILL_IB_SIZE_POS_]=this._fill_ibSize,j.syncBufferToRenderThread(this.fill_vbBuffer),j.syncBufferToRenderThread(this.fill_ibBuffer),j.syncBufferToRenderThread(this._paramData)}),A(0,t,"pen",function(){return this._pen},function(t){this._pen=t,this._lines_ibArray.length=0,this._lines_vbArray.length=0,yt.createLine2(this._points,this._lines_ibArray,t.lineWidth,0,this._lines_vbArray,!1);var e=U.create(t.strokeStyle).numColor,i=this._vertNum;(!this.lines_vbBuffer||this.lines_vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.lines_vbBuffer=new ParamData(3*i*4,!0)),this._lines_vbSize=3*this._vertNum*4;for(var r=this.lines_vbBuffer._float32Data,_=this.lines_vbBuffer._int32Data,a=0,n=0;n<this._vertNum;n++)r[a++]=this._lines_vbArray[2*n]+this.x,r[a++]=this._lines_vbArray[2*n+1]+this.y,_[a++]=e;(!this.lines_ibBuffer||this.lines_ibBuffer.getByteLength()<3*(this._vertNum-2)*2)&&(this.lines_ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._lines_ibSize=3*(this._vertNum-2)*2;for(var s=this.lines_ibBuffer._int16Data,o=0;o<3*(this._vertNum-2);o++)s[o]=this._lines_ibArray[o];(_=this._paramData._int32Data)[T._PARAM_LINES_VB_POS_]=this.lines_vbBuffer.getPtrID(),_[T._PARAM_LINES_IB_POS_]=this.lines_ibBuffer.getPtrID(),_[T._PARAM_LINES_VB_SIZE_POS_]=this._lines_vbSize,_[T._PARAM_LINES_IB_SIZE_POS_]=this._lines_ibSize,j.syncBufferToRenderThread(this.lines_vbBuffer),j.syncBufferToRenderThread(this.lines_ibBuffer),j.syncBufferToRenderThread(this._paramData)}),T.create=function(t,e,i,r,_){var a=L.getItemByClass("DrawPathCmd",T);a._graphicsCmdEncoder=this._commandEncoder,T._DRAW_LINES_CMD_ENCODER_||((T._DRAW_LINES_CMD_ENCODER_=j.instance.createCommandEncoder(188,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),T._DRAW_LINES_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWVG),T._DRAW_LINES_CMD_ENCODER_.useVDO(Nt.VDO_MESHVG),T._DRAW_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),T._DRAW_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),T._DRAW_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),T._DRAW_LINES_CMD_ENCODER_.setMeshExByParamData(4*T._PARAM_LINES_VB_POS_,4*T._PARAM_LINE_VB_OFFSET_POS_,4*T._PARAM_LINES_VB_SIZE_POS_,4*T._PARAM_LINES_IB_POS_,4*T._PARAM_LINE_IB_OFFSET_POS_,4*T._PARAM_LINES_IB_SIZE_POS_,4*T._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_),T._DRAW_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),T._DRAW_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(T._DRAW_LINES_CMD_ENCODER_)),T._DRAW_FILL_CMD_ENCODER_||((T._DRAW_FILL_CMD_ENCODER_=j.instance.createCommandEncoder(168,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),T._DRAW_FILL_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWVG),T._DRAW_FILL_CMD_ENCODER_.useVDO(Nt.VDO_MESHVG),T._DRAW_FILL_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),T._DRAW_FILL_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),T._DRAW_FILL_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),T._DRAW_FILL_CMD_ENCODER_.setMeshExByParamData(4*T._PARAM_FILL_VB_POS_,4*T._PARAM_FILL_VB_OFFSET_POS_,4*T._PARAM_FILL_VB_SIZE_POS_,4*T._PARAM_FILL_IB_POS_,4*T._PARAM_FILL_IB_OFFSET_POS_,4*T._PARAM_FILL_IB_SIZE_POS_,4*T._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_),T._DRAW_FILL_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),T._DRAW_FILL_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(T._DRAW_FILL_CMD_ENCODER_)),T._DRAW_LINES_FILL_CMD_ENCODER_||((T._DRAW_LINES_FILL_CMD_ENCODER_=j.instance.createCommandEncoder(244,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),T._DRAW_LINES_FILL_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWVG),T._DRAW_LINES_FILL_CMD_ENCODER_.useVDO(Nt.VDO_MESHVG),T._DRAW_LINES_FILL_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),T._DRAW_LINES_FILL_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),T._DRAW_LINES_FILL_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),T._DRAW_LINES_FILL_CMD_ENCODER_.setMeshExByParamData(4*T._PARAM_FILL_VB_POS_,4*T._PARAM_FILL_VB_OFFSET_POS_,4*T._PARAM_FILL_VB_SIZE_POS_,4*T._PARAM_FILL_IB_POS_,4*T._PARAM_FILL_IB_OFFSET_POS_,4*T._PARAM_FILL_IB_SIZE_POS_,4*T._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_),T._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),T._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),T._DRAW_LINES_FILL_CMD_ENCODER_.setMeshExByParamData(4*T._PARAM_LINES_VB_POS_,4*T._PARAM_LINE_VB_OFFSET_POS_,4*T._PARAM_LINES_VB_SIZE_POS_,4*T._PARAM_LINES_IB_POS_,4*T._PARAM_LINE_IB_OFFSET_POS_,4*T._PARAM_LINES_IB_SIZE_POS_,4*T._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),T._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),T._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(T._DRAW_LINES_FILL_CMD_ENCODER_)),a._paramData||(a._paramData=new ParamData(60,!0)),a._x=t,a._y=e,a._paths=i,a._brush=r,a._pen=_;for(var n=0,s=i.length;n<s;n++){var o=i[n];switch(0==n&&(a._startOriX=o[1],a._startOriY=o[2]),o[0]){case"moveTo":case"lineTo":a._lastOriX=o[1],a._lastOriY=o[2],a._points.push(o[1]),a._points.push(o[2]);break;case"arcTo":a._arcTo(o);break;case"closePath":a._points.push(a._startOriX),a._points.push(a._startOriY)}}if(a._vertNum=a._points.length,_){yt.createLine2(a._points,a._lines_ibArray,_.lineWidth,0,a._lines_vbArray,!1);var h=U.create(_.strokeStyle),l=h.numColor,u=a._vertNum;(!a.lines_vbBuffer||a.lines_vbBuffer.getByteLength()<3*a._vertNum*4)&&(a.lines_vbBuffer=new ParamData(3*u*4,!0)),a._lines_vbSize=3*a._vertNum*4;var c=a.lines_vbBuffer._float32Data,f=a.lines_vbBuffer._int32Data,d=0;for(n=0;n<a._vertNum;n++)c[d++]=a._lines_vbArray[2*n]+t,c[d++]=a._lines_vbArray[2*n+1]+e,f[d++]=l;(!a.lines_ibBuffer||a.lines_ibBuffer.getByteLength()<3*(a._vertNum-2)*2)&&(a.lines_ibBuffer=new ParamData(3*(u-2)*2,!0,!0)),a._lines_ibSize=3*(a._vertNum-2)*2;for(var A=a.lines_ibBuffer._int16Data,E=0;E<3*(a._vertNum-2);E++)A[E]=a._lines_ibArray[E]}if(r){u=a._vertNum;var m=dt.earcut(a._points,null,2);if(0<m.length){(!a.fill_ibBuffer||a.fill_ibBuffer.getByteLength()<2*m.length)&&(a.fill_ibBuffer=new ParamData(2*m.length,!0,!0)),a._fill_ibSize=2*m.length,A=a.fill_ibBuffer._int16Data;var R=0;for(E=0;E<m.length;E++)A[R++]=m[E]}l=(h=U.create(r.fillStyle)).numColor,(!a.fill_vbBuffer||a.fill_vbBuffer.getByteLength()<3*a._vertNum*4)&&(a.fill_vbBuffer=new ParamData(3*u*4,!0)),a._fill_vbSize=3*a._vertNum*4,c=a.fill_vbBuffer._float32Data;var p=a.fill_vbBuffer._int32Data;for(p=a.fill_vbBuffer._int32Data,n=d=0;n<a._vertNum;n++)c[d++]=a._points[2*n]+t,c[d++]=a._points[2*n+1]+e,p[d++]=l}a._paramData._float32Data;return(f=a._paramData._int32Data)[0]=1,_&&(f[T._PARAM_LINES_VB_POS_]=a.lines_vbBuffer.getPtrID(),f[T._PARAM_LINES_IB_POS_]=a.lines_ibBuffer.getPtrID(),f[T._PARAM_LINES_VB_SIZE_POS_]=a._lines_vbSize,f[T._PARAM_LINES_IB_SIZE_POS_]=a._lines_ibSize,f[T._PARAM_LINE_VB_OFFSET_POS_]=0,f[T._PARAM_LINE_IB_OFFSET_POS_]=0,f[T._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,j.syncBufferToRenderThread(a.lines_vbBuffer),j.syncBufferToRenderThread(a.lines_ibBuffer)),r&&(f[T._PARAM_FILL_VB_POS_]=a.fill_vbBuffer.getPtrID(),f[T._PARAM_FILL_IB_POS_]=a.fill_ibBuffer.getPtrID(),f[T._PARAM_FILL_VB_SIZE_POS_]=a._fill_vbSize,f[T._PARAM_FILL_IB_SIZE_POS_]=a._fill_ibSize,f[T._PARAM_FILL_VB_OFFSET_POS_]=0,f[T._PARAM_FILL_IB_OFFSET_POS_]=0,f[T._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_]=0,j.syncBufferToRenderThread(a.fill_vbBuffer),j.syncBufferToRenderThread(a.fill_ibBuffer)),j.syncBufferToRenderThread(a._paramData),r&&_?a._cmdCurrentPos=a._graphicsCmdEncoder.useCommandEncoder(T._DRAW_LINES_FILL_CMD_ENCODER_.getPtrID(),a._paramData.getPtrID(),-1):r&&!_?a._cmdCurrentPos=a._graphicsCmdEncoder.useCommandEncoder(T._DRAW_FILL_CMD_ENCODER_.getPtrID(),a._paramData.getPtrID(),-1):!r&&_&&(a._cmdCurrentPos=a._graphicsCmdEncoder.useCommandEncoder(T._DRAW_LINES_CMD_ENCODER_.getPtrID(),a._paramData.getPtrID(),-1)),j.syncBufferToRenderThread(a._graphicsCmdEncoder),a},T.ID="DrawPath",T._DRAW_LINES_CMD_ENCODER_=null,T._DRAW_LINES_FILL_CMD_ENCODER_=null,T._DRAW_FILL_CMD_ENCODER_=null,T._PARAM_LINES_VB_POS_=1,T._PARAM_LINES_IB_POS_=2,T._PARAM_LINES_VB_SIZE_POS_=3,T._PARAM_LINES_IB_SIZE_POS_=4,T._PARAM_FILL_VB_POS_=5,T._PARAM_FILL_IB_POS_=6,T._PARAM_FILL_VB_SIZE_POS_=7,T._PARAM_FILL_IB_SIZE_POS_=8,T._PARAM_FILL_VB_OFFSET_POS_=9,T._PARAM_FILL_IB_OFFSET_POS_=10,T._PARAM_LINE_VB_OFFSET_POS_=11,T._PARAM_LINE_IB_OFFSET_POS_=12,T._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_=13,T._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=14}(),function(){function t(){this.ALPHA=1,this.shaderType=0,this.defines=new jt,this.fillStyle=q.DEFAULT,this.strokeStyle=q.DEFAULT}return f(t,"laya.webgl.shader.d2.Shader2D"),t.prototype.destroy=function(){this.defines=null,this.filters=null},t.__init__=function(){var t,e;t="/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_MvpMatrix;\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos = vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos=mmat*pos;\n#endif\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position=u_MvpMatrix*pos1;\n#else\n\tgl_Position=pos1;\n#endif\n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = pos.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}",e="/*\n\ttexture和fillrect使用的。\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n//FILLTEXTURE\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}",he.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}",he.preCompile2D(0,4,t,e,null),t="/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_MvpMatrix;\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos = vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos=mmat*pos;\n#endif\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position=u_MvpMatrix*pos1;\n#else\n\tgl_Position=pos1;\n#endif\n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = pos.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}",e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n\n#import?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n\n#import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_uniform;\n\n#import?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n\n#import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_uniform;\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   \n   #import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_logic;\n   \n   #import?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   \n   #import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_logic;\n   \n   #import?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',he.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",he.preCompile2D(0,512,t,e,null)},t}()),Ct=function(){function t(t,e,i,r){this._idata=[]}f(t,"laya.layagl.CommandEncoder");var e=t.prototype;return e.getArrayData=function(){return this._idata},e.getPtrID=function(){return 0},e.beginEncoding=function(){},e.endEncoding=function(){},e.clearEncoding=function(){this._idata.length=0},e.getCount=function(){return this._idata.length},e.add_ShaderValue=function(t){this._idata.push(t)},e.addShaderUniform=function(t){this.add_ShaderValue(t)},t}(),gt=function(){function t(t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=t;for(var e=0,i=0,r=0;!((e=t.indexOf("#begin",e))<0);){for(r=e+5;!((r=t.indexOf("#end",r))<0)&&"i"===t.charAt(r+4);)r+=5;if(r<0)throw"add include err,no #end:"+t;i=t.indexOf("\n",e);var _=st.splitToWords(t.substr(e,i-e),null);"code"==_[1]?this.codes[_[2]]=t.substr(i+1,r-i-1):"function"==_[1]&&(i=t.indexOf("function",e),i+="function".length,this.funs[_[3]]=t.substr(i+1,r-i-1),this.funnames+=_[3]+";"),e=r+1}}f(t,"laya.webgl.utils.InlcudeFile");var e=t.prototype;return e.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},e.getFunsScript=function(t){var e="";for(var i in this.funs)0<=t.indexOf(i+";")&&(e+=this.funs[i]);return e},t}(),Mt=(function(){function m(){this._graphicsCmdEncoder=null,this._paramData=null,this._fromX=NaN,this._fromY=NaN,this._toX=NaN,this._toY=NaN,this._lineColor=null,this._lineWidth=NaN,this._vid=0}f(m,"laya.layagl.cmdNative.DrawLineCmdNative");var t=m.prototype;t.recover=function(){L.recover("DrawLineCmd",this)},A(0,t,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t;var e=U.create(this.lineColor).numColor,i=this._paramData._int32Data,r=m._PARAM_VB_POS_;r++,r++,i[r++]=e,r++,r++,i[r++]=e,r++,r++,i[r++]=e,r++,r++,i[r++]=e,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"cmdID",function(){return"DrawLine"}),A(0,t,"toY",function(){return this._toY},function(t){this._toY=t;var e=[this._fromX,this._fromY,this._toX,this._toY],i=[],r=[];yt.createLine2(e,r,this._lineWidth,0,i,!1);var _=this._paramData._float32Data,a=(this._paramData._int32Data,this._paramData._int16Data),n=m._PARAM_VB_POS_;_[n++]=i[0],_[n++]=i[1],n++,_[n++]=i[2],_[n++]=i[3],n++,_[n++]=i[4],_[n++]=i[5],n++,_[n++]=i[6],_[n++]=i[7],n++;var s=2*m._PARAM_IB_POS_;a[s++]=r[0],a[s++]=r[1],a[s++]=r[2],a[s++]=r[3],a[s++]=r[4],a[s++]=r[5],j.syncBufferToRenderThread(this._paramData)}),A(0,t,"fromX",function(){return this._fromX},function(t){this._fromX=t;var e=[this._fromX,this._fromY,this._toX,this._toY],i=[],r=[];yt.createLine2(e,r,this._lineWidth,0,i,!1);var _=this._paramData._float32Data,a=(this._paramData._int32Data,this._paramData._int16Data),n=m._PARAM_VB_POS_;_[n++]=i[0],_[n++]=i[1],n++,_[n++]=i[2],_[n++]=i[3],n++,_[n++]=i[4],_[n++]=i[5],n++,_[n++]=i[6],_[n++]=i[7],n++;var s=2*m._PARAM_IB_POS_;a[s++]=r[0],a[s++]=r[1],a[s++]=r[2],a[s++]=r[3],a[s++]=r[4],a[s++]=r[5],j.syncBufferToRenderThread(this._paramData)}),A(0,t,"vid",function(){return this._vid},function(t){this._vid=t}),A(0,t,"toX",function(){return this._toX},function(t){this._toX=t;var e=[this._fromX,this._fromY,this._toX,this._toY],i=[],r=[];yt.createLine2(e,r,this._lineWidth,0,i,!1);var _=this._paramData._float32Data,a=(this._paramData._int32Data,this._paramData._int16Data),n=m._PARAM_VB_POS_;_[n++]=i[0],_[n++]=i[1],n++,_[n++]=i[2],_[n++]=i[3],n++,_[n++]=i[4],_[n++]=i[5],n++,_[n++]=i[6],_[n++]=i[7],n++;var s=2*m._PARAM_IB_POS_;a[s++]=r[0],a[s++]=r[1],a[s++]=r[2],a[s++]=r[3],a[s++]=r[4],a[s++]=r[5],j.syncBufferToRenderThread(this._paramData)}),A(0,t,"fromY",function(){return this._fromY},function(t){this._fromY=t;var e=[this._fromX,this._fromY,this._toX,this._toY],i=[],r=[];yt.createLine2(e,r,this._lineWidth,0,i,!1);var _=this._paramData._float32Data,a=(this._paramData._int32Data,this._paramData._int16Data),n=m._PARAM_VB_POS_;_[n++]=i[0],_[n++]=i[1],n++,_[n++]=i[2],_[n++]=i[3],n++,_[n++]=i[4],_[n++]=i[5],n++,_[n++]=i[6],_[n++]=i[7],n++;var s=2*m._PARAM_IB_POS_;a[s++]=r[0],a[s++]=r[1],a[s++]=r[2],a[s++]=r[3],a[s++]=r[4],a[s++]=r[5],j.syncBufferToRenderThread(this._paramData)}),A(0,t,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t;var e=[this._fromX,this._fromY,this._toX,this._toY],i=[],r=[];yt.createLine2(e,r,this.lineWidth,0,i,!1);var _=this._paramData._float32Data,a=(this._paramData._int32Data,this._paramData._int16Data),n=m._PARAM_VB_POS_;_[n++]=i[0],_[n++]=i[1],n++,_[n++]=i[2],_[n++]=i[3],n++,_[n++]=i[4],_[n++]=i[5],n++,_[n++]=i[6],_[n++]=i[7],n++;var s=2*m._PARAM_IB_POS_;a[s++]=r[0],a[s++]=r[1],a[s++]=r[2],a[s++]=r[3],a[s++]=r[4],a[s++]=r[5],j.syncBufferToRenderThread(this._paramData)}),m.create=function(t,e,i,r,_,a,n){var s=L.getItemByClass("DrawLineCmd",m);s._graphicsCmdEncoder=this._commandEncoder,m._DRAW_LINE_CMD_ENCODER_||((m._DRAW_LINE_CMD_ENCODER_=j.instance.createCommandEncoder(152,32,!0)).useProgramEx(Nt.PROGRAMEX_DRAWVG),m._DRAW_LINE_CMD_ENCODER_.useVDO(Nt.VDO_MESHVG),m._DRAW_LINE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),m._DRAW_LINE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),m._DRAW_LINE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),m._DRAW_LINE_CMD_ENCODER_.setMeshByParamData(4*m._PARAM_VB_POS_,4*m._PARAM_VB_OFFSET_POS_,4,4*m._PARAM_IB_POS_,4*m._PARAM_IB_OFFSET_POS_,8,4*m._PARAM_INDEX_ELEMENT_OFFSET_POS_),m._DRAW_LINE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),m._DRAW_LINE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(m._DRAW_LINE_CMD_ENCODER_)),s._paramData||(s._paramData=new ParamData(96,!0)),s._fromX=t,s._fromY=e,s._toX=i,s._toY=r,s._lineColor=_,s._lineWidth=a,s._vid=n;var o=U.create(_).numColor,h=[t,e,i,r],l=[],u=[];yt.createLine2(h,u,a,0,l,!1);var c=s._paramData._float32Data,f=s._paramData._int32Data,d=s._paramData._int16Data;f[0]=1,f[1]=48,f[2]=12,f[m._PARAM_VB_OFFSET_POS_]=0,f[m._PARAM_IB_OFFSET_POS_]=0,f[m._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0;var A=m._PARAM_VB_POS_;c[A++]=l[0],c[A++]=l[1],f[A++]=o,c[A++]=l[2],c[A++]=l[3],f[A++]=o,c[A++]=l[4],c[A++]=l[5],f[A++]=o,c[A++]=l[6],c[A++]=l[7],f[A++]=o;var E=2*m._PARAM_IB_POS_;return d[E++]=u[0],d[E++]=u[1],d[E++]=u[2],d[E++]=u[3],d[E++]=u[4],d[E++]=u[5],c[m._PARAM_LINECOLOR_POS_]=_||4278190335,c[m._PARAM_LINEWIDTH_POS_]=a,c[m._PARAM_VID_POS_]=n,j.syncBufferToRenderThread(s._paramData),s._graphicsCmdEncoder.useCommandEncoder(m._DRAW_LINE_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1),j.syncBufferToRenderThread(s._graphicsCmdEncoder),s},m.ID="DrawLine",m._DRAW_LINE_CMD_ENCODER_=null,m._PARAM_VB_POS_=3,m._PARAM_IB_POS_=15,m._PARAM_LINECOLOR_POS_=18,m._PARAM_LINEWIDTH_POS_=19,m._PARAM_VID_POS_=20,m._PARAM_VB_OFFSET_POS_=21,m._PARAM_IB_OFFSET_POS_=22,m._PARAM_INDEX_ELEMENT_OFFSET_POS_=23}(),function(){function h(){this._draw_texture_cmd_encoder_=j.instance.createCommandEncoder(64,32,!0)}f(h,"laya.layagl.cmdNative.FillBorderWordsCmdNative");var t=h.prototype;t.createFillBorderText=function(l,t,e,i,r,_,a,n){U.create(_).numColor;var s={};s._curMat=new S,s._italicDeg=0,s._drawTextureUseColor=4294967295,s.fillStyle=_,s._fillColor=4294967295,s.setFillColor=function(t){s._fillColor=t},s.getFillColor=function(){return s._fillColor},s.mixRGBandAlpha=function(t){return t},s._drawTextureM=function(t,e,i,r,_,a,n,s){l.blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),l.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),l.useVDO(Nt.VDO_MESHQUADTEXTURE),l.uniformEx(Nt.GLOBALVALUE_VIEWS,0),l.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),l.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),l.uniformTexture(3,33984,t.bitmap._glTexture);var o=new Float32Array([e,i,s[0],s[1],0,0,e+r,i,s[2],s[3],0,0,e+r,i+_,s[4],s[5],0,0,e,i+_,s[6],s[7],0,0]),h=new Int32Array(o.buffer);h[4]=h[10]=h[16]=h[22]=4294967295,h[5]=h[11]=h[17]=h[23]=4294967295,l.setRectMesh(1,o,o.length),l.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),l.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(l)},h.cbook.filltext_native(s,null,t,e,i,r,_,a,n,null,0)},t.recover=function(){this._graphicsCmdEncoder=null,this.words=null,L.recover("FillBorderWordsCmd",this)},A(0,t,"cmdID",function(){return"FillBorderWords"}),h.create=function(t,e,i,r,_,a,n){h.cbook||new Error("Error:charbook not create!");var s=L.getItemByClass("FillBorderWordsCmd",h),o=s._graphicsCmdEncoder=this._commandEncoder;return s.words=t,s.x=e,s.y=i,s.font=r,s.color=_,s.strokeColor=a,s.strokeWidth=n,s._draw_texture_cmd_encoder_.clearEncoding(),s.createFillBorderText(s._draw_texture_cmd_encoder_,t,e,i,r,_,a,n),j.syncBufferToRenderThread(s._draw_texture_cmd_encoder_),o.useCommandEncoder(s._draw_texture_cmd_encoder_.getPtrID(),-1,-1),j.syncBufferToRenderThread(o),s},h.ID="FillBorderWords",n(h,["cbook",function(){return this.cbook=D.textRender}])}(),function(){function t(t,e){this.submitStartPos=0,this.submitEndPos=0,this.context=null,this.touches=[],this.submits=[],this.sprite=null,this._mesh=null,this._pathMesh=null,this._triangleMesh=null,this.meshlist=[],this._oldMesh=null,this._oldPathMesh=null,this._oldTriMesh=null,this._oldMeshList=null,this.oldTx=0,this.oldTy=0,this.cachedClipInfo=new S,this.invMat=new S,this.context=t,this.sprite=e,t._globalClipMatrix.copyTo(this.cachedClipInfo)}f(t,"laya.webgl.canvas.WebGLCacheAsNormalCanvas");var e=t.prototype;e.startRec=function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context)),this.touches.length=0,this.context.touches=this.touches,this.context._globalClipMatrix.copyTo(this.cachedClipInfo),this.submits.length=0,this.submitStartPos=this.context._submits._length;for(var t=0,e=this.meshlist.length;t<e;t++){var i=this.meshlist[t];i.canReuse?i.releaseMesh():i.destroy()}this.meshlist.length=0,this._mesh=Yt.getAMesh(),this._pathMesh=Ht.getAMesh(),this._triangleMesh=Zt.getAMesh(),this.meshlist.push(this._mesh),this.meshlist.push(this._pathMesh),this.meshlist.push(this._triangleMesh),this.context._curSubmit=At.RENDERBASE,this._oldMesh=this.context._mesh,this._oldPathMesh=this.context._pathMesh,this._oldTriMesh=this.context._triangleMesh,this._oldMeshList=this.context.meshlist,this.context._mesh=this._mesh,this.context._pathMesh=this._pathMesh,this.context._triangleMesh=this._triangleMesh,this.context.meshlist=this.meshlist,this.oldTx=this.context._curMat.tx,this.oldTy=this.context._curMat.ty,this.context._curMat.tx=0,this.context._curMat.ty=0,this.context._curMat.copyTo(this.invMat),this.invMat.invert()},e.endRec=function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context));var t=this.context._submits;this.submitEndPos=t._length;for(var e=this.submitEndPos-this.submitStartPos,i=0;i<e;i++)this.submits.push(t[this.submitStartPos+i]);t._length-=e,this.context._mesh=this._oldMesh,this.context._pathMesh=this._oldPathMesh,this.context._triangleMesh=this._oldTriMesh,this.context.meshlist=this._oldMeshList,this.context._curSubmit=At.RENDERBASE,this.context._curMat.tx=this.oldTx,this.context._curMat.ty=this.oldTy,this.context.touches=null},e.isCacheValid=function(){var t=this.context._globalClipMatrix;return t.a==this.cachedClipInfo.a&&t.b==this.cachedClipInfo.b&&t.c==this.cachedClipInfo.c&&t.d==this.cachedClipInfo.d&&t.tx==this.cachedClipInfo.tx&&t.ty==this.cachedClipInfo.ty},e.flushsubmit=function(){var e=At.RENDERBASE;this.submits.forEach(function(t){t!=At.RENDERBASE&&(At.preRender=e,(e=t).renderSubmit())})},e.releaseMem=function(){},n(t,["matI",function(){return this.matI=new S}])}(),function(){function t(t,e,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return f(t,"laya.webgl.shapes.EarcutNode"),t}()),yt=function(){function x(){}return f(x,"laya.webgl.shapes.BasePoly"),x.createLine2=function(t,e,i,r,_,a){if(t.length<4)return null;var n=x.tempData.length>t.length+2?x.tempData:new Array(t.length+2);n[0]=t[0],n[1]=t[1];var s=2,o=0,h=t.length;for(o=2;o<h;o+=2).01<Math.abs(t[o]-t[o-2])+Math.abs(t[o+1]-t[o-1])&&(n[s++]=t[o],n[s++]=t[o+1]);a&&.01<Math.abs(t[0]-n[s-2])+Math.abs(t[1]-n[s-1])&&(n[s++]=t[0],n[s++]=t[1]);var l=_;h=s/2;var u,c,f,d,A,E,m,R,p,T,v,D,P,C,g,M,y,O,S,b,L=i/2;f=n[0],d=n[1],T=f-(A=n[2]);p=(p=-(d-(E=n[3])))/(b=Math.sqrt(p*p+T*T))*L,T=T/b*L;for(l.push(f-p,d-T,f+p,d+T),o=1;o<h-1;o++)f=n[2*(o-1)],d=n[2*(o-1)+1],A=n[2*o],E=n[2*o+1],m=n[2*(o+1)],R=n[2*(o+1)+1],T=f-A,D=A-m,g=(-(p=(p=-(d-E))/(b=Math.sqrt(p*p+T*T))*L)+f)*(-(T=T/b*L)+E)-(-p+A)*(-T+d),O=(-(v=(v=-(E-R))/(b=Math.sqrt(v*v+D*D))*L)+m)*(-(D=D/b*L)+E)-(-v+A)*(-D+R),S=(P=-T+d-(-T+E))*(y=-v+A-(-v+m))-(M=-D+R-(-D+E))*(C=-p+A-(-p+f)),Math.abs(S)<.1?(S+=10.1,l.push(A-p,E-T,A+p,E+T)):(((u=(C*O-y*g)/S)-A)*(u-A)+((c=(M*g-P*O)/S)-E)+(c-E),l.push(u,c,A-(u-A),E-(c-E)));for(f=n[s-4],d=n[s-3],T=f-(A=n[s-2]),p=(p=-(d-(E=n[s-1])))/(b=Math.sqrt(p*p+T*T))*L,T=T/b*L,l.push(A-p,E-T,A+p,E+T),o=1;o<h;o++)e.push(r+2*(o-1),r+2*(o-1)+1,r+2*o+1,r+2*o+1,r+2*o,r+2*(o-1));return l},x.createLineTriangle=function(t,e,i,r,_,a,n){var s=t.slice(),o=s.length,h=s[0],l=s[1],u=s[2],c=(s[2],0),f=0,d=0,A=0,E=o/2;if(!(E<=1)&&2!=E){for(var m=new Array(4*E),R=0,p=0,T=0;T<E-1;T++)h=s[p++],l=s[p++],u=s[p++],A=s[p++]-l,0!=(d=u-h)&&0!=A&&.001<(c=Math.sqrt(d*d+A*A))&&(m[f=4*R]=h,m[f+1]=l,m[f+2]=d/c,m[f+3]=A/c,R++);for(r?(h=s[o-2],l=s[o-1],u=s[0],A=s[1]-l,0!=(d=u-h)&&0!=A&&.001<(c=Math.sqrt(d*d+A*A))&&(m[f=4*R]=h,m[f+1]=l,m[f+2]=d/c,m[f+3]=A/c,R++)):(m[f=4*R]=h,m[f+1]=l,m[f+2]=d/c,m[f+3]=A/c,R++),T=p=0;T<E;T++){h=s[p],l=s[p+1],u=s[p+2],s[p+3];s[p+4],s[p+5]}}},n(x,["tempData",function(){return this.tempData=new Array(256)}]),x}(),Ot=function(){function n(){this._data=[],this._ndata=0,this._tex=null,this._imgId=0,this._clipid=-1,this._enbale=!1,this._colorFiler=null,this._clipMatrix=new S}f(n,"laya.webgl.text.CharSubmitCache");var t=n.prototype;return t.clear=function(){this._tex=null,this._imgId=-1,this._ndata=0,this._enbale=!1,this._colorFiler=null},t.destroy=function(){this.clear(),this._data.length=0,this._data=null},t.add=function(t,e,i,r,_,a){0<this._ndata&&(this._tex!=e||this._imgId!=i||0<=this._clipid&&this._clipid!=t._clipInfoID)&&this.submit(t),this._clipid=t._clipInfoID,t._globalClipMatrix.copyTo(this._clipMatrix),this._tex=e,this._imgId=i,this._colorFiler=t._colorFiler,this._data[this._ndata]=r,this._data[this._ndata+1]=_,this._data[this._ndata+2]=a,this._ndata+=3},t.getPos=function(){return 0==n.__nPosPool?new Array(8):n.__posPool[--n.__nPosPool]},t.enable=function(t,e){t!==this._enbale&&(this._enbale=t,this._enbale||this.submit(e))},t.submit=function(t){var e=this._ndata;if(e){var i=t._mesh,r=t._colorFiler;t._colorFiler=this._colorFiler;var _=te.create(t,i,Y.create(1,0));t._submits[t._submits._length++]=t._curSubmit=_,_.shaderValue.textureHost=this._tex,_._key.other=this._imgId,t._colorFiler=r,t._copyClipInfo(_,this._clipMatrix),_.clipInfoID=this._clipid;for(var a=0;a<e;a+=3)i.addQuad(this._data[a],this._data[a+1],this._data[a+2],!0),n.__posPool[n.__nPosPool++]=this._data[a];e/=3,_._numEle+=6*e,i.indexNum+=6*e,i.vertNum+=4*e,t._drawCount+=e,this._ndata=0,I.loopCount%100==0&&(this._data.length=0)}},n.__posPool=[],n.__nPosPool=0,n}(),St=(function(){function m(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=NaN,this._y=NaN,this._width=NaN,this._height=NaN,this._matrix=null,this._alpha=NaN,this._color=null,this._blendMode=null,this._cmdCurrentPos=0,this._blend_src=0,this._blend_dest=0}f(m,"laya.layagl.cmdNative.DrawTextureCmdNative");var t=m.prototype;t.recover=function(){this._texture=null,L.recover("DrawTextureCmd",this)},t._setBlendMode=function(t){switch(t){case"normal":this._blend_src=1,this._blend_dest=771;break;case"add":this._blend_src=1,this._blend_dest=772;break;case"multiply":this._blend_src=774,this._blend_dest=771;break;case"screen":case"light":this._blend_src=1,this._blend_dest=1;break;case"overlay":this._blend_src=1,this._blend_dest=769;break;case"destination-out":this._blend_src=0,this._blend_dest=0;break;case"mask":this._blend_src=0,this._blend_dest=770;break;default:alert("_setBlendMode Unknown type")}},t._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},A(0,t,"cmdID",function(){return"DrawTexture"}),A(0,t,"matrix",function(){return this._matrix},function(t){this._matrix||(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.getPtrID(),j.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._matrix=t;var e=this._paramData._float32Data;e[m._PARAM_MATRIX_POS_]=t.a,e[m._PARAM_MATRIX_POS_+1]=t.b,e[m._PARAM_MATRIX_POS_+2]=t.c,e[m._PARAM_MATRIX_POS_+3]=t.d,e[m._PARAM_MATRIX_POS_+4]=t.tx,e[m._PARAM_MATRIX_POS_+5]=t.ty,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"y",function(){return this._y},function(t){this._y=t;var e=this._paramData._float32Data;e[m._PARAM_VB_POS_+1]=this._y,e[m._PARAM_VB_POS_+7]=this._y,e[m._PARAM_VB_POS_+13]=this._y+this._height,e[m._PARAM_VB_POS_+19]=this._y+this._height,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"texture",function(){return this._texture},function(t){if(t&&t.url){this._texture=t,this._paramData._int32Data[m._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id;var e=this._paramData._float32Data,i=this.texture.uv;e[m._PARAM_VB_POS_+2]=i[0],e[m._PARAM_VB_POS_+3]=i[1],e[m._PARAM_VB_POS_+8]=i[2],e[m._PARAM_VB_POS_+9]=i[3],e[m._PARAM_VB_POS_+14]=i[4],e[m._PARAM_VB_POS_+15]=i[5],e[m._PARAM_VB_POS_+20]=i[6],e[m._PARAM_VB_POS_+21]=i[7],j.syncBufferToRenderThread(this._paramData)}}),A(0,t,"width",function(){return this._width},function(t){this._width=t;var e=this._paramData._float32Data;e[m._PARAM_VB_POS_]=this._x,e[m._PARAM_VB_POS_+6]=this._x+this._width,e[m._PARAM_VB_POS_+12]=this._x+this._width,e[m._PARAM_VB_POS_+18]=this._x,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"x",function(){return this._x},function(t){this._x=t;var e=this._paramData._float32Data;e[m._PARAM_VB_POS_]=this._x,e[m._PARAM_VB_POS_+6]=this._x+this._width,e[m._PARAM_VB_POS_+12]=this._x+this._width,e[m._PARAM_VB_POS_+18]=this._x,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"height",function(){return this._height},function(t){this._height=t;var e=this._paramData._float32Data;e[m._PARAM_VB_POS_+1]=this._y,e[m._PARAM_VB_POS_+7]=this._y,e[m._PARAM_VB_POS_+13]=this._y+this._height,e[m._PARAM_VB_POS_+19]=this._y+this._height,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"alpha",function(){return this._alpha},function(t){this._alpha=t}),m.create=function(t,e,i,r,_,a,n,s,o){var h=L.getItemByClass("DrawTextureCmd",m);h._graphicsCmdEncoder=this._commandEncoder,m._DRAW_TEXTURE_CMD_ENCODER_||((m._DRAW_TEXTURE_CMD_ENCODER_=j.instance.createCommandEncoder(188,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),m._DRAW_TEXTURE_CMD_ENCODER_.blendFuncByParamData(4*m._PARAM_BLEND_SRC_POS_,4*m._PARAM_BLEND_DEST_POS_),m._DRAW_TEXTURE_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),m._DRAW_TEXTURE_CMD_ENCODER_.useVDO(Nt.VDO_MESHQUADTEXTURE),m._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),m._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),m._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),m._DRAW_TEXTURE_CMD_ENCODER_.uniformTextureByParamData(4*m._PARAM_UNIFORM_LOCATION_POS_,4*m._PARAM_TEX_LOCATION_POS_,4*m._PARAM_TEXTURE_POS_),m._DRAW_TEXTURE_CMD_ENCODER_.setRectMeshByParamData(4*m._PARAM_RECT_NUM_POS_,4*m._PARAM_VB_POS_,4*m._PARAM_VB_SIZE_POS_),m._DRAW_TEXTURE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),m._DRAW_TEXTURE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(m._DRAW_TEXTURE_CMD_ENCODER_)),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_||((m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_=j.instance.createCommandEncoder(224,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.blendFuncByParamData(4*m._PARAM_BLEND_SRC_POS_,4*m._PARAM_BLEND_DEST_POS_),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.useVDO(Nt.VDO_MESHQUADTEXTURE),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.save(),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.setGlobalValueByParamData(Nt.GLOBALVALUE_MATRIX32,7,4*m._PARAM_MATRIX_POS_),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformTextureByParamData(4*m._PARAM_UNIFORM_LOCATION_POS_,4*m._PARAM_TEX_LOCATION_POS_,4*m._PARAM_TEXTURE_POS_),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.setRectMeshByParamData(4*m._PARAM_RECT_NUM_POS_,4*m._PARAM_VB_POS_,4*m._PARAM_VB_SIZE_POS_),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.restore(),j.syncBufferToRenderThread(m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_)),h._paramData||(h._paramData=new ParamData(148,!0)),h._texture=t,h._x=e,h._y=i,h._width=r,h._height=_,h._matrix=a,h._alpha=n,h._color=s,h._blendMode=o;var l=0!=r?r:t.bitmap.width,u=0!=_?_:t.bitmap.height,c=t.uv,f=h._paramData._float32Data,d=h._paramData._int32Data;d[m._PARAM_UNIFORM_LOCATION_POS_]=3,d[m._PARAM_TEX_LOCATION_POS_]=33984,d[m._PARAM_TEXTURE_POS_]=t.bitmap._glTexture.id,d[m._PARAM_RECT_NUM_POS_]=1,d[m._PARAM_VB_SIZE_POS_]=96,d[m._PARAM_BLEND_DEST_POS_]=o?(h._setBlendMode(o),d[m._PARAM_BLEND_SRC_POS_]=h._blend_src,h._blend_dest):d[m._PARAM_BLEND_SRC_POS_]=-1;var A=4294967295;n&&(A=h._mixRGBandAlpha(A,n));var E=m._PARAM_VB_POS_;return f[E++]=e,f[E++]=i,f[E++]=c[0],f[E++]=c[1],d[E++]=A,d[E++]=4294967295,f[E++]=e+l,f[E++]=i,f[E++]=c[2],f[E++]=c[3],d[E++]=A,d[E++]=4294967295,f[E++]=e+l,f[E++]=i+u,f[E++]=c[4],f[E++]=c[5],d[E++]=A,d[E++]=4294967295,f[E++]=e,f[E++]=i+u,f[E++]=c[6],f[E++]=c[7],d[E++]=A,d[E++]=4294967295,a&&(f[m._PARAM_MATRIX_POS_]=a.a,f[m._PARAM_MATRIX_POS_+1]=a.b,f[m._PARAM_MATRIX_POS_+2]=a.c,f[m._PARAM_MATRIX_POS_+3]=a.d,f[m._PARAM_MATRIX_POS_+4]=a.tx,f[m._PARAM_MATRIX_POS_+5]=a.ty),j.syncBufferToRenderThread(h._paramData),h._cmdCurrentPos=a?h._graphicsCmdEncoder.useCommandEncoder(m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.getPtrID(),h._paramData.getPtrID(),-1):h._graphicsCmdEncoder.useCommandEncoder(m._DRAW_TEXTURE_CMD_ENCODER_.getPtrID(),h._paramData.getPtrID(),-1),j.syncBufferToRenderThread(h._graphicsCmdEncoder),h},m.ID="DrawTexture",m._DRAW_TEXTURE_CMD_ENCODER_=null,m._DRAW_TEXTURE_CMD_ENCODER_MATRIX_=null,m._PARAM_UNIFORM_LOCATION_POS_=0,m._PARAM_TEX_LOCATION_POS_=1,m._PARAM_TEXTURE_POS_=2,m._PARAM_RECT_NUM_POS_=3,m._PARAM_VB_SIZE_POS_=4,m._PARAM_VB_POS_=5,m._PARAM_MATRIX_POS_=29,m._PARAM_BLEND_SRC_POS_=35,m._PARAM_BLEND_DEST_POS_=36}(),function(){function i(){this._graphicsCmdEncoder=null}f(i,"laya.layagl.cmdNative.RestoreCmdNative");var t=i.prototype;t.recover=function(){L.recover("RestoreCmd",this)},A(0,t,"cmdID",function(){return"Restore"}),i.create=function(){var t=L.getItemByClass("RestoreCmd",i),e=t._graphicsCmdEncoder=this._commandEncoder;return e.restore(),j.syncBufferToRenderThread(e),t},i.ID="Restore"}(),function(){function a(){}return f(a,"laya.webgl.resource.WebGLRTMgr"),a.getRT=function(t,e){e|=0,1e4<=(t|=0)&&console.error("getRT error! w too big");var i,r=1e4*e+t,_=a.dict[r];return _&&0<_.length?(i=_.pop())._mgrKey=r:(i=new le(t,e,1,-1))._mgrKey=r,i},a.releaseRT=function(t){if(!(t._mgrKey<=0)){var e=a.dict[t._mgrKey];!e&&(e=[],a.dict[t._mgrKey]=e),t._mgrKey=0,e.push(t)}},a.dict={},a}()),bt=(function(){function h(){this._graphicsCmdEncoder=null,this._paramData=null,this.vbBuffer=null,this._template=null,this._floatCountPerVertex=29,this._firstNewElement=0,this._firstFreeElement=0,this._firstActiveElement=0,this._firstRetiredElement=0,this._maxParticleNum=0}f(h,"laya.layagl.cmdNative.DrawParticleCmdNative");var t=h.prototype;t.updateParticle=function(){if(this._template.texture){this._template.updateParticleForNative();var t=this._template.sv,e=this._paramData._int32Data,i=this._paramData._float32Data;i[h._PARAM_CURRENTTIME_POS_]=t.u_CurrentTime,i[h._PARAM_DURATION_POS_]=t.u_Duration,i[h._PARAM_ENDVEL_POS_]=t.u_EndVelocity,i[h._PARAM_GRAVITY_POS_]=t.u_Gravity[0],i[h._PARAM_GRAVITY_POS_+1]=t.u_Gravity[1],i[h._PARAM_GRAVITY_POS_+2]=t.u_Gravity[2],t.size[0]=bt.width,t.size[1]=bt.height,i[h._PARAM_SIZE_POS_]=t.size[0],i[h._PARAM_SIZE_POS_+1]=t.size[1],i[h._PARAM_MAT_POS_]=1,i[h._PARAM_MAT_POS_+1]=0,i[h._PARAM_MAT_POS_+2]=0,i[h._PARAM_MAT_POS_+3]=0,i[h._PARAM_MAT_POS_+4]=0,i[h._PARAM_MAT_POS_+5]=1,i[h._PARAM_MAT_POS_+6]=0,i[h._PARAM_MAT_POS_+7]=0,i[h._PARAM_MAT_POS_+8]=0,i[h._PARAM_MAT_POS_+9]=0,i[h._PARAM_MAT_POS_+10]=1,i[h._PARAM_MAT_POS_+11]=0,i[h._PARAM_MAT_POS_+12]=0,i[h._PARAM_MAT_POS_+13]=0,i[h._PARAM_MAT_POS_+14]=0,i[h._PARAM_MAT_POS_+15]=1,e[h._PARAM_TEXTURE_LOC_POS_]=33984,e[h._PARAM_TEXTURE_POS_]=this._template.texture.bitmap._glTexture.id,this.vbBuffer=this._template.getConchMesh(),this._firstNewElement=this._template.getFirstNewElement(),this._firstFreeElement=this._template.getFirstFreeElement(),this._firstActiveElement=this._template.getFirstActiveElement(),this._firstRetiredElement=this._template.getFirstRetiredElement();var r=0,_=0,a=0,n=0,s=0,o=0;this._firstActiveElement!=this._firstFreeElement&&(this._firstActiveElement<this._firstFreeElement?(e[h._PARAM_REGDATA_POS_]=1,s=this._firstFreeElement-this._firstActiveElement,r=(this._firstFreeElement-this._firstActiveElement)*this._floatCountPerVertex*4*4,a=this._firstActiveElement*this._floatCountPerVertex*4*4):(e[h._PARAM_REGDATA_POS_]=0,s=this._maxParticleNum-this._firstActiveElement,r=(this._maxParticleNum-this._firstActiveElement)*this._floatCountPerVertex*4*4,a=this._firstActiveElement*this._floatCountPerVertex*4*4,0<this._firstFreeElement?(o=this._firstFreeElement,_=this._firstFreeElement*this._floatCountPerVertex*4*4,n=0):e[h._PARAM_REGDATA_POS_]=1)),e[h._PARAM_VB1_POS_]=this.vbBuffer.getPtrID(),e[h._PARAM_RECT1_NUM_POS_]=s,e[h._PARAM_VB1_SIZE_POS_]=r,e[h._PARAM_VB1_OFFSET_POS_]=a,j.syncBufferToRenderThread(this.vbBuffer),0<_&&(e[h._PARAM_VB2_POS_]=this.vbBuffer.getPtrID(),e[h._PARAM_RECT2_NUM_POS_]=o,e[h._PARAM_VB2_SIZE_POS_]=_,e[h._PARAM_VB2_OFFSET_POS_]=n),j.syncBufferToRenderThread(this._paramData),this._template.addDrawCounter()}},t.recover=function(){this._template=null,L.recover("DrawParticleCmd",this)},A(0,t,"cmdID",function(){return"DrawParticleCmd"}),h.create=function(t){var e=L.getItemByClass("DrawParticleCmd",h);e._graphicsCmdEncoder=this._commandEncoder,h._DRAW_PARTICLE_CMD_ENCODER_||((h._DRAW_PARTICLE_CMD_ENCODER_=j.instance.createCommandEncoder(284,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),h._DRAW_PARTICLE_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWPARTICLE),h._DRAW_PARTICLE_CMD_ENCODER_.useVDO(Nt.VDO_MESHPARTICLE),h._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(0,4*h._PARAM_CURRENTTIME_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(1,4*h._PARAM_DURATION_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(2,4*h._PARAM_ENDVEL_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(3,4*h._PARAM_GRAVITY_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(4,4*h._PARAM_SIZE_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(5,4*h._PARAM_MAT_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.uniformTextureByParamData(4*h._PARAM_TEXTURE_UNIFORMLOC_POS_,4*h._PARAM_TEXTURE_LOC_POS_,4*h._PARAM_TEXTURE_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.setRectMeshExByParamData(4*h._PARAM_RECT1_NUM_POS_,4*h._PARAM_VB1_POS_,4*h._PARAM_VB1_SIZE_POS_,4*h._PARAM_VB1_OFFSET_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,1,7),h._DRAW_PARTICLE_CMD_ENCODER_.loadDataToRegByParamData(0,4*h._PARAM_REGDATA_POS_,4),h._DRAW_PARTICLE_CMD_ENCODER_.ifGreater0(0,2),h._DRAW_PARTICLE_CMD_ENCODER_.setRectMeshExByParamData(4*h._PARAM_RECT2_NUM_POS_,4*h._PARAM_VB2_POS_,4*h._PARAM_VB2_SIZE_POS_,4*h._PARAM_VB2_OFFSET_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,1,7),j.syncBufferToRenderThread(h._DRAW_PARTICLE_CMD_ENCODER_)),e._paramData||(e._paramData=new ParamData(144,!0)),e._template=t,e._maxParticleNum=t.settings.maxPartices;var i=e._paramData._int32Data,r=(t._sv,e._paramData._float32Data),_=0;for(r[h._PARAM_CURRENTTIME_POS_]=-1,r[h._PARAM_DURATION_POS_]=-1,r[h._PARAM_ENDVEL_POS_]=-1,r[h._PARAM_GRAVITY_POS_]=-1,r[h._PARAM_GRAVITY_POS_+1]=-1,r[h._PARAM_GRAVITY_POS_+2]=-1,r[h._PARAM_SIZE_POS_]=-1,r[h._PARAM_SIZE_POS_+1]=-1,_=0;_<16;_++)r[h._PARAM_MAT_POS_+_]=-1;return i[h._PARAM_TEXTURE_LOC_POS_]=-1,i[h._PARAM_TEXTURE_POS_]=-1,i[h._PARAM_TEXTURE_UNIFORMLOC_POS_]=6,i[h._PARAM_REGDATA_POS_]=0,i[h._PARAM_VB1_POS_]=-1,i[h._PARAM_VB2_POS_]=-1,i[h._PARAM_VB1_SIZE_POS_]=-1,i[h._PARAM_VB2_SIZE_POS_]=-1,i[h._PARAM_RECT1_NUM_POS_]=-1,i[h._PARAM_RECT2_NUM_POS_]=-1,j.syncBufferToRenderThread(e._paramData),e._graphicsCmdEncoder.useCommandEncoder(h._DRAW_PARTICLE_CMD_ENCODER_.getPtrID(),e._paramData.getPtrID(),-1),j.syncBufferToRenderThread(e._graphicsCmdEncoder),e},h.ID="DrawParticleCmd",h._DRAW_PARTICLE_CMD_ENCODER_=null,h._PARAM_VB1_POS_=0,h._PARAM_VB2_POS_=1,h._PARAM_VB1_SIZE_POS_=2,h._PARAM_VB2_SIZE_POS_=3,h._PARAM_CURRENTTIME_POS_=4,h._PARAM_DURATION_POS_=5,h._PARAM_ENDVEL_POS_=6,h._PARAM_GRAVITY_POS_=7,h._PARAM_SIZE_POS_=10,h._PARAM_MAT_POS_=12,h._PARAM_TEXTURE_LOC_POS_=28,h._PARAM_TEXTURE_POS_=29,h._PARAM_REGDATA_POS_=30,h._PARAM_TEXTURE_UNIFORMLOC_POS_=31,h._PARAM_RECT1_NUM_POS_=32,h._PARAM_RECT2_NUM_POS_=33,h._PARAM_VB1_OFFSET_POS_=34,h._PARAM_VB2_OFFSET_POS_=35}(),function(){function _(){}return f(_,"laya.webgl.utils.RenderState2D"),_.mat2MatArray=function(t,e){var i=t,r=e;return r[0]=i.a,r[1]=i.b,r[2]=_.EMPTYMAT4_ARRAY[2],r[3]=_.EMPTYMAT4_ARRAY[3],r[4]=i.c,r[5]=i.d,r[6]=_.EMPTYMAT4_ARRAY[6],r[7]=_.EMPTYMAT4_ARRAY[7],r[8]=_.EMPTYMAT4_ARRAY[8],r[9]=_.EMPTYMAT4_ARRAY[9],r[10]=_.EMPTYMAT4_ARRAY[10],r[11]=_.EMPTYMAT4_ARRAY[11],r[12]=i.tx,r[13]=i.ty,r[14]=_.EMPTYMAT4_ARRAY[14],r[15]=_.EMPTYMAT4_ARRAY[15],e},_.restoreTempArray=function(){_.TEMPMAT4_ARRAY[0]=1,_.TEMPMAT4_ARRAY[1]=0,_.TEMPMAT4_ARRAY[4]=0,_.TEMPMAT4_ARRAY[5]=1,_.TEMPMAT4_ARRAY[12]=0,_.TEMPMAT4_ARRAY[13]=0},_.clear=function(){_.worldScissorTest=!1,_.worldAlpha=1},_._MAXSIZE=99999999,_.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_.worldMatrix4=_.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_.matWVP=null,_.worldAlpha=1,_.worldScissorTest=!1,_.worldShaderDefines=null,_.worldFilters=null,_.width=0,_.height=0,n(_,["worldMatrix",function(){return this.worldMatrix=new S}]),_}()),Lt=(function(){function _(){this._renderType=0,this._repaint=0,this._x=NaN,this._y=NaN}f(_,"laya.layagl.QuickTestTool");var t=_.prototype;t.render=function(t,e,i){I.spriteCount++,_._addType(this._renderType),_.showRenderTypeInfo(this._renderType),m.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0},t._stageRender=function(t,e,i){_._countStart(),_._PreStageRender.call(D.stage,t,e,i),_._countEnd()},_.getMCDName=function(t){return _._typeToNameDic[t]},_.showRenderTypeInfo=function(t,e){if(void 0===e&&(e=!1),e||!_.showedDic[t]){if(_.showedDic[t]=!0,!_._rendertypeToStrDic[t]){var i=[],r=0;for(r=1;r<=t;)r&t&&i.push(_.getMCDName(r&t)),r<<=1;_._rendertypeToStrDic[t]=i.join(",")}console.log("cmd:",_._rendertypeToStrDic[t])}},_.__init__=function(){_._typeToNameDic[1]="ALPHA",_._typeToNameDic[2]="TRANSFORM",_._typeToNameDic[256]="TEXTURE",_._typeToNameDic[512]="GRAPHICS",_._typeToNameDic[4096]="ONECHILD",_._typeToNameDic[8192]="CHILDS",_._typeToNameDic[3]="TRANSFORM|ALPHA",_._typeToNameDic[8]="CANVAS",_._typeToNameDic[4]="BLEND",_._typeToNameDic[16]="FILTERS",_._typeToNameDic[32]="MASK",_._typeToNameDic[64]="CLIP",_._typeToNameDic[1024]="LAYAGL3D"},_._countStart=function(){var t;for(t in _._countDic)_._countDic[t]=0},_._countEnd=function(){60<++_._i&&(_.showCountInfo(),_._i=0)},_._addType=function(t){_._countDic[t]?_._countDic[t]+=1:_._countDic[t]=1},_.showCountInfo=function(){var t;for(t in console.log("==================="),_._countDic)console.log("count:"+_._countDic[t]),_.showRenderTypeInfo(t,!0)},_.enableQuickTest=function(){_.__init__(),B.prototype.render=_.prototype.render,_._PreStageRender=y.prototype.render,y.prototype.render=_.prototype._stageRender},_.showedDic={},_._rendertypeToStrDic={},_._typeToNameDic={},_._PreStageRender=null,_._countDic={},_._i=0}(),function(){function t(){this.blendShader=0,this.submitType=0,this.other=0,this.clear()}f(t,"laya.webgl.submit.SubmitKey");var e=t.prototype;return e.clear=function(){this.submitType=-1,this.blendShader=this.other=0},e.copyFrom=function(t){this.other=t.other,this.blendShader=t.blendShader,this.submitType=t.submitType},e.copyFrom2=function(t,e,i){this.other=i,this.submitType=e},e.equal3_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},e.equal4_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},e.equal_3=function(t){return this.submitType===t.submitType&&this.blendShader===t.blendShader},e.equal=function(t){return this.other===t.other&&this.submitType===t.submitType&&this.blendShader===t.blendShader},t}()),xt=(function(){function u(){this._graphicsCmdEncoder=null,this._index=0,this._text=null,this._x=NaN,this._y=NaN,this._font=null,this._color=null,this._strokeColor=null,this._strokeWidth=0,this._textAlign=null,this._draw_texture_cmd_encoder_=j.instance.createCommandEncoder(64,32,!0)}f(u,"laya.layagl.cmdNative.FillBorderTextCmdNative");var t=u.prototype;t.createFillBorderText=function(l,t,e,i,r,_,a,n,s){U.create(_).numColor;var o={};o._curMat=new S,o._italicDeg=0,o._drawTextureUseColor=4294967295,o.fillStyle=_,o._fillColor=4294967295,o.setFillColor=function(t){o._fillColor=t},o.getFillColor=function(){return o._fillColor},o.mixRGBandAlpha=function(t){return t},o._drawTextureM=function(t,e,i,r,_,a,n,s){l.blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),l.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),l.useVDO(Nt.VDO_MESHQUADTEXTURE),l.uniformEx(Nt.GLOBALVALUE_VIEWS,0),l.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),l.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),l.uniformTexture(3,33984,t.bitmap._glTexture);var o=new Float32Array([e,i,s[0],s[1],0,0,e+r,i,s[2],s[3],0,0,e+r,i+_,s[4],s[5],0,0,e,i+_,s[6],s[7],0,0]),h=new Int32Array(o.buffer);h[4]=h[10]=h[16]=h[22]=4294967295,h[5]=h[11]=h[17]=h[23]=4294967295,l.setRectMesh(1,o,o.length),l.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),l.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(l)},u.cbook.filltext_native(o,t,null,e,i,r,_,a,n,s)},t.recover=function(){this._graphicsCmdEncoder=null,L.recover("FillBorderTextCmd",this)},A(0,t,"text",function(){return this._text},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._text=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),j.syncBufferToRenderThread(e)}),A(0,t,"cmdID",function(){return"FillBorderText"}),A(0,t,"font",function(){return this._font},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._font=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),j.syncBufferToRenderThread(e)}),A(0,t,"color",function(){return this._color},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._color=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),j.syncBufferToRenderThread(e)}),A(0,t,"textAlign",function(){return this._textAlign},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._textAlign=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),j.syncBufferToRenderThread(e)}),A(0,t,"x",function(){return this._x},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._x=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),j.syncBufferToRenderThread(e)}),A(0,t,"y",function(){return this._y},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._y=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),j.syncBufferToRenderThread(e)}),u.create=function(t,e,i,r,_,a,n,s){u.cbook||new Error("Error:charbook not create!");var o=L.getItemByClass("FillBorderTextCmd",u),h=o._graphicsCmdEncoder=this._commandEncoder;return o._text=t,o._x=e,o._y=i,o._font=r,o._color=_,o._strokeColor=a,o._strokeWidth=n,o._textAlign=s,o._draw_texture_cmd_encoder_.clearEncoding(),o.createFillBorderText(o._draw_texture_cmd_encoder_,t,e,i,r,_,a,n,s),j.syncBufferToRenderThread(o._draw_texture_cmd_encoder_),h.useCommandEncoder(o._draw_texture_cmd_encoder_.getPtrID(),-1,-1),j.syncBufferToRenderThread(h),o},u.ID="FillBorderText",n(u,["cbook",function(){return this.cbook=D.textRender}])}(),function(){function t(){}return f(t,"laya.layagl.ConchPropertyAdpt"),t.rewriteProperties=function(){laya.layagl.ConchPropertyAdpt.rewriteNumProperty(M.prototype,"x"),laya.layagl.ConchPropertyAdpt.rewriteNumProperty(M.prototype,"y"),laya.layagl.ConchPropertyAdpt.rewriteNumProperty(M.prototype,"width"),laya.layagl.ConchPropertyAdpt.rewriteNumProperty(M.prototype,"height"),laya.layagl.ConchPropertyAdpt.rewriteFunc(M.prototype,"recover")},t.rewriteNumProperty=function(t,e){Object.defineProperty(t,e,{get:function(){return this["_"+e]||0},set:function(t){this["_"+e]=t,this.onPropertyChanged&&this.onPropertyChanged(this)}})},t.rewriteFunc=function(t,e){t["__"+e]=t[e],t[e]=function(){t["__"+e].call(this),this.onPropertyChanged&&(this.onPropertyChanged=null)}},t}()),Bt=function(){function r(t,e,i,r,_,a,n){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===_&&(_=0),void 0===a&&(a=0),this._nums=n=n||new Float32Array(6),n[0]=t,n[1]=e,n[2]=i,n[3]=r,n[4]=_,n[5]=a,this._checkTransform()}f(r,"laya.layagl.MatrixConch");var t=r.prototype;return t.identity=function(){var t=this._nums;return t[0]=t[3]=1,t[1]=t[4]=t[5]=t[2]=0,this._bTransform=!1,this},t._checkTransform=function(){var t=this._nums;return this._bTransform=1!==t[0]||0!==t[1]||0!==t[2]||1!==t[3]},t.setTranslate=function(t,e){return this._nums[4]=t,this._nums[5]=e,this},t.translate=function(t,e){return this._nums[4]+=t,this._nums[5]+=e,this},t.scale=function(t,e){var i=this._nums;return i[0]*=t,i[3]*=e,i[2]*=t,i[1]*=e,i[4]*=t,i[5]*=e,this._bTransform=!0,this},t.rotate=function(t){var e=this._nums,i=Math.cos(t),r=Math.sin(t),_=e[0],a=e[2],n=e[4];return e[0]=_*i-e[1]*r,e[1]=_*r+e[1]*i,e[2]=a*i-e[3]*r,e[3]=a*r+e[3]*i,e[4]=n*i-e[5]*r,e[5]=n*r+e[5]*i,this._bTransform=!0,this},t.skew=function(t,e){var i=this._nums,r=Math.tan(t),_=Math.tan(e),a=i[0],n=i[1];return i[0]+=_*i[2],i[1]+=_*i[3],i[2]+=r*a,i[3]+=r*n,this},t.invertTransformPoint=function(t){var e=this._nums,i=e[0],r=e[1],_=e[2],a=e[3],n=e[4],s=i*a-r*_,o=a/s,h=-r/s,l=-_/s,u=i/s,c=(_*e[5]-a*n)/s,f=-(i*e[5]-r*n)/s;return t.setTo(o*t.x+l*t.y+c,h*t.x+u*t.y+f)},t.transformPoint=function(t){var e=this._nums;return t.setTo(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},t.transformPointN=function(t){var e=this._nums;return t.setTo(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y)},t.getScaleX=function(){var t=this._nums;return 0===t[1]?this.a:Math.sqrt(t[0]*t[0]+t[1]*t[1])},t.getScaleY=function(){var t=this._nums;return 0===t[2]?t[3]:Math.sqrt(t[2]*t[2]+t[3]*t[3])},t.invert=function(){var t=this._nums,e=t[0],i=t[1],r=t[2],_=t[3],a=t[4],n=e*_-i*r;return t[0]=_/n,t[1]=-i/n,t[2]=-r/n,t[3]=e/n,t[4]=(r*this.ty-_*a)/n,t[5]=-(e*this.ty-i*a)/n,this},t.setTo=function(t,e,i,r,_,a){var n=this._nums;return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n[4]=_,n[5]=a,this},t.concat=function(t){var e=this._nums,i=t._nums,r=e[0],_=e[2],a=e[4];return e[0]=r*i[0]+e[1]*i[2],e[1]=r*i[1]+e[1]*i[3],e[2]=_*i[0]+e[3]*i[2],e[3]=_*i[1]+e[3]*i[3],e[4]=a*i[0]+e[5]*i[2]+i[4],e[5]=a*i[1]+e[5]*i[3]+i[5],this},t.scaleEx=function(t,e){var i=this._nums,r=i[0],_=i[1],a=i[2],n=i[3];i[3]=(i[2]=0!==_||0!==a?(i[0]=t*r,i[1]=t*_,e*a):(i[0]=t*r,i[1]=0*n,0*r),e*n),this._bTransform=!0},t.rotateEx=function(t){var e=this._nums,i=Math.cos(t),r=Math.sin(t),_=e[0],a=e[1],n=e[2],s=e[3];e[3]=0!==a||0!==n?(e[0]=i*_+r*n,e[1]=i*a+r*s,e[2]=-r*_+i*n,-r*a+i*s):(e[0]=i*_,e[1]=r*s,e[2]=-r*_,i*s),this._bTransform=!0},t.clone=function(){var t=this._nums,e=r.create(),i=e._nums;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],e._bTransform=this._bTransform,e},t.copyTo=function(t){var e=this._nums,i=t._nums;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],t._bTransform=this._bTransform,t},t.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},t.destroy=function(){this.recover()},t.recover=function(){r._pool.push(this)},A(0,t,"a",function(){return this._nums[0]},function(t){this._nums[0]=t}),A(0,t,"b",function(){return this._nums[1]},function(t){this._nums[1]=t}),A(0,t,"c",function(){return this._nums[2]},function(t){this._nums[2]=t}),A(0,t,"d",function(){return this._nums[3]},function(t){this._nums[3]=t}),A(0,t,"tx",function(){return this._nums[4]},function(t){this._nums[4]=t}),A(0,t,"ty",function(){return this._nums[5]},function(t){this._nums[5]=t}),r.mul=function(t,e,i){var r=t._nums,_=e._nums,a=i._nums,n=r[0],s=r[1],o=r[2],h=r[3],l=r[4],u=r[5],c=_[0],f=_[1],d=_[2],A=_[3],E=_[4],m=_[5];return a[5]=0!==f||0!==d?(a[0]=n*c+s*d,a[1]=n*f+s*A,a[2]=o*c+h*d,a[3]=o*f+h*A,a[4]=c*l+d*u+E,f*l+A*u+m):(a[0]=n*c,a[1]=s*A,a[2]=o*c,a[3]=h*A,a[4]=c*l+E,A*u+m),i},r.mul16=function(t,e,i){var r=t._nums,_=e._nums,a=r[0],n=r[1],s=r[2],o=r[3],h=r[4],l=r[5],u=_[0],c=_[1],f=_[2],d=_[3],A=_[4],E=_[5];return i[13]=0!==c||0!==f?(i[0]=a*u+n*f,i[1]=a*c+n*d,i[4]=s*u+o*f,i[5]=s*c+o*d,i[12]=u*h+f*l+A,c*h+d*l+E):(i[0]=a*u,i[1]=n*d,i[4]=s*u,i[5]=o*d,i[12]=u*h+A,d*l+E),i},r.create=function(t){var e;return r._pool.length?(e=r._pool.pop(),t&&(e._nums=t),e.identity(),e):new r(1,0,0,1,0,0,t)},r.A=0,r.B=1,r.C=2,r.D=3,r.TX=4,r.TY=5,r.EMPTY=new r,r.TEMP=new r,r._pool=[],r}(),It=function(){function t(t){this._par=null,this._loaded=!0,this.bitmap={},this.bitmap.id=t.id,this._par=t}return f(t,"laya.webgl.resource.CharInternalTexture"),t.prototype._getSource=function(){return this._par._source},t}(),Nt=function(){function e(){}return f(e,"laya.layagl.LayaNative2D"),e._init_simple_texture_cmdEncoder_=function(){(e._SIMPLE_TEXTURE_CMDENCODER_=j.instance.createCommandEncoder(172,32,!0)).useProgramEx(laya.layagl.LayaNative2D.PROGRAMEX_DRAWTEXTURE),e._SIMPLE_TEXTURE_CMDENCODER_.useVDO(laya.layagl.LayaNative2D.VDO_MESHQUADTEXTURE),e._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_VIEWS,0),e._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR,1),e._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_POS,2),e._SIMPLE_TEXTURE_CMDENCODER_.uniformTextureByParamData(0,4,8),e._SIMPLE_TEXTURE_CMDENCODER_.blendFuncByGlobalValue(laya.layagl.LayaNative2D.GLOBALVALUE_BLENDFUNC_SRC,laya.layagl.LayaNative2D.GLOBALVALUE_BLENDFUNC_DEST),e._SIMPLE_TEXTURE_CMDENCODER_.setRectMeshByParamData(12,20,16),e._SIMPLE_TEXTURE_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_MATRIX32,0,7),e._SIMPLE_TEXTURE_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(e._SIMPLE_TEXTURE_CMDENCODER_)},e._init_simple_rect_cmdEncoder_=function(){(e._SIMPLE_RECT_CMDENCODER_=j.instance.createCommandEncoder(136,32,!0)).useProgramEx(laya.layagl.LayaNative2D.PROGRAMEX_DRAWTEXTURE),e._SIMPLE_RECT_CMDENCODER_.useVDO(laya.layagl.LayaNative2D.VDO_MESHQUADTEXTURE),e._SIMPLE_RECT_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_VIEWS,0),e._SIMPLE_RECT_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR,1),e._SIMPLE_RECT_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_POS,2),e._SIMPLE_RECT_CMDENCODER_.setRectMeshByParamData(0,8,4),e._SIMPLE_RECT_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_MATRIX32,0,7),e._SIMPLE_RECT_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(e._SIMPLE_RECT_CMDENCODER_)},e._init_rect_border_cmdEncoder_=function(){(e._RECT_BORDER_CMD_ENCODER_=j.instance.createCommandEncoder(152,32,!0)).useProgramEx(laya.layagl.LayaNative2D.PROGRAMEX_DRAWVG),e._RECT_BORDER_CMD_ENCODER_.useVDO(laya.layagl.LayaNative2D.VDO_MESHVG),e._RECT_BORDER_CMD_ENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_VIEWS,0),e._RECT_BORDER_CMD_ENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR,1),e._RECT_BORDER_CMD_ENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_POS,2),e._RECT_BORDER_CMD_ENCODER_.setMeshByParamData(20,0,4,140,8,12,16),e._RECT_BORDER_CMD_ENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_MATRIX32,0,7),e._RECT_BORDER_CMD_ENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(e._RECT_BORDER_CMD_ENCODER_)},e.__init__=function(){if(x.isConchApp){var t=j.instance;e.GLOBALVALUE_MATRIX32=t.addGlobalValueDefine(0,5126,6,new Float32Array([1,0,0,1,0,0])),e.GLOBALVALUE_DRAWTEXTURE_COLOR=t.addGlobalValueDefine(0,5124,1,new Uint32Array([4294967295])),e.GLOBALVALUE_ITALICDEG=t.addGlobalValueDefine(0,5126,1,new Float32Array([0])),e.GLOBALVALUE_CLIP_MAT_DIR=t.addGlobalValueDefine(0,5126,4,new Float32Array([1e6,0,0,1e6])),e.GLOBALVALUE_CLIP_MAT_POS=t.addGlobalValueDefine(0,5126,2,new Float32Array([0,0])),e.GLOBALVALUE_BLENDFUNC_SRC=t.addGlobalValueDefine(0,5124,1,new Int32Array([1])),e.GLOBALVALUE_BLENDFUNC_DEST=t.addGlobalValueDefine(0,5124,1,new Int32Array([771])),e.GLOBALVALUE_COLORFILTER_COLOR=t.addGlobalValueDefine(0,5126,16,new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])),e.GLOBALVALUE_COLORFILTER_ALPHA=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,1])),e.GLOBALVALUE_BLURFILTER_STRENGTH=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),e.GLOBALVALUE_BLURFILTER_BLURINFO=t.addGlobalValueDefine(0,5126,2,new Float32Array([0,0])),e.GLOBALVALUE_GLOWFILTER_COLOR=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),e.GLOBALVALUE_GLOWFILTER_BLURINFO1=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),e.GLOBALVALUE_GLOWFILTER_BLURINFO2=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),t.endGlobalValueDefine(),e.PROGRAMEX_DRAWTEXTURE=j.instance.createProgramEx("/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_MvpMatrix;\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos = vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos=mmat*pos;\n#endif\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position=u_MvpMatrix*pos1;\n#else\n\tgl_Position=pos1;\n#endif\n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = pos.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}","/*\n\ttexture和fillrect使用的。\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n//FILLTEXTURE\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}","posuv,attribColor,attribFlags","size,clipMatDir,clipMatPos,texture,colorMat,colorAlpha,strength_sig2_2sig2_gauss1,blurInfo,u_color,u_blurInfo1,u_blurInfo2"),e.PROGRAMEX_DRAWVG=j.instance.createProgramEx("attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}","precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}","position,attribColor","size,clipMatDir,clipMatPos"),e.PROGRAMEX_DRAWPARTICLE=j.instance.createProgramEx("attribute vec4 a_CornerTextureCoordinate;\nattribute vec3 a_Position;\nattribute vec3 a_Velocity;\nattribute vec4 a_StartColor;\nattribute vec4 a_EndColor;\nattribute vec3 a_SizeRotation;\nattribute vec2 a_Radius;\nattribute vec4 a_Radian;\nattribute float a_AgeAddScale;\nattribute float a_Time;\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\n\nuniform float u_CurrentTime;\nuniform float u_Duration;\nuniform float u_EndVelocity;\nuniform vec3 u_Gravity;\n\nuniform vec2 size;\nuniform mat4 u_mmat;\n\nvec4 ComputeParticlePosition(in vec3 position, in vec3 velocity,in float age,in float normalizedAge)\n{\n\n   float startVelocity = length(velocity);//起始标量速度\n   float endVelocity = startVelocity * u_EndVelocity;//结束标量速度\n\n   float velocityIntegral = startVelocity * normalizedAge +(endVelocity - startVelocity) * normalizedAge *normalizedAge/2.0;//计算当前速度的标量（单位空间），vt=v0*t+(1/2)*a*(t^2)\n   \n   vec3 addPosition = normalize(velocity) * velocityIntegral * u_Duration;//计算受自身速度影响的位置，转换标量到矢量    \n   addPosition += u_Gravity * age * normalizedAge;//计算受重力影响的位置\n   \n   float radius=mix(a_Radius.x, a_Radius.y, normalizedAge); //计算粒子受半径和角度影响（无需计算角度和半径时，可用宏定义优化屏蔽此计算）\n   float radianHorizontal =mix(a_Radian.x,a_Radian.z,normalizedAge);\n   float radianVertical =mix(a_Radian.y,a_Radian.w,normalizedAge);\n   \n   float r =cos(radianVertical)* radius;\n   addPosition.y += sin(radianVertical) * radius;\n\t\n   addPosition.x += cos(radianHorizontal) *r;\n   addPosition.z += sin(radianHorizontal) *r;\n  \n   addPosition.y=-addPosition.y;//2D粒子位置更新需要取负，2D粒子坐标系Y轴正向朝上\n   position+=addPosition;\n   return  vec4(position,1.0);\n}\n\nfloat ComputeParticleSize(in float startSize,in float endSize, in float normalizedAge)\n{    \n    float size = mix(startSize, endSize, normalizedAge);\n    return size;\n}\n\nmat2 ComputeParticleRotation(in float rot,in float age)\n{    \n    float rotation =rot * age;\n    //计算2x2旋转矩阵.\n    float c = cos(rotation);\n    float s = sin(rotation);\n    return mat2(c, -s, s, c);\n}\n\nvec4 ComputeParticleColor(in vec4 startColor,in vec4 endColor,in float normalizedAge)\n{\n\tvec4 color=mix(startColor,endColor,normalizedAge);\n    //硬编码设置，使粒子淡入很快，淡出很慢,6.7的缩放因子把置归一在0到1之间，可以谷歌x*(1-x)*(1-x)*6.7的制图表\n    color.a *= normalizedAge * (1.0-normalizedAge) * (1.0-normalizedAge) * 6.7;\n   \n    return color;\n}\n\nvoid main()\n{\n   float age = u_CurrentTime - a_Time;\n   age *= 1.0 + a_AgeAddScale;\n   float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n   gl_Position = ComputeParticlePosition(a_Position, a_Velocity, age, normalizedAge);//计算粒子位置\n   float pSize = ComputeParticleSize(a_SizeRotation.x,a_SizeRotation.y, normalizedAge);\n   mat2 rotation = ComputeParticleRotation(a_SizeRotation.z, age);\n\t\n    mat4 mat=u_mmat;\n    gl_Position=vec4((mat*gl_Position).xy,0.0,1.0);\n    gl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize*vec2(mat[0][0],mat[1][1]);\n    gl_Position=vec4((gl_Position.x/size.x-0.5)*2.0,(0.5-gl_Position.y/size.y)*2.0,0.0,1.0);\n   \n   v_Color = ComputeParticleColor(a_StartColor,a_EndColor, normalizedAge);\n   v_TextureCoordinate =a_CornerTextureCoordinate.zw;\n}\n\n","#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\n\nvoid main()\n{\t\n\tgl_FragColor=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\tgl_FragColor.xyz *= v_Color.w;\n}","a_CornerTextureCoordinate,a_Position,a_Velocity,a_StartColor,a_EndColor,a_SizeRotation,a_Radius,a_Radian,a_AgeAddScale,a_Time","u_CurrentTime,u_Duration,u_EndVelocity,u_Gravity,size,u_mmat,u_texture"),e.VDO_MESHQUADTEXTURE=t.createVDO(new Int32Array([5126,0,4,24,5121,16,4,24,5121,20,4,24])),e.VDO_MESHVG=t.createVDO(new Int32Array([5126,0,2,12,5121,8,4,12])),e.VDO_MESHPARTICLE=t.createVDO(new Int32Array([5126,0,4,116,5126,16,3,116,5126,28,3,116,5126,40,4,116,5126,56,4,116,5126,72,3,116,5126,84,2,116,5126,92,4,116,5126,108,1,116,5126,112,1,116])),e._init_simple_texture_cmdEncoder_(),e._init_simple_rect_cmdEncoder_(),e._init_rect_border_cmdEncoder_(),e.SHADER_MACRO_COLOR_FILTER=j.instance.defineShaderMacro("#define COLOR_FILTER",[{uname:4,id:e.GLOBALVALUE_COLORFILTER_COLOR},{uname:5,id:e.GLOBALVALUE_COLORFILTER_ALPHA}]),e.SHADER_MACRO_BLUR_FILTER=j.instance.defineShaderMacro("#define BLUR_FILTER",[{uname:6,id:e.GLOBALVALUE_BLURFILTER_STRENGTH},{uname:7,id:e.GLOBALVALUE_BLURFILTER_BLURINFO}]),e.SHADER_MACRO_GLOW_FILTER=j.instance.defineShaderMacro("#define GLOW_FILTER",[{uname:8,id:e.GLOBALVALUE_GLOWFILTER_COLOR},{uname:9,id:e.GLOBALVALUE_GLOWFILTER_BLURINFO1},{uname:10,id:e.GLOBALVALUE_GLOWFILTER_BLURINFO2}]),Ft.__init__(),Ft.__init_END_(),J.useOldCharBook?new wt:new J,at.charRender=new qt}},e._SIMPLE_TEXTURE_CMDENCODER_=null,e._SIMPLE_RECT_CMDENCODER_=null,e._RECT_BORDER_CMD_ENCODER_=null,e.PROGRAMEX_DRAWTEXTURE=0,e.PROGRAMEX_DRAWVG=0,e.PROGRAMEX_DRAWRECT=0,e.PROGRAMEX_DRAWPARTICLE=0,e.VDO_MESHQUADTEXTURE=0,e.VDO_MESHVG=0,e.VDO_MESHPARTICLE=0,e.GLOBALVALUE_VIEWS=0,e.GLOBALVALUE_MATRIX32=0,e.GLOBALVALUE_DRAWTEXTURE_COLOR=0,e.GLOBALVALUE_ITALICDEG=0,e.GLOBALVALUE_CLIP_MAT_DIR=0,e.GLOBALVALUE_CLIP_MAT_POS=0,e.GLOBALVALUE_BLENDFUNC_SRC=0,e.GLOBALVALUE_BLENDFUNC_DEST=0,e.GLOBALVALUE_COLORFILTER_COLOR=0,e.GLOBALVALUE_COLORFILTER_ALPHA=0,e.GLOBALVALUE_BLURFILTER_STRENGTH=0,e.GLOBALVALUE_BLURFILTER_BLURINFO=0,e.SHADER_MACRO_COLOR_FILTER=0,e.SHADER_MACRO_BLUR_FILTER=0,e.SHADER_MACRO_GLOW_FILTER=0,e.GLOBALVALUE_GLOWFILTER_COLOR=0,e.GLOBALVALUE_GLOWFILTER_BLURINFO1=0,e.GLOBALVALUE_GLOWFILTER_BLURINFO2=0,e}(),Ft=function(){function s(){this._commStr="",this._commandEncoder=null,this._id=0,this._commandEncoder=j.instance.createCommandEncoder(64,16,!1)}return f(s,"laya.layagl.LayaGLTemplate"),s.prototype.addComd=function(t,e){this._commStr+=t+"("+e+");",this._commandEncoder[t].apply(this._commandEncoder,e)},s.createByRenderType=function(t){var e=s.GLS[t]=new s;x.isConchApp&&j.instance.setGLTemplate(t,e._commandEncoder.getPtrID());for(var i=1;i<=8192;){if(t&i&&s.__FUN_PARAM__[i])for(var r=s.__FUN_PARAM__[i],_=0,a=r.length;_<a;_++){var n=r[_];e.addComd(n.func,n.args)}i<<=1}return e._id=t,console.log("template="+e._commStr),e},s.createByRenderTypeEnd=function(t){var e=s.GLSE[t]=new s;x.isConchApp&&j.instance.setEndGLTemplate(t,e._commandEncoder.getPtrID());for(var i=8192;1<i;){if(t&i&&s.__FUN_PARAM_END_[i])for(var r=s.__FUN_PARAM_END_[i],_=0,a=r.length;_<a;_++){var n=r[_];e.addComd(n.func,n.args)}i>>=1}return e._id=t,console.log("templateEnd="+e._commStr),e},s.__init__=function(){s.__FUN_PARAM__[1]=[{func:"setGlobalValueByParamData",args:[Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,15,88]}],s.__FUN_PARAM__[2]=[{func:"calcLocalMatrix32",args:[60,64,24,28,32,36,40,44,48,52,56]},{func:"setGlobalValueByParamData",args:[Nt.GLOBALVALUE_MATRIX32,7,64]}],s.__FUN_PARAM__[4]=[{func:"setGlobalValueByParamData",args:[Nt.GLOBALVALUE_BLENDFUNC_SRC,8,284]},{func:"setGlobalValueByParamData",args:[Nt.GLOBALVALUE_BLENDFUNC_DEST,8,288]}],s.__FUN_PARAM__[256]=[{func:"useCommandEncoderByParamData",args:[96,100,1]}],s.__FUN_PARAM__[512]=[{func:"callbackJSByParamData",args:[216,272]},{func:"useCommandEncoderByParamData",args:[92,-1,1]}],s.__FUN_PARAM__[1024]=[{func:"callbackJSByParamData",args:[216,248]},{func:"useCommandEncoderByParamData",args:[104,-1,3]}],s.__FUN_PARAM__[2048]=[{func:"callbackJSByParamData",args:[216,220]},{func:"useCommandEncoderByParamData",args:[108,-1,1]}],s.__FUN_PARAM__[64]=[{func:"setClipByParamData",args:[Nt.GLOBALVALUE_CLIP_MAT_DIR,Nt.GLOBALVALUE_CLIP_MAT_POS,Nt.GLOBALVALUE_MATRIX32,112]},{func:"setGlobalValueByParamData",args:[Nt.GLOBALVALUE_MATRIX32,9,128]}],s.__FUN_PARAM__[16]=[{func:"callbackJSByParamData",args:[216,260]},{func:"useCommandEncoderByParamData",args:[256,-1,0]}],s.__FUN_PARAM__[32]=[{func:"callbackJSByParamData",args:[216,276]},{func:"useCommandEncoderByParamData",args:[280,-1,0]}],s.__FUN_PARAM__[8]=[{func:"callbackJSByParamData",args:[216,224]},{func:"loadDataToRegByParamData",args:[0,252,4]},{func:"ifGreater0",args:[0,2147483647]},{func:"useCommandEncoderByParamData",args:[232,-1,0]}],s.__FUN_PARAM__[128]=[{func:"useCommandEncoderByParamData",args:[292,296,1]},{func:"useCommandEncoderByParamData",args:[300,304,1]}]},s.__init_END_=function(){s.__FUN_PARAM_END_[16]=[{func:"loadDataToRegByParamData",args:[0,252,4]},{func:"ifGreater0",args:[0,2]},{func:"callbackJSByParamData",args:[216,268]},{func:"useCommandEncoderByParamData",args:[264,-1,1]}],s.__FUN_PARAM_END_[8]=[{func:"callbackJSByParamData",args:[216,228]},{func:"useCommandEncoderByParamData",args:[236,-1,0]},{func:"useCommandEncoderByParamData",args:[240,244,1]}]},s.GLS=[],s.GLSE=[],s.__FUN_PARAM__=[],s.__FUN_PARAM_END_=[],s}(),wt=function(){var t;function V(){this.fontPages=[],this.fontPagesName=[],this._curPage=null,this.tempUV=[0,0,1,0,1,1,0,1],this.fontScaleX=1,this.fontScaleY=1,this._curStrPos=0,this.tempMat=new S;var t=!1,e=D.MiniAdpter;e&&e.systemInfo&&e.systemInfo.system&&(t="ios 10.1.1"===e.systemInfo.system.toLowerCase()),s.onMiniGame&&!t&&(V.isWan1Wan=!0),V.charbookInst=this,D.textRender=this,at.charRender=x.isConchApp?new qt:new Qt(V.textureWidth,V.textureWidth,V.scaleFontWithCtx,!V.isWan1Wan,V.debug)}f(V,"laya.webgl.resource.CharBook");var e=V.prototype;return e.selectFont=function(t,e){var i,r=Math.max(this.fontScaleX,this.fontScaleY),_=e*r;if(t===V._lastFont&&_===V._lastFontSz)i=V._lastCharPage;else{var a=at.getBmpSize(e)*r,n=t+Math.floor(a/V.gridSize),s=this.fontPagesName.indexOf(n);if(s<0){var o=new at(t,a,x.isConchApp?0:Math.ceil(e/4));this.fontPages.push(o),this.fontPagesName.push(n),i=o}else i=this.fontPages[s];i.selectSize(e,a),V._lastFont=t,V._lastFontSz=_,V._lastCharPage=i}return i},e.getNextChar=function(t){var e=t.length,i=this._curStrPos;if(e<=i)return null;for(var r=i,_=0;r<e;r++){var a=t.charCodeAt(r);if(a>>>11==27){if(1==_)break;_=1,r++}else if(65038===a||65039===a);else if(8205==a)_=2;else if(0==_)_=1;else if(1==_)break}return this._curStrPos=r,t.substring(i,r)},e.hasFreedText=function(t,e){if(t&&0<t.length)for(var i=e,r=t.length;i<r;i++){var _=t[i];if(_)for(var a=0,n=_.length;a<n;a++){var s=_[a].ri;if(s.deleted||s.tex.__destroyed)return!0}}return!1},e._fast_filltext=function(t,e,i,r,_,a,n,s,o,h,l){if(void 0===l&&(l=0),!(e&&e.length<1||i&&i.length<1)){if(V._curFont=a._font,this.fontScaleX=this.fontScaleY=1,V.scaleFontWithCtx){var u=t.getMatScaleX(),c=t.getMatScaleY();if(u<1e-4||c<.1)return;1<u&&(this.fontScaleX=u),1<c&&(this.fontScaleY=c)}a._italic&&(t._italicDeg=12),this._curPage=this.selectFont(a._family,a._size);var f=r,d=e,A=e,E=0,m=!i&&e instanceof laya.utils.WordText,R=!!i,p=V.cacheRenderInfoInWordText&&m?d.pageChars:[];switch(m?(A=d._text,(E=d.width)<0&&(E=d.width=this._curPage.getWidth(A))):E=A?this._curPage.getWidth(A):0,h){case b.ENUM_TEXTALIGN_CENTER:f=r-E/2;break;case b.ENUM_TEXTALIGN_RIGHT:f=r-E;break;default:f=r}d&&d.lastGCCnt!=this._curPage.gcCnt&&(d.lastGCCnt=this._curPage.gcCnt,this.hasFreedText(p,d.startID)&&(p=d.pageChars=[]));var T=m?d.startID:0,v=m?d.startIDStroke:0;if(!p||p.length<1){var D=null;V.scaleFontWithCtx&&(at.charRender.scale(Math.max(this.fontScaleX,1),Math.max(this.fontScaleY,1)),(1<this.fontScaleX||1<this.fontScaleY)&&(D=""+(10*this.fontScaleX|0)+(10*this.fontScaleY|0))),v=T=-1;var P,C=0,g=0;if(this._curStrPos=0,R){var M=i[this._curStrPos++];P=M.char,C=M.x,g=M.y}else P=this.getNextChar(A);for(var y=a._bold;P;){var O;if(!(O=this._curPage.getChar(P,o,a._size,n,s,y,!1,D)))break;if(O.char=P,O.isSpace);else{var S=p[O.tex.id];S||(p[O.tex.id]=S=[],(T<0||T>O.tex.id)&&(T=O.tex.id)),S.push({ri:O,x:C,y:g,w:O.bmpWidth/this.fontScaleX,h:O.bmpHeight/this.fontScaleY})}R?(M=i[this._curStrPos++])?(P=M.char,C=M.x,g=M.y):P=null:(P=this.getNextChar(A),C+=O.width)}m&&(d.startID=T,d.startIDStroke=v)}this._drawResortedWords(t,f,p,T,_),t._italicDeg=0}},e.fillWords=function(t,e,i,r,_,a,n,s){if(e&&!(e.length<=0)){U.create(a).numColor,n&&U.create(n).numColor;V._curFont=_;var o=W.Parse(_);this._fast_filltext(t,null,e,i,r,o,a,n,s,0,0)}},e.filltext=function(t,e,i,r,_,a,n,s,o,h){if(void 0===h&&(h=0),!(e.length<=0)){U.create(a).numColor,n&&U.create(n).numColor;V._curFont=_;var l=W.Parse(_),u=0;switch(o){case"center":u=b.ENUM_TEXTALIGN_CENTER;break;case"right":u=b.ENUM_TEXTALIGN_RIGHT}this._fast_filltext(t,e,null,i,r,l,a,n,s,u,h)}},e.filltext_native=function(t,e,i,r,_,a,n,s,o,h,l){if(void 0===l&&(l=0),!(e&&e.length<=0)){var u=U.create(n).numColor;s&&U.create(s).numColor;if(V._curFont=a,this.fontScaleX=this.fontScaleY=1,V.scaleFontWithCtx){var c=t._curMat.getScaleX(),f=t._curMat.getScaleY();if(c<1e-4||f<.1)return;this.fontScaleX=c,this.fontScaleY=f,at.charRender.scale(this.fontScaleX,this.fontScaleY)}var d=W.Parse(a),A=d._family,E=d._bold;d._italic&&(t._italicDeg=12),this._curPage=this.selectFont(A,d._size*this.fontScaleX);var m=r,R=e,p=e,T=0,v=!i&&p instanceof laya.utils.WordText,D=!!i,P=V.cacheRenderInfoInWordText&&v?R.pageChars:[];switch(v?(p=R.toString(),(T=R.width)<0&&(T=R.width=this._curPage.getWidth(p))):T=this._curPage.getWidth(p),h){case"center":m=r-T/2;break;case"right":m=r-T;break;default:m=r}if(P){for(var C=!1,g=0,M=P.length;g<M;g++){var y=P[g];if(y){for(var O=0,S=y.length;O<S;O++){if(y[O].ri.tex.__destroyed){C=!0;break}}if(C)break}}C&&(P=R.pageChars=[])}if(!P||P.length<=0){var b=null;V.scaleFontWithCtx&&(at.charRender.scale(Math.max(this.fontScaleX,1),Math.max(this.fontScaleY,1)),(1<this.fontScaleX||1<this.fontScaleY)&&(b=""+(10*this.fontScaleX|0)+(10*this.fontScaleY|0)));var L,x=0,B=0;if(this._curStrPos=0,D){var I=i[this._curStrPos++];L=I.char,x=I.x,B=I.y}else L=this.getNextChar(p);for(E=d._bold;L;){var N;if((N=this._curPage.getChar(L,o,d._size,n,s,E,!1,b)).isSpace);else{var F=P[N.tex.id];F||(P[N.tex.id]=F=[]),F.push({ri:N,x:x,y:B,color:n,nColor:u})}D?(I=i[this._curStrPos++])?(L=I.char,x=I.x,B=I.y):L=null:(x+=N.width,L=this.getNextChar(p))}}var w=t._drawTextureUseColor;this._drawResortedWords_native(t,m,P,_),t._drawTextureUseColor=w,t._italicDeg=0}},e._drawResortedWords=function(t,e,i,r,_){var a=t.getFillColor();t.setFillColor(t.mixRGBandAlpha(16777215)),e-=this._curPage.margin_left,_-=this._curPage.margin_top;for(var n=t._charSubmitCache._enbale,s=r,o=i.length;s<o;s++){var h=i[s];if(h){var l=h.length;if(!(l<=0))for(var u=0;u<l;u++){var c=h[u],f=c.ri;f.isSpace||(f.touch(),t.drawTexAlign=!0,t._inner_drawTexture(f.tex.texture,f.tex.texture.bitmap.id,e+c.x,_+c.y,c.w,c.h,null,f.uv,1,n),t.touches&&t.touches.push(f))}}}t.setFillColor(a)},e._drawResortedWords_native=function(t,e,i,r){for(var _=0,a=0,n=i.length;a<n;a++){var s=i[a];if(s)for(var o=0,h=s.length;o<h;o++){var l=s[o],u=l.ri;u.isSpace||(t._drawTextureUseColor=!1,_!=l.nColor&&(t.fillStyle=l.color,_=l.nColor),u.touch(),this._drawCharRenderInfo(t,l.ri,e+l.x,l.y+r))}}},e._drawCharRenderInfo=function(t,e,i,r){t._drawTextureM(e.tex.texture,i-this._curPage.margin_left,r-this._curPage.margin_top,e.bmpWidth,e.bmpHeight,null,1,e.uv),t.touches&&t.touches.push(e)},e.listPages=function(){var _=this;console.log("打印所有页的信息:"),this.fontPages.forEach(function(t,e){var i=_.fontPagesName[e],r=parseInt(i.substr(t.fontFamily.length))*V.gridSize;console.log("==================================="),console.log("名字:",_.fontPagesName[e],"大小范围:",r,r+V.gridSize),t.printPagesInfo()})},e.GC=function(t){this.fontPages.length;this.fontPages.forEach(function(t){t.removeLRU()})},V.textureWidth=512,V.cacheRenderInfoInWordText=!0,V.scaleFontWithCtx=!0,V.gridSize=16,V.debug=!1,V._curFont=null,V.charbookInst=null,V._fontMem=0,V._lastFont=null,V._lastFontSz=0,V._lastCharPage=null,V.isWan1Wan=!1,n(V,["_uint32",function(){return this._uint32=new Uint32Array(1)},"trash",function(){return this.trash=new t(V.textureWidth)}]),V.__init$=function(){t=function(){function t(t){this.poolLen=0,this.cleanTm=0,this.texW=0,this.pool=new Array(10),this.texW=t}f(t,"");var e=t.prototype;return e.getAPage=function(t){if(0<this.poolLen){var e=this.pool[--this.poolLen];return e.setGridNum(t),0<this.poolLen&&this.clean(),e}return new ie(this.texW,this.texW,t)},e.discardPage=function(t){this.clean(),t&&(t.genID++,this.poolLen>=this.pool.length&&(this.pool=this.pool.concat(new Array(10))),t.reset(),this.pool[this.poolLen++]=t)},e.clean=function(){var t=D.stage.getFrameTm();if(0===this.cleanTm&&(this.cleanTm=t),3e4<t-this.cleanTm){for(var e=0;e<this.poolLen;e++){var i=this.pool[e];2e4<t-i._discardTm&&(i.destroy(),this.pool[e]=this.pool[this.poolLen-1],this.poolLen--,e--)}this.cleanTm=t}},t}()},V}(),Vt=function(){function _(){this.fun=null,this._this=null,this.args=null,this._ref=1,this._key=new Lt}f(_,"laya.webgl.submit.SubmitCMD");var t=_.prototype;return D.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){return this.fun.apply(this._this,this.args),1},t.getRenderType=function(){return 0},t.reUse=function(t,e){return this._ref++,e},t.releaseRender=function(){if(--this._ref<1){var t=_.POOL;t[t._length++]=this}},t.clone=function(t,e,i){return null},_.create=function(t,e,i){var r=_.POOL._length?_.POOL[--_.POOL._length]:new _;return r.fun=e,r.args=t,r._this=i,r._ref=1,r._key.clear(),r},_.POOL=((_.POOL=[])._length=0,_.POOL),_}(),Ut=(function(){function E(){this._graphicsCmdEncoder=null,this._paramData=null,this._x=NaN,this._y=NaN,this._points=null,this._lineColor=null,this._lineWidth=NaN,this._vid=0,this._vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this._ibSize=0,this._vbSize=0,this._ibArray=[],this._vbArray=[]}f(E,"laya.layagl.cmdNative.DrawLinesCmdNative");var t=E.prototype;t.recover=function(){this._points=null,this._lineColor=null,this._ibArray.length=0,this._vbArray.length=0,L.recover("DrawLinesCmd",this)},A(0,t,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t;for(var e=U.create(this._lineColor).numColor,i=this.vbBuffer._int32Data,r=0,_=0;_<this._vertNum;_++)r++,r++,i[r++]=e;j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"points",function(){return this._points},function(t){this._points=t,this._ibArray.length=0,this._vbArray.length=0,yt.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);var e=U.create(this._lineColor).numColor;this._vertNum=this._points.length;var i=this._vertNum;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*i*4,!0)),this._vbSize=3*this._vertNum*4;for(var r=this.vbBuffer._float32Data,_=this.vbBuffer._int32Data,a=0,n=0;n<this._vertNum;n++)r[a++]=this._vbArray[2*n]+this.x,r[a++]=this._vbArray[2*n+1]+this.y,_[a++]=e;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*(this._vertNum-2)*2)&&(this.ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._ibSize=3*(this._vertNum-2)*2;for(var s=this.ibBuffer._int16Data,o=0;o<3*(this._vertNum-2);o++)s[o]=this._ibArray[o];(_=this._paramData._int32Data)[E._PARAM_VB_SIZE_POS_]=this._vbSize,_[E._PARAM_IB_SIZE_POS_]=this._ibSize,j.syncBufferToRenderThread(this.ibBuffer),j.syncBufferToRenderThread(this.vbBuffer),j.syncBufferToRenderThread(this._paramData)}),A(0,t,"cmdID",function(){return"DrawLines"}),A(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)e[i++]=this._vbArray[2*r]+this._x,i++,i++;j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"vid",function(){return this._vid},function(t){this._vid=t}),A(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)i++,e[i++]=this._vbArray[2*r+1]+this._y,i++;j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t,this._ibArray.length=0,this._vbArray.length=0,yt.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)e[i++]=this._vbArray[2*r]+this.x,e[i++]=this._vbArray[2*r+1]+this.y,i++;j.syncBufferToRenderThread(this.vbBuffer)}),E.create=function(t,e,i,r,_,a){var n=L.getItemByClass("DrawLinesCmd",E);n._graphicsCmdEncoder=this._commandEncoder,E._DRAW_LINES_CMD_ENCODER_||((E._DRAW_LINES_CMD_ENCODER_=j.instance.createCommandEncoder(152,32,!0)).useProgramEx(Nt.PROGRAMEX_DRAWVG),E._DRAW_LINES_CMD_ENCODER_.useVDO(Nt.VDO_MESHVG),E._DRAW_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),E._DRAW_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),E._DRAW_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),E._DRAW_LINES_CMD_ENCODER_.setMeshExByParamData(4*E._PARAM_VB_POS_,4*E._PARAM_VB_OFFSET_POS_,4*E._PARAM_VB_SIZE_POS_,4*E._PARAM_IB_POS_,4*E._PARAM_IB_OFFSET_POS_,4*E._PARAM_IB_SIZE_POS_,4*E._PARAM_INDEX_ELEMENT_OFFSET_POS_),E._DRAW_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),E._DRAW_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(E._DRAW_LINES_CMD_ENCODER_)),n._paramData||(n._paramData=new ParamData(44,!0)),n._x=t,n._y=e,n._points=i,n._lineColor=r,n._lineWidth=_,n._vid=a,yt.createLine2(i,n._ibArray,_,0,n._vbArray,!1);var s=U.create(r).numColor;n._vertNum=i.length;var o=n._vertNum;(!n.vbBuffer||n.vbBuffer.getByteLength()<3*n._vertNum*4)&&(n.vbBuffer=new ParamData(3*o*4,!0)),n._vbSize=3*n._vertNum*4;for(var h=n.vbBuffer._float32Data,l=n.vbBuffer._int32Data,u=0,c=0;c<n._vertNum;c++)h[u++]=n._vbArray[2*c]+t,h[u++]=n._vbArray[2*c+1]+e,l[u++]=s;(!n.ibBuffer||n.ibBuffer.getByteLength()<3*(n._vertNum-2)*2)&&(n.ibBuffer=new ParamData(3*(o-2)*2,!0,!0)),n._ibSize=3*(n._vertNum-2)*2;for(var f=n.ibBuffer._int16Data,d=0;d<3*(n._vertNum-2);d++)f[d]=n._ibArray[d];var A=n._paramData._float32Data;return(l=n._paramData._int32Data)[0]=1,l[E._PARAM_VB_POS_]=n.vbBuffer.getPtrID(),l[E._PARAM_IB_POS_]=n.ibBuffer.getPtrID(),A[E._PARAM_LINECOLOR_POS_]=r||4278190335,A[E._PARAM_LINEWIDTH_POS_]=_,A[E._PARAM_VID_POS_]=a,l[E._PARAM_VB_SIZE_POS_]=n._vbSize,l[E._PARAM_IB_SIZE_POS_]=n._ibSize,l[E._PARAM_VB_OFFSET_POS_]=0,l[E._PARAM_IB_OFFSET_POS_]=0,l[E._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,j.syncBufferToRenderThread(n.vbBuffer),j.syncBufferToRenderThread(n.ibBuffer),j.syncBufferToRenderThread(n._paramData),n._graphicsCmdEncoder.useCommandEncoder(E._DRAW_LINES_CMD_ENCODER_.getPtrID(),n._paramData.getPtrID(),-1),j.syncBufferToRenderThread(n._graphicsCmdEncoder),n},E.ID="DrawLines",E._DRAW_LINES_CMD_ENCODER_=null,E._PARAM_VB_POS_=1,E._PARAM_IB_POS_=2,E._PARAM_LINECOLOR_POS_=3,E._PARAM_LINEWIDTH_POS_=4,E._PARAM_VID_POS_=5,E._PARAM_VB_SIZE_POS_=6,E._PARAM_IB_SIZE_POS_=7,E._PARAM_VB_OFFSET_POS_=8,E._PARAM_IB_OFFSET_POS_=9,E._PARAM_INDEX_ELEMENT_OFFSET_POS_=10}(),function(){function c(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=NaN,this._y=NaN,this._width=NaN,this._height=NaN}f(c,"laya.layagl.cmdNative.DrawImageCmdNative");var t=c.prototype;t.recover=function(){this._texture._removeReference(),this._texture=null,this._graphicsCmdEncoder=null,L.recover("DrawImageCmd",this)},A(0,t,"cmdID",function(){return"DrawImage"}),A(0,t,"y",function(){return this._y},function(t){this._y=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_+1]=this._y,e[c._PARAM_VB_POS_+7]=this._y,e[c._PARAM_VB_POS_+13]=this._y+this._height,e[c._PARAM_VB_POS_+19]=this._y+this._height,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"texture",function(){return this._texture},function(t){this._texture=t,this._paramData._int32Data[c._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id;var e=this._paramData._float32Data,i=this._texture.uv;e[c._PARAM_VB_POS_+2]=i[0],e[c._PARAM_VB_POS_+3]=i[1],e[c._PARAM_VB_POS_+8]=i[2],e[c._PARAM_VB_POS_+9]=i[3],e[c._PARAM_VB_POS_+14]=i[4],e[c._PARAM_VB_POS_+15]=i[5],e[c._PARAM_VB_POS_+20]=i[6],e[c._PARAM_VB_POS_+21]=i[7],j.syncBufferToRenderThread(this._paramData)}),A(0,t,"width",function(){return this._width},function(t){this._width=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_]=this._x,e[c._PARAM_VB_POS_+6]=this._x+this._width,e[c._PARAM_VB_POS_+12]=this._x+this._width,e[c._PARAM_VB_POS_+18]=this._x,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"x",function(){return this._x},function(t){this._x=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_]=this._x,e[c._PARAM_VB_POS_+6]=this._x+this._width,e[c._PARAM_VB_POS_+12]=this._x+this._width,e[c._PARAM_VB_POS_+18]=this._x,j.syncBufferToRenderThread(this._paramData)}),A(0,t,"height",function(){return this._height},function(t){this._height=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_+1]=this._y,e[c._PARAM_VB_POS_+7]=this._y,e[c._PARAM_VB_POS_+13]=this._y+this._height,e[c._PARAM_VB_POS_+19]=this._y+this._height,j.syncBufferToRenderThread(this._paramData)}),c.create=function(t,e,i,r,_){var a=L.getItemByClass("DrawImageCmd",c);a._graphicsCmdEncoder=this._commandEncoder,c._DRAW_IMAGE_CMD_ENCODER_||((c._DRAW_IMAGE_CMD_ENCODER_=j.instance.createCommandEncoder(172,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),c._DRAW_IMAGE_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWTEXTURE),c._DRAW_IMAGE_CMD_ENCODER_.useVDO(Nt.VDO_MESHQUADTEXTURE),c._DRAW_IMAGE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),c._DRAW_IMAGE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),c._DRAW_IMAGE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),c._DRAW_IMAGE_CMD_ENCODER_.uniformTextureByParamData(0,4,4*c._PARAM_TEXTURE_POS_),c._DRAW_IMAGE_CMD_ENCODER_.setRectMeshByParamData(12,4*c._PARAM_VB_POS_,16),c._DRAW_IMAGE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),c._DRAW_IMAGE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(c._DRAW_IMAGE_CMD_ENCODER_)),a._paramData||(a._paramData=new ParamData(116,!0)),(a._texture=t)._addReference(),a._x=e,a._y=i,a._width=r,a._height=_;var n=a._paramData._float32Data,s=a._paramData._int32Data;s[0]=3,s[1]=33984,s[c._PARAM_TEXTURE_POS_]=t.getIsReady()?t.bitmap._glTexture.id:0,s[3]=1,s[4]=96;var o=0!=r?r:t.bitmap.width,h=0!=_?_:t.bitmap.height,l=t.uv,u=c._PARAM_VB_POS_;return n[u++]=e,n[u++]=i,n[u++]=l[0],n[u++]=l[1],s[u++]=4294967295,s[u++]=4294967295,n[u++]=e+o,n[u++]=i,n[u++]=l[2],n[u++]=l[3],s[u++]=4294967295,s[u++]=4294967295,n[u++]=e+o,n[u++]=i+h,n[u++]=l[4],n[u++]=l[5],s[u++]=4294967295,s[u++]=4294967295,n[u++]=e,n[u++]=i+h,n[u++]=l[6],n[u++]=l[7],s[u++]=4294967295,s[u++]=4294967295,j.syncBufferToRenderThread(a._paramData),a._graphicsCmdEncoder.useCommandEncoder(c._DRAW_IMAGE_CMD_ENCODER_.getPtrID(),a._paramData.getPtrID(),-1),j.syncBufferToRenderThread(a._graphicsCmdEncoder),a},c.ID="DrawImage",c._DRAW_IMAGE_CMD_ENCODER_=null,c._PARAM_TEXTURE_POS_=2,c._PARAM_VB_POS_=5}(),function(){function y(){this._graphicsCmdEncoder=null,this._paramData=null,this._paramID=null,this._x=NaN,this._y=NaN,this._radius=NaN,this._fillColor=null,this._lineColor=null,this._lineWidth=NaN,this._vertNum=0,this._line_vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this.line_ibBuffer=null,this.line_vbBuffer=null,this._ibSize=0,this._vbSize=0,this._line_ibSize=0,this._line_vbSize=0,this._cmdCurrentPos=0,this._points=[],this._linePoints=[],this._line_vbArray=[],this._line_ibArray=[]}f(y,"laya.layagl.cmdNative.DrawCircleCmdNative");var t=y.prototype;t._arc=function(t,e,i,r,_){void 0===r&&(r=!1),void 0===_&&(_=!0);var a,n=[],s=0,o=0,h=0,l=0,u=0,c=0,f=0;if(o=2*Math.PI-0,r)if(Math.abs(o)>=2*Math.PI)o=2*-Math.PI;else for(;0<o;)o-=2*Math.PI;else if(Math.abs(o)>=2*Math.PI)o=2*Math.PI;else for(;o<0;)o+=2*Math.PI;a=o/(f=i<101?Math.max(10,o*i/5):i<201?Math.max(10,o*i/20):Math.max(10,o*i/40))/2,h=Math.abs(4/3*(1-Math.cos(a))/Math.sin(a)),r&&(h=-h);for(c=0;c<=f;c++)s=0+o*(c/f),l=t+Math.cos(s)*i,u=e+Math.sin(s)*i,n.push(l),n.push(u);return n},t.recover=function(){this._fillColor=null,this._lineColor=null,this._points.length=0,this._linePoints.length=0,this._line_vbArray.length=0,this._line_ibArray.length=0,L.recover("DrawCircleCmd",this)},A(0,t,"lineColor",function(){return this._lineColor},function(t){!this._lineColor&&this._lineWidth&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=y._DRAW_CIRCLE_LINES_CMD_ENCODER_.getPtrID(),j.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineColor=t,this._linePoints.length=0,this._line_ibArray.length=0;for(var e=this._line_vbArray.length=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),yt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var i=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var r=this.line_ibBuffer._int16Data,_=0,a=0;a<3*(this._line_vertNum-2);a++)r[_++]=this._line_ibArray[a];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*i*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var n=U.create(t).numColor,s=this.line_vbBuffer._float32Data,o=this.line_vbBuffer._int32Data,h=0;for(e=0;e<this._line_vertNum;e++)s[h++]=this._line_vbArray[2*e]+this.x,s[h++]=this._line_vbArray[2*e+1]+this.y,o[h++]=n;var l=this._paramData._int32Data;l[y._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),l[y._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),l[y._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,l[y._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,j.syncBufferToRenderThread(this.line_vbBuffer),j.syncBufferToRenderThread(this.line_ibBuffer),j.syncBufferToRenderThread(this._paramData)}),A(0,t,"cmdID",function(){return"DrawCircle"}),A(0,t,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t;for(var e=U.create(this._fillColor).numColor,i=this.vbBuffer._int32Data,r=0,_=0;_<this._vertNum;_++)r++,r++,i[r++]=e;j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)e[i++]=this._points[2*r]+this._x,i++,i++;if(this._lineColor){var _=this.line_vbBuffer._float32Data;for(r=i=0;r<this._line_vertNum;r++)_[i++]=this._line_vbArray[2*r]+this._x,i++,i++;j.syncBufferToRenderThread(this.line_vbBuffer)}j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,r=0;r<this._vertNum;r++)i++,e[i++]=this._points[2*r+1]+this._y,i++;if(this._lineColor){var _=this.line_vbBuffer._float32Data;for(r=i=0;r<this._line_vertNum;r++)i++,_[i++]=this._line_vbArray[2*r+1]+this._y,i++;j.syncBufferToRenderThread(this.line_vbBuffer)}j.syncBufferToRenderThread(this.vbBuffer)}),A(0,t,"radius",function(){return this._radius},function(t){this._points=this._arc(0,0,t),this._vertNum=this._points.length/2;var e=this._vertNum,i=0;this._linePoints.length=0,this._line_ibArray.length=0;this._line_vbArray.length=0;var r=this._vertNum-2;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*r*2)&&(this.ibBuffer=new ParamData(3*r*2,!0,!0)),this._ibSize=3*r*2;for(var _=this.ibBuffer._int16Data,a=0,n=0;n<r;n++)_[a++]=0,_[a++]=n+1+0,_[a++]=n+2+0;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*e*4,!0)),this._vbSize=3*this._vertNum*4;for(var s=U.create(this._fillColor).numColor,o=this.vbBuffer._float32Data,h=this.vbBuffer._int32Data,l=0,u=0;u<this._vertNum;u++)o[l++]=this._points[2*u]+this._x,o[l++]=this._points[2*u+1]+this._y,h[l++]=s;if(this._lineColor){for(u=0;u<this._points.length;u++)this._linePoints.push(this._points[u]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),yt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,i=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var c=this.line_ibBuffer._int16Data,f=a=0;f<3*(this._line_vertNum-2);f++)c[a++]=this._line_ibArray[f];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*i*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var d=U.create(this._lineColor).numColor,A=this.line_vbBuffer._float32Data,E=this.line_vbBuffer._int32Data;for(u=l=0;u<this._line_vertNum;u++)A[l++]=this._line_vbArray[2*u]+this._x,A[l++]=this._line_vbArray[2*u+1]+this._y,E[l++]=d}var m=this._paramData._int32Data;m[y._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),m[y._PARAM_IB_POS_]=this.ibBuffer.getPtrID(),m[y._PARAM_VB_SIZE_POS_]=this._vbSize,m[y._PARAM_IB_SIZE_POS_]=this._ibSize,j.syncBufferToRenderThread(this.vbBuffer),j.syncBufferToRenderThread(this.ibBuffer),this._lineColor&&(m[y._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),m[y._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),m[y._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,m[y._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,j.syncBufferToRenderThread(this.line_vbBuffer),j.syncBufferToRenderThread(this.line_ibBuffer)),j.syncBufferToRenderThread(this._paramData)}),A(0,t,"lineWidth",function(){return this._lineWidth},function(t){!this._lineWidth&&this._lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=y._DRAW_CIRCLE_LINES_CMD_ENCODER_.getPtrID(),j.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=t,this._linePoints.length=0,this._line_ibArray.length=0;for(var e=this._line_vbArray.length=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),yt.createLine2(this._linePoints,this._line_ibArray,t,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var i=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var r=this.line_ibBuffer._int16Data,_=0,a=0;a<3*(this._line_vertNum-2);a++)r[_++]=this._line_ibArray[a];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*i*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var n=U.create(this._lineColor).numColor,s=this.line_vbBuffer._float32Data,o=this.line_vbBuffer._int32Data,h=0;for(e=0;e<this._line_vertNum;e++)s[h++]=this._line_vbArray[2*e]+this.x,s[h++]=this._line_vbArray[2*e+1]+this.y,o[h++]=n;var l=this._paramData._int32Data;l[y._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),l[y._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),l[y._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,l[y._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,j.syncBufferToRenderThread(this.line_vbBuffer),j.syncBufferToRenderThread(this.line_ibBuffer),j.syncBufferToRenderThread(this._paramData)}),y.create=function(t,e,i,r,_,a,n){var s=L.getItemByClass("DrawCircleCmd",y);s._graphicsCmdEncoder=this._commandEncoder,y._DRAW_CIRCLE_LINES_CMD_ENCODER_||((y._DRAW_CIRCLE_LINES_CMD_ENCODER_=j.instance.createCommandEncoder(244,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWVG),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.useVDO(Nt.VDO_MESHVG),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_VB_POS_,4*y._PARAM_VB_OFFSET_POS_,4*y._PARAM_VB_SIZE_POS_,4*y._PARAM_IB_POS_,4*y._PARAM_IB_OFFSET_POS_,4*y._PARAM_IB_SIZE_POS_,4*y._PARAM_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_LINE_VB_POS_,4*y._PARAM_LINE_VB_OFFSET_POS_,4*y._PARAM_LINE_VB_SIZE_POS_,4*y._PARAM_LINE_IB_POS_,4*y._PARAM_LINE_IB_OFFSET_POS_,4*y._PARAM_LINE_IB_SIZE_POS_,4*y._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(y._DRAW_CIRCLE_LINES_CMD_ENCODER_)),y._DRAW_CIRCLE_CMD_ENCODER_||((y._DRAW_CIRCLE_CMD_ENCODER_=j.instance.createCommandEncoder(168,32,!0)).blendFuncByGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,Nt.GLOBALVALUE_BLENDFUNC_DEST),y._DRAW_CIRCLE_CMD_ENCODER_.useProgramEx(Nt.PROGRAMEX_DRAWVG),y._DRAW_CIRCLE_CMD_ENCODER_.useVDO(Nt.VDO_MESHVG),y._DRAW_CIRCLE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_VIEWS,0),y._DRAW_CIRCLE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_DIR,1),y._DRAW_CIRCLE_CMD_ENCODER_.uniformEx(Nt.GLOBALVALUE_CLIP_MAT_POS,2),y._DRAW_CIRCLE_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_VB_POS_,4*y._PARAM_VB_OFFSET_POS_,4*y._PARAM_VB_SIZE_POS_,4*y._PARAM_IB_POS_,4*y._PARAM_IB_OFFSET_POS_,4*y._PARAM_IB_SIZE_POS_,4*y._PARAM_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_CIRCLE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_CIRCLE_CMD_ENCODER_.modifyMesh(Nt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),j.syncBufferToRenderThread(y._DRAW_CIRCLE_CMD_ENCODER_)),s._paramData||(s._paramData=new ParamData(72,!0)),s._x=t,s._y=e,s._radius=i,s._fillColor=r,s._lineColor=_,s._lineWidth=a,s._points=s._arc(0,0,i),s._vertNum=s._points.length/2;var o=s._vertNum,h=s._vertNum-2;(!s.ibBuffer||s.ibBuffer.getByteLength()<3*h*2)&&(s.ibBuffer=new ParamData(3*h*2,!0,!0)),s._ibSize=3*h*2;for(var l=s.ibBuffer._int16Data,u=0,c=0;c<h;c++)l[u++]=0,l[u++]=c+1+0,l[u++]=c+2+0;var f=U.create(r).numColor;(!s.vbBuffer||s.vbBuffer.getByteLength()<3*s._vertNum*4)&&(s.vbBuffer=new ParamData(3*o*4,!0)),s._vbSize=3*s._vertNum*4;for(var d=s.vbBuffer._float32Data,A=s.vbBuffer._int32Data,E=0,m=0;m<s._vertNum;m++)d[E++]=s._points[2*m]+t,d[E++]=s._points[2*m+1]+e,A[E++]=f;var R=0;for(m=0;m<s._points.length;m++)s._linePoints.push(s._points[m]);if(s._linePoints.push(s._points[0]),s._linePoints.push(s._points[1]),_){yt.createLine2(s._linePoints,s._line_ibArray,a,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,R=s._line_vertNum,(!s.line_ibBuffer||s.line_ibBuffer.getByteLength()<3*(s._line_vertNum-2)*2)&&(s.line_ibBuffer=new ParamData(3*(R-2)*2,!0,!0)),s._line_ibSize=3*(s._line_vertNum-2)*2;for(var p=s.line_ibBuffer._int16Data,T=u=0;T<3*(s._line_vertNum-2);T++)p[u++]=s._line_ibArray[T];(!s.line_vbBuffer||s.line_vbBuffer.getByteLength()<3*s._line_vertNum*4)&&(s.line_vbBuffer=new ParamData(3*R*4,!0)),s._line_vbSize=3*s._line_vertNum*4;var v=U.create(_),D=v.numColor,P=s.line_vbBuffer._float32Data,C=s.line_vbBuffer._int32Data;for(m=E=0;m<s._line_vertNum;m++)P[E++]=s._line_vbArray[2*m]+t,P[E++]=s._line_vbArray[2*m+1]+e,C[E++]=D}else{s._lineWidth=1;for(yt.createLine2(s._linePoints,s._line_ibArray,s._lineWidth,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,R=s._line_vertNum,(!s.line_ibBuffer||s.line_ibBuffer.getByteLength()<3*(s._line_vertNum-2)*2)&&(s.line_ibBuffer=new ParamData(3*(R-2)*2,!0,!0)),s._line_ibSize=3*(s._line_vertNum-2)*2,p=s.line_ibBuffer._int16Data,T=u=0;T<3*(s._line_vertNum-2);T++)p[u++]=s._line_ibArray[T];for((!s.line_vbBuffer||s.line_vbBuffer.getByteLength()<3*s._line_vertNum*4)&&(s.line_vbBuffer=new ParamData(3*R*4,!0)),s._line_vbSize=3*s._line_vertNum*4,D=(v=U.create("#FFFFFF")).numColor,P=s.line_vbBuffer._float32Data,C=s.line_vbBuffer._int32Data,m=E=0;m<s._line_vertNum;m++)P[E++]=s._line_vbArray[2*m]+t,P[E++]=s._line_vbArray[2*m+1]+e,C[E++]=D}var g=s._paramData._float32Data,M=s._paramData._int32Data;return M[0]=1,M[1]=32,M[y._PARAM_VB_POS_]=s.vbBuffer.getPtrID(),M[y._PARAM_IB_POS_]=s.ibBuffer.getPtrID(),M[y._PARAM_VB_SIZE_POS_]=s._vbSize,M[y._PARAM_IB_SIZE_POS_]=s._ibSize,M[y._PARAM_VB_OFFSET_POS_]=0,M[y._PARAM_IB_OFFSET_POS_]=0,M[y._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,j.syncBufferToRenderThread(s.vbBuffer),j.syncBufferToRenderThread(s.ibBuffer),M[y._PARAM_LINE_VB_POS_]=s.line_vbBuffer.getPtrID(),M[y._PARAM_LINE_IB_POS_]=s.line_ibBuffer.getPtrID(),g[y._PARAM_LINECOLOR_POS_]=_,g[y._PARAM_LINEWIDTH_POS_]=a,M[y._PARAM_LINE_VB_SIZE_POS_]=s._line_vbSize,M[y._PARAM_LINE_IB_SIZE_POS_]=s._line_ibSize,M[y._PARAM_LINE_VB_OFFSET_POS_]=0,M[y._PARAM_LINE_IB_OFFSET_POS_]=0,M[y._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,j.syncBufferToRenderThread(s.line_vbBuffer),j.syncBufferToRenderThread(s.line_ibBuffer),j.syncBufferToRenderThread(s._paramData),s._cmdCurrentPos=_?s._graphicsCmdEncoder.useCommandEncoder(y._DRAW_CIRCLE_LINES_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1):s._graphicsCmdEncoder.useCommandEncoder(y._DRAW_CIRCLE_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1),j.syncBufferToRenderThread(s._graphicsCmdEncoder),s},y.ID="DrawCircle",y._DRAW_CIRCLE_CMD_ENCODER_=null,y._DRAW_CIRCLE_LINES_CMD_ENCODER_=null,y._PARAM_VB_POS_=2,y._PARAM_IB_POS_=3,y._PARAM_LINE_VB_POS_=4,y._PARAM_LINE_IB_POS_=5,y._PARAM_LINECOLOR_POS_=6,y._PARAM_LINEWIDTH_POS_=7,y._PARAM_VB_SIZE_POS_=8,y._PARAM_IB_SIZE_POS_=9,y._PARAM_LINE_VB_SIZE_POS_=10,y._PARAM_LINE_IB_SIZE_POS_=11,y._PARAM_VB_OFFSET_POS_=12,y._PARAM_IB_OFFSET_POS_=13,y._PARAM_LINE_VB_OFFSET_POS_=14,y._PARAM_LINE_IB_OFFSET_POS_=15,y._PARAM_INDEX_ELEMENT_OFFSET_POS_=16,y._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=17}(),function(){function _(){this.texWidth=1024,this.texHeight=1024,this.atlasgrid=null,this.protectDist=1,this.texture=null,this.charMaps={},this.texHeight=this.texWidth=J.atlasWidth,this.texture=_e.getTextTexture(this.texWidth,this.texHeight),256<this.texWidth/_.atlasGridW&&(_.atlasGridW=Math.ceil(this.texWidth/256)),this.atlasgrid=new Q(this.texWidth/_.atlasGridW,this.texHeight/_.atlasGridW,this.texture.id)}f(_,"laya.webgl.text.TextAtlas");var t=_.prototype;return t.setProtecteDist=function(t){this.protectDist=t},t.getAEmpty=function(t,e,i){var r=this.atlasgrid.addRect(1,Math.ceil(t/_.atlasGridW),Math.ceil(e/_.atlasGridW),i);return r&&(i.x*=_.atlasGridW,i.y*=_.atlasGridW),r},t.destroy=function(){for(var t in this.charMaps){this.charMaps[t].deleted=!0}this.texture.discard()},t.printDebugInfo=function(){},A(0,t,"usedRate",function(){return this.atlasgrid._used}),_.atlasGridW=16,_}()),Wt=function(t){function i(t,e){i.__super.call(this,t,e)}f(i,"laya.webgl.utils.RenderSprite3D",m);var e=i.prototype;return e.onCreate=function(t){switch(t){case 4:return void(this._fun=this._blend)}},e._mask=function(t,e,i,r){var _=this._next,a=t.mask,n=e;if(a){n.save();var s=n.globalCompositeOperation,o=new M;if(o.copyFrom(a.getBounds()),o.width=Math.round(o.width),o.height=Math.round(o.height),o.x=Math.round(o.x),o.y=Math.round(o.y),0<o.width&&0<o.height){var h=o.width,l=o.height,u=St.getRT(h,l);n.breakNextMerge(),n.pushRT(),n.addRenderObject(Vt.create([n,u,h,l],laya.webgl.utils.RenderSprite3D.tmpTarget,this)),a.render(n,-o.x,-o.y),n.breakNextMerge(),n.popRT(),n.save(),n.clipRect(i+o.x-t.getStyle().pivotX,r+o.y-t.getStyle().pivotY,h,l),_._fun.call(_,t,n,i,r),n.restore(),s=n.globalCompositeOperation,n.addRenderObject(Vt.create(["mask"],laya.webgl.utils.RenderSprite3D.setBlendMode,this));var c=Y.create(1,0),f=V.INV_UV;n.drawTarget(u,i+o.x-t.getStyle().pivotX,r+o.y-t.getStyle().pivotY,h,l,S.TEMP.identity(),c,f,6),n.addRenderObject(Vt.create([u],laya.webgl.utils.RenderSprite3D.recycleTarget,this)),n.addRenderObject(Vt.create([s],laya.webgl.utils.RenderSprite3D.setBlendMode,this))}n.restore()}else _._fun.call(_,t,e,i,r)},e._blend=function(t,e,i,r){var _=t._style,a=this._next;_.blendMode?(e.save(),e.globalCompositeOperation=_.blendMode,a._fun.call(a,t,e,i,r),e.restore()):a._fun.call(a,t,e,i,r)},i.tmpTarget=function(t,e,i,r){e.start(),e.clear(0,0,0,0)},i.recycleTarget=function(t){St.releaseRT(t)},i.setBlendMode=function(t){var e=mt.mainContext;Rt.targetFns[Rt.TOINT[t]](e)},n(i,["tempUV",function(){return this.tempUV=new Array(8)}]),i}(),Gt=function(t){var i;function X(){if(this._drawTriUseAbsMatrix=!1,this._id=++X._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._renderCount=0,this._isConvexCmd=!0,this._submits=null,this._curSubmit=null,this.meshlist=[],this._clipInfoID=0,this._lastMatScaleX=1,this._lastMatScaleY=1,this._lastMat_a=1,this._lastMat_b=0,this._lastMat_c=0,this._lastMat_d=1,this._nBlendType=0,this._saveMark=null,this._drawTextureUseColor=!1,this._italicDeg=0,this._lastTex=null,this._fillColor=0,this._flushCnt=0,this.drawTexAlign=!1,this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,X.__super.call(this),this._width=99999999,this._height=99999999,this._submitKey=new Lt,this._transedPoints=new Array(8),this._temp4Points=new Array(8),this._clipRect=X.MAXCLIPRECT,this._globalClipMatrix=new S(99999999,0,0,99999999,0,0),this._shader2D=new Pt,this.mOutPoint,X._contextcount++,!X.defTexture){var t=new ue(2,2);t.setPixels(new Uint8Array(16)),X.defTexture=new V(t)}this._lastTex=X.defTexture,this.clear()}f(X,"laya.webgl.canvas.WebGLContext2D",b);var e=X.prototype;return e.clearBG=function(t,e,i,r){var _=mt.mainContext;_.clearColor(t,e,i,r),_.clear(16384)},e._getSubmits=function(){return this._submits},e._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null,this._charSubmitCache.clear();for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path=null,this._save=null;var i;for(t=0,i=this.meshlist.length;t<i;t++){this.meshlist[t].destroy()}this.meshlist.length=0,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}},e.destroy=function(){--X._contextcount,this.sprite=null,this._releaseMem(),this._charSubmitCache.destroy(),this._targets&&this._targets.destroy(),this._targets=null,this._mesh.destroy()},e.clear=function(){this._submits||(this._other=i.DEFAULT,this._curMat=S.create(),this._charSubmitCache=new Ot,this._mesh=Yt.getAMesh(),this.meshlist.push(this._mesh),this._pathMesh=Ht.getAMesh(),this.meshlist.push(this._pathMesh),this._triangleMesh=Zt.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits=[],this._save=[tt.Create(this)],this._save.length=10,this._shader2D=new Pt),this._submitKey.clear(),this._mesh.clearVB(),this._renderCount++,this._drawCount=1,this._other=i.DEFAULT,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=X.MAXCLIPRECT,this._curSubmit=At.RENDERBASE,At.RENDERBASE._ref=16777215,At.RENDERBASE._numEle=0,this._shader2D.fillStyle=this._shader2D.strokeStyle=q.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},e.size=function(t,e){this._width==t&&this._height==e||(this._width=t,this._height=e,this._targets&&(this._targets.destroy(),this._targets=new le(t,e,1,-1)),x._context==this&&(mt.mainContext.viewport(0,0,t,e),bt.width=t,bt.height=e)),0===t&&0===e&&this._releaseMem()},e.getMatScaleX=function(){return this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b||(this._lastMatScaleX=this._curMat.getScaleX(),this._lastMat_a=this._curMat.a,this._lastMat_b=this._curMat.b),this._lastMatScaleX},e.getMatScaleY=function(){return this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d||(this._lastMatScaleY=this._curMat.getScaleY(),this._lastMat_c=this._curMat.c,this._lastMat_d=this._curMat.d),this._lastMatScaleY},e.setFillColor=function(t){this._fillColor=t},e.getFillColor=function(){return this._fillColor},e.translate=function(t,e){0===t&&0===e||(ut.save(this),this._curMat._bTransform?(Dt.save(this),this._curMat.tx+=t*this._curMat.a+e*this._curMat.c,this._curMat.ty+=t*this._curMat.b+e*this._curMat.d):(this._curMat.tx=t,this._curMat.ty=e))},e.save=function(){this._save[this._save._length++]=tt.Create(this)},e.restore=function(){var t=this._save._length,e=this._nBlendType;if(!(t<1)){for(var i=t-1;0<=i;i--){var r=this._save[i];if(r.restore(this),r.isSaveMark())return void(this._save._length=i)}e!=this._nBlendType&&(this._curSubmit=At.RENDERBASE)}},e.fillText=function(t,e,i,r,_,a){this._fillText(t,null,e,i,r,_,null,0,null)},e._fillText=function(t,e,i,r,_,a,n,s,o,h){void 0===h&&(h=0),t?X._textRender.filltext(this,t,i,r,_,a,n,s,o,h):e&&X._textRender.fillWords(this,e,i,r,_,a,n,s)},e._fast_filltext=function(t,e,i,r,_,a,n,s,o){void 0===o&&(o=0),X._textRender._fast_filltext(this,t,null,e,i,r,_,a,n,s,o)},e.fillWords=function(t,e,i,r,_){this._fillText(null,t,e,i,r,_,null,-1,null,0)},e.fillBorderWords=function(t,e,i,r,_,a,n){this._fillBorderText(null,t,e,i,r,_,a,n,null)},e.drawText=function(t,e,i,r,_,a){this._fillText(t,null,e,i,r,U.create(_).strColor,null,-1,a)},e.strokeWord=function(t,e,i,r,_,a,n){this._fillText(t,null,e,i,r,null,U.create(_).strColor,a||1,n)},e.fillBorderText=function(t,e,i,r,_,a,n,s){this._fillBorderText(t,null,e,i,r,U.create(_).strColor,U.create(a).strColor,n,s)},e._fillBorderText=function(t,e,i,r,_,a,n,s,o){this._fillText(t,e,i,r,_,a,n,s||1,o)},e._fillRect=function(t,e,i,r,_){var a=this._curSubmit,n=a&&2===a._key.submitType&&a._key.blendShader===this._nBlendType;65535<this._mesh.vertNum+4&&(this._mesh=Yt.getAMesh(),this.meshlist.push(this._mesh),n=!1),n&&(n=n&&this.isSameClipInfo(a)),this.transformQuad(t,e,i,r,0,this._curMat,this._transedPoints),this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,V.NO_UV,_,!1),n||(a=this._curSubmit=te.create(this,this._mesh,Y.create(1,0)),this._submits[this._submits._length++]=a,this._copyClipInfo(a,this._globalClipMatrix),a.shaderValue.textureHost=this._lastTex,a._key.other=this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1,a._renderType=10016),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},e.fillRect=function(t,e,i,r,_){var a=_?q.create(_):this._shader2D.fillStyle,n=this.mixRGBandAlpha(a.toInt());this._fillRect(t,e,i,r,n)},e.fillTexture=function(t,e,i,r,_,a,n,s){if(t._getSource()){var o=this._curSubmit;65535<this._mesh.vertNum+4&&(this._mesh=Yt.getAMesh(),this.meshlist.push(this._mesh),!1);t.bitmap;var h=!0,l=!0;switch(a){case"repeat":break;case"repeat-x":l=!1;break;case"repeat-y":h=!1;break;case"no-repeat":h=l=!1}var u=this._temp4Points,c=0,f=0,d=0,A=0,E=0,m=0;if(n.x<0?(d=e,c=-n.x%t.width/t.width):d=e+n.x,n.y<0?(A=i,f=-n.y%t.height/t.height):A=i+n.y,E=e+r,m=i+_,!h&&(E=Math.min(E,e+n.x+t.width)),!l&&(m=Math.min(m,i+n.y+t.height)),!(E<e||m<i||E<d||m<A)){var R=(E-e-n.x)/t.width,p=(m-i-n.y)/t.height;if(this.transformQuad(d,A,E-d,m-A,0,this._curMat,this._transedPoints),u[0]=c,u[1]=f,u[2]=R,u[3]=f,u[4]=R,u[5]=p,u[6]=c,u[7]=p,!this.clipedOff(this._transedPoints)){var T=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA);this._mesh.addQuad(this._transedPoints,u,T,!0);var v=Y.create(1,0);v.defines.add(256),v.u_TexRange=t.uvrect,o=this._curSubmit=te.create(this,this._mesh,v),this._submits[this._submits._length++]=o,this._copyClipInfo(o,this._globalClipMatrix),o.shaderValue.textureHost=t,o._renderType=10016,this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4}this.breakNextMerge()}}else this.sprite&&D.systemTimer.callLater(this,this._repaintSprite)},e.setColorFilter=function(t){z.save(this,8388608,this,!0),this._colorFiler=t,this._curSubmit=At.RENDERBASE},e.drawTexture=function(t,e,i,r,_){this._drawTextureM(t,e,i,r,_,null,1,null)},e.drawTextures=function(t,e,i,r){if(t._getSource())for(var _=e.length/2,a=0,n=0;n<_;n++)this._inner_drawTexture(t,t.bitmap.id,e[a++]+i,e[a++]+r,0,0,null,null,1,!1);else this.sprite&&D.systemTimer.callLater(this,this._repaintSprite)},e._drawTextureAddSubmit=function(t,e){var i=null;i=te.create(this,this._mesh,Y.create(1,0)),(this._submits[this._submits._length++]=i).shaderValue.textureHost=e,i._key.other=t,i._renderType=10016,this._curSubmit=i},e._drawTextureM=function(t,e,i,r,_,a,n,s){return t._getSource()?this._inner_drawTexture(t,t.bitmap.id,e,i,r,_,a,s,n,!1):(this.sprite&&D.systemTimer.callLater(this,this._repaintSprite),!1)},e._drawRenderTexture=function(t,e,i,r,_,a,n,s){return this._inner_drawTexture(t,-1,e,i,r,_,a,s,1,!1)},e.submitDebugger=function(){this._submits[this._submits._length++]=Vt.create([],function(){},this)},e._copyClipInfo=function(t,e){var i=t.shaderValue.clipMatDir;i[0]=e.a,i[1]=e.b,i[2]=e.c,i[3]=e.d;var r=t.shaderValue.clipMatPos;r[0]=e.tx,r[1]=e.ty,t.clipInfoID=this._clipInfoID},e.isSameClipInfo=function(t){return t.clipInfoID===this._clipInfoID},e._useNewTex2DSubmit=function(t,e){65535<this._mesh.vertNum+e&&(this._mesh=Yt.getAMesh(),this.meshlist.push(this._mesh));var i=te.create(this,this._mesh,Y.create(1,0));this._submits[this._submits._length++]=this._curSubmit=i,i.shaderValue.textureHost=t,this._copyClipInfo(i,this._globalClipMatrix)},e._drawTexRect=function(t,e,i,r,_){this.transformQuad(t,e,i,r,this._italicDeg,this._curMat,this._transedPoints);var a=this._transedPoints;a[0]=a[0]+.5|0,a[1]=a[1]+.5|0,a[2]=a[2]+.5|0,a[3]=a[3]+.5|0,a[4]=a[4]+.5|0,a[5]=a[5]+.5|0,a[6]=a[6]+.5|0,a[7]=a[7]+.5|0,this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,_,this._fillColor,!0),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},e.drawCallOptimize=function(t){return this._charSubmitCache.enable(t,this),t},e._inner_drawTexture=function(t,e,i,r,_,a,n,s,o,h){var l=this._curSubmit._key;if(s=s||t._uv,4===l.submitType&&l.other===e){var u=X._drawTexToDrawTri_Vert;return u[0]=i,u[1]=r,u[2]=i+_,u[3]=r,u[4]=i+_,u[5]=r+a,u[6]=i,u[7]=r+a,this._drawTriUseAbsMatrix=!0,this.drawTriangles(t,0,0,u,s,X._drawTexToDrawTri_Index,n,o,null,"normal"),!(this._drawTriUseAbsMatrix=!1)}var c=h?this._charSubmitCache.getPos():this._transedPoints;this.transformQuad(i,r,_||t.width,a||t.height,this._italicDeg,n||this._curMat,c),this.drawTexAlign&&(c[0]=c[0]+.5|0,c[1]=c[1]+.5|0,c[2]=c[2]+.5|0,c[3]=c[3]+.5|0,c[4]=c[4]+.5|0,c[5]=c[5]+.5|0,c[6]=c[6]+.5|0,c[7]=c[7]+.5|0,this.drawTexAlign=!1);var f=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*o);if(h)return this._charSubmitCache.add(this,t,e,c,s,f),!0;this._drawCount++;var d=0<=e&&2===l.submitType&&l.other===e;if(d&&(d=d&&this.isSameClipInfo(this._curSubmit)),this._lastTex=t,65535<this._mesh.vertNum+4&&(this._mesh=Yt.getAMesh(),this.meshlist.push(this._mesh),d=!1),this.clipedOff(this._transedPoints))return!1;if(this._mesh.addQuad(c,s,f,!0),!d){var A=te.create(this,this._mesh,Y.create(1,0));this._submits[this._submits._length++]=this._curSubmit=A,A.shaderValue.textureHost=t,A._key.other=e,this._copyClipInfo(A,this._globalClipMatrix)}return this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,!0},e.transform4Points=function(t,e,i){var r=e.tx,_=e.ty;e._bTransform?(i[0]=t[0]*e.a+t[1]*e.c+r,i[1]=t[0]*e.b+t[1]*e.d+_,i[2]=t[2]*e.a+t[3]*e.c+r,i[3]=t[2]*e.b+t[3]*e.d+_,i[4]=t[4]*e.a+t[5]*e.c+r,i[5]=t[4]*e.b+t[5]*e.d+_,i[6]=t[6]*e.a+t[7]*e.c+r,i[7]=t[6]*e.b+t[7]*e.d+_):(i[0]=t[0]+r,i[1]=t[1]+_,i[2]=t[2]+r,i[3]=t[3]+_,i[4]=t[4]+r,i[5]=t[5]+_,i[6]=t[6]+r,i[7]=t[7]+_)},e.clipedOff=function(t){return this._clipRect.width<=0||this._clipRect.height<=0},e.transformQuad=function(t,e,i,r,_,a,n){var s=0;0!=_&&(s=Math.tan(_*Math.PI/180)*r);var o=t+i,h=e+r;this._temp4Points[0]=t+s,this._temp4Points[1]=e,this._temp4Points[2]=o+s,this._temp4Points[3]=e,this._temp4Points[4]=o,this._temp4Points[5]=h,this._temp4Points[6]=t,this._temp4Points[7]=h,this.transform4Points(this._temp4Points,a,n)},e.pushRT=function(){this.addRenderObject(Vt.create(null,le.pushRT,this))},e.popRT=function(){this.addRenderObject(Vt.create(null,le.popRT,this)),this.breakNextMerge()},e.useRT=function(t){this.addRenderObject(Vt.create([t],function(t){if(!t)throw"error useRT";t.start(),t.clear(0,0,0,0)},this)),this.breakNextMerge()},e.RTRestore=function(t){this.addRenderObject(Vt.create([t],function(t){t.restore()},this)),this.breakNextMerge()},e.breakNextMerge=function(){this._curSubmit=At.RENDERBASE},e._repaintSprite=function(){this.sprite&&this.sprite.repaint()},e.drawTextureWithTransform=function(t,e,i,r,_,a,n,s,o,h,l){var u=null;h&&(u=this.globalCompositeOperation,this.globalCompositeOperation=h);var c=this._colorFiler;if(l&&this.setColorFilter(l),!a)return this._drawTextureM(t,e+n,i+s,r,_,null,o,null),h&&(this.globalCompositeOperation=u),void(l&&this.setColorFilter(c));var f=this._curMat;X._tmpMatrix.a=a.a,X._tmpMatrix.b=a.b,X._tmpMatrix.c=a.c,X._tmpMatrix.d=a.d,X._tmpMatrix.tx=a.tx+n,X._tmpMatrix.ty=a.ty+s,X._tmpMatrix._bTransform=a._bTransform,a&&f._bTransform?(S.mul(X._tmpMatrix,f,X._tmpMatrix),(a=X._tmpMatrix)._bTransform=!0):a=X._tmpMatrix,this._drawTextureM(t,e,i,r,_,a,o,null),h&&(this.globalCompositeOperation=u),l&&this.setColorFilter(c)},e._flushToTarget=function(t,e){bt.worldScissorTest=!1,mt.mainContext.disable(3089);var i=bt.worldAlpha,r=bt.worldMatrix4,_=bt.worldMatrix;bt.worldShaderDefines;bt.worldMatrix=S.EMPTY,bt.restoreTempArray(),bt.worldMatrix4=bt.TEMPMAT4_ARRAY,bt.worldAlpha=1,ee.activeShader=null,e.start(),0<t._submits._length&&e.clear(0,0,0,0),t._curSubmit=At.RENDERBASE,t.flush(),t.clear(),e.restore(),t._curSubmit=At.RENDERBASE,ee.activeShader=null,bt.worldAlpha=i,bt.worldMatrix4=r,bt.worldMatrix=_},e.drawCanvas=function(t,e,i,r,_){var a,n=t.context;if(n._targets)0<n._submits._length&&(a=Vt.create([n,n._targets],this._flushToTarget,this),this._submits[this._submits._length++]=a),this._drawRenderTexture(n._targets,e,i,r,_,null,1,le.flipyuv),this._curSubmit=At.RENDERBASE;else{var s=t;s.touches&&s.touches.forEach(function(t){t.touch()}),a=Jt.create(t,this._shader2D.ALPHA,this._shader2D.filters),(this._submits[this._submits._length++]=a)._key.clear();var o=a._matrix;this._curMat.copyTo(o);var h=o.tx,l=o.ty;o.tx=o.ty=0,o.transformPoint(g.TEMP.setTo(e,i)),o.translate(g.TEMP.x+h,g.TEMP.y+l),S.mul(s.invMat,o,o),this._curSubmit=At.RENDERBASE}},e.drawTarget=function(t,e,i,r,_,a,n,s,o){void 0===o&&(o=-1),this._drawCount++;this.mixRGBandAlpha(this._drawTextureUseColor?this.fillStyle?this.fillStyle.toInt():0:4294967295);if(65535<this._mesh.vertNum+4&&(this._mesh=Yt.getAMesh(),this.meshlist.push(this._mesh)),this.transformQuad(e,i,r,_,0,a||this._curMat,this._transedPoints),this.clipedOff(this._transedPoints))return this._curSubmit=At.RENDERBASE,!1;this._mesh.addQuad(this._transedPoints,s||V.DEF_UV,4294967295,!0);var h=this._curSubmit=ft.create(this,this._mesh,n,t);return h.blendType=-1==o?this._nBlendType:o,this._copyClipInfo(h,this._globalClipMatrix),h._numEle=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._maxNumEle=Math.max(this._maxNumEle,h._numEle),this._submits[this._submits._length++]=h,this._curSubmit=At.RENDERBASE,!0},e.drawTriangles=function(t,e,i,r,_,a,n,s,o,h){if(t._getSource()){this._drawCount++;var l=null,u=!1;o&&(l=this._colorFiler,this._colorFiler=o,this._curSubmit=At.RENDERBASE,u=l!=o);var c=t.bitmap,f=this._curSubmit._key,d=4===f.submitType&&f.other===c.id&&f.blendShader==this._nBlendType,A=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*s),E=r.length/2,m=a.length;if(65535<this._triangleMesh.vertNum+E&&(this._triangleMesh=Zt.getAMesh(),this.meshlist.push(this._triangleMesh),d=!1),!d){var R=this._curSubmit=te.create(this,this._triangleMesh,Y.create(1,0));R.shaderValue.textureHost=t,R._renderType=10016,R._key.submitType=4,R._key.other=c.id,this._copyClipInfo(R,this._globalClipMatrix),this._submits[this._submits._length++]=R}X._tmpMatrix.ty=n?(X._tmpMatrix.a=n.a,X._tmpMatrix.b=n.b,X._tmpMatrix.c=n.c,X._tmpMatrix.d=n.d,X._tmpMatrix.tx=n.tx+e,n.ty+i):(X._tmpMatrix.a=1,X._tmpMatrix.b=0,X._tmpMatrix.c=0,X._tmpMatrix.d=1,X._tmpMatrix.tx=e,i),this._drawTriUseAbsMatrix||S.mul(X._tmpMatrix,this._curMat,X._tmpMatrix),this._triangleMesh.addData(r,_,a,X._tmpMatrix,A,this),this._curSubmit._numEle+=m,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),u&&(this._colorFiler=l,this._curSubmit=At.RENDERBASE)}else this.sprite&&D.systemTimer.callLater(this,this._repaintSprite)},e.transform=function(t,e,i,r,_,a){Dt.save(this),S.mul(S.TEMP.setTo(t,e,i,r,_,a),this._curMat,this._curMat),this._curMat._checkTransform()},e._transformByMatrix=function(t,e,i){t.setTranslate(e,i),S.mul(t,this._curMat,this._curMat),t.setTranslate(0,0),this._curMat._bTransform=!0},e.setTransformByMatrix=function(t){t.copyTo(this._curMat)},e.rotate=function(t){Dt.save(this),this._curMat.rotateEx(t)},e.scale=function(t,e){Dt.save(this),this._curMat.scaleEx(t,e)},e.clipRect=function(t,e,i,r){Z.save(this),this._clipRect==X.MAXCLIPRECT?this._clipRect=new M(t,e,i,r):(this._clipRect.width=i,this._clipRect.height=r,this._clipRect.x=t,this._clipRect.y=e),X._clipID_Gen++,X._clipID_Gen%=1e4,this._clipInfoID=X._clipID_Gen;var _=this._globalClipMatrix,a=_.tx,n=_.ty,s=a+_.a,o=n+_.d;if(99999999<=this._clipRect.width?(_.a=_.d=99999999,_.b=_.c=_.tx=_.ty=0):this._curMat._bTransform?(_.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx,_.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty,_.a=this._clipRect.width*this._curMat.a,_.b=this._clipRect.width*this._curMat.b,_.c=this._clipRect.height*this._curMat.c,_.d=this._clipRect.height*this._curMat.d):(_.tx=this._clipRect.x+this._curMat.tx,_.ty=this._clipRect.y+this._curMat.ty,_.a=this._clipRect.width,_.b=_.c=0,_.d=this._clipRect.height),0<_.a&&0<_.d){var h=_.tx+_.a,l=_.ty+_.d;h<=a||l<=n||_.tx>=s||_.ty>=o?(_.a=-.1,_.d=-.1):(_.tx<a&&(_.a-=a-_.tx,_.tx=a),s<h&&(_.a-=h-s),_.ty<n&&(_.d-=n-_.ty,_.ty=n),o<l&&(_.d-=l-o),_.a<=0&&(_.a=-.1),_.d<=0&&(_.d=-.1))}},e.drawMesh=function(t,e,i,r,_,a,n,s,o){void 0===o&&(o=0)},e.addRenderObject=function(t){this._submits[this._submits._length++]=t},e.submitElement=function(t,e){x._context;var i=this._submits,r=i._length;e<0&&(e=i._length);for(var _=At.RENDERBASE;t<e;)this._renderNextSubmitIndex=t+1,i[t]!==At.RENDERBASE?(At.preRender=_,t+=(_=i[t]).renderSubmit()):t++;return r},e.flush=function(){var t=this.submitElement(0,this._submits._length);this._path&&this._path.reset(),H.instance&&H.getInstance().reset(),this._curSubmit=At.RENDERBASE;for(var e=0,i=this.meshlist.length;e<i;e++){var r=this.meshlist[e];r.canReuse?r.releaseMesh():r.destroy()}if(this.meshlist.length=0,this._mesh=Yt.getAMesh(),this._pathMesh=Ht.getAMesh(),this._triangleMesh=Zt.getAMesh(),this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh),this._flushCnt++,this._flushCnt%60==0&&x._context==this){var _=D.textRender;_&&_.GC(!1)}return t},e.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=k.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},e.beginPath=function(t){void 0===t&&(t=!1),this._getPath().beginPath(t)},e.closePath=function(){this._path.closePath()},e.addPath=function(t,e,i,r,_){for(var a=0,n=0,s=t.length/2;n<s;n++){var o=t[a]+r,h=t[a+1]+_;t[a]=o,t[a+1]=h,a+=2}this._getPath().push(t,i)},e.fill=function(){var t=this._curMat,e=this._getPath(),i=this._curSubmit,r=3===i._key.submitType&&i._key.blendShader===this._nBlendType;r&&(r=r&&this.isSameClipInfo(i)),r||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var _,a=this.mixRGBandAlpha(this.fillStyle.toInt()),n=0,s=0,o=e.paths.length;s<o;s++){var h=e.paths[s],l=h.path.length/2;if(!(l<3||3==l&&!h.convex)){var u=h.path.concat(),c=0,f=0,d=0,A=NaN,E=NaN;if(t._bTransform)for(c=0;c<l;c++)d=(f=c<<1)+1,A=u[f],E=u[d],u[f]=t.a*A+t.c*E+t.tx,u[d]=t.b*A+t.d*E+t.ty;else for(c=0;c<l;c++)d=(f=c<<1)+1,A=u[f],E=u[d],u[f]=A+t.tx,u[d]=E+t.ty;65535<this._pathMesh.vertNum+l&&(this._curSubmit._numEle+=n,n=0,this._pathMesh=Ht.getAMesh(),this._curSubmit=this.addVGSubmit(this._pathMesh));var m=this._pathMesh.vertNum;if(h.convex){var R=l-2;_=new Array(3*R);for(var p=0,T=0;T<R;T++)_[p++]=m,_[p++]=T+1+m,_[p++]=T+2+m}else if(_=dt.earcut(u,null,2),0<m)for(var v=0;v<_.length;v++)_[v]+=m;this._pathMesh.addVertAndIBToMesh(this,u,a,_),n+=_.length}}this._curSubmit._numEle+=n},e.addVGSubmit=function(t){var e=At.createShape(this,t,0,Y.create(4,0));return e._key.submitType=3,this._submits[this._submits._length++]=e,this._copyClipInfo(e,this._globalClipMatrix),e},e.stroke=function(){if(0<this.lineWidth){var t=this.mixRGBandAlpha(this.strokeStyle._color.numColor),e=this._getPath(),i=this._curSubmit,r=3===i._key.submitType&&i._key.blendShader===this._nBlendType;r&&(r=r&&this.isSameClipInfo(i)),r||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var _=0,a=0,n=e.paths.length;a<n;a++){var s=e.paths[a];if(!(s.path.length<=0)){var o=[],h=[],l=2*s.path.length;if(!(l<2)){65535<this._pathMesh.vertNum+l&&(this._curSubmit._numEle+=_,_=0,this._pathMesh=Ht.getAMesh(),this.meshlist.push(this._pathMesh),this._curSubmit=this.addVGSubmit(this._pathMesh)),yt.createLine2(s.path,o,this.lineWidth,this._pathMesh.vertNum,h,s.loop);var u=h.length/2,c=this._curMat,f=0,d=0,A=0,E=NaN,m=NaN;if(c._bTransform)for(f=0;f<u;f++)A=(d=f<<1)+1,E=h[d],m=h[A],h[d]=c.a*E+c.c*m+c.tx,h[A]=c.b*E+c.d*m+c.ty;else for(f=0;f<u;f++)A=(d=f<<1)+1,E=h[d],m=h[A],h[d]=E+c.tx,h[A]=m+c.ty;this._pathMesh.addVertAndIBToMesh(this,h,t,o),_+=o.length}}}this._curSubmit._numEle+=_}},e.moveTo=function(t,e){var i=this._getPath();i.newPath(),i._lastOriX=t,i._lastOriY=e,i.addPoint(t,e)},e.lineTo=function(t,e){var i=this._getPath();Math.abs(t-i._lastOriX)<.001&&Math.abs(e-i._lastOriY)<.001||(i._lastOriX=t,i._lastOriY=e,i.addPoint(t,e))},e.arcTo=function(t,e,i,r,_){var a=0,n=0,s=0,o=this._path._lastOriX-t,h=this._path._lastOriY-e,l=Math.sqrt(o*o+h*h);if(!(l<=1e-6)){var u=o/l,c=h/l,f=i-t,d=r-e,A=f*f+d*d,E=Math.sqrt(A);if(!(E<=1e-6)){var m=f/E,R=d/E,p=u+m,T=c+R,v=Math.sqrt(p*p+T*T);if(!(v<=1e-6)){var D=p/v,P=T/v,C=Math.acos(D*u+P*c),g=Math.PI/2-C,M=(l=_/Math.tan(g))*u+t,y=l*c+e,O=Math.sqrt(l*l+_*_),S=t+D*O,b=e+P*O,L=0,x=0;if(0<=u*R-c*m){var B=2*g/X.SEGNUM;L=Math.sin(B),x=Math.cos(B)}else B=2*-g/X.SEGNUM,L=Math.sin(B),x=Math.cos(B);var I=this._path._lastOriX,N=this._path._lastOriY,F=M,w=y;(.1<Math.abs(F-this._path._lastOriX)||.1<Math.abs(w-this._path._lastOriY))&&(I=n=F,N=s=w,this._path.addPoint(n,s));var V=M-S,U=y-b;for(a=0;a<X.SEGNUM;a++){var W=V*x+U*L,G=-V*L+U*x;n=W+S,s=G+b,(.1<Math.abs(I-n)||.1<Math.abs(N-s))&&(this._path.addPoint(n,s),I=n,N=s),V=W,U=G}}}}},e.arc=function(t,e,i,r,_,a,n){void 0===a&&(a=!1),void 0===n&&(n=!0);var s,o,h=0,l=0,u=0,c=0,f=0,d=0,A=0;if(l=_-r,a)if(Math.abs(l)>=2*Math.PI)l=2*-Math.PI;else for(;0<l;)l-=2*Math.PI;else if(Math.abs(l)>=2*Math.PI)l=2*Math.PI;else for(;l<0;)l+=2*Math.PI;var E=this.getMatScaleX(),m=this.getMatScaleY(),R=i*(m<E?E:m),p=2*Math.PI*R;s=l/(o=0|Math.max(p/10,10))/2,u=Math.abs(4/3*(1-Math.cos(s))/Math.sin(s)),a&&(u=-u);var T=this._getPath();for(A=0;A<=o;A++)h=r+l*(A/o),c=Math.cos(h),d=e+Math.sin(h)*i,(f=t+c*i)==this._path._lastOriX&&d==this._path._lastOriY||T.addPoint(f,d);c=Math.cos(_),d=e+Math.sin(_)*i,(f=t+c*i)==this._path._lastOriX&&d==this._path._lastOriY||T.addPoint(f,d)},e.quadraticCurveTo=function(t,e,i,r){for(var _=o.I.getBezierPoints([this._path._lastOriX,this._path._lastOriY,t,e,i,r],30,2),a=0,n=_.length/2;a<n;a++)this.lineTo(_[2*a],_[2*a+1]);this.lineTo(i,r)},e.rect=function(t,e,i,r){this._other=this._other.make(),this._other.path||(this._other.path=new pt),this._other.path.rect(t,e,i,r)},e.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},e._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},e.strokeRect=function(t,e,i,r,_){if(0<this.lineWidth){var a=this.mixRGBandAlpha(this.strokeStyle._color.numColor),n=this.lineWidth/2;this._fillRect(t-n,e-n,i+this.lineWidth,this.lineWidth,a),this._fillRect(t-n,e-n+r,i+this.lineWidth,this.lineWidth,a),this._fillRect(t-n,e+n,this.lineWidth,r-this.lineWidth,a),this._fillRect(t-n+i,e+n,this.lineWidth,r-this.lineWidth,a)}},e.clip=function(){},e.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},e._getPath=function(){return this._path||(this._path=new pt)},A(0,e,"globalCompositeOperation",function(){return Rt.NAMES[this._nBlendType]},function(t){var e=Rt.TOINT[t];null==e||this._nBlendType===e||(z.save(this,65536,this,!0),this._curSubmit=At.RENDERBASE,this._nBlendType=e)}),A(0,e,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(z.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=q.create(t),this._submitKey.other=-this._shader2D.strokeStyle.toInt())}),A(0,e,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(z.save(this,1,this._shader2D,!1),this._shader2D.ALPHA=t)}),A(0,e,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new le(this._width,this._height,1,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets&&this._targets.destroy(),this._targets=null}),A(0,e,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(z.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=q.create(t),this._submitKey.other=-this._shader2D.fillStyle.toInt())}),A(0,e,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),z.save(this,32768,this._other,!1),this._other.textAlign=t)}),A(0,e,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),z.save(this,256,this._other,!1),this._other.lineWidth=t)}),A(0,e,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),z.save(this,16384,this._other,!1),this._other.textBaseline=t)}),A(0,e,"font",null,function(t){this._other=this._other.make(),z.save(this,8,this._other,!1)}),A(0,e,"canvas",function(){return this._canvas}),X.__init__=function(){i.DEFAULT=new i},X.set2DRenderConfig=function(){var t=j.instance;ot.setBlend(t,!0),ot.setBlendFunc(t,1,771),ot.setDepthTest(t,!1),ot.setCullFace(t,!1),ot.setDepthMask(t,!0),ot.setFrontFace(t,2305),t.viewport(0,0,bt.width,bt.height)},X._tempPoint=new g,X._SUBMITVBSIZE=32e3,X._MAXSIZE=99999999,X._MAXVERTNUM=65535,X.MAXCLIPRECT=new M(0,0,99999999,99999999),X._COUNT=0,X._tmpMatrix=new S,X.SEGNUM=32,X._contextcount=0,X._clipID_Gen=0,X.defTexture=null,n(X,["_drawStyleTemp",function(){return this._drawStyleTemp=new q(null)},"_keyMap",function(){return this._keyMap=new N},"_drawTexToDrawTri_Vert",function(){return this._drawTexToDrawTri_Vert=new Float32Array(8)},"_drawTexToDrawTri_Index",function(){return this._drawTexToDrawTri_Index=new Uint16Array([0,1,2,0,2,3])},"_textRender",function(){return this._textRender=J.useOldCharBook?new wt:new J}]),X.__init$=function(){i=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null}f(t,"");var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,t}()},X}(),Xt=function(t){function i(t){this.texcoord=null,this.position=null,this.offsetX=300,this.offsetY=0,i.__super.call(this,512,0);var e=8*Et.BYTES_PE;this.position=[2,5126,!1,e,0],this.texcoord=[2,5126,!1,e,2*Et.BYTES_PE],this.color=[4,5126,!1,e,4*Et.BYTES_PE]}return f(i,"laya.webgl.shader.d2.skinAnishader.SkinSV",Y),i}(),kt=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,void 0===t&&(t=0),e.__super.call(this,1,t),this._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2]}return f(e,"laya.webgl.shader.d2.value.TextureSV",Y),e.prototype.clear=function(){this.texture=null,this.shader=null,this.defines._value=this.subID+(mt.shaderHighPrecision?1024:0)},e}(),zt=function(t){function e(t){e.__super.call(this,4,0),this._attribLocation=["position",0,"attribColor",1]}return f(e,"laya.webgl.shader.d2.value.PrimitiveSV",Y),e}(),Yt=function(t){function e(){e.__super.call(this,laya.webgl.utils.MeshQuadTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshQuadTexture._fixattriInfo),laya.webgl.utils.MeshQuadTexture._fixib?(this._ib=laya.webgl.utils.MeshQuadTexture._fixib,this._quadNum=e._maxIB):(this.createQuadIB(e._maxIB),laya.webgl.utils.MeshQuadTexture._fixib=this._ib)}f(e,"laya.webgl.utils.MeshQuadTexture",K);var i=e.prototype;return i.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshQuadTexture._POOL.push(this)},i.destroy=function(){this._vb.destroy(),this._vb.deleteBuffer()},i.addQuad=function(t,e,i,r){var _=this._vb,a=_._byteLength>>2;_.setByteLength(a+laya.webgl.utils.MeshQuadTexture.const_stride<<2);var n=_._floatArray32||_.getFloat32Array(),s=_._uint32Array,o=a,h=r?255:0;n[o++]=t[0],n[o++]=t[1],n[o++]=e[0],n[o++]=e[1],s[o++]=i,s[o++]=h,n[o++]=t[2],n[o++]=t[3],n[o++]=e[2],n[o++]=e[3],s[o++]=i,s[o++]=h,n[o++]=t[4],n[o++]=t[5],n[o++]=e[4],n[o++]=e[5],s[o++]=i,s[o++]=h,n[o++]=t[6],n[o++]=t[7],n[o++]=e[6],n[o++]=e[7],s[o++]=i,s[o++]=h,_._upload=!0},e.getAMesh=function(){return laya.webgl.utils.MeshQuadTexture._POOL.length?laya.webgl.utils.MeshQuadTexture._POOL.pop():new e},e.const_stride=24,e._fixib=null,e._maxIB=16384,e._POOL=[],n(e,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]),e}(),Ht=function(t){function l(){l.__super.call(this,laya.webgl.utils.MeshVG.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshVG._fixattriInfo)}f(l,"laya.webgl.utils.MeshVG",K);var e=l.prototype;return e.addVertAndIBToMesh=function(t,e,i,r){for(var _=this._vb.needSize(e.length/2*l.const_stride)>>2,a=this._vb._floatArray32||this._vb.getFloat32Array(),n=this._vb._uint32Array,s=0,o=e.length/2,h=0;h<o;h++)a[_++]=e[s],a[_++]=e[s+1],s+=2,n[_++]=i;this._vb.setNeedUpload(),this._ib.append(new Uint16Array(r)),this._ib.setNeedUpload(),this.vertNum+=o,this.indexNum+=r.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshVG._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},l.getAMesh=function(){return laya.webgl.utils.MeshVG._POOL.length?laya.webgl.utils.MeshVG._POOL.pop():new l},l.const_stride=12,l._POOL=[],n(l,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5121,4,8]}]),l}(),Zt=function(t){function p(){p.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}f(p,"laya.webgl.utils.MeshTexture",K);var e=p.prototype;return e.addData=function(t,e,i,r,_,a){for(var n=t.length/2,s=this._vb.needSize(n*p.const_stride)>>2,o=this._vb._floatArray32||this._vb.getFloat32Array(),h=this._vb._uint32Array,l=0,u=0;u<n;u++){var c=t[l],f=t[l+1],d=c*r.a+f*r.c+r.tx,A=c*r.b+f*r.d+r.ty;o[s++]=d,o[s++]=A,o[s++]=e[l],o[s++]=e[l+1],l+=2,h[s++]=_,h[s++]=255}this._vb.setNeedUpload();var E=this.vertNum;if(0<E){var m=i.length;m>p.tmpIdx.length&&(p.tmpIdx=new Uint16Array(m));for(var R=0;R<m;R++)p.tmpIdx[R]=i[R]+E;this._ib.appendU16Array(p.tmpIdx,i.length)}else this._ib.append(i);this._ib.setNeedUpload(),this.vertNum+=n,this.indexNum+=i.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},p.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new p},p.const_stride=24,p._POOL=[],n(p,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),p}(),jt=function(t){function i(){i.__super.call(this,i.__name2int,i.__int2name,i.__int2nameMap)}return f(i,"laya.webgl.shader.d2.ShaderDefines2D",et),i.__init__=function(){i.reg("TEXTURE2D",1),i.reg("PRIMITIVE",4),i.reg("GLOW_FILTER",8),i.reg("BLUR_FILTER",16),i.reg("COLOR_FILTER",32),i.reg("COLOR_ADD",64),i.reg("WORLDMAT",128),i.reg("FILLTEXTURE",256),i.reg("FSHIGHPRECISION",1024),i.reg("MVP3D",2048)},i.reg=function(t,e){et._reg(t,e,i.__name2int,i.__int2name)},i.toText=function(t,e,i){return et._toText(t,e,i)},i.toInt=function(t){return et._toInt(t,i.__name2int)},i.TEXTURE2D=1,i.PRIMITIVE=4,i.FILTERGLOW=8,i.FILTERBLUR=16,i.FILTERCOLOR=32,i.COLORADD=64,i.WORLDMAT=128,i.FILLTEXTURE=256,i.SKINMESH=512,i.SHADERDEFINE_FSHIGHPRECISION=1024,i.MVP3D=2048,i.NOOPTMASK=312,i.__name2int={},i.__int2name=[],i.__int2nameMap=[],i}(),Qt=function(t){function E(t,e,i,r,_){this.lastScaleX=1,this.lastScaleY=1,this.needResetScale=!1,this.maxTexW=0,this.maxTexH=0,this.scaleFontSize=!0,this.showDbgInfo=!1,this.supportImageData=!0,E.__super.call(this),void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===_&&(_=!1),this.maxTexW=t,this.maxTexH=e,this.scaleFontSize=i,this.supportImageData=r,this.showDbgInfo=_,E.canvas||((E.canvas=d.document.createElement("canvas")).width=1024,E.canvas.height=512,E.canvas.style.left="-10000px",E.canvas.style.position="absolute",a.body.appendChild(E.canvas),E.ctx=E.canvas.getContext("2d"))}f(E,"laya.webgl.resource.CharRender_Canvas",rt);var e=E.prototype;return e.getWidth=function(t,e){return E.ctx?(E.ctx._lastFont!=t&&(E.ctx.font=t,E.ctx._lastFont=t),E.ctx.measureText(e).width):0},e.scale=function(t,e){if(!this.supportImageData)return this.lastScaleX=t,void(this.lastScaleY=e);this.lastScaleX==t&&this.lastScaleY==e||(E.ctx.setTransform(t,0,0,e,0,0),this.lastScaleX=t,this.lastScaleY=e)},e.getCharBmp=function(t,e,i,r,_,a,n,s,o,h,l){if(!this.supportImageData)return this.getCharCanvas(t,e,i,r,_,a,n,s,o,h);E.ctx.font!=e&&(E.ctx.font=e,E.ctx._lastFont=e),a.width=E.ctx.measureText(t).width;var u=a.width*this.lastScaleX,c=a.height*this.lastScaleY;u+=(n+o)*this.lastScaleX,c+=(s+h)*this.lastScaleY,u=Math.ceil(u),c=Math.ceil(c);var f=(u=Math.min(u,laya.webgl.resource.CharRender_Canvas.canvas.width))+2*i+1,d=(c=Math.min(c,laya.webgl.resource.CharRender_Canvas.canvas.height))+2*i+1;l&&(f=Math.max(f,l[0]+l[2]+1),d=Math.max(d,l[1]+l[3]+1)),E.ctx.clearRect(0,0,f,d),E.ctx.save(),E.ctx.textBaseline="top",0<i&&(E.ctx.strokeStyle=_,E.ctx.lineWidth=i,E.ctx.strokeText(t,n,s)),E.ctx.fillStyle=r,E.ctx.fillText(t,n,s),this.showDbgInfo&&(E.ctx.strokeStyle="#ff0000",E.ctx.strokeRect(0,0,u,c),E.ctx.strokeStyle="#00ff00",E.ctx.strokeRect(n,s,a.width,a.height)),l&&-1==l[2]&&(l[2]=Math.ceil((a.width+i)*this.lastScaleX));var A=l?E.ctx.getImageData(l[0],l[1],l[2],l[3]):E.ctx.getImageData(0,0,u,c);return E.ctx.restore(),a.bmpWidth=A.width,a.bmpHeight=A.height,A},e.getCharCanvas=function(t,e,i,r,_,a,n,s,o,h){E.ctx.font!=e&&(E.ctx.font=e,E.ctx._lastFont=e),a.width=E.ctx.measureText(t).width;var l=a.width*this.lastScaleX,u=a.height*this.lastScaleY;return l+=(n+o)*this.lastScaleX,u+=(s+h)*this.lastScaleY+1,l=Math.min(l,this.maxTexW),u=Math.min(u,this.maxTexH),E.canvas.width=Math.min(l+1,this.maxTexW),E.canvas.height=Math.min(u+1,this.maxTexH),E.ctx.font=e,E.ctx.clearRect(0,0,l+1+i,u+1+i),E.ctx.setTransform(1,0,0,1,0,0),E.ctx.save(),this.scaleFontSize&&E.ctx.scale(this.lastScaleX,this.lastScaleY),E.ctx.translate(n,s),E.ctx.textAlign="left",E.ctx.textBaseline="top",0<i?(E.ctx.strokeStyle=_,E.ctx.fillStyle=r,E.ctx.lineWidth=i,E.ctx.fillAndStrokeText?E.ctx.fillAndStrokeText(t,0,0):(E.ctx.strokeText(t,0,0),E.ctx.fillText(t,0,0))):(E.ctx.fillStyle=r,E.ctx.fillText(t,0,0)),this.showDbgInfo&&(E.ctx.strokeStyle="#ff0000",E.ctx.strokeRect(0,0,l,u),E.ctx.strokeStyle="#00ff00",E.ctx.strokeRect(0,0,a.width,a.height)),E.ctx.restore(),a.bmpWidth=E.canvas.width,a.bmpHeight=E.canvas.height,E.canvas},A(0,e,"canvasWidth",function(){return E.canvas.width},function(t){E.canvas.width!=t&&(2048<(E.canvas.width=t)&&console.warn("画文字设置的宽度太大，超过2048了"),E.ctx.setTransform(1,0,0,1,0,0),E.ctx.scale(this.lastScaleX,this.lastScaleY))}),E.canvas=null,E.ctx=null,E}(),Kt=function(t){function e(){e.__super.call(this)}return f(e,"laya.webgl.BufferState2D",nt),e}(),qt=function(t){function e(){this.lastFont="",e.__super.call(this)}f(e,"laya.webgl.resource.CharRender_Native",rt);var i=e.prototype;return i.getWidth=function(t,e){return d.conchTextCanvas?(this.lastFont!=t&&(d.conchTextCanvas.font=t,this.lastFont=t),d.conchTextCanvas.measureText(e).width):0},i.scale=function(t,e){},i.getCharBmp=function(t,e,i,r,_,a,n,s,o,h,l){if(!d.conchTextCanvas)return null;this.lastFont!=e&&(d.conchTextCanvas.font=e,this.lastFont=e);a.width=d.conchTextCanvas.measureText(t).width,a.height;var u=U.create(_).numColor,c=U.create(r).numColor,f=d.conchTextCanvas.getTextBitmapData(t,c,2<i?2:i,u);return a.bmpWidth=f.width,a.bmpHeight=f.height,f},e}(),Jt=function(t){function a(){this._matrix=new S,this._matrix4=Et.defaultMatrix4.concat(),a.__super.call(this,1e4),this.shaderValue=new Y(0,0)}f(a,"laya.webgl.submit.SubmitCanvas",At);var e=a.prototype;return e.renderSubmit=function(){var t=bt.worldAlpha,e=bt.worldMatrix4,i=bt.worldMatrix,r=bt.worldFilters,_=bt.worldShaderDefines,a=this.shaderValue,n=this._matrix,s=this._matrix4,o=S.TEMP;return S.mul(n,i,o),s[0]=o.a,s[1]=o.b,s[4]=o.c,s[5]=o.d,s[12]=o.tx,s[13]=o.ty,bt.worldMatrix=o.clone(),bt.worldMatrix4=s,bt.worldAlpha=bt.worldAlpha*a.alpha,a.filters&&a.filters.length&&(bt.worldFilters=a.filters,bt.worldShaderDefines=a.defines),this.canv.flushsubmit(),bt.worldAlpha=t,bt.worldMatrix4=e,bt.worldMatrix.destroy(),bt.worldMatrix=i,bt.worldFilters=r,bt.worldShaderDefines=_,1},e.releaseRender=function(){if(--this._ref<1){var t=a.POOL;this._mesh=null,t[t._length++]=this}},e.clone=function(t,e,i){return null},e.getRenderType=function(){return 10003},a.create=function(t,e,i){var r=a.POOL._length?a.POOL[--a.POOL._length]:new a;r.canv=t,r._ref=1,r._numEle=0;var _=r.shaderValue;return _.alpha=e,_.defines.setValue(0),i&&i.length&&_.setFilters(i),r},a.POOL=((a.POOL=[])._length=0,a.POOL),a}(),$t=(function(t){function i(t){i.__super.call(this,laya.webgl.utils.MeshParticle2D.const_stride,4*t*i.const_stride,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshParticle2D._fixattriInfo),this.createQuadIB(t),this._quadNum=t}f(i,"laya.webgl.utils.MeshParticle2D",K);var e=i.prototype;e.setMaxParticleNum=function(t){this._vb._resizeBuffer(4*t*i.const_stride,!1),this.createQuadIB(t)},e.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshParticle2D._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._vb.deleteBuffer()},i.getAMesh=function(t){if(laya.webgl.utils.MeshParticle2D._POOL.length){var e=laya.webgl.utils.MeshParticle2D._POOL.pop();return e.setMaxParticleNum(t),e}return new i(t)},i.const_stride=116,i._POOL=[],n(i,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5126,3,16,5126,3,28,5126,4,40,5126,4,56,5126,3,72,5126,2,84,5126,4,92,5126,1,108,5126,1,112]}])}(),function(t){function e(){this._maxsize=0,this._upload=!0,this._uploadSize=0,this._bufferSize=0,this._u8Array=null,e.__super.call(this)}f(e,"laya.webgl.utils.Buffer2D",Tt);var i=e.prototype;return i.setByteLength=function(t){this._byteLength!==t&&(t<=this._bufferSize||this._resizeBuffer(2*t+256,!0),this._byteLength=t)},i.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._bufferSize||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),I.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,j.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),j.instance.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),I.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,j.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),e||i){var r=this._buffer.slice(e,i);j.instance.bufferSubData(this._bufferType,t,r)}else j.instance.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_uploadForVAO=function(){return!!this._upload&&(this._upload=!1,this._bindForVAO(),this._bufferData(),!0)},i._bind_upload=function(){return!!this._upload&&(this._upload=!1,this.bind(),this._bufferData(),!0)},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this.bind(),this._bufferSubData(t,e,i),!0)},i._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(e&&this._buffer&&0<this._buffer.byteLength){var i=new ArrayBuffer(t),r=this._u8Array&&this._u8Array.buffer==this._buffer?this._u8Array:new Uint8Array(this._buffer);this._u8Array=new Uint8Array(i),this._u8Array.set(r,0),this._buffer=i}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this._bufferSize=this._buffer.byteLength,this},i.append=function(t){this._upload=!0;var e,i;e=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+e,!0),i=new Float32Array(this._buffer,this._byteLength)),i.set(t,0),this._byteLength+=e,this._checkArrayUse()},i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var i=new Uint16Array(this._buffer,this._byteLength,e),r=0;r<e;r++)i[r]=t[r];this._byteLength+=2*e,this._checkArrayUse()},i.appendEx=function(t,e){this._upload=!0;var i;i=t.byteLength,this._resizeBuffer(this._byteLength+i,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendEx2=function(t,e,i,r){void 0===r&&(r=1),this._upload=!0;var _,a;_=i*r,this._resizeBuffer(this._byteLength+_,!0),a=new e(this._buffer,this._byteLength);var n=0;for(n=0;n<i;n++)a[n]=t[n];this._byteLength+=_,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();return j.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(Tt._bindedVertexBuffer=null),34963==this._bufferType&&(Tt._bindedIndexBuffer=null),ee.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var r=this._bind_subUpload();return j.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(Tt._bindedVertexBuffer=null),34963==this._bufferType&&(Tt._bindedIndexBuffer=null),ee.activeShader=null,r},i._disposeResource=function(){this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},A(0,i,"bufferLength",function(){return this._buffer.byteLength}),A(0,i,"byteLength",null,function(t){this.setByteLength(t)}),e.__int__=function(t){},e.FLOAT32=4,e.SHORT=2,e}()),te=function(t){function n(t){void 0===t&&(t=1e4),n.__super.call(this,t)}f(n,"laya.webgl.submit.SubmitTexture",At);var e=n.prototype;return e.clone=function(t,e,i){var r=n._poolSize?n.POOL[--n._poolSize]:new n;return this._cloneInit(r,t,e,i),r},e.releaseRender=function(){--this._ref<1&&((n.POOL[n._poolSize++]=this).shaderValue.release(),this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},e.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t?t._getSource():null;if(!e)return 1}var i=mt.mainContext;this._mesh.useMesh(i);var r=At.preRender,_=At.preRender._key;return 0===this._key.blendShader&&this._key.submitType===_.submitType&&this._key.blendShader===_.blendShader&&ee.activeShader&&At.preRender.clipInfoID==this.clipInfoID&&r.shaderValue.defines._value===this.shaderValue.defines._value&&0==(this.shaderValue.defines._value&jt.NOOPTMASK)?ee.activeShader.uploadTexture2D(e):(Rt.activeBlendFunction!==this._blendFn&&(ot.setBlend(i,!0),this._blendFn(i),Rt.activeBlendFunction=this._blendFn),this.shaderValue.texture=e,this.shaderValue.upload()),i.drawElements(4,this._numEle,5123,this._startIdx),I.renderBatch++,I.trianglesFaces+=this._numEle/3,1},n.create=function(t,e,i){var r=n._poolSize?n.POOL[--n._poolSize]:new n(10016);r._mesh=e,r._key.clear(),r._key.submitType=2,r._ref=1,r._startIdx=e.indexNum*Et.BYTES_PIDX,r._numEle=0;var _=t._nBlendType;if(r._key.blendShader=_,r._blendFn=t._targets?Rt.targetFns[_]:Rt.fns[_],r.shaderValue=i,t._colorFiler){var a=t._colorFiler;i.defines.add(a.type),i.colorMat=a._mat,i.colorAlpha=a._alpha}return r},n._poolSize=0,n.POOL=[],n}(),ee=function(t){function e(){e.__super.call(this)}return f(e,"laya.webgl.shader.BaseShader",R),e.activeShader=null,e.bindShader=null,e}(),ie=function(t){function r(t,e,i){this.texture=null,this._source=null,this._used=null,this._startFindPos=0,this._texW=0,this._texH=0,this._gridNum=0,this.charMaps=[],this._score=0,this._scoreTick=0,this.__destroyed=!1,this._discardTm=0,this.genID=0,this.ArrCharRenderInfo=[],r.__super.call(this),this._texW=t,this._texH=e,this._gridNum=i,this.texture=new It(this),this.setGridNum(i),this.lock=!0}f(r,"laya.webgl.resource.CharPageTexture",R);var e=r.prototype;return e.findAGrid=function(){for(var t=this._startFindPos;t<this._gridNum;t++)if(0==this._used[t]){this._startFindPos=t+1,this._used[t]=1;var e=this.ArrCharRenderInfo[t]=new ht;return e.tex=this,e.pos=t,e}return null},e.removeGrid=function(t){this.ArrCharRenderInfo[t]&&(this.ArrCharRenderInfo[t].deleted=!0),this._used[t]=0,t<this._startFindPos&&(this._startFindPos=t)},e.removeOld=function(r){for(var _=0,t=null,e=0,i=this.charMaps.length;e<i;e++)if(t=this.charMaps[e]){var a=this;t.forEach(function(t,e,i){t&&t.touchTick<r&&(console.log("remove char "+e),a.removeGrid(t.pos),i.delete(e),_++)})}return _},e.reset=function(){this._discardTm=D.stage.getFrameTm(),this._startFindPos=0,this.charMaps=[],this._score=0,this._scoreTick=0,this.__destroyed=!0,this.ArrCharRenderInfo.forEach(function(t){t.deleted=!0})},e.setGridNum=function(t){if(this._gridNum=t,this._used&&this._used.length==this._gridNum)if(this._used.fill)this._used.fill(0);else for(var e=0;e<this._used.length;e++)this._used[e]=0;else this._used=new Uint8Array(t)},e.recreateResource=function(){if(!this._source){var t=x.isConchApp?j.instance.getDefaultCommandEncoder():mt.mainContext,e=this._source=t.createTexture();this.texture.bitmap._glTexture=this._source,ot.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._texW,this._texH,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)}},e.addChar=function(t,e,i){if(wt.isWan1Wan)this.addCharCanvas(t,e,i);else{!this._source&&this.recreateResource();var r=x.isConchApp?j.instance.getDefaultCommandEncoder():mt.mainContext;ot.bindTexture(r,3553,this._source),!x.isConchApp&&r.pixelStorei(37441,!0);var _=t.data;t.data instanceof Uint8ClampedArray&&(_=new Uint8Array(_.buffer)),r.texSubImage2D(3553,0,e,i,t.width,t.height,6408,5121,_),!x.isConchApp&&r.pixelStorei(37441,!1)}},e.addCharCanvas=function(t,e,i){!this._source&&this.recreateResource();var r=x.isConchApp?j.instance.getDefaultCommandEncoder():mt.mainContext;ot.bindTexture(r,3553,this._source),!x.isConchApp&&r.pixelStorei(37441,!0),r.texSubImage2D(3553,0,e,i,6408,5121,t),!x.isConchApp&&r.pixelStorei(37441,!1)},e.destroy=function(){console.log("destroy CharPageTexture"),this.__destroyed=!0;var t=x.isConchApp?j.instance.getDefaultCommandEncoder():mt.mainContext;this._source&&t.deleteTexture(this._source),this._source=null,this.ArrCharRenderInfo.forEach(function(t){t.deleted=!0})},e.touchRect=function(t,e){this._scoreTick!=e&&(this._score=0,this._scoreTick=e),this._score++},e.printDebugInfo=function(r){void 0===r&&(r=!1),console.log("。得分:",this._score,", 算分时间:",this._scoreTick,",格子数:",this._gridNum);for(var _=Math.sqrt(this._gridNum),t=0,e=this.charMaps.length;t<e;t++){var i=this.charMaps[t];if(i){var a="";r&&console.log("   与基本大小差"+t+"的map信息:"),i.forEach(function(t,e,i){t&&(r?console.log("      key:",e," 位置:",t.pos/_|0,t.pos%_|0," 宽高:",t.bmpWidth,t.bmpHeight," 是否删除:",t.deleted," touch时间:",t.touchTick):a+=e)}),r||console.log("data[",t,"]:",a)}}},r}(),re=function(t){function c(){this._customRenderCmd=null,this._customCmds=null,this._x=0,this._y=0,this._renderType=0,this._bRepaintCanvas=!1,this._lastContext=null,c.__super.call(this)}f(c,"laya.layagl.ConchSpriteAdpt",i);var e=c.prototype;return e.createData=function(){this._conchData=new ParamData(308,!1),this._datai32=this._conchData._int32Data,this._dataf32=this._conchData._float32Data,this._dataf32[4]=1,this._datai32[3]=-1,this._datai32[1]=0,this._datai32[2]=0,this._datai32[22]=4294967295,this._datai32[5]=1,this._dataf32[8]=0,this._dataf32[9]=0,this._dataf32[10]=1,this._dataf32[11]=1,this._dataf32[16]=1,this._dataf32[17]=0,this._dataf32[18]=0,this._dataf32[19]=1,this._dataf32[20]=0,this._dataf32[21]=0,this._datai32[24]=-1,this._datai32[25]=-1,this._datai32[27]=-1,this._datai32[28]=0,this._datai32[29]=0,this._datai32[30]=1e6,this._datai32[31]=1e6,this._datai32[63]=0,this._datai32[71]=1,this._datai32[72]=771,this._datai32[68]=-1,this._renderType|=2,this._setRenderType(this._renderType)},e._createTransform=function(){return Bt.create(new Float32Array(6))},e._setTransform=function(t){var e=this._conchData._float32Data;e[15]=0,e[16]=t.a,e[17]=t.b,e[18]=t.c,e[19]=t.d,e[20]=t.tx,e[21]=t.ty},e._setTranformChange=function(){this._tfChanged=!0,this.parentRepaint(2)},e._setGraphics=function(t){this._datai32[23]=t._commandEncoder.getPtrID()},e._setGraphicsCallBack=function(){this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(5,this.updateParticleFromNative.bind(this)),this._datai32[68]=5},e._setCacheAs=function(t){lt.createCommandEncoder(),this._drawCanvasParamData||(this._drawCanvasParamData=new ParamData(132,!0)),this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._canvasBeginCmd||(this._canvasBeginCmd=j.instance.createCommandEncoder(128,64,!1)),this._canvasEndCmd||(this._canvasEndCmd=j.instance.createCommandEncoder(128,64,!1)),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(1,this.canvasBeginRenderFromNative.bind(this)),this._callbackFuncObj.addCallbackFunc(2,this.canvasEndRenderFromNative.bind(this)),this._datai32[56]=1,this._datai32[57]=2,this._datai32[58]=this._canvasBeginCmd.getPtrID(),this._datai32[59]=this._canvasEndCmd.getPtrID(),this._datai32[60]=lt._DRAW_CANVAS_CMD_ENCODER_.getPtrID(),this._datai32[61]=this._drawCanvasParamData.getPtrID()},e._setX=function(t){this._x=this._dataf32[6]=t,this._dataf32[15]=1},e._setY=function(t){this._y=this._dataf32[7]=t,this._dataf32[15]=1},e._setWidth=function(t,e){t&&t.getIsReady()&&this._setTextureEx(t,!0)},e._setHeight=function(t,e){t&&t.getIsReady()&&this._setTextureEx(t,!0)},e._setPivotX=function(t){this._renderType|=2,this._dataf32[8]=t,this._dataf32[15]=1},e._getPivotX=function(){return this._dataf32[8]},e._setPivotY=function(t){this._renderType|=2,this._dataf32[9]=t,this._dataf32[15]=1},e._getPivotY=function(){return this._dataf32[9]},e._setAlpha=function(t){t=(t=1<(this.getStyle().alpha=t)?1:t)<0?0:t;var e=this._datai32[22];e=16777215&e|255*t<<24,this._datai32[22]=e,1!==t?this._renderType|=1:this._renderType&=-2,this._setRenderType(this._renderType),this.parentRepaint()},e._setRenderType=function(t){this._datai32[0]=t,Ft.GLS[t]||(Ft.createByRenderType(t),Ft.createByRenderTypeEnd(t))},e.parentRepaint=function(){},e._getAlpha=function(){return(this._datai32[22]>>>24)/255},e._setScaleX=function(t){this._style.scaleX=this._dataf32[10]=t,this._dataf32[15]=1},e._setScaleY=function(t){this._style.scaleY=this._dataf32[11]=t,this._dataf32[15]=1},e._setSkewX=function(t){this._style.skewX=this._dataf32[12]=t,this._dataf32[15]=1},e._setSkewY=function(t){this._style.skewY=this._dataf32[13]=t,this._dataf32[15]=1},e._setRotation=function(t){this._style.rotation=this._dataf32[14]=t,this._dataf32[15]=1},e._setBgStyleColor=function(t,e,i,r,_){var a=null,n=null;this._drawSimpleRectParamData||(this._drawSimpleRectParamData=new ParamData(104,!0)),a=this._drawSimpleRectParamData._float32Data,n=this._drawSimpleRectParamData._int32Data;var s=U.create(_).numColor;n[0]=1,n[1]=96;var o=2;a[o++]=t,a[o++]=e,a[o++]=0,a[o++]=0,n[o++]=s,a[o++]=4294967295,a[o++]=t+i,a[o++]=e,a[o++]=0,a[o++]=0,n[o++]=s,a[o++]=4294967295,a[o++]=t+i,a[o++]=e+r,a[o++]=0,a[o++]=0,n[o++]=s,a[o++]=4294967295,a[o++]=t,a[o++]=e+r,a[o++]=0,a[o++]=0,n[o++]=s,a[o++]=4294967295,this._datai32[74]=this._drawSimpleRectParamData.getPtrID(),j.syncBufferToRenderThread(this._drawSimpleRectParamData),this._datai32[73]=Nt._SIMPLE_RECT_CMDENCODER_.getPtrID()},e._setBorderStyleColor=function(t,e,i,r,_,a){var n=null,s=null;this._drawRectBorderParamData||(this._drawRectBorderParamData=new ParamData(236,!0)),n=this._drawRectBorderParamData._float32Data,s=this._drawRectBorderParamData._int32Data;var o=[],h=[],l=[];o.push(t),o.push(e),o.push(t+i),o.push(e),o.push(t+i),o.push(e+r),o.push(t),o.push(e+r),o.push(t),o.push(e-a/2),yt.createLine2(o,h,a,0,l,!1);var u=o.length;n=this._drawRectBorderParamData._float32Data,s=this._drawRectBorderParamData._int32Data;var c=this._drawRectBorderParamData._int16Data,f=U.create(_).numColor;s[0]=0,s[1]=120,s[2]=0,s[3]=2*h.length;for(var d=5,A=s[4]=0;A<u;A++)n[d++]=l[2*A],n[d++]=l[2*A+1],s[d++]=f;d=70;for(var E=0;E<h.length;E++)c[d++]=h[E];this._datai32[76]=this._drawRectBorderParamData.getPtrID(),j.syncBufferToRenderThread(this._drawRectBorderParamData),this._datai32[75]=Nt._RECT_BORDER_CMD_ENCODER_.getPtrID()},e._setTextureEx=function(t,e){var i=null,r=null;if(!this._drawSimpleImageData){this._drawSimpleImageData=new ParamData(116,!0),i=this._drawSimpleImageData._float32Data,(r=this._drawSimpleImageData._int32Data)[0]=3,r[1]=33984,r[2]=e?t.bitmap._glTexture.id:0,r[3]=1,r[4]=96;var _=t.uv;i[5]=0,i[6]=0,i[7]=_[0],i[8]=_[1],r[9]=4294967295,r[10]=4294967295,i[11]=0,i[12]=0,i[13]=_[2],i[14]=_[3],r[15]=4294967295,r[16]=4294967295,i[17]=0,i[18]=0,i[19]=_[4],i[20]=_[5],r[21]=4294967295,r[22]=4294967295,i[23]=0,i[24]=0,i[25]=_[6],i[26]=_[7],r[27]=4294967295,r[28]=4294967295}i=this._drawSimpleImageData._float32Data,(r=this._drawSimpleImageData._int32Data)[2]=e?t.bitmap._glTexture.id:0;var a=e?t.width:0,n=e?t.height:0,s=this._width,o=this._height;a=0<s?s:a,n=0<o?o:n,i[11]=i[17]=a,i[18]=i[24]=n;var h=this._drawSimpleImageData.getPtrID();this._datai32[25]=h,j.syncBufferToRenderThread(this._drawSimpleImageData),this._datai32[24]=Nt._SIMPLE_TEXTURE_CMDENCODER_.getPtrID()},e._setTexture=function(t){t&&(t.getIsReady()?this._setTextureEx(t,!0):(this._setTextureEx(t,!1),t.on("ready",this,this._setTextureEx,[t,!0])))},e._setCustomRender=function(){this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._customCmds=[],this._callbackFuncObj.addCallbackFunc(0,this.customRenderFromNative.bind(this)),this._customRenderCmd=j.instance.createCommandEncoder(128,64,!0),this._datai32[54]=this._callbackFuncObj.id,this._datai32[55]=0,this._datai32[27]=this._customRenderCmd.getPtrID()},e._setScrollRect=function(t){this._dataf32[28]=0,this._dataf32[29]=0,this._dataf32[30]=t.width,this._dataf32[31]=t.height,this._dataf32[32]=-t.x,this._dataf32[33]=-t.y,t.onPropertyChanged=this._setScrollRect.bind(this)},e._setColorFilter=function(t){this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._filterBeginCmd||(this._filterBeginCmd=j.instance.createCommandEncoder(128,64,!1)),this._filterEndCmd||(this._filterEndCmd=j.instance.createCommandEncoder(128,64,!0)),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(3,this.filterBeginRenderFromNative.bind(this)),this._callbackFuncObj.addCallbackFunc(4,this.filterEndRenderFromNative.bind(this)),this._datai32[65]=3,this._datai32[64]=this._filterBeginCmd.getPtrID(),this._datai32[67]=4,this._datai32[66]=this._filterEndCmd.getPtrID()},e._setMask=function(t){t.cacheAs="bitmap",this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._maskCmd||(this._maskCmd=j.instance.createCommandEncoder(128,64,!1)),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(6,this.maskRenderFromNative.bind(this)),this._datai32[69]=6,this._datai32[70]=this._maskCmd.getPtrID()},e._adjustTransform=function(){var t=this._transform||(this._transform=this._createTransform());t._bTransform=!0,j.instance.calcMatrixFromScaleSkewRotation(this._conchData._data._ptrID,60,64,24,28,32,36,40,44,48,52,56);var e=this._conchData._float32Data;return t.a=e[16],t.b=e[17],t.c=e[18],t.d=e[19],t.tx=0,t.ty=0,t},e._setBlendMode=function(t){switch(t){case"normal":this._datai32[71]=1,this._datai32[72]=771;break;case"add":case"lighter":this._datai32[71]=1,this._datai32[72]=772;break;case"multiply":this._datai32[71]=774,this._datai32[72]=771;break;case"screen":this._datai32[71]=1,this._datai32[72]=1;break;case"overlay":this._datai32[71]=1,this._datai32[72]=769;break;case"light":this._datai32[71]=1,this._datai32[72]=1;break;case"mask":this._datai32[71]=0,this._datai32[72]=770;break;case"destination-out":this._datai32[71]=0,this._datai32[72]=0;break;default:alert("_setBlendMode Unknown type")}},e.customRenderFromNative=function(){var t=j.instance.getCurrentContext();this._customRenderCmd.beginEncoding(),this._customRenderCmd.clearEncoding(),t._commandEncoder=this._customRenderCmd,t._customCmds=this._customCmds;for(var e=0,i=this._customCmds.length;e<i;e++)this._customCmds[e].recover();this._customCmds.length=0,this.customRender(t,0,0),this._customRenderCmd.endEncoding()},e.canvasBeginRenderFromNative=function(){var t=j.instance,e=null,i=null,r=this._cacheStyle;if(r.canvas&&0==this._datai32[4])e=r.canvas,0!=this._bRepaintCanvas&&(this.setChildrenNativeVisible(!1),this._bRepaintCanvas=!1),this._datai32[63]=1;else{if(this._canvasBeginCmd.beginEncoding(),this._canvasBeginCmd.clearEncoding(),e=laya.layagl.ConchSpriteAdpt.buildCanvas(this,0,0)){this._datai32[63]=0,this._lastContext=t.getCurrentContext();var _=(i=e.context)._targets;lt.setParamData(this._drawCanvasParamData,_,-16,-16,_.width,_.height),t.setCurrentContext(i),i.beginRT(),t.save(),c._tempFloatArrayMatrix[0]=1,c._tempFloatArrayMatrix[1]=0,c._tempFloatArrayMatrix[2]=0,c._tempFloatArrayMatrix[3]=1,c._tempFloatArrayMatrix[4]=16,c._tempFloatArrayMatrix[5]=16,t.setGlobalValue(Nt.GLOBALVALUE_MATRIX32,8,c._tempFloatArrayMatrix),1!=this._bRepaintCanvas&&(this.setChildrenNativeVisible(!0),this._bRepaintCanvas=!0)}this._canvasBeginCmd.endEncoding()}},e.setChildrenNativeVisible=function(t){for(var e,i=this._children,r=i.length,_=0;_<r;++_)(e=i[_])._datai32[5]=t?1:0,e.setChildrenNativeVisible(t)},e.canvasEndRenderFromNative=function(){var t=j.instance;if(this._canvasEndCmd.beginEncoding(),this._canvasEndCmd.clearEncoding(),this._bRepaintCanvas){var e=j.instance.getCurrentContext();t.restore(),t.setCurrentContext(this._lastContext),t.commitContextToGPU(e),e.endRT(),t.blendFunc(1,771)}this._canvasEndCmd.endEncoding()},e.filterBeginRenderFromNative=function(){var t=this,e=j.instance;this._filterBeginCmd.beginEncoding(),this._filterBeginCmd.clearEncoding();var i=this._getCacheStyle().filters;i.length;if(i[0]instanceof laya.filters.ColorFilter){e.addShaderMacro(Nt.SHADER_MACRO_COLOR_FILTER);var r=i[0];e.setGlobalValue(Nt.GLOBALVALUE_COLORFILTER_COLOR,8,r._mat),e.setGlobalValue(Nt.GLOBALVALUE_COLORFILTER_ALPHA,8,r._alpha)}else{var _=g.TEMP,a=S.create(),n=0,s=0;t._isHaveGlowFilter()&&(n=50,s=25);var o=new M;o.copyFrom(t.getSelfBounds()),o.x+=t.x,o.y+=t.y,o.x-=t.pivotX+4,o.y-=t.pivotY+4;var h=o.x,l=o.y;if(o.width+=n+8,o.height+=n+8,_.x=o.x*a.a+o.y*a.c,_.y=o.y*a.d+o.x*a.b,o.x=_.x,o.y=_.y,_.x=o.width*a.a+o.height*a.c,_.y=o.height*a.d+o.width*a.b,o.width=_.x,o.height=_.y,o.width<=0||o.height<=0)return;var u=t._getCacheStyle().filterCache;u&&St.releaseRT(u),u=St.getRT(o.width,o.height),t._getCacheStyle().filterCache=u,c.useRenderTarget(u),c._tempFloatArrayMatrix[0]=1,c._tempFloatArrayMatrix[1]=0,c._tempFloatArrayMatrix[2]=0,c._tempFloatArrayMatrix[3]=1,c._tempFloatArrayMatrix[4]=t.x-h+s,c._tempFloatArrayMatrix[5]=t.y-l+s,e.setGlobalValue(Nt.GLOBALVALUE_MATRIX32,8,c._tempFloatArrayMatrix)}this._filterBeginCmd.endEncoding()},e.filterEndRenderFromNative=function(){this._filterEndCmd.beginEncoding(),this._filterEndCmd.clearEncoding();var t=j.instance,e=this._getCacheStyle().filters;if(e[0]instanceof laya.filters.ColorFilter);else{t.restore();var i=j.instance.getCurrentContext(),r=le.currentActive;if(le.popRT(),e[0]instanceof D.BlurFilter){t.addShaderMacro(Nt.SHADER_MACRO_BLUR_FILTER);var _=e[0];c._tempFloatArrayBuffer2[0]=r.width,c._tempFloatArrayBuffer2[1]=r.height,t.setGlobalValue(Nt.GLOBALVALUE_BLURFILTER_BLURINFO,8,c._tempFloatArrayBuffer2),t.setGlobalValue(Nt.GLOBALVALUE_BLURFILTER_STRENGTH,8,_.getStrenth_sig2_2sig2_native()),i.drawTarget(this._filterEndCmd,r,-4,-4,0,0)}else if(e[0]instanceof D.GlowFilter){var a=r.width,n=r.height,s=St.getRT(a,n);c.useRenderTarget(s),t.addShaderMacro(Nt.SHADER_MACRO_GLOW_FILTER);var o=e[0],h=o.getBlurInfo2Native();h[0]=a,h[1]=n,t.setGlobalValue(Nt.GLOBALVALUE_GLOWFILTER_COLOR,8,o.getColorNative()),t.setGlobalValue(Nt.GLOBALVALUE_GLOWFILTER_BLURINFO1,8,o.getBlurInfo1Native()),t.setGlobalValue(Nt.GLOBALVALUE_GLOWFILTER_BLURINFO2,8,h),i.drawTarget(this._filterEndCmd,r,-16,-16,0,0),t.restore(),le.popRT(),i.drawTarget(this._filterEndCmd,s,-29,-29,0,0),i.drawTarget(this._filterEndCmd,r,-29,-29,0,0)}}this._filterEndCmd.endEncoding(),j.syncBufferToRenderThread(this._filterEndCmd)},e.maskRenderFromNative=function(){this._maskCmd.beginEncoding(),this._maskCmd.clearEncoding();var t=j.instance,e=t.getCurrentContext(),i=this.mask;i&&(0<i._children.length?(t.blockStart(i._conchData),i._renderChilds(e),t.blockEnd(i._conchData)):t.block(i._conchData)),c._tempInt1[0]=772,t.setGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_SRC,8,c._tempInt1),c._tempInt1[0]=0,t.setGlobalValue(Nt.GLOBALVALUE_BLENDFUNC_DEST,8,c._tempInt1),this._maskCmd.endEncoding()},e.updateParticleFromNative=function(){this.tempCmd.updateParticle()},c.createMatrix=function(t,e,i,r,_,a,n){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===_&&(_=0),void 0===a&&(a=0),new Bt(t,e,i,r,_,a,n)},c.init=function(){ct.__init__(),$.__init__();var t,e,i=B.prototype,r=c.prototype,_=["_createTransform","_setTransform","_setGraphics","_setGraphicsCallBack","_setCacheAs","_setX","_setY","_setPivotX","_getPivotX","_setPivotY","_getPivotY","_setAlpha","_getAlpha","_setScaleX","_setScaleY","_setSkewX","_setSkewY","_setRotation","_adjustTransform","_setRenderType","_setTexture","_setTextureEx","_setCustomRender","_setScrollRect","_setColorFilter","customRenderFromNative","canvasBeginRenderFromNative","canvasEndRenderFromNative","setChildrenNativeVisible","filterBeginRenderFromNative","filterEndRenderFromNative","updateParticleFromNative","_setMask","maskRenderFromNative","_setBlendMode","_setBgStyleColor","_setBorderStyleColor","_setWidth","_setHeight","_setTranformChange"],a=0;for(t=_.length,a=0;a<t;a++)i[e=_[a]]=r[e];i.createGLBuffer=r.createData,S._createFun=c.createMatrix;i.render=i.renderToNative=oe.prototype.renderToNative,i.repaint=i.repaintForNative=oe.prototype.repaintForNative,i.parentRepaint=i.parentRepaintForNative=oe.prototype.parentRepaintForNative,i._renderChilds=oe.prototype._renderChilds,i.writeBlockToNative=oe.prototype.writeBlockToNative,i._writeBlockChilds=oe.prototype._writeBlockChilds},c.useRenderTarget=function(t){var e=j.instance;le.pushRT(),t.start(),e.clearColor(0,0,0,0),e.clear(17664),e.save(),c._tempFloatArrayBuffer2[0]=t.width,c._tempFloatArrayBuffer2[1]=t.height,e.setGlobalValue(Nt.GLOBALVALUE_VIEWS,8,c._tempFloatArrayBuffer2)},c.buildCanvas=function(t,e,i){var r,_,a,n,s,o,h,l=t._cacheStyle,u=l.canvas,c=l.cacheAs;return s=(h=l._calculateCacheRect(t,c,e,i)).x,o=h.y,a=(_=l.cacheRect).width*s,n=_.height*o,_.x,_.y,"bitmap"===c&&(2048<a||2048<n)?(alert("cache bitmap size larger than 2048,cache ignored"),l.releaseContext(),null):(u||(l.createContext(),u=l.canvas),r=u.context,u.context.sprite=t,u.width==a&&u.height==n||(u.size(a,n),r._targets&&(r._targets.destroy(),r._targets=null)),"bitmap"===c?u.context.asBitmap=!0:"normal"===c&&(u.context.asBitmap=!1),"normal"===c&&(r.touches=[]),u)},n(c,["_tempFloatArrayBuffer2",function(){return this._tempFloatArrayBuffer2=new Float32Array(2)},"_tempFloatArrayMatrix",function(){return this._tempFloatArrayMatrix=new Float32Array(6)},"_tempInt1",function(){return this._tempInt1=new Int32Array(1)}]),c}(),_e=function(t){function r(t,e){this._source=null,this._texW=0,this._texH=0,this.__destroyed=!1,this._discardTm=0,this.genID=0,this.bitmap={id:0,_glTexture:null},this.curUsedCovRate=0,this.curUsedCovRateAtlas=0,this.lastTouchTm=0,this.ri=null,r.__super.call(this),this._texW=t||J.atlasWidth,this._texH=e||J.atlasWidth,this.bitmap.id=this.id,this.lock=!0}f(r,"laya.webgl.text.TextTexture",R);var e=r.prototype;return e.recreateResource=function(){if(!this._source){var t=x.isConchApp?j.instance.getDefaultCommandEncoder():mt.mainContext,e=this._source=t.createTexture();this.bitmap._glTexture=e,ot.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._texW,this._texH,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),J.debugUV&&this.fillWhite()}},e.addChar=function(t,e,i,r){if(J.isWan1Wan)return this.addCharCanvas(t,e,i,r);!this._source&&this.recreateResource();var _=x.isConchApp?j.instance.getDefaultCommandEncoder():mt.mainContext;ot.bindTexture(_,3553,this._source),!x.isConchApp&&_.pixelStorei(37441,!0);var a=t.data;t.data instanceof Uint8ClampedArray&&(a=new Uint8Array(a.buffer)),_.texSubImage2D(3553,0,e,i,t.width,t.height,6408,5121,a),!x.isConchApp&&_.pixelStorei(37441,!1);var n=NaN,s=NaN,o=NaN,h=NaN;return h=x.isConchApp?(n=e/this._texW,s=i/this._texH,o=(e+t.width)/this._texW,(i+t.height)/this._texH):(n=(e+1)/this._texW,s=(i+1)/this._texH,o=(e+t.width-1)/this._texW,(i+t.height-1)/this._texH),(r=r||new Array(8))[0]=n,r[1]=s,r[2]=o,r[3]=s,r[4]=o,r[5]=h,r[6]=n,r[7]=h,r},e.addCharCanvas=function(t,e,i,r){!this._source&&this.recreateResource();var _=x.isConchApp?j.instance.getDefaultCommandEncoder():mt.mainContext;ot.bindTexture(_,3553,this._source),!x.isConchApp&&_.pixelStorei(37441,!0),_.texSubImage2D(3553,0,e,i,6408,5121,t),!x.isConchApp&&_.pixelStorei(37441,!1);var a=NaN,n=NaN,s=NaN,o=NaN;return o=x.isConchApp?(a=e/this._texW,n=i/this._texH,s=(e+t.width)/this._texW,(i+t.height)/this._texH):(a=(e+1)/this._texW,n=(i+1)/this._texH,s=(e+t.width-1)/this._texW,(i+t.height-1)/this._texH),(r=r||new Array(8))[0]=a,r[1]=n,r[2]=s,r[3]=n,r[4]=s,r[5]=o,r[6]=a,r[7]=o,r},e.fillWhite=function(){!this._source&&this.recreateResource();var t=x.isConchApp?j.instance.getDefaultCommandEncoder():mt.mainContext,e=new Uint8Array(this._texW*this._texH*4);e.fill(255),t.texSubImage2D(3553,0,0,0,this._texW,this._texH,6408,5121,e)},e.discard=function(){this._texW==J.atlasWidth&&this._texH==J.atlasWidth?(this.genID++,r.poolLen>=r.pool.length&&(r.pool=r.pool.concat(new Array(10))),this._discardTm=D.stage.getFrameTm(),r.pool[r.poolLen++]=this):this.destroy()},e.destroy=function(){console.log("destroy TextTexture"),this.__destroyed=!0;var t=x.isConchApp?j.instance.getDefaultCommandEncoder():mt.mainContext;this._source&&t.deleteTexture(this._source),this._source=null},e.touchRect=function(t,e){this.lastTouchTm!=e&&(this.curUsedCovRate=0,this.curUsedCovRateAtlas=0,this.lastTouchTm=e);var i=J.atlasWidth*J.atlasWidth,r=Ut.atlasGridW*Ut.atlasGridW;this.curUsedCovRate+=t.bmpWidth*t.bmpHeight/i,this.curUsedCovRateAtlas+=Math.ceil(t.bmpWidth/Ut.atlasGridW)*Math.ceil(t.bmpHeight/Ut.atlasGridW)/(i/r)},e._getSource=function(){return this._source},e.drawOnScreen=function(t,e){},A(0,e,"texture",function(){return this}),r.getTextTexture=function(t,e){if(t!=J.atlasWidth||t!=J.atlasWidth)return new r(t,e);if(0<r.poolLen){var i=r.pool[--r.poolLen];return 0<r.poolLen&&r.clean(),i}return new r(t,e)},r.clean=function(){var t=D.stage.getFrameTm();if(0===r.cleanTm&&(r.cleanTm=t),t-r.cleanTm>=J.checkCleanTextureDt){for(var e=0;e<r.poolLen;e++){var i=r.pool[e];t-i._discardTm>=J.destroyUnusedTextureDt&&(i.destroy(),r.pool[e]=r.pool[r.poolLen-1],r.poolLen--,e--)}r.cleanTm=t}},r.poolLen=0,r.cleanTm=0,n(r,["pool",function(){return this.pool=new Array(10)}]),r}(),ae=function(t){function e(t){this._uint16Array=null,void 0===t&&(t=35044),e.__super.call(this),this._bufferUsage=t,this._bufferType=34963,this._buffer=new ArrayBuffer(8)}f(e,"laya.webgl.utils.IndexBuffer2D",$t);var i=e.prototype;return i._checkArrayUse=function(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},i._bindForVAO=function(){j.instance.bindBuffer(34963,this._glBuffer)},i.bind=function(){return Tt._bindedIndexBuffer!==this._glBuffer&&(j.instance.bindBuffer(34963,this._glBuffer),Tt._bindedIndexBuffer=this._glBuffer,!0)},i.destory=function(){this._uint16Array=null,this._buffer=null},i.disposeResource=function(){this._disposeResource()},e.create=function(t){return void 0===t&&(t=35044),new e(t)},e}(),ne=function(t){function i(t,e){this._floatArray32=null,this._uint32Array=null,this._vertexStride=0,i.__super.call(this),this._vertexStride=t,this._bufferUsage=e,this._bufferType=34962,this._buffer=new ArrayBuffer(8),this._floatArray32=new Float32Array(this._buffer),this._uint32Array=new Uint32Array(this._buffer)}f(i,"laya.webgl.utils.VertexBuffer2D",$t);var e=i.prototype;return e.getFloat32Array=function(){return this._floatArray32},e.appendArray=function(t){var e=this._byteLength>>2;this.setByteLength(this._byteLength+4*t.length),this.getFloat32Array().set(t,e),this._upload=!0},e._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer)),this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))},e.deleteBuffer=function(){this._disposeResource()},e._bindForVAO=function(){j.instance.bindBuffer(34962,this._glBuffer)},e.bind=function(){return Tt._bindedVertexBuffer!==this._glBuffer&&(j.instance.bindBuffer(34962,this._glBuffer),Tt._bindedVertexBuffer=this._glBuffer,!0)},e.destroy=function(){laya.webgl.utils.Buffer.prototype.destroy.call(this),this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},A(0,e,"vertexStride",function(){return this._vertexStride}),i.create=function(t,e){return void 0===e&&(e=35048),new i(t,e)},i}(),se=function(t){function i(t,e){i.__super.call(this),this._wrapModeU=0,this._wrapModeV=0,this._filterMode=1,this._readyed=!1,this._width=-1,this._height=-1,this._format=t,this._mipmap=e,this._anisoLevel=1,this._glTexture=j.instance.createTexture()}f(i,"laya.webgl.resource.BaseTexture",r);var e=i.prototype;return e._isPot=function(t){return 0==(t&t-1)},e._getGLFormat=function(){var t=0;switch(this._format){case 0:t=6407;break;case 1:t=6408;break;case 2:t=6406;break;case 3:if(!ot._compressedTextureS3tc)throw"BaseTexture: not support DXT1 format.";t=ot._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case 4:if(!ot._compressedTextureS3tc)throw"BaseTexture: not support DXT5 format.";t=ot._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 5:if(!ot._compressedTextureEtc1)throw"BaseTexture: not support ETC1RGB format.";t=ot._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;break;case 9:if(!ot._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_2BPPV format.";t=ot._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 10:if(!ot._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";t=ot._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case 11:if(!ot._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_4BPPV format.";t=ot._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 12:if(!ot._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";t=ot._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:throw"BaseTexture: unknown texture format."}return t},e._setFilterMode=function(t){var e=j.instance;switch(ot.bindTexture(e,this._glTextureType,this._glTexture),t){case 0:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9984):e.texParameteri(this._glTextureType,10241,9728),e.texParameteri(this._glTextureType,10240,9728);break;case 1:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9985):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;case 2:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9987):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;default:throw new Error("BaseTexture:unknown filterMode value.")}},e._setWarpMode=function(t,e){var i=j.instance;if(ot.bindTexture(i,this._glTextureType,this._glTexture),this._isPot(this._width)&&this._isPot(this._height))switch(e){case 0:i.texParameteri(this._glTextureType,t,10497);break;case 1:i.texParameteri(this._glTextureType,t,33071)}else i.texParameteri(this._glTextureType,t,33071)},e._setAnisotropy=function(t){var e=ot._extTextureFilterAnisotropic;if(e&&!s.onLimixiu){t=Math.max(t,1);var i=j.instance;ot.bindTexture(i,this._glTextureType,this._glTexture),t=Math.min(i.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT),t),i.texParameterf(this._glTextureType,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}},e._disposeResource=function(){this._glTexture&&(j.instance.deleteTexture(this._glTexture),this._glTexture=null,this._setGPUMemory(0))},e._getSource=function(){return this._readyed?this._glTexture:null},A(0,e,"wrapModeU",function(){return this._wrapModeU},function(t){this._wrapModeU!==t&&(this._wrapModeU=t,-1!==this._width&&this._setWarpMode(10242,t))}),A(0,e,"mipmap",function(){return this._mipmap}),A(0,e,"format",function(){return this._format}),A(0,e,"wrapModeV",function(){return this._wrapModeV},function(t){this._wrapModeV!==t&&(this._wrapModeV=t,-1!==this._height&&this._setWarpMode(10243,t))}),A(0,e,"defaulteTexture",function(){throw"BaseTexture:must override it."}),A(0,e,"filterMode",function(){return this._filterMode},function(t){t!==this._filterMode&&(this._filterMode=t,-1!==this._width&&-1!==this._height&&this._setFilterMode(t))}),A(0,e,"anisoLevel",function(){return this._anisoLevel},function(t){t!==this._anisoLevel&&(this._anisoLevel=Math.max(1,Math.min(16,t)),-1!==this._width&&-1!==this._height&&this._setAnisotropy(t))}),i.WARPMODE_REPEAT=0,i.WARPMODE_CLAMP=1,i.FILTERMODE_POINT=0,i.FILTERMODE_BILINEAR=1,i.FILTERMODE_TRILINEAR=2,i.FORMAT_R8G8B8=0,i.FORMAT_R8G8B8A8=1,i.FORMAT_ALPHA8=2,i.FORMAT_DXT1=3,i.FORMAT_DXT5=4,i.FORMAT_ETC1RGB=5,i.FORMAT_PVRTCRGB_2BPPV=9,i.FORMAT_PVRTCRGBA_2BPPV=10,i.FORMAT_PVRTCRGB_4BPPV=11,i.FORMAT_PVRTCRGBA_4BPPV=12,i.FORMAT_DEPTH_16=0,i.FORMAT_STENCIL_8=1,i.FORMAT_DEPTHSTENCIL_16_8=2,i.FORMAT_DEPTHSTENCIL_NONE=3,i}(),oe=function(t){function e(){e.__super.call(this)}f(e,"laya.layagl.ConchSprite",B);var i=e.prototype;return i.parentRepaintForNative=function(t){void 0===t&&(t=2);var e=this._parent;e&&(e._conchData._int32Data[4]&t)!=t&&(e._conchData._int32Data[4]|=t,e.parentRepaintForNative(t))},i.renderToNative=function(t,e,i){var r=t.gl,_=j.getFrameCount()-1,a=this._conchData._int32Data,n=a[4];0<this._children.length?_!=a[3]||0<n&&1==(1&n)?(r.blockStart(this._conchData),this._renderChilds(t),r.blockEnd(this._conchData)):r.copyCmdBuffer(this._conchData._int32Data[1],this._conchData._int32Data[2]):r.block(this._conchData)},i.writeBlockToNative=function(){var t=j.instance;0<this._children.length?(t.blockStart(this._conchData),this._writeBlockChilds(),t.blockEnd(this._conchData)):t.block(this._conchData)},i._renderChilds=function(t){var e,i=this._children,r=0,_=i.length,a=this._style;if(a.viewport)for(var n=a.viewport,s=n.x,o=n.y,h=n.right,l=n.bottom,u=NaN,c=NaN;r<_;++r)(e=i[r])._visible&&(u=e._x)<h&&u+e.width>s&&(c=e._y)<l&&c+e.height>o&&e.renderToNative(t);else for(;r<_;++r)(e=i[r])._visible&&e.renderToNative(t)},i._writeBlockChilds=function(){var t,e=this._children,i=0,r=e.length,_=this._style;if(_.viewport)for(var a=_.viewport,n=a.x,s=a.y,o=a.right,h=a.bottom,l=NaN,u=NaN;i<r;++i)(t=e[i])._visible&&(l=t._x)<o&&l+t.width>n&&(u=t._y)<h&&u+t.height>s&&t.writeBlockToNative();else for(;i<r;++i)(t=e[i])._visible&&t.writeBlockToNative()},i.repaintForNative=function(t){void 0===t&&(t=2),(this._conchData._int32Data[4]&t)!=t&&(this._conchData._int32Data[4]|=t,this.parentRepaintForNative(t))},e}(),he=function(t){function o(t,e,i,r,_){if(this._attribInfo=null,this.customCompile=!1,this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},o.__super.call(this),!t||!e)throw"Shader Error";this._attribInfo=_,x.isConchApp&&(this.customCompile=!0),this._id=++o._count,this._vs=t,this._ps=e,this._nameMap=r||{},null!=i&&(o.sharders[i]=this),this.recreateResource(),this.lock=!0}f(o,"laya.webgl.shader.Shader",ee);var e=o.prototype;return e.recreateResource=function(){this._compile(),this._setGPUMemory(0)},e._disposeResource=function(){mt.mainContext.deleteShader(this._vshader),mt.mainContext.deleteShader(this._pshader),mt.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this._setGPUMemory(0),this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){var t;this._reCompile=!0,this._params=[],this.customCompile&&(t=st.preGetParams(this._vs,this._ps));var e=mt.mainContext;this._program=e.createProgram(),this._vshader=o._createShader(e,this._vs,35633),this._pshader=o._createShader(e,this._ps,35632),e.attachShader(this._program,this._vshader),e.attachShader(this._program,this._pshader);var i,r,_=0,a=this._attribInfo?this._attribInfo.length:0;for(_=0;_<a;_+=2)e.bindAttribLocation(this._program,this._attribInfo[_+1],this._attribInfo[_]);if(e.linkProgram(this._program),!this.customCompile&&!e.getProgramParameter(this._program,35714))throw e.getProgramInfoLog(this._program);var n=this.customCompile?t.uniforms.length:e.getProgramParameter(this._program,35718);for(_=0;_<n;_++){var s=this.customCompile?t.uniforms[_]:e.getActiveUniform(this._program,_);0<(i={vartype:"uniform",glfun:null,ivartype:1,location:e.getUniformLocation(this._program,s.name),name:s.name,type:s.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(i.name=i.name.substr(0,i.name.length-3),i.isArray=!0,i.location=e.getUniformLocation(this._program,i.name)),this._params.push(i)}for(_=0,r=this._params.length;_<r;_++)switch((i=this._params[_]).indexOfParams=_,i.index=1,i.value=[i.location,null],i.codename=i.name,i.name=this._nameMap[i.codename]?this._nameMap[i.codename]:i.codename,(this._paramsMap[i.name]=i)._this=this,i.uploadedValue=[],i.type){case 5124:i.fun=i.isArray?this._uniform1iv:this._uniform1i;break;case 5126:i.fun=i.isArray?this._uniform1fv:this._uniform1f;break;case 35664:i.fun=i.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:i.fun=i.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:i.fun=i.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:i.fun=this._uniform_sampler2D;break;case 35680:i.fun=this._uniform_samplerCube;break;case 35676:i.glfun=e.uniformMatrix4fv,i.fun=this._uniformMatrix4fv;break;case 35670:i.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}}},e.getUniform=function(t){return this._paramsMap[t]},e._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(mt.mainContext.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(mt.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return mt.mainContext.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(mt.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(mt.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return mt.mainContext.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(mt.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return mt.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(mt.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return mt.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return mt.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return mt.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return mt.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(mt.mainContext.uniform1i(t.location,i[0]=e),1):0},e._uniform1iv=function(t,e){return mt.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(mt.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return mt.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(mt.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return mt.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(mt.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return mt.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var i=mt.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),ot.activeTexture(i,33984+this._curActTexIndex),ot.bindTexture(i,3553,e),this._curActTexIndex++,1):(ot.activeTexture(i,33984+r[0]),ot.bindTexture(i,3553,e),0)},e._uniform_samplerCube=function(t,e){var i=mt.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),ot.activeTexture(i,33984+this._curActTexIndex),ot.bindTexture(i,34067,e),this._curActTexIndex++,1):(ot.activeTexture(i,33984+r[0]),ot.bindTexture(i,34067,e),0)},e._noSetValue=function(t){console.log("no....:"+t.name)},e.uploadOne=function(t,e){ot.useProgram(mt.mainContext,this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},e.uploadTexture2D=function(t){var e=ot;e._activeTextures[0]!==t&&(e.bindTexture(mt.mainContext,e.TEXTURE_2D,t),e._activeTextures[0]=t)},e.upload=function(t,e){ee.activeShader=ee.bindShader=this;var i=mt.mainContext;ot.useProgram(i,this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;for(var r,_,a=e.length,n=0,s=0;s<a;s++)null!==(_=t[(r=e[s]).name])&&(n+=r.fun.call(this,r,_));I.shaderCall+=n},e.uploadArray=function(t,e,i){ee.activeShader=this,ee.bindShader=this,ot.useProgram(mt.mainContext,this._program);this._params;for(var r,_,a=0,n=e-2;0<=n;n-=2)(_=this._paramsMap[t[n]])&&null!=(r=t[n+1])&&(i&&i[_.name]&&i[_.name].bind(),a+=_.fun.call(this,_,r));I.shaderCall+=a},e.getParams=function(){return this._params},e.setAttributesLocation=function(t){this._attribInfo=t},o.getShader=function(t){return o.sharders[t]},o.create=function(t,e,i,r,_){return new o(t,e,i,r,_)},o.withCompile=function(t,e,i,r){if(i&&o.sharders[i])return o.sharders[i];var _=o._preCompileShader[2e-4*t];if(!_)throw new Error("withCompile shader err!"+t);return _.createShader(e,i,r,null)},o.withCompile2D=function(t,e,i,r,_,a){if(r&&o.sharders[r])return o.sharders[r];var n=o._preCompileShader[2e-4*t+e];if(!n)throw new Error("withCompile shader err!"+t+" "+e);return n.createShader(i,r,_,a)},o.addInclude=function(t,e){st.addInclude(t,e)},o.preCompile=function(t,e,i,r){o._preCompileShader[2e-4*t]=new st(e,i,r)},o.preCompile2D=function(t,e,i,r,_){o._preCompileShader[2e-4*t+e]=new st(i,r,_)},o._createShader=function(t,e,i){var r=t.createShader(i);return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,35713)?r:(console.log(t.getShaderInfoLog(r)),null)},o._count=0,o._preCompileShader={},o.SHADERNAME2ID=2e-4,o.sharders=new Array(32),n(o,["nameKey",function(){return this.nameKey=new N}]),o}(),le=function(t){function _(t,e,i,r){void(this._mgrKey=0)===i&&(i=0),void 0===r&&(r=0),_.__super.call(this,i,!1),this._glTextureType=3553,this._width=t,this._height=e,this._depthStencilFormat=r,this._create(t,e)}f(_,"laya.webgl.resource.RenderTexture2D",se);var e=_.prototype;return e.getIsReady=function(){return!0},e._create=function(t,e){var i=j.instance;this._frameBuffer=i.createFramebuffer(),ot.bindTexture(i,this._glTextureType,this._glTexture);var r=this._getGLFormat();if(i.texImage2D(this._glTextureType,0,r,t,e,0,r,5121,null),this._setGPUMemory(t*e*4),i.bindFramebuffer(36160,this._frameBuffer),i.framebufferTexture2D(36160,36064,3553,this._glTexture,0),3!==this._depthStencilFormat)switch(this._depthStencilBuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,this._depthStencilBuffer),this._depthStencilFormat){case 0:i.renderbufferStorage(36161,33189,t,e),i.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 1:i.renderbufferStorage(36161,36168,t,e),i.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 2:i.renderbufferStorage(36161,34041,t,e),i.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);break;default:console.log("RenderTexture: unkonw depth format.")}i.bindFramebuffer(36160,null),i.bindRenderbuffer(36161,null),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()},e.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,j.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4))},e.start=function(){var t=j.instance;j.instance.bindFramebuffer(36160,this._frameBuffer),(_._currentActive=this)._readyed=!0,t.viewport(0,0,this._width,this._height),this._lastWidth=bt.width,this._lastHeight=bt.height,bt.width=this._width,bt.height=this._height,ee.activeShader=null},e.end=function(){j.instance.bindFramebuffer(36160,null),_._currentActive=null,this._readyed=!0},e.restore=function(){var t=j.instance;this._lastRT!=_._currentActive&&(j.instance.bindFramebuffer(36160,this._lastRT?this._lastRT._frameBuffer:null),_._currentActive=this._lastRT),this._readyed=!0,t.viewport(0,0,this._lastWidth,this._lastHeight),bt.width=this._lastWidth,bt.height=this._lastHeight,ee.activeShader=null},e.clear=function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1);var _=j.instance;_.clearColor(t,e,i,r);var a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=256,a|=1024}_.clear(a)},e.getData=function(t,e,i,r){var _=j.instance;if(_.bindFramebuffer(36160,this._frameBuffer),!(36053===_.checkFramebufferStatus(36160)))return _.bindFramebuffer(36160,null),null;var a=new Uint8Array(this._width*this._height*4),n=this._getGLFormat();return _.readPixels(t,e,i,r,n,5121,a),_.bindFramebuffer(36160,null),a},e.recycle=function(){},e._disposeResource=function(){if(this._frameBuffer){var t=j.instance;t.deleteTexture(this._glTexture),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}},A(0,e,"depthStencilFormat",function(){return this._depthStencilFormat}),A(0,e,"defaulteTexture",function(){return ue.grayTexture}),A(0,e,"sourceWidth",function(){return this._width}),A(0,e,"sourceHeight",function(){return this._height}),A(0,e,"offsetX",function(){return 0}),A(0,e,"offsetY",function(){return 0}),A(1,_,"currentActive",function(){return _._currentActive},laya.webgl.resource.BaseTexture._$SET_currentActive),_.pushRT=function(){_.rtStack.push({rt:_._currentActive,w:bt.width,h:bt.height})},_.popRT=function(){var t=j.instance,e=_.rtStack.pop();e&&(_._currentActive!=e.rt&&(j.instance.bindFramebuffer(36160,e.rt?e.rt._frameBuffer:null),_._currentActive=e.rt),t.viewport(0,0,e.w,e.h),bt.width=e.w,bt.height=e.h)},_._currentActive=null,_.rtStack=[],n(_,["defuv",function(){return this.defuv=[0,0,1,0,1,1,0,1]},"flipyuv",function(){return this.flipyuv=[0,1,1,1,1,0,0,0]}]),_}(),ue=function(t){function a(t,e,i,r,_){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===r&&(r=!0),void 0===_&&(_=!1),a.__super.call(this,i,r),this._glTextureType=3553,this._width=t,this._height=e,this._canRead=_,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),h.is2DPixelArtGame&&(this._filterMode=0),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel)}f(a,"laya.webgl.resource.Texture2D",se);var e=a.prototype;return e._calcualatesCompressedDataSize=function(t,e,i){switch(t){case 3:case 5:return(e+3>>2)*(i+3>>2)*8;case 4:return(e+3>>2)*(i+3>>2)*16;case 11:case 12:return Math.floor((Math.max(e,8)*Math.max(i,8)*4+7)/8);case 9:case 10:return Math.floor((Math.max(e,16)*Math.max(i,8)*2+7)/8);default:return 0}},e._pharseDDS=function(t){var e=new Int32Array(t,0,31);if(542327876!=e[0])throw"Invalid magic number in DDS header";if(!(4&e[20]))throw"Unsupported format, must contain a FourCC code";var i=e[21];switch(this._format){case 3:if(827611204!==i)throw"the FourCC code is not same with texture format.";break;case 4:if(894720068!==i)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format."}var r=1;if(131072&e[2]){if(r=Math.max(1,e[7]),!this._mipmap)throw"the mipmap is not same with Texture2D."}else if(this._mipmap)throw"the mipmap is not same with Texture2D.";var _=e[4],a=e[3];this._width=_,this._height=a;var n=e[1]+4;this._upLoadCompressedTexImage2D(t,_,a,r,n,0)},e._pharseKTX=function(t){var e=new Uint8Array(t,0,12);if(171!=e[0]||75!=e[1]||84!=e[2]||88!=e[3]||32!=e[4]||49!=e[5]||49!=e[6]||187!=e[7]||13!=e[8]||10!=e[9]||26!=e[10]||10!=e[11])throw"Invalid fileIdentifier in KTX header";var i=new Int32Array(e.buffer,e.length,13),r=i[4],_=this._getGLFormat();switch(this._format){case 5:if(r!==_)throw"the format  is not same with texture format FORMAT_ETC1RGB.";break;default:throw"unknown texture format."}var a=i[11],n=i[6],s=i[7];this._width=n,this._height=s;var o=64+i[12];this._upLoadCompressedTexImage2D(t,n,s,a,o,4)},e._pharsePVR=function(t){var e=new Int32Array(t,0,13);if(55727696!=e[0])throw"Invalid magic number in PVR header";var i=e[2];switch(this._format){case 5:if(6!==i)throw"the format  is not same with texture format FORMAT_ETC1RGB.";break;case 9:if(0!==i)throw"the format  is not same with texture format FORMAT_PVRTCRGB_2BPPV.";break;case 11:if(2!==i)throw"the format  is not same with texture format FORMAT_PVRTCRGB_4BPPV.";break;case 10:if(1!==i)throw"the format  is not same with texture format FORMAT_PVRTCRGBA_2BPPV.";break;case 12:if(3!==i)throw"the format  is not same with texture format FORMAT_PVRTCRGBA_4BPPV.";break;default:throw"unknown texture format."}var r=e[11],_=e[7],a=e[6];this._width=_,this._height=a;var n=e[12]+52;this._upLoadCompressedTexImage2D(t,_,a,r,n,0)},e._upLoadCompressedTexImage2D=function(t,e,i,r,_,a){var n=j.instance,s=this._glTextureType;ot.bindTexture(n,s,this._glTexture);for(var o=this._getGLFormat(),h=_,l=0;l<r;l++){h+=a;var u=this._calcualatesCompressedDataSize(this._format,e,i),c=new Uint8Array(t,h,u);n.compressedTexImage2D(s,l,o,e,i,0,c),e>>=1,i>>=1,h+=u}var f=h;this._setGPUMemory(f),this._readyed=!0,this._activeResource()},e.loadImageSource=function(t,e){void 0===e&&(e=!1);var i=t.width,r=t.height;this._width=i,this._height=r,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode);var _=j.instance;ot.bindTexture(_,this._glTextureType,this._glTexture);var a=this._getGLFormat();x.isConchApp?(t.setPremultiplyAlpha(e),_.texImage2D(this._glTextureType,0,6408,6408,5121,t)):(e&&_.pixelStorei(37441,!0),_.texImage2D(this._glTextureType,0,a,a,5121,t),e&&_.pixelStorei(37441,!1)),this._mipmap&&this._isPot(i)&&this._isPot(r)?(_.generateMipmap(this._glTextureType),this._setGPUMemory(i*r*4*(1+1/3))):this._setGPUMemory(i*r*4),this._canRead&&(x.isConchApp?this._pixels=new Uint8Array(t._nativeObj.getImageData(0,0,i,r)):(s.canvas.size(i,r),s.canvas.clear(),s.context.drawImage(t,0,0,i,r),this._pixels=new Uint8Array(s.context.getImageData(0,0,i,r).data.buffer))),this._readyed=!0,this._activeResource()},e.setPixels=function(t,e){if(void 0===e&&(e=0),!t)throw"Texture2D:pixels can't be null.";var i=this._width,r=this._height,_=j.instance,a=this._glTextureType;ot.bindTexture(_,a,this._glTexture);var n=this._getGLFormat();_.texImage2D(a,e,n,i,r,0,n,5121,t),this._mipmap&&this._isPot(i)&&this._isPot(r)?(_.generateMipmap(a),this._setGPUMemory(i*r*4*(1+1/3))):this._setGPUMemory(i*r*4),this._canRead&&(this._pixels=t),this._readyed=!0,this._activeResource()},e.setCompressData=function(t){switch(this._format){case 3:case 4:this._pharseDDS(t);break;case 5:this._pharseKTX(t);break;case 9:case 10:case 11:case 12:this._pharsePVR(t);break;default:throw"Texture2D:unkonwn format."}},e._recoverResource=function(){},e.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},A(0,e,"defaulteTexture",function(){return laya.webgl.resource.Texture2D.grayTexture}),a.__init__=function(){var t=new Uint8Array(3);t[0]=128,t[1]=128,t[2]=128,(a.grayTexture=new a(1,1,0,!1,!1)).setPixels(t),a.grayTexture.lock=!0},a._parse=function(t,e,i){var r=i?new a(i[0],i[1],i[2],i[3],i[4]):new a(0,0);switch(e&&(r.wrapModeU=e.wrapModeU,r.wrapModeV=e.wrapModeV,r.filterMode=e.filterMode,r.anisoLevel=e.anisoLevel),r._format){case 0:case 1:r.loadImageSource(t);break;case 3:case 4:case 5:case 9:case 10:case 11:case 12:r.setCompressData(t);break;default:throw"Texture2D:unkonwn format."}return r},a.load=function(t,e){D.loader.create(t,e,null,"TEXTURE2D")},a.grayTexture=null,a}(),ce=function(t){function a(t,e,i,r,_){this._params2dQuick2=null,this._shaderValueWidth=0,this._shaderValueHeight=0,a.__super.call(this,t,e,i,r,_)}f(a,"laya.webgl.shader.d2.Shader2X",t);var e=a.prototype;return e._disposeResource=function(){t.prototype._disposeResource.call(this),this._params2dQuick2=null},e.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},e._make2dQuick2=function(){if(!this._params2dQuick2){this._params2dQuick2=[];for(var t,e=this._params,i=0,r=e.length;i<r;i++)"size"!==(t=e[i]).name&&this._params2dQuick2.push(t)}return this._params2dQuick2},a.create=function(t,e,i,r,_){return new a(t,e,i,r,_)},a}(he);D.__init([wt,pt,Gt])}(window,document,Laya);