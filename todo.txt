服务端内部传递玩家ID应该用ukey,这是持久和唯一的,gcNID虽唯一但并不持久

匹配流程:
1,GC请求CS匹配
2,CS匹配成功,等待GC加载游戏数据
3,所有GC加载完成或CS等待超时,通知BS创建战场,并等待GC连接
3,BS通知CS创建成功,CS改变玩家状态为战场并持久化,必须主动通知(避免断线重连后无法进入战场)GC进入战场,下发BS连接信息
4,GC连接BS,BS验证,等待所有GC连接或超时,开始战斗
5,GC请求战场状态,追帧

断线重连:
1,GC登陆CSCS
2,CS检查玩家场景状态,若为休闲状态,无需处理,若为战场状态,通知GC进入战场,下发BS连接信息
3,GC加载游戏数据,完毕后请求战场状态,追帧

补充:BS确认战场创建成功,并返回结果给CS.CS改变玩家状态并持久化.
玩家应一直保持在线上,即使客户端关闭连接,CS里的玩家不应该下线.等待客户端重连或战场结束.
客户端重连应获取当前状态,如果CS没该客户端,应从DB中获取状态.
战场结束后,若玩家不在线,则下线.

创建waitingRoom时应该生成唯一id用于战场id,这样在CS请求BS创建战场时的回应消息就可以携带这个id返回给CS,CS根据这个ID可以创建一个战场和玩家的对应关系,用于战斗过程中所有通信的唯一关系依据.
退出战场时,CS应下线没有连接的GC
BattleStaging的add和remove的参数user都有可能空