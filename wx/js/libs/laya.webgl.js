!function(f,i,P){P.un,P.uns;var n=P.static,v=P.class,E=P.getset,o=(P.__newvec,laya.maths.Bezier),_=laya.resource.Bitmap,s=laya.utils.Browser,L=(laya.display.css.CacheStyle,laya.filters.ColorFilter),W=laya.utils.ColorUtils,h=P.Config,b=laya.resource.Context,r=laya.display.cmd.DrawCanvasCmd,a=laya.display.cmd.DrawImageCmd,u=(laya.events.Event,laya.display.cmd.FillTextCmd),t=laya.filters.Filter,X=laya.utils.FontInfo,l=laya.display.Graphics,A=laya.resource.HTMLCanvas,e=(laya.utils.HTMLChar,laya.resource.HTMLImage),S=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),d=laya.display.Node,C=laya.maths.Point,g=laya.utils.Pool,M=laya.maths.Rectangle,c=laya.renders.Render,D=laya.renders.RenderSprite,R=laya.resource.Resource,m=(laya.resource.ResourceManager,laya.display.cmd.RestoreCmd),T=laya.display.cmd.RotateCmd,p=laya.utils.RunDriver,O=laya.display.cmd.SaveCmd,y=laya.display.cmd.ScaleCmd,B=laya.display.Sprite,I=(laya.display.SpriteConst,laya.display.css.SpriteStyle,laya.display.Stage),x=laya.utils.Stat,N=laya.utils.StringKey,F=laya.system.System,V=laya.display.Text,w=laya.resource.Texture,U=laya.display.cmd.TransformCmd,G=laya.display.cmd.TranslateCmd,k=laya.utils.VectorGraphManager;laya.utils.WordText;P.interface("laya.webgl.submit.ISubmit"),P.interface("laya.webgl.canvas.save.ISaveData");var Y=function(){function s(){}v(s,"laya.webgl.canvas.save.SaveBase");var t=s.prototype;return P.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._dataObj[this._valueName]=this._value,(s.POOL[s.POOL._length++]=this)._newSubmit&&(t._curSubmit=ct.RENDERBASE)},s._createArray=function(){var t=[];return t._length=0,t},s._init=function(){var t=s._namemap={};return t[1]="ALPHA",t[2]="fillStyle",t[8]="font",t[256]="lineWidth",t[512]="strokeStyle",t[8192]="_mergeID",t[1024]=t[2048]=t[4096]=[],t[16384]="textBaseline",t[32768]="textAlign",t[65536]="_nBlendType",t[1048576]="shader",t[2097152]="filters",t[8388608]="_colorFiler",t},s.save=function(t,e,i,_){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var r=s.POOL,a=0<r._length?r[--r._length]:new s;a._value=i[a._valueName=s._namemap[e]],a._dataObj=i,a._newSubmit=_;var n=t._save;n[n._length++]=a}},s.POOL=laya.webgl.canvas.save.SaveBase._createArray(),s._namemap=s._init(),s}(),H=function(){function _(t,e){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this.ref=1,this._cacheID=0,this.clipMatDir=[99999999,0,0,99999999],this.clipMatPos=[0,0],this.defines=new Gt,this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.color=null,this.colorAdd=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=_._cache[this._cacheID],0<t&&!this._inClassCache&&(this._inClassCache=_._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}v(_,"laya.webgl.shader.d2.value.Value2D");var t=_.prototype;return t.setValue=function(t){},t._ShaderWithCompile=function(){return $t.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,ie.create,this._attribLocation)},t.upload=function(){var t=Ct;Ct.worldMatrix4===Ct.TEMPMAT4_ARRAY||this.defines.addInt(128),this.mmat=t.worldMatrix4;var e=$t.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();e._shaderValueWidth!==t.width||e._shaderValueHeight!==t.height?(this.size[0]=t.width,this.size[1]=t.height,e._shaderValueWidth=t.width,e._shaderValueHeight=t.height,e.upload(this,null)):e.upload(this,e._params2dQuick2||e._make2dQuick2())},t.setFilters=function(t){if(this.filters=t)for(var e,i=t.length,_=0;_<i;_++)(e=t[_])&&(this.defines.add(e.type),e.action.setValue(this))},t.clear=function(){this.defines._value=this.subID+(dt.shaderHighPrecision?1024:0)},t.release=function(){--this.ref<1&&(this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this),this.clear(),this.filters=null,this.ref=1)},_._initone=function(t,e){_._typeClass[t]=e,_._cache[t]=[],_._cache[t]._length=0},_.__init__=function(){_._initone(4,Ft),_._initone(512,xt),_._initone(1,Nt),_._initone(9,Nt)},_.create=function(t,e){var i=_._cache[t|e];return i._length?i[--i._length]:new _._typeClass[t|e](e)},_._cache=[],_._typeClass=[],_.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_}(),Z=function(){function t(){this.ib=null,this.vb=null;dt.mainContext;this.ib=_e.create(35048),this.vb=re.create(8)}v(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var e=t.prototype;return e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},e.reset=function(){this.vb.clear(),this.ib.clear()},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),j=(function(){function o(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(16,!0)}v(o,"laya.layagl.cmdNative.ScaleCmdNative");var t=o.prototype;t.recover=function(){g.recover("ScaleCmd",this)},E(0,t,"cmdID",function(){return"Scale"}),E(0,t,"scaleX",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"scaleY",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"pivotX",function(){return this._paramData._float32Data[2]},function(t){this._paramData._float32Data[2]=t,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"pivotY",function(){return this._paramData._float32Data[3]},function(t){this._paramData._float32Data[3]=t,z.syncBufferToRenderThread(this._paramData)}),o.create=function(t,e,i,_){var r=g.getItemByClass("ScaleCmd",o),a=r._graphicsCmdEncoder=this._commandEncoder,n=r._paramData._float32Data;n[0]=t,n[1]=e,n[2]=i,n[3]=_;var s=r._paramData.getPtrID();return z.syncBufferToRenderThread(r._paramData),a.setGlobalValueEx(Lt.GLOBALVALUE_MATRIX32,12,s,0),z.syncBufferToRenderThread(a),r},o.ID="Scale"}(),function(){function r(){this._clipInfoID=-1,this._globalClipMatrix=new S,this._clipRect=new M}v(r,"laya.webgl.canvas.save.SaveClipRect");var t=r.prototype;return P.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._globalClipMatrix.copyTo(t._globalClipMatrix),this._clipRect.clone(t._clipRect),t._clipInfoID=this._clipInfoID,r.POOL[r.POOL._length++]=this},r.save=function(t){if(131072!=(131072&t._saveMark._saveuse)){t._saveMark._saveuse|=131072;var e=r.POOL,i=0<e._length?e[--e._length]:new r;t._globalClipMatrix.copyTo(i._globalClipMatrix),t._clipRect.clone(i._clipRect),i._clipInfoID=t._clipInfoID;var _=t._save;_[_._length++]=i}},r.POOL=Y._createArray(),r}()),z=(function(){function n(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(8,!0)}v(n,"laya.layagl.cmdNative.TranslateCmdNative");var t=n.prototype;t.recover=function(){g.recover("TranslateCmd",this)},E(0,t,"ty",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"cmdID",function(){return"Translate"}),E(0,t,"tx",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,z.syncBufferToRenderThread(this._paramData)}),n.create=function(t,e){var i=g.getItemByClass("TranslateCmd",n),_=i._graphicsCmdEncoder=this._commandEncoder,r=i._paramData._float32Data;r[0]=t,r[1]=e;var a=i._paramData.getPtrID();return z.syncBufferToRenderThread(i._paramData),_.setGlobalValueEx(Lt.GLOBALVALUE_MATRIX32,9,a,0),z.syncBufferToRenderThread(_),i},n.ID="Translate"}(),function(){function t(){}v(t,"laya.layagl.LayaGL");var e=t.prototype;return e.createCommandEncoder=function(t,e,i){return void 0===t&&(t=128),void 0===e&&(e=64),void 0===i&&(i=!1),new Tt(this,t,e,i)},e.beginCommandEncoding=function(t){},e.endCommandEncoding=function(){},e.calcMatrixFromScaleSkewRotation=function(t,e,i,_,r,a,n,s,o,h,u,l){},e.setGLTemplate=function(t,e){},e.setEndGLTemplate=function(t,e){},e.matrix4x4Multiply=function(t,e,i){},e.evaluateClipDatasRealTime=function(t,e,i,_){},t.getFrameCount=function(){return 0},t.syncBufferToRenderThread=function(t,e){void 0===e&&(e=0)},t.createArrayBufferRef=function(t,e,i){},t.createArrayBufferRefs=function(t,e,i,_){},t.EXECUTE_JS_THREAD_BUFFER=0,t.EXECUTE_RENDER_THREAD_BUFFER=1,t.EXECUTE_COPY_TO_RENDER=2,t.EXECUTE_COPY_TO_RENDER3D=3,t.VALUE_OPERATE_ADD=0,t.VALUE_OPERATE_SUB=1,t.VALUE_OPERATE_MUL=2,t.VALUE_OPERATE_DIV=3,t.VALUE_OPERATE_M2_MUL=4,t.VALUE_OPERATE_M3_MUL=5,t.VALUE_OPERATE_M4_MUL=6,t.VALUE_OPERATE_M32_MUL=7,t.VALUE_OPERATE_SET=8,t.VALUE_OPERATE_M32_TRANSLATE=9,t.VALUE_OPERATE_M32_SCALE=10,t.VALUE_OPERATE_M32_ROTATE=11,t.VALUE_OPERATE_M32_SCALE_PIVOT=12,t.VALUE_OPERATE_M32_ROTATE_PIVOT=13,t.VALUE_OPERATE_M32_TRANSFORM_PIVOT=14,t.VALUE_OPERATE_BYTE4_COLOR_MUL=15,t.ARRAY_BUFFER_TYPE_DATA=0,t.ARRAY_BUFFER_TYPE_CMD=1,t.ARRAY_BUFFER_REF_REFERENCE=0,t.ARRAY_BUFFER_REF_COPY=1,t.UPLOAD_SHADER_UNIFORM_TYPE_ID=0,t.UPLOAD_SHADER_UNIFORM_TYPE_DATA=1,t.instance=null,t}()),Q=function(){function e(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new re(t,35048),e?this._vb._resizeBuffer(e,!1):h.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(65536*t,!1),this._ib=new _e,i&&this._ib._resizeBuffer(i,!1)}v(e,"laya.webgl.utils.Mesh2D");var t=e.prototype;return t.cloneWithNewVB=function(){var t=new e(this._stride,0,0);return t._ib=this._ib,t._quadNum=this._quadNum,t._attribInfo=this._attribInfo,t},t.cloneWithNewVBIB=function(){var t=new e(this._stride,0,0);return t._attribInfo=this._attribInfo,t},t.getVBW=function(){return this._vb.setNeedUpload(),this._vb},t.getVBR=function(){return this._vb},t.getIBR=function(){return this._ib},t.getIBW=function(){return this._ib.setNeedUpload(),this._ib},t.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,_=0,r=0;r<t;r++)e[i++]=_,e[i++]=_+2,e[i++]=_+1,e[i++]=_,e[i++]=_+3,e[i++]=_+2,_+=4;this._ib.setNeedUpload()},t.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},t.configVAO=function(t){if(!this._applied){this._applied=!0,this._vao||(this._vao=new Xt),this._vao.bind(),this._vb._bindForVAO(),this._ib.setNeedUpload(),this._ib._bind_uploadForVAO();for(var e=this._attribInfo.length/3,i=0,_=0;_<e;_++){var r=this._attribInfo[i+1],a=this._attribInfo[i],n=this._attribInfo[i+2];t.enableVertexAttribArray(_),t.vertexAttribPointer(_,r,a,!1,this._stride,n),i+=3}this._vao.unBind()}},t.useMesh=function(t){this._applied||this.configVAO(t),this._vao.bind(),this._vb.bind(),this._ib._bind_upload()||this._ib.bind(),this._vb._bind_upload()||this._vb.bind()},t.getEleNum=function(){return this._ib.getBuffer().byteLength/2},t.releaseMesh=function(){},t.destroy=function(){},t.clearVB=function(){this._vb.clear()},e._gvaoid=0,e}(),K=function(){function i(t){this._color=null,this.setValue(t)}v(i,"laya.webgl.canvas.DrawStyle");var t=i.prototype;return t.setValue=function(t){this._color=t?t instanceof laya.utils.ColorUtils?t:W.create(t):W.create("#000000")},t.reset=function(){this._color=W.create("#000000")},t.toInt=function(){return this._color.numColor},t.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.ColorUtils&&this._color.numColor===t.numColor},t.toColorStr=function(){return this._color.strColor},i.create=function(t){if(t){var e=t instanceof laya.utils.ColorUtils?t:W.create(t);return e._drawStyle||(e._drawStyle=new i(t))}return i.DEFAULT},n(i,["DEFAULT",function(){return this.DEFAULT=new i("#000000")}]),i}(),q=function(){function n(){this._commandEncoder=null}v(n,"laya.layagl.ConchGraphicsAdpt");var t=n.prototype;return t._createData=function(){this._commandEncoder=z.instance.createCommandEncoder(128,64,!0)},t._clearData=function(){this._commandEncoder&&this._commandEncoder.clearEncoding()},t._destroyData=function(){this._commandEncoder&&(this._commandEncoder.clearEncoding(),this._commandEncoder=null)},n.__init__=function(){var t,e,i=l.prototype,_=n.prototype,r=["_createData","_clearData","_destroyData"],a=0;for(t=r.length,a=0;a<t;a++)i[e=r[a]]=_[e]},n}(),$=(function(){function o(){}v(o,"laya.webgl.utils.MatirxArray"),o.ArrayMul=function(t,e,i){if(t)if(e)for(var _=NaN,r=NaN,a=NaN,n=NaN,s=0;s<4;s++)_=t[s],r=t[s+4],a=t[s+8],n=t[s+12],i[s]=_*e[0]+r*e[1]+a*e[2]+n*e[3],i[s+4]=_*e[4]+r*e[5]+a*e[6]+n*e[7],i[s+8]=_*e[8]+r*e[9]+a*e[10]+n*e[11],i[s+12]=_*e[12]+r*e[13]+a*e[14]+n*e[15];else o.copyArray(t,i);else o.copyArray(e,i)},o.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]}}(),function(){function s(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(12,!0)}v(s,"laya.layagl.cmdNative.RotateCmdNative");var t=s.prototype;t.recover=function(){g.recover("RotateCmd",this)},E(0,t,"cmdID",function(){return"Rotate"}),E(0,t,"angle",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"pivotX",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"pivotY",function(){return this._paramData._float32Data[2]},function(t){this._paramData._float32Data[2]=t,z.syncBufferToRenderThread(this._paramData)}),s.create=function(t,e,i){var _=g.getItemByClass("RotateCmd",s),r=_._graphicsCmdEncoder=this._commandEncoder,a=_._paramData._float32Data;a[0]=t,a[1]=e,a[2]=i;var n=_._paramData.getPtrID();return z.syncBufferToRenderThread(_._paramData),r.setGlobalValueEx(Lt.GLOBALVALUE_MATRIX32,13,n,0),z.syncBufferToRenderThread(r),_},s.ID="Rotate"}(),function(){function i(){this._graphicsCmdEncoder=null}v(i,"laya.layagl.cmdNative.SaveCmdNative");var t=i.prototype;t.recover=function(){g.recover("SaveCmd",this)},E(0,t,"cmdID",function(){return"Save"}),i.create=function(){var t=g.getItemByClass("SaveCmd",i),e=t._graphicsCmdEncoder=this._commandEncoder;return e.save(),z.syncBufferToRenderThread(e),t},i.ID="Save"}(),function(){function t(){}return v(t,"laya.webgl.VertexArrayObject"),t}()(function(){var r={};function l(t,e){var i;r[t]=!0,void 0!==e&&(i=e,f.console&&f.console.error&&f.console.error(i))}var i=function t(e){var i=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(var _=0;_<this.attribs.length;_++){var r=new t.VertexAttrib(i);this.attribs[_]=r}this.maxAttrib=0};(i.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=t.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var _=function(_){var e,i,o=this;this.gl=_,i=(e=_).getError,e.getError=function(){for(;(t=i.apply(e))!=e.NO_ERROR&&(r[t]=!0),t!=e.NO_ERROR;);for(var t in r)if(r[t])return delete r[t],parseInt(t);return e.NO_ERROR};var h=this.original={getParameter:_.getParameter,enableVertexAttribArray:_.enableVertexAttribArray,disableVertexAttribArray:_.disableVertexAttribArray,bindBuffer:_.bindBuffer,getVertexAttrib:_.getVertexAttrib,vertexAttribPointer:_.vertexAttribPointer};_.getParameter=function(t){return t==o.VERTEX_ARRAY_BINDING_OES?o.currentVertexArrayObject==o.defaultVertexArrayObject?null:o.currentVertexArrayObject:h.getParameter.apply(this,arguments)},_.enableVertexAttribArray=function(t){var e=o.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!0,h.enableVertexAttribArray.apply(this,arguments)},_.disableVertexAttribArray=function(t){var e=o.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!1,h.disableVertexAttribArray.apply(this,arguments)},_.bindBuffer=function(t,e){switch(t){case _.ARRAY_BUFFER:o.currentArrayBuffer=e;break;case _.ELEMENT_ARRAY_BUFFER:o.currentVertexArrayObject.elementArrayBuffer=e}return h.bindBuffer.apply(this,arguments)},_.getVertexAttrib=function(t,e){var i=o.currentVertexArrayObject.attribs[t];switch(e){case _.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return i.buffer;case _.VERTEX_ATTRIB_ARRAY_ENABLED:return i.enabled;case _.VERTEX_ATTRIB_ARRAY_SIZE:return i.size;case _.VERTEX_ATTRIB_ARRAY_STRIDE:return i.stride;case _.VERTEX_ATTRIB_ARRAY_TYPE:return i.type;case _.VERTEX_ATTRIB_ARRAY_NORMALIZED:return i.normalized;default:return h.getVertexAttrib.apply(this,arguments)}},_.vertexAttribPointer=function(t,e,i,_,r,a){var n=o.currentVertexArrayObject;n.maxAttrib=Math.max(n.maxAttrib,t);var s=n.attribs[t];return s.buffer=o.currentArrayBuffer,s.size=e,s.type=i,s.normalized=_,s.stride=r,s.offset=a,s.recache(),h.vertexAttribPointer.apply(this,arguments)},_.instrumentExtension&&_.instrumentExtension(this,"OES_vertex_array_object"),_.canvas&&_.canvas.addEventListener&&_.canvas.addEventListener("webglcontextrestored",function(){var t;t="OESVertexArrayObject emulation library context restored",f.console&&f.console.log&&f.console.log(t),o.reset_()},!0),this.reset_()};_.prototype.VERTEX_ARRAY_BINDING_OES=34229,_.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;var e=this.gl;this.maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new i(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},_.prototype.createVertexArrayOES=function(){var t=new i(this);return this.vertexArrayObjects.push(t),t},_.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject==t&&this.bindVertexArrayOES(null)},_.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof i&&t.hasBeenBound&&t.ext==this)},_.prototype.bindVertexArrayOES=function(t){var e=this.gl;if(!t||t.isAlive){var i=this.original,_=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var r=this.currentVertexArrayObject;if(_!=r){_&&r.elementArrayBuffer==_.elementArrayBuffer||i.bindBuffer.call(e,e.ELEMENT_ARRAY_BUFFER,r.elementArrayBuffer);for(var a=this.currentArrayBuffer,n=Math.max(_?_.maxAttrib:0,r.maxAttrib),s=0;s<=n;s++){var o=r.attribs[s],h=_?_.attribs[s]:null;if(_&&o.enabled==h.enabled||(o.enabled?i.enableVertexAttribArray.call(e,s):i.disableVertexAttribArray.call(e,s)),o.enabled){var u=!1;_&&o.buffer==h.buffer||(a!=o.buffer&&(i.bindBuffer.call(e,e.ARRAY_BUFFER,o.buffer),a=o.buffer),u=!0),(u||o.cached!=h.cached)&&i.vertexAttribPointer.call(e,s,o.size,o.type,o.normalized,o.stride,o.offset)}}this.currentArrayBuffer!=a&&i.bindBuffer.call(e,e.ARRAY_BUFFER,this.currentArrayBuffer)}}else l(e.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject")},f._setupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var i=t.getExtension;t.getExtension=function(t){var e=i.call(this,t);return e||("OES_vertex_array_object"!==t?null:(this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new _(this)),this.__OESVertexArrayObject))}},f._forceSetupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var i=t.getExtension;t.getExtension=function(t){if("OES_vertex_array_object"===t)return this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new _(this)),this.__OESVertexArrayObject;var e=i.call(this,t);return e||null}}}()),function(){function _(){}v(_,"laya.webgl.text.ArabicReshaper");var t=_.prototype;t.characterMapContains=function(t){for(var e=0;e<_.charsMap.length;++e)if(_.charsMap[e][0]===t)return!0;return!1},t.getCharRep=function(t){for(var e=0;e<_.charsMap.length;++e)if(_.charsMap[e][0]===t)return _.charsMap[e];return!1},t.getCombCharRep=function(t,e){for(var i=0;i<_.combCharsMap.length;++i)if(_.combCharsMap[i][0][0]===t&&_.combCharsMap[i][0][1]===e)return _.combCharsMap[i];return!1},t.isTransparent=function(t){for(var e=0;e<_.transChars.length;++e)if(_.transChars[e]===t)return!0;return!1},t.getOriginalCharsFromCode=function(t){var e=0;for(e=0;e<_.charsMap.length;++e)if(-1<_.charsMap[e].indexOf(t))return String.fromCharCode(_.charsMap[e][0]);for(e=0;e<_.combCharsMap.length;++e)if(-1<_.combCharsMap[e].indexOf(t))return String.fromCharCode(_.combCharsMap[e][0][0])+String.fromCharCode(_.combCharsMap[e][0][1]);return String.fromCharCode(t)},t.convertArabic=function(t){for(var e,i,_="",r=0;r<t.length;++r){var a=t.charCodeAt(r);if(this.characterMapContains(a)){for(var n=null,s=null,o=r-1,h=r+1;0<=o&&this.isTransparent(t.charCodeAt(o));--o);for((!(e=!!(n=0<=o?t.charCodeAt(o):null)&&this.getCharRep(n))||null==e[2]&&null==e[3])&&(n=null);h<t.length&&this.isTransparent(t.charCodeAt(h));++h);if((!(e=!!(s=h<t.length?t.charCodeAt(h):null)&&this.getCharRep(s))||null==e[3]&&null==e[4])&&(s=null),1604===a&&null!=s&&(1570===s||1571===s||1573===s||1575===s)){i=this.getCombCharRep(a,s),_+=null!=n?String.fromCharCode(i[4]):String.fromCharCode(i[1]),++r;continue}if(e=this.getCharRep(a),null!=n&&null!=s&&null!=e[3]){_+=String.fromCharCode(e[3]);continue}if(null!=n&&null!=e[4]){_+=String.fromCharCode(e[4]);continue}if(null!=s&&null!=e[2]){_+=String.fromCharCode(e[2]);continue}_+=String.fromCharCode(e[1])}else _+=String.fromCharCode(a)}return _},t.convertArabicBack=function(t){var e="",i=0,_=0;for(_=0;_<t.length;++_)i=t.charCodeAt(_),e+=this.getOriginalCharsFromCode(i);return e},n(_,["charsMap",function(){return this.charsMap=[[1569,65152,null,null,null],[1570,65153,null,null,65154],[1571,65155,null,null,65156],[1572,65157,null,null,65158],[1573,65159,null,null,65160],[1574,65161,65163,65164,65162],[1575,65165,null,null,65166],[1576,65167,65169,65170,65168],[1577,65171,null,null,65172],[1578,65173,65175,65176,65174],[1579,65177,65179,65180,65178],[1580,65181,65183,65184,65182],[1581,65185,65187,65188,65186],[1582,65189,65191,65192,65190],[1583,65193,null,null,65194],[1584,65195,null,null,65196],[1585,65197,null,null,65198],[1586,65199,null,null,65200],[1587,65201,65203,65204,65202],[1588,65205,65207,65208,65206],[1589,65209,65211,65212,65210],[1590,65213,65215,65216,65214],[1591,65217,65219,65220,65218],[1592,65221,65223,65224,65222],[1593,65225,65227,65228,65226],[1594,65229,65231,65232,65230],[1600,1600,1600,1600,1600],[1601,65233,65235,65236,65234],[1602,65237,65239,65240,65238],[1603,65241,65243,65244,65242],[1604,65245,65247,65248,65246],[1605,65249,65251,65252,65250],[1606,65253,65255,65256,65254],[1607,65257,65259,65260,65258],[1608,65261,null,null,65262],[1609,65263,null,null,65264],[1610,65265,65267,65268,65266],[1662,64342,64344,64345,64343],[1740,64508,64510,64511,64509],[1670,64378,64380,64381,64379],[1705,64398,64400,64401,64399],[1711,64402,64404,64405,64403],[1688,64394,null,null,64395]]},"combCharsMap",function(){return this.combCharsMap=[[[1604,1570],65269,null,null,65270],[[1604,1571],65271,null,null,65272],[[1604,1573],65273,null,null,65274],[[1604,1575],65275,null,null,65276]]},"transChars",function(){return this.transChars=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}])}(),function(){function d(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._pos=null,this._rectNum=0,this._vbSize=0,this.vbBuffer=null}v(d,"laya.layagl.cmdNative.DrawTexturesCmdNative");var t=d.prototype;t.recover=function(){this._texture=null,this._pos=null,g.recover("DrawTexturesCmd",this)},E(0,t,"cmdID",function(){return"DrawTextures"}),E(0,t,"texture",function(){return this._texture},function(t){this._texture=t;for(var e=this._texture.bitmap.width,i=this._texture.bitmap.height,_=this._texture.uv,r=this.vbBuffer._float32Data,a=this.vbBuffer._int32Data,n=0,s=0;s<this._rectNum;s++){var o=this.pos[2*s],h=this.pos[2*s+1];r[n++]=o,r[n++]=h,r[n++]=_[0],r[n++]=_[1],a[n++]=4294967295,a[n++]=4294967295,r[n++]=o+e,r[n++]=h,r[n++]=_[2],r[n++]=_[3],a[n++]=4294967295,a[n++]=4294967295,r[n++]=o+e,r[n++]=h+i,r[n++]=_[4],r[n++]=_[5],a[n++]=4294967295,a[n++]=4294967295,r[n++]=o,r[n++]=h+i,r[n++]=_[6],r[n++]=_[7],a[n++]=4294967295,a[n++]=4294967295}var u=this._paramData._int32Data;u[d._PARAM_TEXLOCATION_POS_]=33984,u[d._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id,z.syncBufferToRenderThread(this.vbBuffer),z.syncBufferToRenderThread(this._paramData)}),E(0,t,"pos",function(){return this._pos},function(t){this._pos=t;var e=this._pos.length/2,i=this._texture.bitmap.width,_=this._texture.bitmap.height,r=this._texture.uv;(!this.vbBuffer||this.vbBuffer.getByteLength()<24*e*4)&&(this.vbBuffer=new ParamData(24*e*4,!0)),this._vbSize=24*e*4,this._rectNum=e;for(var a=this.vbBuffer._float32Data,n=this.vbBuffer._int32Data,s=0,o=0;o<e;o++){var h=this.pos[2*o],u=this.pos[2*o+1];a[s++]=h,a[s++]=u,a[s++]=r[0],a[s++]=r[1],n[s++]=4294967295,n[s++]=4294967295,a[s++]=h+i,a[s++]=u,a[s++]=r[2],a[s++]=r[3],n[s++]=4294967295,n[s++]=4294967295,a[s++]=h+i,a[s++]=u+_,a[s++]=r[4],a[s++]=r[5],n[s++]=4294967295,n[s++]=4294967295,a[s++]=h,a[s++]=u+_,a[s++]=r[6],a[s++]=r[7],n[s++]=4294967295,n[s++]=4294967295}this._paramData._float32Data;var l=this._paramData._int32Data;l[d._PARAM_RECT_NUM_POS_]=this._rectNum,l[d._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),l[d._PARAM_VB_SIZE_POS_]=this._vbSize,z.syncBufferToRenderThread(this.vbBuffer),z.syncBufferToRenderThread(this._paramData)}),d.create=function(t,e){var i=g.getItemByClass("DrawTexturesCmd",d);i._graphicsCmdEncoder=this._commandEncoder,d._DRAW_TEXTURES_CMD_ENCODER_||((d._DRAW_TEXTURES_CMD_ENCODER_=z.instance.createCommandEncoder(124,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),d._DRAW_TEXTURES_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),d._DRAW_TEXTURES_CMD_ENCODER_.useVDO(Lt.VDO_MESHQUADTEXTURE),d._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),d._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),d._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),d._DRAW_TEXTURES_CMD_ENCODER_.uniformTextureByParamData(d._PARAM_UNIFORMLOCATION_POS_,4*d._PARAM_TEXLOCATION_POS_,4*d._PARAM_TEXTURE_POS_),d._DRAW_TEXTURES_CMD_ENCODER_.setRectMeshExByParamData(4*d._PARAM_RECT_NUM_POS_,4*d._PARAM_VB_POS_,4*d._PARAM_VB_SIZE_POS_,4*d._PARAM_VB_OFFSET_POS_),d._DRAW_TEXTURES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),d._DRAW_TEXTURES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(d._DRAW_TEXTURES_CMD_ENCODER_)),i._paramData||(i._paramData=new ParamData(28,!0)),i._texture=t,i._pos=e;var _=t.bitmap.width,r=t.bitmap.height,a=t.uv,n=e.length/2;(!i.vbBuffer||i.vbBuffer.getByteLength()<24*n*4)&&(i.vbBuffer=new ParamData(24*n*4,!0)),i._vbSize=24*n*4,i._rectNum=n;for(var s=i.vbBuffer._float32Data,o=i.vbBuffer._int32Data,h=0,u=0;u<n;u++){var l=e[2*u],c=e[2*u+1];s[h++]=l,s[h++]=c,s[h++]=a[0],s[h++]=a[1],o[h++]=4294967295,o[h++]=4294967295,s[h++]=l+_,s[h++]=c,s[h++]=a[2],s[h++]=a[3],o[h++]=4294967295,o[h++]=4294967295,s[h++]=l+_,s[h++]=c+r,s[h++]=a[4],s[h++]=a[5],o[h++]=4294967295,o[h++]=4294967295,s[h++]=l,s[h++]=c+r,s[h++]=a[6],s[h++]=a[7],o[h++]=4294967295,o[h++]=4294967295}i._paramData._float32Data;var f=i._paramData._int32Data;return f[d._PARAM_UNIFORMLOCATION_POS_]=3,f[d._PARAM_TEXLOCATION_POS_]=33984,f[d._PARAM_TEXTURE_POS_]=t.bitmap._glTexture.id,f[d._PARAM_RECT_NUM_POS_]=i._rectNum,f[d._PARAM_VB_POS_]=i.vbBuffer.getPtrID(),f[d._PARAM_VB_SIZE_POS_]=i._vbSize,f[d._PARAM_VB_OFFSET_POS_]=0,z.syncBufferToRenderThread(i.vbBuffer),z.syncBufferToRenderThread(i._paramData),i._graphicsCmdEncoder.useCommandEncoder(d._DRAW_TEXTURES_CMD_ENCODER_.getPtrID(),i._paramData.getPtrID(),-1),z.syncBufferToRenderThread(i._graphicsCmdEncoder),i},d.ID="DrawTextures",d._DRAW_TEXTURES_CMD_ENCODER_=null,d._PARAM_UNIFORMLOCATION_POS_=0,d._PARAM_TEXLOCATION_POS_=1,d._PARAM_TEXTURE_POS_=2,d._PARAM_RECT_NUM_POS_=3,d._PARAM_VB_POS_=4,d._PARAM_VB_SIZE_POS_=5,d._PARAM_VB_OFFSET_POS_=6}(),function(){function _(){this._saveuse=0}v(_,"laya.webgl.canvas.save.SaveMark");var t=_.prototype;return P.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!0},t.restore=function(t){t._saveMark=this._preSaveMark,_.POOL[_.POOL._length++]=this},_.Create=function(t){var e=_.POOL,i=0<e._length?e[--e._length]:new _;return i._saveuse=0,i._preSaveMark=t._saveMark,t._saveMark=i},_.POOL=Y._createArray(),_}()),J=(function(){function y(){this._graphicsCmdEncoder=null,this._paramData=null,this._texture=null,this._x=NaN,this._y=NaN,this._vertices=null,this._uvs=null,this._indices=null,this._matrix=null,this._alpha=NaN,this._color=null,this._blendMode=null,this.vbBuffer=null,this._vbSize=NaN,this.ibBuffer=null,this._ibSize=NaN,this._verticesNum=NaN,this._ibNum=NaN,this._blend_src=0,this._blend_dest=0}v(y,"laya.layagl.cmdNative.DrawTrianglesCmdNative");var t=y.prototype;t.recover=function(){this._texture=null,this._vertices=null,this._uvs=null,this._indices=null,this._matrix=null,g.recover("DrawTrianglesCmd",this)},t._setBlendMode=function(t){switch(t){case"normal":this._blend_src=1,this._blend_dest=771;break;case"add":this._blend_src=1,this._blend_dest=772;break;case"multiply":this._blend_src=774,this._blend_dest=771;break;case"screen":case"light":this._blend_src=1,this._blend_dest=1;break;case"overlay":this._blend_src=1,this._blend_dest=769;break;case"destination-out":this._blend_src=0,this._blend_dest=0;break;case"mask":this._blend_src=0,this._blend_dest=770;break;default:alert("_setBlendMode Unknown type")}},t._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},E(0,t,"vertices",function(){return this._vertices},function(t){this._vertices=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._verticesNum;_++)e[i++]=this._x+t[2*_],e[i++]=this._y+t[2*_+1],i++,i++,i++,i++;z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"cmdID",function(){return"DrawTriangles"}),E(0,t,"matrix",function(){return this._matrix},function(t){this._matrix=t;var e=this._paramData._float32Data;e[y._PARAM_MATRIX_POS_]=t.a,e[y._PARAM_MATRIX_POS_+1]=t.b,e[y._PARAM_MATRIX_POS_+2]=t.c,e[y._PARAM_MATRIX_POS_+3]=t.d,e[y._PARAM_MATRIX_POS_+4]=t.tx,e[y._PARAM_MATRIX_POS_+5]=t.ty,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"texture",function(){return this._texture},function(t){t&&t.url&&(this._texture=t,this._paramData._int32Data[y._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id,z.syncBufferToRenderThread(this._paramData))}),E(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._verticesNum;_++)i++,e[i++]=t+this.vertices[2*_+1],i++,i++,i++,i++;z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._verticesNum;_++)e[i++]=t+this.vertices[2*_],i++,i++,i++,i++,i++;z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"alpha",function(){return this._alpha},function(t){this._alpha=t}),E(0,t,"uvs",function(){return this._uvs},function(t){this._uvs=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._verticesNum;_++)i++,i++,e[i++]=t[2*_],e[i++]=t[2*_+1],i++,i++;z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"indices",function(){return this._indices},function(t){this._indices=t;for(var e=this.ibBuffer._int16Data,i=0,_=0;_<this._ibNum;_++)e[i++]=t[_];z.syncBufferToRenderThread(this.ibBuffer)}),E(0,t,"color",function(){return this._color},function(t){this._color=t}),E(0,t,"blendMode",function(){return this._blendMode},function(t){this._blendMode=t}),y.create=function(t,e,i,_,r,a,n,s,o,h){var u=g.getItemByClass("DrawTrianglesCmd",y);u._graphicsCmdEncoder=this._commandEncoder,y._DRAW_TRIANGLES_CMD_ENCODER_||((y._DRAW_TRIANGLES_CMD_ENCODER_=z.instance.createCommandEncoder(152,32,!0)).save(),y._DRAW_TRIANGLES_CMD_ENCODER_.blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),y._DRAW_TRIANGLES_CMD_ENCODER_.blendFuncByParamData(4*y._PARAM_BLEND_SRC_POS_,4*y._PARAM_BLEND_DEST_POS_),y._DRAW_TRIANGLES_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),y._DRAW_TRIANGLES_CMD_ENCODER_.useVDO(Lt.VDO_MESHQUADTEXTURE),y._DRAW_TRIANGLES_CMD_ENCODER_.setGlobalValueByParamData(Lt.GLOBALVALUE_MATRIX32,7,4*y._PARAM_MATRIX_POS_),y._DRAW_TRIANGLES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),y._DRAW_TRIANGLES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),y._DRAW_TRIANGLES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),y._DRAW_TRIANGLES_CMD_ENCODER_.uniformTextureByParamData(4*y._PARAM_UNIFORMLOCATION_POS_,4*y._PARAM_TEXLOCATION_POS_,4*y._PARAM_TEXTURE_POS_),y._DRAW_TRIANGLES_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_VB_POS_,4*y._PARAM_VB_OFFSET_POS_,4*y._PARAM_VB_SIZE_POS_,4*y._PARAM_IB_POS_,4*y._PARAM_IB_OFFSET_POS_,4*y._PARAM_IB_SIZE_POS_,4*y._PARAM_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_TRIANGLES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_TRIANGLES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),y._DRAW_TRIANGLES_CMD_ENCODER_.restore(),z.syncBufferToRenderThread(y._DRAW_TRIANGLES_CMD_ENCODER_)),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_||((y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_=z.instance.createCommandEncoder(152,32,!0)).save(),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.blendFuncByParamData(4*y._PARAM_BLEND_SRC_POS_,4*y._PARAM_BLEND_DEST_POS_),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.addShaderMacro(Lt.SHADER_MACRO_COLOR_FILTER),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setGlobalValueByParamData(Lt.GLOBALVALUE_COLORFILTER_COLOR,8,4*y._PARAM_FILTER_COLOR_POS_),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setGlobalValueByParamData(Lt.GLOBALVALUE_COLORFILTER_ALPHA,8,4*y._PARAM_FILTER_ALPHA_POS_),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.useVDO(Lt.VDO_MESHQUADTEXTURE),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setGlobalValueByParamData(Lt.GLOBALVALUE_MATRIX32,7,4*y._PARAM_MATRIX_POS_),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformTextureByParamData(4*y._PARAM_UNIFORMLOCATION_POS_,4*y._PARAM_TEXLOCATION_POS_,4*y._PARAM_TEXTURE_POS_),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_VB_POS_,4*y._PARAM_VB_OFFSET_POS_,4*y._PARAM_VB_SIZE_POS_,4*y._PARAM_IB_POS_,4*y._PARAM_IB_OFFSET_POS_,4*y._PARAM_IB_SIZE_POS_,4*y._PARAM_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.restore(),z.syncBufferToRenderThread(y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_)),u._paramData||(u._paramData=new ParamData(152,!0)),u._texture=t,u._x=e,u._y=i,u._vertices=_,u._uvs=r,u._indices=a,u._matrix=n||new S,u._alpha=s,u._color=o,u._blendMode=h;var l=new L,c=W.create(o);l.color(c.arrColor[0],c.arrColor[1],c.arrColor[2],c.arrColor[3]),u._verticesNum=u._vertices.length/2;var f=u._verticesNum;(!u.vbBuffer||u.vbBuffer.getByteLength()<24*f*3)&&(u.vbBuffer=new ParamData(24*f*3,!0)),u._vbSize=24*f*3;var d=u.vbBuffer._float32Data,E=u.vbBuffer._int32Data,A=4294967295;s&&(A=u._mixRGBandAlpha(A,s));for(var D=0,R=0;R<u._verticesNum;R++)d[D++]=e/u._matrix.a+_[2*R],d[D++]=i/u._matrix.d+_[2*R+1],d[D++]=r[2*R],d[D++]=r[2*R+1],E[D++]=A,E[D++]=4294967295;u._ibNum=a.length;var m=u._ibNum;(!u.ibBuffer||u.ibBuffer.getByteLength()<2*m)&&(u.ibBuffer=new ParamData(2*m,!0,!0)),u._ibSize=2*m;for(var T=u.ibBuffer._int16Data,v=0,P=0;P<u._ibNum;P++)T[v++]=a[P];var p=u._paramData._float32Data,C=u._paramData._int32Data;if(C[y._PARAM_UNIFORMLOCATION_POS_]=3,C[y._PARAM_TEXLOCATION_POS_]=33984,C[y._PARAM_TEXTURE_POS_]=t.bitmap._glTexture.id,C[y._PARAM_VB_POS_]=u.vbBuffer.getPtrID(),C[y._PARAM_VB_SIZE_POS_]=u._vbSize,C[y._PARAM_IB_POS_]=u.ibBuffer.getPtrID(),C[y._PARAM_IB_SIZE_POS_]=u._ibSize,C[y._PARAM_VB_OFFSET_POS_]=0,C[y._PARAM_IB_OFFSET_POS_]=0,C[y._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,p[y._PARAM_MATRIX_POS_]=u._matrix.a,p[y._PARAM_MATRIX_POS_+1]=u._matrix.b,p[y._PARAM_MATRIX_POS_+2]=u._matrix.c,p[y._PARAM_MATRIX_POS_+3]=u._matrix.d,p[y._PARAM_MATRIX_POS_+4]=u._matrix.tx,p[y._PARAM_MATRIX_POS_+5]=u._matrix.ty,h?(u._setBlendMode(h),C[y._PARAM_BLEND_SRC_POS_]=u._blend_src,C[y._PARAM_BLEND_DEST_POS_]=u._blend_dest):(C[y._PARAM_BLEND_SRC_POS_]=-1,C[y._PARAM_BLEND_DEST_POS_]=-1),o){D=y._PARAM_FILTER_COLOR_POS_;var M=l._mat;p[D++]=M[0],p[D++]=M[1],p[D++]=M[2],p[D++]=M[3],p[D++]=M[4],p[D++]=M[5],p[D++]=M[6],p[D++]=M[7],p[D++]=M[8],p[D++]=M[9],p[D++]=M[10],p[D++]=M[11],p[D++]=M[12],p[D++]=M[13],p[D++]=M[14],p[D++]=M[15],D=y._PARAM_FILTER_ALPHA_POS_;var O=l._alpha;p[D++]=255*O[0],p[D++]=255*O[1],p[D++]=255*O[2],p[D++]=255*O[3]}return z.syncBufferToRenderThread(u.vbBuffer),z.syncBufferToRenderThread(u.ibBuffer),z.syncBufferToRenderThread(u._paramData),o?u._graphicsCmdEncoder.useCommandEncoder(y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.getPtrID(),u._paramData.getPtrID(),-1):u._graphicsCmdEncoder.useCommandEncoder(y._DRAW_TRIANGLES_CMD_ENCODER_.getPtrID(),u._paramData.getPtrID(),-1),z.syncBufferToRenderThread(u._graphicsCmdEncoder),u},y.ID="DrawTriangles",y._DRAW_TRIANGLES_CMD_ENCODER_=null,y._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_=null,y._PARAM_UNIFORMLOCATION_POS_=0,y._PARAM_TEXLOCATION_POS_=1,y._PARAM_TEXTURE_POS_=2,y._PARAM_VB_POS_=3,y._PARAM_VB_SIZE_POS_=4,y._PARAM_IB_POS_=5,y._PARAM_IB_SIZE_POS_=6,y._PARAM_VB_OFFSET_POS_=7,y._PARAM_IB_OFFSET_POS_=8,y._PARAM_INDEX_ELEMENT_OFFSET_POS_=9,y._PARAM_BLEND_SRC_POS_=10,y._PARAM_BLEND_DEST_POS_=11,y._PARAM_MATRIX_POS_=12,y._PARAM_FILTER_COLOR_POS_=18,y._PARAM_FILTER_ALPHA_POS_=34}(),function(){function e(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}v(e,"laya.webgl.shader.ShaderDefinesBase");var t=e.prototype;return t.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},t.addInt=function(t){return this._value|=t,this._value},t.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},t.isDefine=function(t){return(this._value&t)===t},t.getValue=function(){return this._value},t.setValue=function(t){this._value=t},t.toNameDic=function(){var t=this._int2nameMap[this._value];return t||e._toText(this._value,this._int2name,this._int2nameMap)},e._reg=function(t,e,i,_){_[i[t]=e]=t},e._toText=function(t,e,i){var _=i[t];if(_)return _;for(var r={},a=1,n=0;n<32&&!(t<(a=1<<n));n++)if(t&a){var s=e[a];s&&(r[s]="")}return i[t]=r},e._toInt=function(t,e){for(var i=t.split("."),_=0,r=0,a=i.length;r<a;r++){var n=e[i[r]];if(!n)throw new Error("Defines to int err:"+t+"/"+i[r]);_|=n}return _},e}()),tt=(function(){function y(){this._graphicsCmdEncoder=null,this._graphicsCmdEncoder_lines=null,this._paramData=null,this._x=NaN,this._y=NaN,this._points=null,this._fillColor=null,this._lineColor=null,this._lineWidth=NaN,this._isConvexPolygon=!1,this._vid=0,this._vertNum=0,this._line_vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this.line_ibBuffer=null,this.line_vbBuffer=null,this._ibSize=0,this._vbSize=0,this._line_ibSize=0,this._line_vbSize=0,this._cmdCurrentPos=0,this._linePoints=[],this._line_vbArray=[],this._line_ibArray=[]}v(y,"laya.layagl.cmdNative.DrawPolyCmdNative");var t=y.prototype;t.recover=function(){this._points=null,this._fillColor=null,this._lineColor=null,this._linePoints.length=0,this._line_vbArray.length=0,this._line_ibArray.length=0,g.recover("DrawPolyCmd",this)},E(0,t,"lineColor",function(){return this._lineColor},function(t){if(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=y._DRAW_POLY_LINES_CMD_ENCODER_.getPtrID(),z.syncBufferToRenderThread(this._graphicsCmdEncoder),this._lineColor=t,this._lineColor&&this.line_vbBuffer){for(var e=W.create(this._lineColor).numColor,i=this.line_vbBuffer._int32Data,_=0,r=0;r<this._line_vertNum;r++)_++,_++,i[_++]=e;z.syncBufferToRenderThread(this.line_vbBuffer)}}),E(0,t,"points",function(){return this._points},function(t){this._points=t,this._vertNum=t.length/2;var e=this._vertNum,i=lt.earcut(t,null,2);if(0<i.length){(!this.ibBuffer||this.ibBuffer.getByteLength()<2*i.length)&&(this.ibBuffer=new ParamData(2*i.length,!0,!0)),this._ibSize=2*i.length;for(var _=this.ibBuffer._int16Data,r=0,a=0;a<i.length;a++)_[r++]=i[a]}(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*e*4,!0)),this._vbSize=3*this._vertNum*4;for(var n=W.create(this._fillColor).numColor,s=this.vbBuffer._float32Data,o=this.vbBuffer._int32Data,h=0,u=0;u<this._vertNum;u++)s[h++]=this._points[2*u]+this._x,s[h++]=this._points[2*u+1]+this._y,o[h++]=n;var l=this._paramData._int32Data;if(l[y._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),l[y._PARAM_IB_POS_]=this.ibBuffer.getPtrID(),l[y._PARAM_VB_SIZE_POS_]=this._vbSize,l[y._PARAM_IB_SIZE_POS_]=this._ibSize,z.syncBufferToRenderThread(this.vbBuffer),z.syncBufferToRenderThread(this.ibBuffer),z.syncBufferToRenderThread(this._paramData),this.lineColor){var c;for(this._linePoints.length=0,this._line_ibArray.length=0,u=this._line_vbArray.length=0;u<t.length;u++)this._linePoints.push(t[u]);this._linePoints.push(t[0]),this._linePoints.push(t[1]),Pt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,c=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(c-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;var f=this.line_ibBuffer._int16Data;for(a=r=0;a<3*(this._line_vertNum-2);a++)f[r++]=this._line_ibArray[a];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*c*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var d=W.create(this._lineColor).numColor,E=this.line_vbBuffer._float32Data,A=this.line_vbBuffer._int32Data;for(u=h=0;u<this._line_vertNum;u++)E[h++]=this._line_vbArray[2*u]+this._x,E[h++]=this._line_vbArray[2*u+1]+this._y,A[h++]=d;(l=this._paramData._int32Data)[y._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),l[y._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),l[y._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,l[y._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,z.syncBufferToRenderThread(this.line_vbBuffer),z.syncBufferToRenderThread(this.line_ibBuffer)}}),E(0,t,"cmdID",function(){return"DrawPoly"}),E(0,t,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t;for(var e=W.create(this._fillColor).numColor,i=this.vbBuffer._int32Data,_=0,r=0;r<this._vertNum;r++)_++,_++,i[_++]=e;z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._points[2*_]+this._x,i++,i++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(_=i=0;_<this._line_vertNum;_++)r[i++]=this._line_vbArray[2*_]+this._x,i++,i++;z.syncBufferToRenderThread(this.line_vbBuffer)}z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"isConvexPolygon",function(){return this._isConvexPolygon},function(t){this._isConvexPolygon=t}),E(0,t,"vid",function(){return this._vid},function(t){this._vid=t}),E(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)i++,e[i++]=this._points[2*_+1]+this._y,i++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(_=i=0;_<this._line_vertNum;_++)i++,r[i++]=this._line_vbArray[2*_+1]+this._y,i++;z.syncBufferToRenderThread(this.line_vbBuffer)}z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"lineWidth",function(){return this._lineWidth},function(t){this.lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=y._DRAW_POLY_LINES_CMD_ENCODER_.getPtrID(),z.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=t,this._linePoints.length=0,this._line_ibArray.length=0;for(var e=this._line_vbArray.length=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Pt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);var i=this.line_vbBuffer._float32Data,_=0;for(e=0;e<this._line_vertNum;e++)i[_++]=this._line_vbArray[2*e]+this._x,i[_++]=this._line_vbArray[2*e+1]+this._y,_++;z.syncBufferToRenderThread(this.line_vbBuffer)}),y.create=function(t,e,i,_,r,a,n,s){var o=g.getItemByClass("DrawPolyCmd",y);o._graphicsCmdEncoder=this._commandEncoder,y._DRAW_POLY_CMD_ENCODER_||((y._DRAW_POLY_CMD_ENCODER_=z.instance.createCommandEncoder(168,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),y._DRAW_POLY_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWVG),y._DRAW_POLY_CMD_ENCODER_.useVDO(Lt.VDO_MESHVG),y._DRAW_POLY_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),y._DRAW_POLY_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),y._DRAW_POLY_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),y._DRAW_POLY_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_VB_POS_,4*y._PARAM_VB_OFFSET_POS_,4*y._PARAM_VB_SIZE_POS_,4*y._PARAM_IB_POS_,4*y._PARAM_IB_OFFSET_POS_,4*y._PARAM_IB_SIZE_POS_,4*y._PARAM_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_POLY_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_POLY_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(y._DRAW_POLY_CMD_ENCODER_)),y._DRAW_POLY_LINES_CMD_ENCODER_||((y._DRAW_POLY_LINES_CMD_ENCODER_=z.instance.createCommandEncoder(244,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),y._DRAW_POLY_LINES_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWVG),y._DRAW_POLY_LINES_CMD_ENCODER_.useVDO(Lt.VDO_MESHVG),y._DRAW_POLY_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),y._DRAW_POLY_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),y._DRAW_POLY_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),y._DRAW_POLY_LINES_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_VB_POS_,4*y._PARAM_VB_OFFSET_POS_,4*y._PARAM_VB_SIZE_POS_,4*y._PARAM_IB_POS_,4*y._PARAM_IB_OFFSET_POS_,4*y._PARAM_IB_SIZE_POS_,4*y._PARAM_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),y._DRAW_POLY_LINES_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_LINE_VB_POS_,4*y._PARAM_LINE_VB_OFFSET_POS_,4*y._PARAM_LINE_VB_SIZE_POS_,4*y._PARAM_LINE_IB_POS_,4*y._PARAM_LINE_VB_OFFSET_POS_,4*y._PARAM_LINE_IB_SIZE_POS_,4*y._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(y._DRAW_POLY_LINES_CMD_ENCODER_)),o._paramData||(o._paramData=new ParamData(68,!0)),o._x=t,o._y=e,o._points=i,o._fillColor=_,o._lineColor=r,o._lineWidth=a,o._isConvexPolygon=n,o._vertNum=i.length/2;var h=o._vertNum,u=lt.earcut(i,null,2);if(0<u.length){(!o.ibBuffer||o.ibBuffer.getByteLength()<2*u.length)&&(o.ibBuffer=new ParamData(2*u.length,!0,!0)),o._ibSize=2*u.length;for(var l=o.ibBuffer._int16Data,c=0,f=0;f<u.length;f++)l[c++]=u[f]}var d=W.create(_).numColor;(!o.vbBuffer||o.vbBuffer.getByteLength()<3*o._vertNum*4)&&(o.vbBuffer=new ParamData(3*h*4,!0)),o._vbSize=3*o._vertNum*4;for(var E=o.vbBuffer._float32Data,A=o.vbBuffer._int32Data,D=0,R=0;R<o._vertNum;R++)E[D++]=i[2*R]+t,E[D++]=i[2*R+1]+e,A[D++]=d;for(R=0;R<i.length;R++)o._linePoints.push(i[R]);if(o._linePoints.push(i[0]),o._linePoints.push(i[1]),r){Pt.createLine2(o._linePoints,o._line_ibArray,a,0,o._line_vbArray,!1),o._line_vertNum=o._linePoints.length;var m=o._line_vertNum;(!o.line_ibBuffer||o.line_ibBuffer.getByteLength()<3*(o._line_vertNum-2)*2)&&(o.line_ibBuffer=new ParamData(3*(m-2)*2,!0,!0)),o._line_ibSize=3*(o._line_vertNum-2)*2;var T=o.line_ibBuffer._int16Data;for(f=c=0;f<3*(o._line_vertNum-2);f++)T[c++]=o._line_ibArray[f];(!o.line_vbBuffer||o.line_vbBuffer.getByteLength()<3*o._line_vertNum*4)&&(o.line_vbBuffer=new ParamData(3*m*4,!0)),o._line_vbSize=3*o._line_vertNum*4;var v=W.create(r),P=v.numColor,p=o.line_vbBuffer._float32Data,C=o.line_vbBuffer._int32Data;for(R=D=0;R<o._line_vertNum;R++)p[D++]=o._line_vbArray[2*R]+t,p[D++]=o._line_vbArray[2*R+1]+e,C[D++]=P}else{o._lineWidth=1;for(Pt.createLine2(o._linePoints,o._line_ibArray,o._lineWidth,0,o._line_vbArray,!1),o._line_vertNum=o._linePoints.length,m=o._line_vertNum,(!o.line_ibBuffer||o.line_ibBuffer.getByteLength()<3*(o._line_vertNum-2)*2)&&(o.line_ibBuffer=new ParamData(3*(m-2)*2,!0,!0)),o._line_ibSize=3*(o._line_vertNum-2)*2,T=o.line_ibBuffer._int16Data,f=c=0;f<3*(o._line_vertNum-2);f++)T[c++]=o._line_ibArray[f];for((!o.line_vbBuffer||o.line_vbBuffer.getByteLength()<3*o._line_vertNum*4)&&(o.line_vbBuffer=new ParamData(3*m*4,!0)),o._line_vbSize=3*o._line_vertNum*4,P=(v=W.create("#ffffff")).numColor,p=o.line_vbBuffer._float32Data,C=o.line_vbBuffer._int32Data,R=D=0;R<o._line_vertNum;R++)p[D++]=o._line_vbArray[2*R]+t,p[D++]=o._line_vbArray[2*R+1]+e,C[D++]=P}var M=o._paramData._float32Data,O=o._paramData._int32Data;return O[0]=1,O[1]=32,null==o.ibBuffer?null:(O[y._PARAM_VB_POS_]=o.vbBuffer.getPtrID(),O[y._PARAM_IB_POS_]=o.ibBuffer.getPtrID(),O[y._PARAM_VB_SIZE_POS_]=o._vbSize,O[y._PARAM_IB_SIZE_POS_]=o._ibSize,O[y._PARAM_VB_OFFSET_POS_]=0,O[y._PARAM_IB_OFFSET_POS_]=0,O[y._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,M[y._PARAM_ISCONVEXT_POS_]=n,z.syncBufferToRenderThread(o.vbBuffer),z.syncBufferToRenderThread(o.ibBuffer),O[y._PARAM_LINE_VB_POS_]=o.line_vbBuffer.getPtrID(),O[y._PARAM_LINE_IB_POS_]=o.line_ibBuffer.getPtrID(),O[y._PARAM_LINE_VB_SIZE_POS_]=o._line_vbSize,O[y._PARAM_LINE_IB_SIZE_POS_]=o._line_ibSize,O[y._PARAM_LINE_VB_OFFSET_POS_]=0,O[y._PARAM_LINE_IB_OFFSET_POS_]=0,O[y._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,z.syncBufferToRenderThread(o.line_vbBuffer),z.syncBufferToRenderThread(o.line_ibBuffer),z.syncBufferToRenderThread(o._paramData),o._cmdCurrentPos=r?o._graphicsCmdEncoder.useCommandEncoder(y._DRAW_POLY_LINES_CMD_ENCODER_.getPtrID(),o._paramData.getPtrID(),-1):o._graphicsCmdEncoder.useCommandEncoder(y._DRAW_POLY_CMD_ENCODER_.getPtrID(),o._paramData.getPtrID(),-1),z.syncBufferToRenderThread(o._graphicsCmdEncoder),o)},y.ID="DrawPoly",y._DRAW_POLY_CMD_ENCODER_=null,y._DRAW_POLY_LINES_CMD_ENCODER_=null,y._PARAM_VB_POS_=2,y._PARAM_IB_POS_=3,y._PARAM_VB_SIZE_POS_=4,y._PARAM_IB_SIZE_POS_=5,y._PARAM_LINE_VB_POS_=6,y._PARAM_LINE_IB_POS_=7,y._PARAM_LINE_VB_SIZE_POS_=8,y._PARAM_LINE_IB_SIZE_POS_=9,y._PARAM_ISCONVEXT_POS_=10,y._PARAM_VB_OFFSET_POS_=11,y._PARAM_IB_OFFSET_POS_=12,y._PARAM_LINE_VB_OFFSET_POS_=13,y._PARAM_LINE_IB_OFFSET_POS_=14,y._PARAM_INDEX_ELEMENT_OFFSET_POS_=15,y._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=16}(),function(){function t(){}v(t,"laya.webgl.shader.ShaderValue")}(),function(){function t(){}v(t,"laya.webgl.resource.ICharRender");var e=t.prototype;return e.getWidth=function(t){return 0},e.scale=function(t,e){},e.getCharBmp=function(t,e,i,_,r,a,n,s,o,h){return null},t}()),et=function(){function t(){}return v(t,"laya.layagl.LayaGLRunner"),t.uploadShaderUniforms=function(t,e,i,_){for(var r=i._data,a=e.getArrayData(),n=0,s=0,o=a.length;s<o;s++){var h=a[s];if(_||-1!==h.textureID){var u=r[h.dataOffset];null!=u&&(n+=h.fun.call(h.caller,h,u))}}return n},t.uploadCustomUniform=function(t,e,i,_){var r=0,a=e[i];return a&&null!=_&&(r+=a.fun.call(a.caller,a,_)),r},t.uploadShaderUniformsForNative=function(t,e,i){var _=0;0<=i._runtimeCopyValues.length&&(_=1);var r=i._data;return t.uploadShaderUniforms(e,r,_)},t}(),it=function(){function n(t,e,i){this.pages=[],this.fontFamily=null,this._slotW=0,this._gridW=0,this._gridNum=0,this._baseSize=0,this._lastSz=0,this._spaceWidthMap=[],this._minScoreID=-1,this._selectedSizeIdx=0,this.margin_left=0,this.margin_top=0,this.margin_bottom=0,this.margin_right=0,this.gcCnt=0,this._textureWidth=gt.textureWidth,this.fontFamily=t,this.margin_top=this.margin_left=this.margin_right=this.margin_bottom=i,this._baseSize=Math.floor(e/gt.gridSize)*gt.gridSize,this._selectedSizeIdx=e-this._baseSize|0,this._slotW=Math.ceil(e/gt.gridSize)*gt.gridSize,this._gridW=Math.floor(this._textureWidth/this._slotW),this._gridW<=0&&console.error("文字太大,需要修改texture大小"),this._gridNum=this._gridW*this._gridW,console.log("gridInfo:slotW="+this._slotW+",gridw="+this._gridW+",gridNum="+this._gridNum+",textureW="+this._textureWidth)}v(n,"laya.webgl.resource.CharPages");var t=n.prototype;return t.getWidth=function(t){return n.charRender.getWidth(t)},t.selectSize=function(t,e){this._selectedSizeIdx=e-this._baseSize|0},t.getSpaceChar=function(t){if(this._spaceWidthMap[this._selectedSizeIdx])return this._spaceWidthMap[this._selectedSizeIdx];var e=new nt;return(this._spaceWidthMap[this._selectedSizeIdx]=e).width=this.getWidth(" "),e.isSpace=!0,e},t.getChar=function(t,e,i,_,r,a,n,s){if(" "===t)return this.getSpaceChar(n);var o,h=0<e?t+"_"+e+r:t;_&=16777215,r&=16777215,gt.getFontBmpWithColor&&(h+=16777215===_?"#w":16711680===_?"#b":1048320===_?"#g":255===_?"#r":"#"+_.toString(16)),a&&(h+="B"),s&&(h+=s);for(var u=0,l=this.pages.length;u<l;u++){var c=this.pages[u].charMaps[this._selectedSizeIdx];if(c&&(o=c.get(h)))return n&&o.touch(),o}o=new nt,this._getASlot(o);var f=o.tex.charMaps[this._selectedSizeIdx];!f&&(f=o.tex.charMaps[this._selectedSizeIdx]=new Map),f.set(h,o),n&&o.touch();var d="",E="";gt.getFontBmpWithColor&&(d=((65280&_)+((255&_)<<16)+((16711680&_)>>16)).toString(16),d="#000000".substr(0,7-d.length)+d,e&&(E=((65280&r)+((255&r)<<16)+((16711680&r)>>16)).toString(16),E="#000000".substr(0,7-E.length)+E)),o.height=i;var A=this.getCharBmp(t,gt._curFont,e,d,E,o);o.bmpWidth=A.width,o.bmpHeight=A.height;var D=Math.floor(o.pos/this._gridW),R=o.pos%this._gridW*this._slotW,m=D*this._slotW,T=this._textureWidth,v=R/T,P=m/T,p=(R+A.width)/T,C=(m+A.height)/T,M=o.uv;return M[0]=v,M[1]=P,M[2]=p,M[3]=P,M[4]=p,M[5]=C,M[6]=v,M[7]=C,o.tex.addChar(A,R,m),o},t._getASlot=function(t){for(var e,i=this.pages.length,_=0,r=0;r<i;r++)if(0<=(_=(e=this.pages[r]).findAGrid()))return t.tex=e,void(t.pos=_);if(e=gt.trash.getAPage(this._gridNum),this.pages.push(e),-1==(_=e.findAGrid()))throw"_getASlot error!";t.tex=e,t.pos=_},t.getAllPageScore=function(){for(var t=0,e=this.pages.length,i=x.loopCount,_=0,r=1e4;t<e;t++){var a=this.pages[t];a._scoreTick==i?_+=a._score:a._score=0,a._score<r&&(r=a._score,this._minScoreID=t)}return _},t.removeLRU=function(){var t;if(this._gridNum*this.pages.length-this.getAllPageScore()>=this._gridNum){if(0<=this._minScoreID){console.log("remove font page "+this._minScoreID);var e=(t=this.pages[this._minScoreID])._score;gt.trash.discardPage(t),this.pages[this._minScoreID]=this.pages[this.pages.length-1],this.pages.pop();for(var i=x.loopCount,_=0,r=this.pages.length;_<r&&0<e;_++){e-=(t=this.pages[_]).removeOld(i)}}return this.gcCnt++,!0}return!1},t.getCharBmp=function(t,e,i,_,r,a){return n.charRender.getCharBmp(t,e,i,_,r,a,this.margin_left,this.margin_top,this.margin_right,this.margin_bottom)},n.getBmpSize=function(t){return 1.5*t},n.charRender=null,n}(),_t=(function(){function u(){this._graphicsCmdEncoder=null,this._paramData=null,this._paramID=null,this._x=NaN,this._y=NaN,this._radius=NaN,this._startAngle=NaN,this._endAngle=NaN,this._fillColor=null,this._lineColor=null,this._lineWidth=NaN,this._vertNum=0,this._line_vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this.line_ibBuffer=null,this.line_vbBuffer=null,this._ibSize=0,this._vbSize=0,this._line_ibSize=0,this._line_vbSize=0,this._cmdCurrentPos=0,this._points=[],this._linePoints=[],this._line_vbArray=[],this._line_ibArray=[]}v(u,"laya.layagl.cmdNative.DrawPieCmdNative");var t=u.prototype;t._arc=function(t,e,i,_,r,a,n){void 0===a&&(a=!1),void 0===n&&(n=!0);var s=[];s.push(0),s.push(0);var o,h=0,u=0,l=0,c=0,f=0,d=0,E=0,A=0;if(u=r-_,a)if(Math.abs(u)>=2*Math.PI)u=2*-Math.PI;else for(;0<u;)u-=2*Math.PI;else if(Math.abs(u)>=2*Math.PI)u=2*Math.PI;else for(;u<0;)u+=2*Math.PI;o=u/(A=i<101?Math.max(10,u*i/5):i<201?Math.max(10,u*i/20):Math.max(10,u*i/40))/2,l=Math.abs(4/3*(1-Math.cos(o))/Math.sin(o)),a&&(l=-l);var D=0,R=0;for(E=0;E<=A;E++)h=_+u*(E/A),c=Math.cos(h),d=e+Math.sin(h)*i,(f=t+c*i)==D&&d==R||(s.push(f),s.push(d)),D=f,R=d;return c=Math.cos(r),d=e+Math.sin(r)*i,(f=t+c*i)==D&&d==R||(s.push(f),s.push(d)),s},t._setData=function(t,e,i,_,r,a){this._vertNum=_.length/2;var n=this._vertNum,s=this._vertNum-2;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*s*2)&&(this.ibBuffer=new ParamData(3*s*2,!0,!0)),this._ibSize=3*s*2;for(var o=this.ibBuffer._int16Data,h=0,u=0;u<s;u++)o[h++]=0,o[h++]=u+1+0,o[h++]=u+2+0;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*n*4,!0)),this._vbSize=3*this._vertNum*4;for(var l=W.create(i).numColor,c=this.vbBuffer._float32Data,f=this.vbBuffer._int32Data,d=0,E=0;E<this._vertNum;E++)c[d++]=_[2*E]+t,c[d++]=_[2*E+1]+e,f[d++]=l;var A=0;for(this._linePoints.length=0,this._line_ibArray.length=0,E=this._line_vbArray.length=0;E<_.length;E++)this._linePoints.push(_[E]);if(this._linePoints.push(_[0]),this._linePoints.push(_[1]),r){Pt.createLine2(this._linePoints,this._line_ibArray,a,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,A=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(A-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var D=this.line_ibBuffer._int16Data,R=h=0;R<3*(this._line_vertNum-2);R++)D[h++]=this._line_ibArray[R];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*A*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var m=W.create(r),T=m.numColor,v=this.line_vbBuffer._float32Data,P=this.line_vbBuffer._int32Data;for(E=d=0;E<this._line_vertNum;E++)v[d++]=this._line_vbArray[2*E]+this._x,v[d++]=this._line_vbArray[2*E+1]+this._y,P[d++]=T}else{this._lineWidth=1;for(Pt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,A=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(A-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2,D=this.line_ibBuffer._int16Data,R=h=0;R<3*(this._line_vertNum-2);R++)D[h++]=this._line_ibArray[R];for((!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*A*4,!0)),this._line_vbSize=3*this._line_vertNum*4,T=(m=W.create("#FFFFFF")).numColor,v=this.line_vbBuffer._float32Data,P=this.line_vbBuffer._int32Data,E=d=0;E<this._line_vertNum;E++)v[d++]=this._line_vbArray[2*E]+this._x,v[d++]=this._line_vbArray[2*E+1]+this._y,P[d++]=T}},t._saveToParamData=function(){this._paramData._float32Data;var t=this._paramData._int32Data;t[0]=1,t[1]=32,t[u._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),t[u._PARAM_IB_POS_]=this.ibBuffer.getPtrID(),t[u._PARAM_VB_SIZE_POS_]=this._vbSize,t[u._PARAM_IB_SIZE_POS_]=this._ibSize,t[u._PARAM_VB_OFFSET_POS_]=0,t[u._PARAM_IB_OFFSET_POS_]=0,t[u._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,z.syncBufferToRenderThread(this.vbBuffer),z.syncBufferToRenderThread(this.ibBuffer),t[u._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),t[u._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),t[u._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,t[u._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,t[u._PARAM_LINE_VB_OFFSET_POS_]=0,t[u._PARAM_LINE_IB_OFFSET_POS_]=0,t[u._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,z.syncBufferToRenderThread(this.line_vbBuffer),z.syncBufferToRenderThread(this.line_ibBuffer)},t.recover=function(){this._fillColor=null,this._lineColor=null,this._points.length=0,this._linePoints.length=0,this._line_vbArray.length=0,this._line_ibArray.length=0,g.recover("DrawPieCmd",this)},E(0,t,"lineColor",function(){return this._lineColor},function(t){!this._lineColor&&this._lineWidth&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=u._DRAW_PIE_LINES_CMD_ENCODER_.getPtrID(),z.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineColor=t,this._linePoints.length=0,this._line_ibArray.length=0;for(var e=this._line_vbArray.length=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Pt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var i=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var _=this.line_ibBuffer._int16Data,r=0,a=0;a<3*(this._line_vertNum-2);a++)_[r++]=this._line_ibArray[a];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*i*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var n=W.create(t).numColor,s=this.line_vbBuffer._float32Data,o=this.line_vbBuffer._int32Data,h=0;for(e=0;e<this._line_vertNum;e++)s[h++]=this._line_vbArray[2*e]+this._x,s[h++]=this._line_vbArray[2*e+1]+this._y,o[h++]=n;z.syncBufferToRenderThread(this.line_ibBuffer),z.syncBufferToRenderThread(this.line_vbBuffer)}),E(0,t,"startAngle",function(){return 180*this._startAngle/Math.PI},function(t){this._startAngle=t*Math.PI/180,this._points=this._arc(0,0,this._radius,t*Math.PI/180,this._endAngle),this._setData(this._x,this._y,this._fillColor,this._points,this._lineColor,this._lineWidth),this._saveToParamData(),z.syncBufferToRenderThread(this._paramData)}),E(0,t,"cmdID",function(){return"DrawPie"}),E(0,t,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t;for(var e=W.create(this._fillColor).numColor,i=this.vbBuffer._int32Data,_=0,r=0;r<this._vertNum;r++)_++,_++,i[_++]=e;z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._points[2*_]+this._x,i++,i++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(_=i=0;_<this._line_vertNum;_++)r[i++]=this._line_vbArray[2*_]+this._x,i++,i++;z.syncBufferToRenderThread(this.line_vbBuffer)}z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)i++,e[i++]=this._points[2*_+1]+this._y,i++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(_=i=0;_<this._line_vertNum;_++)i++,r[i++]=this._line_vbArray[2*_+1]+this._y,i++;z.syncBufferToRenderThread(this.line_vbBuffer)}z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"radius",function(){return this._radius},function(t){this._points=this._arc(0,0,t,this._startAngle,this._endAngle),this._setData(this._x,this._y,this._fillColor,this._points,this._lineColor,this._lineWidth),this._saveToParamData(),z.syncBufferToRenderThread(this._paramData)}),E(0,t,"endAngle",function(){return 180*this._endAngle/Math.PI},function(t){this._endAngle=t*Math.PI/180,this._points=this._arc(0,0,this._radius,this._startAngle,t*Math.PI/180),this._setData(this._x,this._y,this._fillColor,this._points,this._lineColor,this._lineWidth),this._saveToParamData(),z.syncBufferToRenderThread(this._paramData)}),E(0,t,"lineWidth",function(){return this._lineWidth},function(t){this.lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=u._DRAW_PIE_LINES_CMD_ENCODER_.getPtrID(),z.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=t,this._linePoints.length=0,this._line_ibArray.length=0;for(var e=this._line_vbArray.length=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Pt.createLine2(this._linePoints,this._line_ibArray,t,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var i=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var _=this.line_ibBuffer._int16Data,r=0,a=0;a<3*(this._line_vertNum-2);a++)_[r++]=this._line_ibArray[a];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*i*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var n=W.create(this.lineColor).numColor,s=this.line_vbBuffer._float32Data,o=this.line_vbBuffer._int32Data,h=0;for(e=0;e<this._line_vertNum;e++)s[h++]=this._line_vbArray[2*e]+this._x,s[h++]=this._line_vbArray[2*e+1]+this._y,o[h++]=n;z.syncBufferToRenderThread(this.line_ibBuffer),z.syncBufferToRenderThread(this.line_vbBuffer)}),u.create=function(t,e,i,_,r,a,n,s,o){var h=g.getItemByClass("DrawPieCmd",u);return h._graphicsCmdEncoder=this._commandEncoder,u._DRAW_PIE_LINES_CMD_ENCODER_||((u._DRAW_PIE_LINES_CMD_ENCODER_=z.instance.createCommandEncoder(244,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),u._DRAW_PIE_LINES_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWVG),u._DRAW_PIE_LINES_CMD_ENCODER_.useVDO(Lt.VDO_MESHVG),u._DRAW_PIE_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),u._DRAW_PIE_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),u._DRAW_PIE_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),u._DRAW_PIE_LINES_CMD_ENCODER_.setMeshExByParamData(4*u._PARAM_VB_POS_,4*u._PARAM_VB_OFFSET_POS_,4*u._PARAM_VB_SIZE_POS_,4*u._PARAM_IB_POS_,4*u._PARAM_IB_OFFSET_POS_,4*u._PARAM_IB_SIZE_POS_,4*u._PARAM_INDEX_ELEMENT_OFFSET_POS_),u._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),u._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),u._DRAW_PIE_LINES_CMD_ENCODER_.setMeshExByParamData(4*u._PARAM_LINE_VB_POS_,4*u._PARAM_LINE_VB_OFFSET_POS_,4*u._PARAM_LINE_VB_SIZE_POS_,4*u._PARAM_LINE_IB_POS_,4*u._PARAM_LINE_IB_OFFSET_POS_,4*u._PARAM_LINE_IB_SIZE_POS_,4*u._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),u._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),u._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(u._DRAW_PIE_LINES_CMD_ENCODER_)),u._DRAW_PIE_CMD_ENCODER_||((u._DRAW_PIE_CMD_ENCODER_=z.instance.createCommandEncoder(168,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),u._DRAW_PIE_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWVG),u._DRAW_PIE_CMD_ENCODER_.useVDO(Lt.VDO_MESHVG),u._DRAW_PIE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),u._DRAW_PIE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),u._DRAW_PIE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),u._DRAW_PIE_CMD_ENCODER_.setMeshExByParamData(4*u._PARAM_VB_POS_,4*u._PARAM_VB_OFFSET_POS_,4*u._PARAM_VB_SIZE_POS_,4*u._PARAM_IB_POS_,4*u._PARAM_IB_OFFSET_POS_,4*u._PARAM_IB_SIZE_POS_,4*u._PARAM_INDEX_ELEMENT_OFFSET_POS_),u._DRAW_PIE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),u._DRAW_PIE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(u._DRAW_PIE_CMD_ENCODER_)),h._paramData||(h._paramData=new ParamData(64,!0)),h._x=t,h._y=e,h._radius=i,h._startAngle=_,h._endAngle=r,h._fillColor=a,h._lineColor=n,h._lineWidth=s,h._points=h._arc(0,0,i,_,r),h._setData(t,e,a,h._points,n,s),h._saveToParamData(),z.syncBufferToRenderThread(h._paramData),h._cmdCurrentPos=n?h._graphicsCmdEncoder.useCommandEncoder(u._DRAW_PIE_LINES_CMD_ENCODER_.getPtrID(),h._paramData.getPtrID(),-1):h._graphicsCmdEncoder.useCommandEncoder(u._DRAW_PIE_CMD_ENCODER_.getPtrID(),h._paramData.getPtrID(),-1),z.syncBufferToRenderThread(h._graphicsCmdEncoder),h},u.ID="DrawPie",u._DRAW_PIE_CMD_ENCODER_=null,u._DRAW_PIE_LINES_CMD_ENCODER_=null,u._PARAM_VB_POS_=2,u._PARAM_IB_POS_=3,u._PARAM_LINE_VB_POS_=4,u._PARAM_LINE_IB_POS_=5,u._PARAM_VB_SIZE_POS_=6,u._PARAM_IB_SIZE_POS_=7,u._PARAM_LINE_VB_SIZE_POS_=8,u._PARAM_LINE_IB_SIZE_POS_=9,u._PARAM_VB_OFFSET_POS_=10,u._PARAM_IB_OFFSET_POS_=11,u._PARAM_LINE_VB_OFFSET_POS_=12,u._PARAM_LINE_IB_OFFSET_POS_=13,u._PARAM_INDEX_ELEMENT_OFFSET_POS_=14,u._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=15}(),function(){function t(){this._nativeVertexArrayObject=null,this._bindedIndexBuffer=null,this._nativeVertexArrayObject=z.instance.createVertexArray()}v(t,"laya.webgl.BufferStateBase");var e=t.prototype;return e.bind=function(){t._curBindedBufferState!==this&&(z.instance.bindVertexArray(this._nativeVertexArrayObject),t._curBindedBufferState=this)},e.unBind=function(){if(t._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";z.instance.bindVertexArray(null),t._curBindedBufferState=null},e.bindForNative=function(){z.instance.bindVertexArray(this._nativeVertexArrayObject),t._curBindedBufferState=this},e.unBindForNative=function(){z.instance.bindVertexArray(null),t._curBindedBufferState=null},e.destroy=function(){z.instance.deleteVertexArray(this._nativeVertexArrayObject)},t._curBindedBufferState=null,t}()),rt=(function(){function D(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._x=NaN,this._y=NaN,this._width=NaN,this._height=NaN,this._fillColor=null,this._lineColor=null,this._lineWidth=NaN,this._line_vertNum=0,this._cmdCurrentPos=0,this._linePoints=[],this._line_ibArray=[],this._line_vbArray=[]}v(D,"laya.layagl.cmdNative.DrawRectCmdNative");var t=D.prototype;t.recover=function(){this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0,this._graphicsCmdEncoder=null,g.recover("DrawRectCmd",this)},E(0,t,"lineColor",function(){return this._lineColor},function(t){this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=D._DRAW_RECT_LINE_CMD_ENCODER_.getPtrID(),z.syncBufferToRenderThread(this._graphicsCmdEncoder),this._lineColor=t;for(var e=this._paramData._int32Data,i=W.create(t).numColor,_=D._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)_++,_++,e[_++]=i;z.syncBufferToRenderThread(this._paramData)}),E(0,t,"cmdID",function(){return"DrawRect"}),E(0,t,"fillColor",function(){return this._fillColor},function(t){if("string"==typeof(this._fillColor=t)){var e=W.create(this._fillColor).numColor,i=this._paramData._int32Data;i[D._PARAM_VB_POS_+4]=e,i[D._PARAM_VB_POS_+10]=e,i[D._PARAM_VB_POS_+16]=e,i[D._PARAM_VB_POS_+22]=e}else(i=this._paramData._int32Data)[D._PARAM_VB_POS_+4]=t,i[D._PARAM_VB_POS_+10]=t,i[D._PARAM_VB_POS_+16]=t,i[D._PARAM_VB_POS_+22]=t;z.syncBufferToRenderThread(this._paramData)}),E(0,t,"width",function(){return this._width},function(t){this._width=t;var e=this._paramData._float32Data;if(e[D._PARAM_VB_POS_+6]=this._x+this._width,e[D._PARAM_VB_POS_+12]=this._x+this._width,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[2]=this._x+this._width,this._linePoints[4]=this._x+this._width,Pt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;for(var i=D._PARAM_LINE_VB_POS_,_=0;_<this._line_vertNum;_++)e[i++]=this._line_vbArray[2*_],e[i++]=this._line_vbArray[2*_+1],i++}z.syncBufferToRenderThread(this._paramData)}),E(0,t,"x",function(){return this._x},function(t){this._x=t;var e=this._paramData._float32Data;if(e[D._PARAM_VB_POS_]=this._x,e[D._PARAM_VB_POS_+6]=this._x+this._width,e[D._PARAM_VB_POS_+12]=this._x+this._width,e[D._PARAM_VB_POS_+18]=this._x,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[0]=this._x,this._linePoints[2]=this._x+this._width,this._linePoints[4]=this._x+this._width,this._linePoints[6]=this._x,this._linePoints[8]=this._x,Pt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var i=D._PARAM_LINE_VB_POS_,_=0;_<this._line_vertNum;_++)e[i++]=this._line_vbArray[2*_],e[i++]=this._line_vbArray[2*_+1],i++}z.syncBufferToRenderThread(this._paramData)}),E(0,t,"y",function(){return this._y},function(t){this._y=t;var e=this._paramData._float32Data;if(e[D._PARAM_VB_POS_+1]=this._y,e[D._PARAM_VB_POS_+7]=this._y,e[D._PARAM_VB_POS_+13]=this._y+this._height,e[D._PARAM_VB_POS_+19]=this._y+this._height,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[1]=this._y,this._linePoints[3]=this._y,this._linePoints[5]=this._y+this._height,this._linePoints[7]=this._y+this._height,this._linePoints[9]=this._y-this._lineWidth/2,Pt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var i=D._PARAM_LINE_VB_POS_,_=0;_<this._line_vertNum;_++)e[i++]=this._line_vbArray[2*_],e[i++]=this._line_vbArray[2*_+1],i++}z.syncBufferToRenderThread(this._paramData)}),E(0,t,"height",function(){return this._height},function(t){this._height=t;var e=this._paramData._float32Data;if(e[D._PARAM_VB_POS_+13]=this._y+this._height,e[D._PARAM_VB_POS_+19]=this._y+this._height,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[5]=this._y+this._height,this._linePoints[7]=this._y+this._height,Pt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var i=D._PARAM_LINE_VB_POS_,_=0;_<this._line_vertNum;_++)e[i++]=this._line_vbArray[2*_],e[i++]=this._line_vbArray[2*_+1],i++}z.syncBufferToRenderThread(this._paramData)}),E(0,t,"lineWidth",function(){return this._lineWidth},function(t){this.lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=D._DRAW_RECT_LINE_CMD_ENCODER_.getPtrID(),z.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=t,this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[9]=this._y-this._lineWidth/2,Pt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;for(var e=this._paramData._float32Data,i=D._PARAM_LINE_VB_POS_,_=0;_<this._line_vertNum;_++)e[i++]=this._line_vbArray[2*_],e[i++]=this._line_vbArray[2*_+1],i++;z.syncBufferToRenderThread(this._paramData)}),D.create=function(t,e,i,_,r,a,n){var s=g.getItemByClass("DrawRectCmd",D);s._graphicsCmdEncoder=this._commandEncoder,D._DRAW_RECT_LINE_CMD_ENCODER_||((D._DRAW_RECT_LINE_CMD_ENCODER_=z.instance.createCommandEncoder(300,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),D._DRAW_RECT_LINE_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),D._DRAW_RECT_LINE_CMD_ENCODER_.useVDO(Lt.VDO_MESHQUADTEXTURE),D._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),D._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),D._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),D._DRAW_RECT_LINE_CMD_ENCODER_.setRectMeshByParamData(4*D._PARAM_RECT_NUM_POS_,4*D._PARAM_VB_POS_,4*D._PARAM_VB_SIZE_POS_),D._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),D._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),D._DRAW_RECT_LINE_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWVG),D._DRAW_RECT_LINE_CMD_ENCODER_.useVDO(Lt.VDO_MESHVG),D._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),D._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),D._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),D._DRAW_RECT_LINE_CMD_ENCODER_.setMeshByParamData(4*D._PARAM_LINE_VB_POS_,4*D._PARAM_LINE_VB_OFFSET_POS_,4*D._PARAM_LINE_VB_SIZE_POS_,4*D._PARAM_LINE_IB_POS_,4*D._PARAM_LINE_IB_OFFSET_POS_,4*D._PARAM_LINE_IB_SIZE_POS_,4*D._PARAM_LINE_IBELEMENT_OFFSET_POS_),D._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),D._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(D._DRAW_RECT_LINE_CMD_ENCODER_)),D._DRAW_RECT_CMD_ENCODER_||((D._DRAW_RECT_CMD_ENCODER_=z.instance.createCommandEncoder(152,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),D._DRAW_RECT_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),D._DRAW_RECT_CMD_ENCODER_.useVDO(Lt.VDO_MESHQUADTEXTURE),D._DRAW_RECT_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),D._DRAW_RECT_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),D._DRAW_RECT_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),D._DRAW_RECT_CMD_ENCODER_.setRectMeshByParamData(4*D._PARAM_RECT_NUM_POS_,4*D._PARAM_VB_POS_,4*D._PARAM_VB_SIZE_POS_),D._DRAW_RECT_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),D._DRAW_RECT_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(D._DRAW_RECT_CMD_ENCODER_)),s._paramData||(s._paramData=new ParamData(292,!0)),s._x=t,s._y=e,s._width=i,s._height=_,s._fillColor=r,s._lineColor=a,s._lineWidth=n;var o=W.create(r).numColor,h=s._paramData._float32Data,u=s._paramData._int32Data;u[D._PARAM_RECT_NUM_POS_]=1,u[D._PARAM_VB_SIZE_POS_]=96;var l=D._PARAM_VB_POS_;if(h[l++]=t,h[l++]=e,h[l++]=0,h[l++]=0,u[l++]=o,h[l++]=4294967295,h[l++]=t+i,h[l++]=e,h[l++]=0,h[l++]=0,u[l++]=o,h[l++]=4294967295,h[l++]=t+i,h[l++]=e+_,h[l++]=0,h[l++]=0,u[l++]=o,h[l++]=4294967295,h[l++]=t,h[l++]=e+_,h[l++]=0,h[l++]=0,u[l++]=o,h[l++]=4294967295,s._linePoints.push(t),s._linePoints.push(e),s._linePoints.push(t+i),s._linePoints.push(e),s._linePoints.push(t+i),s._linePoints.push(e+_),s._linePoints.push(t),s._linePoints.push(e+_),s._linePoints.push(t),s._linePoints.push(e-n/2),a){Pt.createLine2(s._linePoints,s._line_ibArray,n,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,u[D._PARAM_LINE_VB_SIZE_POS_]=120;var c=W.create(a),f=c.numColor;l=D._PARAM_LINE_VB_POS_;for(var d=0;d<s._line_vertNum;d++)h[l++]=s._line_vbArray[2*d],h[l++]=s._line_vbArray[2*d+1],u[l++]=f;u[D._PARAM_LINE_IB_SIZE_POS_]=2*s._line_ibArray.length;var E=s._paramData._int16Data;l=2*D._PARAM_LINE_IB_POS_;for(var A=0;A<s._line_ibArray.length;A++)E[l++]=s._line_ibArray[A]}else{s._lineWidth=1;for(Pt.createLine2(s._linePoints,s._line_ibArray,s._lineWidth,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,u[D._PARAM_LINE_VB_SIZE_POS_]=120,f=(c=W.create("#ffffff")).numColor,l=D._PARAM_LINE_VB_POS_,d=0;d<s._line_vertNum;d++)h[l++]=s._line_vbArray[2*d],h[l++]=s._line_vbArray[2*d+1],u[l++]=f;for(u[D._PARAM_LINE_IB_SIZE_POS_]=2*s._line_ibArray.length,E=s._paramData._int16Data,l=2*D._PARAM_LINE_IB_POS_,A=0;A<s._line_ibArray.length;A++)E[l++]=s._line_ibArray[A]}return u[D._PARAM_LINE_VB_OFFSET_POS_]=0,u[D._PARAM_LINE_IB_OFFSET_POS_]=0,u[D._PARAM_LINE_IBELEMENT_OFFSET_POS_]=0,z.syncBufferToRenderThread(s._paramData),s._cmdCurrentPos=a?s._graphicsCmdEncoder.useCommandEncoder(D._DRAW_RECT_LINE_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1):s._graphicsCmdEncoder.useCommandEncoder(D._DRAW_RECT_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1),z.syncBufferToRenderThread(s._graphicsCmdEncoder),s},D.ID="DrawRect",D._DRAW_RECT_CMD_ENCODER_=null,D._DRAW_RECT_LINE_CMD_ENCODER_=null,D._PARAM_RECT_NUM_POS_=0,D._PARAM_VB_SIZE_POS_=1,D._PARAM_VB_POS_=2,D._PARAM_LINE_VB_SIZE_POS_=26,D._PARAM_LINE_VB_POS_=27,D._PARAM_LINE_IB_SIZE_POS_=57,D._PARAM_LINE_IB_POS_=58,D._PARAM_LINE_VB_OFFSET_POS_=70,D._PARAM_LINE_IB_OFFSET_POS_=71,D._PARAM_LINE_IBELEMENT_OFFSET_POS_=72}(),function(){var R,i;function m(t,e,i,_){var r=this;function a(t){var e=[],i=new R(e);return r._compileToTree(i,t.split("\n"),0,e,_),i}var n=s.now();this._VS=a(t),this._PS=a(e),this._nameMap=i,2<s.now()-n&&console.log("ShaderCompile use time:"+(s.now()-n)+"  size:"+t.length+"/"+e.length)}v(m,"laya.webgl.utils.ShaderCompile");var t=m.prototype;return t._compileToTree=function(t,e,i,_,r){var a,n,s,o,h,u,l,c=0,f=0,d=0,E=0;for(f=i;f<e.length;f++)if(!((s=e[f]).length<1)&&0!==(c=s.indexOf("//"))){if(0<=c&&(s=s.substr(0,c)),a=l||new R(_),l=null,a.text=s,a.noCompile=!0,0<=(c=s.indexOf("#"))){for(o="#",E=c+1,d=s.length;E<d;E++){var A=s.charAt(E);if(" "===A||"\t"===A||"?"===A)break;o+=A}switch(a.name=o){case"#ifdef":case"#ifndef":if(a.src=s,a.noCompile=null!=s.match(/[!&|()=<>]/),a.noCompile?console.log("function():Boolean{return "+s.substr(c+a.name.length)+"}"):(u=s.replace(/^\s*/,"").split(/\s+/),a.setCondition(u[1],"#ifdef"===o?1:2),a.text="//"+a.text),a.setParent(t),t=a,r)for(u=s.substr(E).split(m._splitToWordExps3),E=0;E<u.length;E++)(s=u[E]).length&&(r[s]=!0);continue;case"#if":if(a.src=s,a.noCompile=!0,a.setParent(t),t=a,r)for(u=s.substr(E).split(m._splitToWordExps3),E=0;E<u.length;E++)(s=u[E]).length&&"defined"!=s&&(r[s]=!0);continue;case"#else":a.src=s,n=(t=t.parent).childs[t.childs.length-1],a.noCompile=n.noCompile,a.noCompile||(a.condition=n.condition,a.conditionType=1==n.conditionType?2:1,a.text="//"+a.text+" "+n.text+" "+a.conditionType),a.setParent(t),t=a;continue;case"#endif":n=(t=t.parent).childs[t.childs.length-1],a.noCompile=n.noCompile,a.noCompile||(a.text="//"+a.text),a.setParent(t);continue;case"#include":u=m.splitToWords(s,null);var D=m.includes[u[1]];if(!D)throw"ShaderCompile error no this include file:"+u[1];if((c=u[0].indexOf("?"))<0){a.setParent(t),s=D.getWith("with"==u[2]?u[3]:null),this._compileToTree(a,s.split("\n"),0,_,r),a.text="";continue}a.setCondition(u[0].substr(c+1),1),a.text=D.getWith("with"==u[2]?u[3]:null);break;case"#import":h=(u=m.splitToWords(s,null))[1],_.push({node:a,file:m.includes[h],ofs:a.text.length});continue}}else{if((n=t.childs[t.childs.length-1])&&!n.name){0<_.length&&m.splitToWords(s,n),l=a,n.text+="\n"+s;continue}0<_.length&&m.splitToWords(s,a)}a.setParent(t)}},t.createShader=function(t,e,i,_){var r={},a="";if(t)for(var n in t)a+="#define "+n+"\n",r[n]=!0;var s=this._VS.toscript(r,[]),o=this._PS.toscript(r,[]);return(i||$t.create)(a+s.join("\n"),a+o.join("\n"),e,this._nameMap,_)},m._parseOne=function(t,e,i,_,r,a){var n={type:m.shaderParamsMap[i[_+1]],name:i[_+2],size:isNaN(parseInt(i[_+3]))?1:parseInt(i[_+3])};return a&&("attribute"==r?t.push(n):e.push(n)),":"==i[_+3]&&(n.type=i[_+4],_+=2),_+=2},m.addInclude=function(t,e){if(!e||0===e.length)throw new Error("add shader include file err:"+t);if(m.includes[t])throw new Error("add shader include file err, has add:"+t);m.includes[t]=new i(e)},m.preGetParams=function(t,e){var i=[t,e],_={},r=[],a=[],n={},s=[];_.attributes=r,_.uniforms=a,_.defines=n;for(var o=0,h=0,u=0;u<2;u++){i[u]=i[u].replace(m._removeAnnotation,"");var l,c=i[u].match(m._reg);for(o=0,h=c.length;o<h;o++){var f=c[o];if("attribute"==f||"uniform"==f)o=m._parseOne(r,a,c,o,f,!0);else{if("#define"==f){s[f=c[++o]]=1;continue}if("#ifdef"==f){n[l=c[++o]]=n[l]||[];for(o++;o<h;o++)if("attribute"==(f=c[o])||"uniform"==f)o=m._parseOne(r,a,c,o,f,s[l]);else if("#else"==f)for(o++;o<h;o++)if("attribute"==(f=c[o])||"uniform"==f)o=m._parseOne(r,a,c,o,f,!s[l]);else if("#endif"==f)break}}}}return _},m.splitToWords=function(t,e){for(var i,_,r=[],a=-1,n=0,s=t.length;n<s;n++)if(i=t.charAt(n),0<=" \t=+-*/&%!<>()'\",;".indexOf(i)){if(0<=a&&1<n-a&&(_=t.substr(a,n-a),r.push(_)),'"'==i||"'"==i){var o=t.indexOf(i,n+1);if(o<0)throw"Sharder err:"+t;r.push(t.substr(n+1,o-n-1)),n=o,a=-1;continue}"("==i&&e&&0<r.length&&(_=r[r.length-1]+";","vec4;main;".indexOf(_)<0&&(e.useFuns+=_)),a=-1}else a<0&&(a=n);return a<s&&1<s-a&&(_=t.substr(a,s-a),r.push(_)),r},m.IFDEF_NO=0,m.IFDEF_YES=1,m.IFDEF_ELSE=2,m.IFDEF_PARENT=3,m._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),m._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),m._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),m.includes={},n(m,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),m.__init$=function(){R=function(){function i(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}v(i,"");var t=i.prototype;return t.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},t.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},t.toscript=function(t,e){return this._toscript(t,e,++i.__id)},t._toscript=function(_,r,a){if(this.childs.length<1&&!this.text)return r;r.length;if(this.condition){var t=!!this.condition.call(_);if(2===this.conditionType&&(t=!t),!t)return r}if(this.text&&r.push(this.text),0<this.childs.length&&this.childs.forEach(function(t,e,i){t._toscript(_,r,a)}),0<this.includefiles.length&&0<this.useFuns.length)for(var e,i=0,n=this.includefiles.length;i<n;i++)this.includefiles[i].curUseID!=a&&0<(e=this.includefiles[i].file.getFunsScript(this.useFuns)).length&&(this.includefiles[i].curUseID=a,r[0]=e+r[0]);return r},i.__id=1,i}(),i=function(){function t(t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=t;for(var e=0,i=0,_=0;!((e=t.indexOf("#begin",e))<0);){for(_=e+5;!((_=t.indexOf("#end",_))<0)&&"i"===t.charAt(_+4);)_+=5;if(_<0)throw"add include err,no #end:"+t;i=t.indexOf("\n",e);var r=m.splitToWords(t.substr(e,i-e),null);"code"==r[1]?this.codes[r[2]]=t.substr(i+1,_-i-1):"function"==r[1]&&(i=t.indexOf("function",e),i+="function".length,this.funs[r[3]]=t.substr(i+1,_-i-1),this.funnames+=r[3]+";"),e=_+1}}v(t,"");var e=t.prototype;return e.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},e.getFunsScript=function(t){var e="";for(var i in this.funs)0<=t.indexOf(i+";")&&(e+=this.funs[i]);return e},t}()},m}()),at=(function(){function o(){this._graphicsCmdEncoder=null,this._index=0,this._text=null,this._x=NaN,this._y=NaN,this._font=null,this._color=null,this._textAlign=null,this._draw_texture_cmd_encoder_=z.instance.createCommandEncoder(64,32,!0)}v(o,"laya.layagl.cmdNative.FillTextCmdNative");var t=o.prototype;t.createFillText=function(u,t,e,i,_,r,a){W.create(r).numColor;var n={};n._curMat=new S,n._italicDeg=0,n._drawTextureUseColor=4294967295,n.fillStyle=r,n._fillColor=4294967295,n.setFillColor=function(t){n._fillColor=t},n.getFillColor=function(){return n._fillColor},n.mixRGBandAlpha=function(t){return t},n._drawTextureM=function(t,e,i,_,r,a,n,s){u.blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),u.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),u.useVDO(Lt.VDO_MESHQUADTEXTURE),u.uniformEx(Lt.GLOBALVALUE_VIEWS,0),u.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),u.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),u.uniformTexture(3,33984,t.bitmap._glTexture);var o=new Float32Array([e,i,s[0],s[1],0,0,e+_,i,s[2],s[3],0,0,e+_,i+r,s[4],s[5],0,0,e,i+r,s[6],s[7],0,0]),h=new Int32Array(o.buffer);h[4]=h[10]=h[16]=h[22]=4294967295,h[5]=h[11]=h[17]=h[23]=4294967295,u.setRectMesh(1,o,o.length),u.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),u.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(u)},o.cbook.filltext_native(n,t,null,e,i,_,r,null,0,a)},t.recover=function(){this._graphicsCmdEncoder=null,g.recover("FillTextCmd",this)},E(0,t,"text",function(){return this._text},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._text=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),z.syncBufferToRenderThread(e)}),E(0,t,"cmdID",function(){return"FillText"}),E(0,t,"font",function(){return this._font},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._font=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),z.syncBufferToRenderThread(e)}),E(0,t,"color",function(){return this._color},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._color=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),z.syncBufferToRenderThread(e)}),E(0,t,"textAlign",function(){return this._textAlign},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._textAlign=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),z.syncBufferToRenderThread(e)}),E(0,t,"x",function(){return this._x},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._x=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),z.syncBufferToRenderThread(e)}),E(0,t,"y",function(){return this._y},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._y=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),z.syncBufferToRenderThread(e)}),o.create=function(t,e,i,_,r,a){o.cbook||new Error("Error:charbook not create!");var n=g.getItemByClass("FillTextCmd",o),s=n._graphicsCmdEncoder=this._commandEncoder;return n._text=t,n._x=e,n._y=i,n._font=_,n._color=r,n._textAlign=a,n._draw_texture_cmd_encoder_.clearEncoding(),n.createFillText(n._draw_texture_cmd_encoder_,t,e,i,_,r,a),z.syncBufferToRenderThread(n._draw_texture_cmd_encoder_),s.useCommandEncoder(n._draw_texture_cmd_encoder_.getPtrID(),-1,-1),z.syncBufferToRenderThread(s),n},o.ID="FillText",n(o,["cbook",function(){return this.cbook=gt.charbookInst}])}(),function(){function a(){}v(a,"laya.webgl.WebGLContext");var t=a.prototype;return t.getContextAttributes=function(){return null},t.isContextLost=function(){},t.getSupportedExtensions=function(){return null},t.getExtension=function(t){return null},t.activeTexture=function(t){},t.attachShader=function(t,e){},t.bindAttribLocation=function(t,e,i){},t.bindBuffer=function(t,e){},t.bindFramebuffer=function(t,e){},t.bindRenderbuffer=function(t,e){},t.bindTexture=function(t,e){},t.useTexture=function(t){},t.blendColor=function(t,e,i,_){},t.blendEquation=function(t){},t.blendEquationSeparate=function(t,e){},t.blendFunc=function(t,e){},t.blendFuncSeparate=function(t,e,i,_){},t.bufferData=function(t,e,i){},t.bufferSubData=function(t,e,i){},t.checkFramebufferStatus=function(t){return null},t.clear=function(t){},t.clearColor=function(t,e,i,_){},t.clearDepth=function(t){},t.clearStencil=function(t){},t.colorMask=function(t,e,i,_){},t.compileShader=function(t){},t.copyTexImage2D=function(t,e,i,_,r,a,n,s){},t.copyTexSubImage2D=function(t,e,i,_,r,a,n,s){},t.createBuffer=function(){},t.createFramebuffer=function(){},t.createProgram=function(){},t.createRenderbuffer=function(){},t.createShader=function(t){},t.createTexture=function(){return null},t.cullFace=function(t){},t.deleteBuffer=function(t){},t.deleteFramebuffer=function(t){},t.deleteProgram=function(t){},t.deleteRenderbuffer=function(t){},t.deleteShader=function(t){},t.deleteTexture=function(t){},t.depthFunc=function(t){},t.depthMask=function(t){},t.depthRange=function(t,e){},t.detachShader=function(t,e){},t.disable=function(t){},t.disableVertexAttribArray=function(t){},t.drawArrays=function(t,e,i){},t.drawElements=function(t,e,i,_){},t.enable=function(t){},t.enableVertexAttribArray=function(t){},t.finish=function(){},t.flush=function(){},t.framebufferRenderbuffer=function(t,e,i,_){},t.framebufferTexture2D=function(t,e,i,_,r){},t.frontFace=function(t){return null},t.generateMipmap=function(t){return null},t.getActiveAttrib=function(t,e){return null},t.getActiveUniform=function(t,e){return null},t.getAttribLocation=function(t,e){return 0},t.getParameter=function(t){return null},t.getBufferParameter=function(t,e){return null},t.getError=function(){return null},t.getFramebufferAttachmentParameter=function(t,e,i){},t.getProgramParameter=function(t,e){return 0},t.getProgramInfoLog=function(t){return null},t.getRenderbufferParameter=function(t,e){return null},t.getShaderPrecisionFormat=function(t){return null},t.getShaderParameter=function(t,e){},t.getShaderInfoLog=function(t){return null},t.getShaderSource=function(t){return null},t.getTexParameter=function(t,e){},t.getUniform=function(t,e){},t.getUniformLocation=function(t,e){return null},t.getVertexAttrib=function(t,e){return null},t.getVertexAttribOffset=function(t,e){return null},t.hint=function(t,e){},t.isBuffer=function(t){},t.isEnabled=function(t){},t.isFramebuffer=function(t){},t.isProgram=function(t){},t.isRenderbuffer=function(t){},t.isShader=function(t){},t.isTexture=function(t){},t.lineWidth=function(t){},t.linkProgram=function(t){},t.pixelStorei=function(t,e){},t.polygonOffset=function(t,e){},t.readPixels=function(t,e,i,_,r,a,n){},t.renderbufferStorage=function(t,e,i,_){},t.sampleCoverage=function(t,e){},t.scissor=function(t,e,i,_){},t.shaderSource=function(t,e){},t.stencilFunc=function(t,e,i){},t.stencilFuncSeparate=function(t,e,i,_){},t.stencilMask=function(t){},t.stencilMaskSeparate=function(t,e){},t.stencilOp=function(t,e,i){},t.stencilOpSeparate=function(t,e,i,_){},t.texImage2D=function(t){},t.texParameterf=function(t,e,i){},t.texParameteri=function(t,e,i){},t.texSubImage2D=function(t){},t.uniform1f=function(t,e){},t.uniform1fv=function(t,e){},t.uniform1i=function(t,e){},t.uniform1iv=function(t,e){},t.uniform2f=function(t,e,i){},t.uniform2fv=function(t,e){},t.uniform2i=function(t,e,i){},t.uniform2iv=function(t,e){},t.uniform3f=function(t,e,i,_){},t.uniform3fv=function(t,e){},t.uniform3i=function(t,e,i,_){},t.uniform3iv=function(t,e){},t.uniform4f=function(t,e,i,_,r){},t.uniform4fv=function(t,e){},t.uniform4i=function(t,e,i,_,r){},t.uniform4iv=function(t,e){},t.uniformMatrix2fv=function(t,e,i){},t.uniformMatrix3fv=function(t,e,i){},t.uniformMatrix4fv=function(t,e,i){},t.useProgram=function(t){},t.validateProgram=function(t){},t.vertexAttrib1f=function(t,e){},t.vertexAttrib1fv=function(t,e){},t.vertexAttrib2f=function(t,e,i){},t.vertexAttrib2fv=function(t,e){},t.vertexAttrib3f=function(t,e,i,_){},t.vertexAttrib3fv=function(t,e){},t.vertexAttrib4f=function(t,e,i,_,r){},t.vertexAttrib4fv=function(t,e){},t.vertexAttribPointer=function(t,e,i,_,r,a){},t.viewport=function(t,e,i,_){},t.configureBackBuffer=function(t,e,i,_,r){void 0===_&&(_=!0),void 0===r&&(r=!1)},t.compressedTexImage2D=function(t){},t.createVertexArray=function(){throw"not implemented"},t.bindVertexArray=function(t){throw"not implemented"},t.deleteVertexArray=function(t){throw"not implemented"},t.isVertexArray=function(t){throw"not implemented"},a.__init__=function(t){if(a.__init_native(),laya.webgl.WebGLContext._checkExtensions(t),!dt._isWebGL2){f._setupVertexArrayObject&&(s.onMiniGame?f._forceSetupVertexArrayObject(t):f._setupVertexArrayObject(t));var e=(t.rawgl||t).getExtension("OES_vertex_array_object");if(e){console.log("EXT:webgl support OES_vertex_array_object！");var i=t;i.createVertexArray=function(){return e.createVertexArrayOES()},i.bindVertexArray=function(t){e.bindVertexArrayOES(t)},i.deleteVertexArray=function(t){e.deleteVertexArrayOES(t)},i.isVertexArray=function(t){e.isVertexArrayOES(t)}}}},a._getExtension=function(t,e){var i=a._extentionVendorPrefixes;for(var _ in i){var r=t.getExtension(i[_]+e);if(r)return r}return null},a._checkExtensions=function(t){return a._extTextureFilterAnisotropic=a._getExtension(t,"EXT_texture_filter_anisotropic"),a._compressedTextureS3tc=a._getExtension(t,"WEBGL_compressed_texture_s3tc"),a._compressedTexturePvrtc=a._getExtension(t,"WEBGL_compressed_texture_pvrtc"),a._compressedTextureEtc1=a._getExtension(t,"WEBGL_compressed_texture_etc1"),null},a.__init_native=function(){if(c.isConchApp){var t=a;t.useProgram=t.useProgramForNative,t.activeTexture=t.activeTextureForNative,t.bindTexture=t.bindTextureForNative,t.bindVertexArray=t.bindVertexArrayForNative,t.setDepthTest=t.setDepthTestForNative,t.setDepthMask=t.setDepthMaskForNative,t.setDepthFunc=t.setDepthFuncForNative,t.setBlend=t.setBlendForNative,t.setBlendFunc=t.setBlendFuncForNative,t.setCullFace=t.setCullFaceForNative,t.setFrontFace=t.setFrontFaceForNative,t._checkExtensions(s.window.LayaGLContext.instance)}},a.useProgram=function(t,e){return a._useProgram!==e&&(t.useProgram(e),a._useProgram=e,!0)},a.setDepthTest=function(t,e){e!==a._depthTest&&((a._depthTest=e)?t.enable(2929):t.disable(2929))},a.setDepthMask=function(t,e){e!==a._depthMask&&(a._depthMask=e,t.depthMask(e))},a.setDepthFunc=function(t,e){e!==a._depthFunc&&(a._depthFunc=e,t.depthFunc(e))},a.setBlend=function(t,e){e!==a._blend&&((a._blend=e)?t.enable(3042):t.disable(3042))},a.setBlendFunc=function(t,e,i){(e!==a._sFactor||i!==a._dFactor)&&(a._sFactor=e,a._dFactor=i,t.blendFunc(e,i))},a.setCullFace=function(t,e){e!==a._cullFace&&((a._cullFace=e)?t.enable(2884):t.disable(2884))},a.setFrontFace=function(t,e){e!==a._frontFace&&(a._frontFace=e,t.frontFace(e))},a.activeTexture=function(t,e){a._activedTextureID!==e&&(t.activeTexture(e),a._activedTextureID=e)},a.bindTexture=function(t,e,i){a._activeTextures[a._activedTextureID-33984]!==i&&(t.bindTexture(e,i),a._activeTextures[a._activedTextureID-33984]=i)},a.useProgramForNative=function(t,e){return t.useProgram(e),!0},a.setDepthTestForNative=function(t,e){e?t.enable(2929):t.disable(2929)},a.setDepthMaskForNative=function(t,e){t.depthMask(e)},a.setDepthFuncForNative=function(t,e){t.depthFunc(e)},a.setBlendForNative=function(t,e){e?t.enable(3042):t.disable(3042)},a.setBlendFuncForNative=function(t,e,i){t.blendFunc(e,i)},a.setCullFaceForNative=function(t,e){e?t.enable(2884):t.disable(2884)},a.setFrontFaceForNative=function(t,e){t.frontFace(e)},a.activeTextureForNative=function(t,e){t.activeTexture(e)},a.bindTextureForNative=function(t,e,i){t.bindTexture(e,i)},a.bindVertexArrayForNative=function(t,e){t.bindVertexArray(e)},a.DEPTH_BUFFER_BIT=256,a.STENCIL_BUFFER_BIT=1024,a.COLOR_BUFFER_BIT=16384,a.POINTS=0,a.LINES=1,a.LINE_LOOP=2,a.LINE_STRIP=3,a.TRIANGLES=4,a.TRIANGLE_STRIP=5,a.TRIANGLE_FAN=6,a.ZERO=0,a.ONE=1,a.SRC_COLOR=768,a.ONE_MINUS_SRC_COLOR=769,a.SRC_ALPHA=770,a.ONE_MINUS_SRC_ALPHA=771,a.DST_ALPHA=772,a.ONE_MINUS_DST_ALPHA=773,a.DST_COLOR=774,a.ONE_MINUS_DST_COLOR=775,a.SRC_ALPHA_SATURATE=776,a.FUNC_ADD=32774,a.BLEND_EQUATION=32777,a.BLEND_EQUATION_RGB=32777,a.BLEND_EQUATION_ALPHA=34877,a.FUNC_SUBTRACT=32778,a.FUNC_REVERSE_SUBTRACT=32779,a.BLEND_DST_RGB=32968,a.BLEND_SRC_RGB=32969,a.BLEND_DST_ALPHA=32970,a.BLEND_SRC_ALPHA=32971,a.CONSTANT_COLOR=32769,a.ONE_MINUS_CONSTANT_COLOR=32770,a.CONSTANT_ALPHA=32771,a.ONE_MINUS_CONSTANT_ALPHA=32772,a.BLEND_COLOR=32773,a.ARRAY_BUFFER=34962,a.ELEMENT_ARRAY_BUFFER=34963,a.ARRAY_BUFFER_BINDING=34964,a.ELEMENT_ARRAY_BUFFER_BINDING=34965,a.STREAM_DRAW=35040,a.STATIC_DRAW=35044,a.DYNAMIC_DRAW=35048,a.BUFFER_SIZE=34660,a.BUFFER_USAGE=34661,a.CURRENT_VERTEX_ATTRIB=34342,a.FRONT=1028,a.BACK=1029,a.CULL_FACE=2884,a.FRONT_AND_BACK=1032,a.BLEND=3042,a.DITHER=3024,a.STENCIL_TEST=2960,a.DEPTH_TEST=2929,a.SCISSOR_TEST=3089,a.POLYGON_OFFSET_FILL=32823,a.SAMPLE_ALPHA_TO_COVERAGE=32926,a.SAMPLE_COVERAGE=32928,a.NO_ERROR=0,a.INVALID_ENUM=1280,a.INVALID_VALUE=1281,a.INVALID_OPERATION=1282,a.OUT_OF_MEMORY=1285,a.CW=2304,a.CCW=2305,a.LINE_WIDTH=2849,a.ALIASED_POINT_SIZE_RANGE=33901,a.ALIASED_LINE_WIDTH_RANGE=33902,a.CULL_FACE_MODE=2885,a.FRONT_FACE=2886,a.DEPTH_RANGE=2928,a.DEPTH_WRITEMASK=2930,a.DEPTH_CLEAR_VALUE=2931,a.DEPTH_FUNC=2932,a.STENCIL_CLEAR_VALUE=2961,a.STENCIL_FUNC=2962,a.STENCIL_FAIL=2964,a.STENCIL_PASS_DEPTH_FAIL=2965,a.STENCIL_PASS_DEPTH_PASS=2966,a.STENCIL_REF=2967,a.STENCIL_VALUE_MASK=2963,a.STENCIL_WRITEMASK=2968,a.STENCIL_BACK_FUNC=34816,a.STENCIL_BACK_FAIL=34817,a.STENCIL_BACK_PASS_DEPTH_FAIL=34818,a.STENCIL_BACK_PASS_DEPTH_PASS=34819,a.STENCIL_BACK_REF=36003,a.STENCIL_BACK_VALUE_MASK=36004,a.STENCIL_BACK_WRITEMASK=36005,a.VIEWPORT=2978,a.SCISSOR_BOX=3088,a.COLOR_CLEAR_VALUE=3106,a.COLOR_WRITEMASK=3107,a.UNPACK_ALIGNMENT=3317,a.PACK_ALIGNMENT=3333,a.MAX_TEXTURE_SIZE=3379,a.MAX_VIEWPORT_DIMS=3386,a.SUBPIXEL_BITS=3408,a.RED_BITS=3410,a.GREEN_BITS=3411,a.BLUE_BITS=3412,a.ALPHA_BITS=3413,a.DEPTH_BITS=3414,a.STENCIL_BITS=3415,a.POLYGON_OFFSET_UNITS=10752,a.POLYGON_OFFSET_FACTOR=32824,a.TEXTURE_BINDING_2D=32873,a.SAMPLE_BUFFERS=32936,a.SAMPLES=32937,a.SAMPLE_COVERAGE_VALUE=32938,a.SAMPLE_COVERAGE_INVERT=32939,a.NUM_COMPRESSED_TEXTURE_FORMATS=34466,a.COMPRESSED_TEXTURE_FORMATS=34467,a.DONT_CARE=4352,a.FASTEST=4353,a.NICEST=4354,a.GENERATE_MIPMAP_HINT=33170,a.BYTE=5120,a.UNSIGNED_BYTE=5121,a.SHORT=5122,a.UNSIGNED_SHORT=5123,a.INT=5124,a.UNSIGNED_INT=5125,a.FLOAT=5126,a.DEPTH_COMPONENT=6402,a.ALPHA=6406,a.RGB=6407,a.RGBA=6408,a.LUMINANCE=6409,a.LUMINANCE_ALPHA=6410,a.UNSIGNED_SHORT_4_4_4_4=32819,a.UNSIGNED_SHORT_5_5_5_1=32820,a.UNSIGNED_SHORT_5_6_5=33635,a.FRAGMENT_SHADER=35632,a.VERTEX_SHADER=35633,a.MAX_VERTEX_ATTRIBS=34921,a.MAX_VERTEX_UNIFORM_VECTORS=36347,a.MAX_VARYING_VECTORS=36348,a.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,a.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,a.MAX_TEXTURE_IMAGE_UNITS=34930,a.MAX_FRAGMENT_UNIFORM_VECTORS=36349,a.SHADER_TYPE=35663,a.DELETE_STATUS=35712,a.LINK_STATUS=35714,a.VALIDATE_STATUS=35715,a.ATTACHED_SHADERS=35717,a.ACTIVE_UNIFORMS=35718,a.ACTIVE_ATTRIBUTES=35721,a.SHADING_LANGUAGE_VERSION=35724,a.CURRENT_PROGRAM=35725,a.NEVER=512,a.LESS=513,a.EQUAL=514,a.LEQUAL=515,a.GREATER=516,a.NOTEQUAL=517,a.GEQUAL=518,a.ALWAYS=519,a.KEEP=7680,a.REPLACE=7681,a.INCR=7682,a.DECR=7683,a.INVERT=5386,a.INCR_WRAP=34055,a.DECR_WRAP=34056,a.VENDOR=7936,a.RENDERER=7937,a.VERSION=7938,a.NEAREST=9728,a.LINEAR=9729,a.NEAREST_MIPMAP_NEAREST=9984,a.LINEAR_MIPMAP_NEAREST=9985,a.NEAREST_MIPMAP_LINEAR=9986,a.LINEAR_MIPMAP_LINEAR=9987,a.TEXTURE_MAG_FILTER=10240,a.TEXTURE_MIN_FILTER=10241,a.TEXTURE_WRAP_S=10242,a.TEXTURE_WRAP_T=10243,a.TEXTURE_2D=3553,a.TEXTURE_3D=32879,a.TEXTURE=5890,a.TEXTURE_CUBE_MAP=34067,a.TEXTURE_BINDING_CUBE_MAP=34068,a.TEXTURE_CUBE_MAP_POSITIVE_X=34069,a.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,a.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,a.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,a.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,a.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,a.MAX_CUBE_MAP_TEXTURE_SIZE=34076,a.TEXTURE0=33984,a.TEXTURE1=33985,a.TEXTURE2=33986,a.TEXTURE3=33987,a.TEXTURE4=33988,a.TEXTURE5=33989,a.TEXTURE6=33990,a.TEXTURE7=33991,a.TEXTURE8=33992,a.TEXTURE9=33993,a.TEXTURE10=33994,a.TEXTURE11=33995,a.TEXTURE12=33996,a.TEXTURE13=33997,a.TEXTURE14=33998,a.TEXTURE15=33999,a.TEXTURE16=34e3,a.TEXTURE17=34001,a.TEXTURE18=34002,a.TEXTURE19=34003,a.TEXTURE20=34004,a.TEXTURE21=34005,a.TEXTURE22=34006,a.TEXTURE23=34007,a.TEXTURE24=34008,a.TEXTURE25=34009,a.TEXTURE26=34010,a.TEXTURE27=34011,a.TEXTURE28=34012,a.TEXTURE29=34013,a.TEXTURE30=34014,a.TEXTURE31=34015,a.ACTIVE_TEXTURE=34016,a.REPEAT=10497,a.CLAMP_TO_EDGE=33071,a.MIRRORED_REPEAT=33648,a.FLOAT_VEC2=35664,a.FLOAT_VEC3=35665,a.FLOAT_VEC4=35666,a.INT_VEC2=35667,a.INT_VEC3=35668,a.INT_VEC4=35669,a.BOOL=35670,a.BOOL_VEC2=35671,a.BOOL_VEC3=35672,a.BOOL_VEC4=35673,a.FLOAT_MAT2=35674,a.FLOAT_MAT3=35675,a.FLOAT_MAT4=35676,a.SAMPLER_2D=35678,a.SAMPLER_CUBE=35680,a.VERTEX_ATTRIB_ARRAY_ENABLED=34338,a.VERTEX_ATTRIB_ARRAY_SIZE=34339,a.VERTEX_ATTRIB_ARRAY_STRIDE=34340,a.VERTEX_ATTRIB_ARRAY_TYPE=34341,a.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,a.VERTEX_ATTRIB_ARRAY_POINTER=34373,a.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,a.COMPILE_STATUS=35713,a.LOW_FLOAT=36336,a.MEDIUM_FLOAT=36337,a.HIGH_FLOAT=36338,a.LOW_INT=36339,a.MEDIUM_INT=36340,a.HIGH_INT=36341,a.FRAMEBUFFER=36160,a.RENDERBUFFER=36161,a.RGBA4=32854,a.RGB5_A1=32855,a.RGB565=36194,a.DEPTH_COMPONENT16=33189,a.STENCIL_INDEX=6401,a.STENCIL_INDEX8=36168,a.DEPTH_STENCIL=34041,a.RENDERBUFFER_WIDTH=36162,a.RENDERBUFFER_HEIGHT=36163,a.RENDERBUFFER_INTERNAL_FORMAT=36164,a.RENDERBUFFER_RED_SIZE=36176,a.RENDERBUFFER_GREEN_SIZE=36177,a.RENDERBUFFER_BLUE_SIZE=36178,a.RENDERBUFFER_ALPHA_SIZE=36179,a.RENDERBUFFER_DEPTH_SIZE=36180,a.RENDERBUFFER_STENCIL_SIZE=36181,a.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,a.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,a.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,a.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,a.COLOR_ATTACHMENT0=36064,a.DEPTH_ATTACHMENT=36096,a.STENCIL_ATTACHMENT=36128,a.DEPTH_STENCIL_ATTACHMENT=33306,a.NONE=0,a.FRAMEBUFFER_COMPLETE=36053,a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,a.FRAMEBUFFER_UNSUPPORTED=36061,a.FRAMEBUFFER_BINDING=36006,a.RENDERBUFFER_BINDING=36007,a.MAX_RENDERBUFFER_SIZE=34024,a.INVALID_FRAMEBUFFER_OPERATION=1286,a.UNPACK_FLIP_Y_WEBGL=37440,a.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,a.CONTEXT_LOST_WEBGL=37442,a.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,a.BROWSER_DEFAULT_WEBGL=37444,a._extTextureFilterAnisotropic=null,a._compressedTextureS3tc=null,a._compressedTexturePvrtc=null,a._compressedTextureEtc1=null,a._glTextureIDs=[33984,33985,33986,33987,33988,33989,33990,33991],a._useProgram=null,a._depthTest=!0,a._depthMask=!0,a._blend=!1,a._cullFace=!1,a._activedTextureID=33984,n(a,["_extentionVendorPrefixes",function(){return this._extentionVendorPrefixes=["","WEBKIT_","MOZ_"]},"_activeTextures",function(){return this._activeTextures=new Array(8)},"_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),a}()),nt=(function(){function o(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(16,!0)}v(o,"laya.layagl.cmdNative.ClipRectCmdNative");var t=o.prototype;t.recover=function(){g.recover("ClipRectCmd",this)},E(0,t,"cmdID",function(){return"ClipRect"}),E(0,t,"width",function(){return 0},function(t){}),E(0,t,"x",function(){return 0},function(t){}),E(0,t,"y",function(){return 0},function(t){}),E(0,t,"height",function(){return 0},function(t){}),o.create=function(t,e,i,_){var r=g.getItemByClass("ClipRectCmd",o);r._graphicsCmdEncoder=this._commandEncoder;var a=r._graphicsCmdEncoder,n=r._paramData._float32Data;n[0]=t,n[1]=e,n[2]=i,n[3]=_;var s=r._paramData.getPtrID();return z.syncBufferToRenderThread(r._paramData),a.setClipValueEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,Lt.GLOBALVALUE_CLIP_MAT_POS,Lt.GLOBALVALUE_MATRIX32,s),z.syncBufferToRenderThread(a),r},o.ID="ClipRect"}(),function(){function d(){this._graphicsCmdEncoder=null,this._paramData=null,this._x=0,this._y=0,this._points=[],this._lineColor=null,this._lineWidth=NaN,this.lastOriX=0,this.lastOriY=0,this.tArray=[],this._vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this._ibSize=0,this._vbSize=0,this._ibArray=[],this._vbArray=[]}v(d,"laya.layagl.cmdNative.DrawCurvesCmdNative");var t=d.prototype;t._getPoints=function(t){var e=[];this._points.push(t[0]),this._points.push(t[1]);for(var i=2,_=t.length;i<_;)this._quadraticCurveTo(e,t[i++],t[i++],t[i++],t[i++]);return e},t._quadraticCurveTo=function(t,e,i,_,r){var a=o.I;0==this.tArray.length?(this.lastOriX=this._points[0],this.lastOriY=this._points[1]):(this.lastOriX=this.tArray[this.tArray.length-2],this.lastOriY=this.tArray[this.tArray.length-1]),this.tArray=a.getBezierPoints([this.lastOriX,this.lastOriY,e,i,_,r],30,2);for(var n=2,s=this.tArray.length;n<s;n++)t.push(this.tArray[n])},t.recover=function(){this._lineColor=null,this._points.length=0,this.tArray.length=0,this._ibArray.length=0,this._vbArray.length=0,g.recover("DrawCurvesCmd",this)},E(0,t,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t;for(var e=W.create(this._lineColor).numColor,i=this.vbBuffer._int32Data,_=0,r=0;r<this._vertNum;r++)_++,_++,i[_++]=e;z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"points",function(){return this._points},function(t){this._points.length=0,this.lastOriX=0,this.lastOriY=0,this._points=this._getPoints(t),this._ibArray.length=0,this._vbArray.length=0,Pt.createLine2(this._points,this._ibArray,this.lineWidth,0,this._vbArray,!1);var e=W.create(this._lineColor).numColor;this._vertNum=this._points.length;var i=this._vertNum;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*i*4,!0)),this._vbSize=3*this._vertNum*4;for(var _=this.vbBuffer._float32Data,r=this.vbBuffer._int32Data,a=0,n=0;n<this._vertNum;n++)_[a++]=this._vbArray[2*n]+this.x,_[a++]=this._vbArray[2*n+1]+this.y,r[a++]=e;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*(this._vertNum-2)*2)&&(this.ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._ibSize=3*(this._vertNum-2)*2;for(var s=this.ibBuffer._int16Data,o=0;o<3*(this._vertNum-2);o++)s[o]=this._ibArray[o];(r=this._paramData._int32Data)[d._PARAM_VB_SIZE_POS_]=this._vbSize,r[d._PARAM_IB_SIZE_POS_]=this._ibSize,z.syncBufferToRenderThread(this.ibBuffer),z.syncBufferToRenderThread(this.vbBuffer),z.syncBufferToRenderThread(this._paramData)}),E(0,t,"cmdID",function(){return"DrawCurves"}),E(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._vbArray[2*_]+this._x,i++,i++;z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)i++,e[i++]=this._vbArray[2*_+1]+this._y,i++;z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t,this._ibArray.length=0,this._vbArray.length=0,Pt.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._vbArray[2*_]+this.x,e[i++]=this._vbArray[2*_+1]+this.y,i++;z.syncBufferToRenderThread(this.vbBuffer)}),d.create=function(t,e,i,_,r){var a=g.getItemByClass("DrawCurvesCmd",d);a._graphicsCmdEncoder=this._commandEncoder,d._DRAW_CURVES_CMD_ENCODER_||((d._DRAW_CURVES_CMD_ENCODER_=z.instance.createCommandEncoder(152,32,!0)).useProgramEx(Lt.PROGRAMEX_DRAWVG),d._DRAW_CURVES_CMD_ENCODER_.useVDO(Lt.VDO_MESHVG),d._DRAW_CURVES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),d._DRAW_CURVES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),d._DRAW_CURVES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),d._DRAW_CURVES_CMD_ENCODER_.setMeshExByParamData(4*d._PARAM_VB_POS_,4*d._PARAM_VB_OFFSET_POS_,4*d._PARAM_VB_SIZE_POS_,4*d._PARAM_IB_POS_,4*d._PARAM_IB_OFFSET_POS_,4*d._PARAM_IB_SIZE_POS_,4*d._PARAM_INDEX_ELEMENT_OFFSET_POS_),d._DRAW_CURVES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),d._DRAW_CURVES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(d._DRAW_CURVES_CMD_ENCODER_)),a._paramData||(a._paramData=new ParamData(32,!0)),a._x=t,a._y=e,a._lineColor=_,a._lineWidth=r,a._points=a._getPoints(i),Pt.createLine2(a._points,a._ibArray,r,0,a._vbArray,!1);var n=W.create(_).numColor;a._vertNum=a._points.length;var s=a._vertNum;(!a.vbBuffer||a.vbBuffer.getByteLength()<3*a._vertNum*4)&&(a.vbBuffer=new ParamData(3*s*4,!0)),a._vbSize=3*a._vertNum*4;for(var o=a.vbBuffer._float32Data,h=a.vbBuffer._int32Data,u=0,l=0;l<a._vertNum;l++)o[u++]=a._vbArray[2*l]+t,o[u++]=a._vbArray[2*l+1]+e,h[u++]=n;(!a.ibBuffer||a.ibBuffer.getByteLength()<3*(a._vertNum-2)*2)&&(a.ibBuffer=new ParamData(3*(s-2)*2,!0,!0)),a._ibSize=3*(a._vertNum-2)*2;for(var c=a.ibBuffer._int16Data,f=0;f<3*(a._vertNum-2);f++)c[f]=a._ibArray[f];a._paramData._float32Data;return(h=a._paramData._int32Data)[0]=1,h[d._PARAM_VB_POS_]=a.vbBuffer.getPtrID(),h[d._PARAM_IB_POS_]=a.ibBuffer.getPtrID(),h[d._PARAM_VB_SIZE_POS_]=a._vbSize,h[d._PARAM_IB_SIZE_POS_]=a._ibSize,h[d._PARAM_VB_OFFSET_POS_]=0,h[d._PARAM_IB_OFFSET_POS_]=0,h[d._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,z.syncBufferToRenderThread(a.vbBuffer),z.syncBufferToRenderThread(a.ibBuffer),z.syncBufferToRenderThread(a._paramData),a._graphicsCmdEncoder.useCommandEncoder(d._DRAW_CURVES_CMD_ENCODER_.getPtrID(),a._paramData.getPtrID(),-1),z.syncBufferToRenderThread(a._graphicsCmdEncoder),a},d.ID="DrawCurves",d._DRAW_CURVES_CMD_ENCODER_=null,d._PARAM_VB_POS_=1,d._PARAM_IB_POS_=2,d._PARAM_VB_SIZE_POS_=3,d._PARAM_IB_SIZE_POS_=4,d._PARAM_VB_OFFSET_POS_=5,d._PARAM_IB_OFFSET_POS_=6,d._PARAM_INDEX_ELEMENT_OFFSET_POS_=7}(),function(){function t(){this.tex=null,this.uv=[0,0,1,1],this.pos=0,this.width=0,this.height=0,this.bmpWidth=0,this.bmpHeight=0,this.touchTick=0,this.isSpace=!1}return v(t,"laya.webgl.resource.CharRenderInfo"),t.prototype.touch=function(){var t=x.loopCount;this.tex._scoreTick!=t&&(this.tex._score=0,this.tex._scoreTick=t),this.touchTick!=t&&this.tex._score++,this.touchTick=t},t}()),st=function(){function c(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=NaN,this._y=NaN,this._width=NaN,this._height=NaN}v(c,"laya.layagl.cmdNative.DrawCanvasCmdNative");var t=c.prototype;return t.recover=function(){this._graphicsCmdEncoder=null,g.recover("DrawCanvasCmd",this)},E(0,t,"cmdID",function(){return"DrawCanvas"}),E(0,t,"y",function(){return this._y},function(t){this._y=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_+1]=this._y,e[c._PARAM_VB_POS_+7]=this._y,e[c._PARAM_VB_POS_+13]=this._y+this._height,e[c._PARAM_VB_POS_+19]=this._y+this._height,e[c._PARAM_CLIP_SIZE+1]=t+16,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"texture",function(){return this._texture},function(t){this._texture=t,this._paramData._int32Data[c._PARAM_TEXTURE_POS_]=this._texture._getSource().id;var e=this._paramData._float32Data,i=te.flipyuv;e[c._PARAM_VB_POS_+2]=i[0],e[c._PARAM_VB_POS_+3]=i[1],e[c._PARAM_VB_POS_+8]=i[2],e[c._PARAM_VB_POS_+9]=i[3],e[c._PARAM_VB_POS_+14]=i[4],e[c._PARAM_VB_POS_+15]=i[5],e[c._PARAM_VB_POS_+20]=i[6],e[c._PARAM_VB_POS_+21]=i[7],z.syncBufferToRenderThread(this._paramData)}),E(0,t,"width",function(){return this._width},function(t){this._width=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_]=this._x,e[c._PARAM_VB_POS_+6]=this._x+this._width,e[c._PARAM_VB_POS_+12]=this._x+this._width,e[c._PARAM_VB_POS_+18]=this._x,e[c._PARAM_CLIP_SIZE+2]=t-32,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"x",function(){return this._x},function(t){this._x=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_]=this._x,e[c._PARAM_VB_POS_+6]=this._x+this._width,e[c._PARAM_VB_POS_+12]=this._x+this._width,e[c._PARAM_VB_POS_+18]=this._x,e[c._PARAM_CLIP_SIZE]=t+16,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"height",function(){return this._height},function(t){this._height=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_+1]=this._y,e[c._PARAM_VB_POS_+7]=this._y,e[c._PARAM_VB_POS_+13]=this._y+this._height,e[c._PARAM_VB_POS_+19]=this._y+this._height,e[c._PARAM_CLIP_SIZE+3]=t-32,z.syncBufferToRenderThread(this._paramData)}),c.create=function(t,e,i,_,r){var a=g.getItemByClass("DrawCanvasCmd",c);a._graphicsCmdEncoder=this._commandEncoder,c.createCommandEncoder(),a._paramData||(a._paramData=new ParamData(132,!0)),a._texture=t,a._x=e,a._y=i,a._width=_,a._height=r,c.setParamData(a._paramData,t,e,i,_,r);var n=c._DRAW_CANVAS_CMD_ENCODER_.getPtrID(),s=a._paramData.getPtrID();return a._graphicsCmdEncoder.useCommandEncoder(n,s,-1),z.syncBufferToRenderThread(a._graphicsCmdEncoder),a},c.createCommandEncoder=function(){c._DRAW_CANVAS_CMD_ENCODER_||((c._DRAW_CANVAS_CMD_ENCODER_=z.instance.createCommandEncoder(172,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),c._DRAW_CANVAS_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),c._DRAW_CANVAS_CMD_ENCODER_.useVDO(Lt.VDO_MESHQUADTEXTURE),c._DRAW_CANVAS_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),c._DRAW_CANVAS_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),c._DRAW_CANVAS_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),c._DRAW_CANVAS_CMD_ENCODER_.uniformTextureByParamData(0,4,4*c._PARAM_TEXTURE_POS_),c._DRAW_CANVAS_CMD_ENCODER_.setRectMeshByParamData(12,4*c._PARAM_VB_POS_,16),c._DRAW_CANVAS_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),c._DRAW_CANVAS_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(c._DRAW_CANVAS_CMD_ENCODER_))},c.setParamData=function(t,e,i,_,r,a){var n=t._float32Data,s=t._int32Data;s[0]=3,s[1]=33984,s[c._PARAM_TEXTURE_POS_]=e._getSource().id,s[3]=1,s[4]=96;var o=0!=r?r:e.width,h=0!=a?a:e.height,u=te.flipyuv,l=c._PARAM_VB_POS_;n[l++]=i,n[l++]=_,n[l++]=u[0],n[l++]=u[1],s[l++]=4294967295,s[l++]=4294967295,n[l++]=i+o,n[l++]=_,n[l++]=u[2],n[l++]=u[3],s[l++]=4294967295,s[l++]=4294967295,n[l++]=i+o,n[l++]=_+h,n[l++]=u[4],n[l++]=u[5],s[l++]=4294967295,s[l++]=4294967295,n[l++]=i,n[l++]=_+h,n[l++]=u[6],n[l++]=u[7],s[l++]=4294967295,s[l++]=4294967295,n[c._PARAM_CLIP_SIZE]=i+16,n[c._PARAM_CLIP_SIZE+1]=_+16,n[c._PARAM_CLIP_SIZE+2]=r-32,n[c._PARAM_CLIP_SIZE+3]=a-32,z.syncBufferToRenderThread(t)},c.ID="DrawCanvas",c._DRAW_CANVAS_CMD_ENCODER_=null,c._PARAM_TEXTURE_POS_=2,c._PARAM_VB_POS_=5,c._PARAM_CLIP_SIZE=29,c}(),ot=function(){function r(){this._mat=new S}v(r,"laya.webgl.canvas.save.SaveTranslate");var t=r.prototype;return P.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._mat.copyTo(t._curMat),r.POOL[r.POOL._length++]=this},r.save=function(t){var e=r.POOL,i=0<e._length?e[--e._length]:new r;t._curMat.copyTo(i._mat);var _=t._save;_[_._length++]=i},r.POOL=Y._createArray(),r}(),ht=(function(){function s(){this._graphicsCmdEncoder=null,this._matrix=null,this._paramData=new ParamData(32,!0)}v(s,"laya.layagl.cmdNative.TransformCmdNative");var t=s.prototype;t.recover=function(){this._matrix=null,g.recover("TransformCmd",this)},E(0,t,"cmdID",function(){return"Transform"}),E(0,t,"matrix",function(){return this._matrix},function(t){this._matrix=t;var e=this._paramData._float32Data;e[0]=this._matrix.a,e[1]=this._matrix.b,e[2]=this._matrix.c,e[3]=this._matrix.d,e[4]=this._matrix.tx,e[5]=this._matrix.ty,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"pivotX",function(){return this._paramData._float32Data[6]},function(t){this._paramData._float32Data[6]=t,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"pivotY",function(){return this._paramData._float32Data[7]},function(t){this._paramData._float32Data[7]=t,z.syncBufferToRenderThread(this._paramData)}),s.create=function(t,e,i){var _=g.getItemByClass("TransformCmd",s),r=_._graphicsCmdEncoder=this._commandEncoder,a=_._paramData._float32Data;a[0]=t.a,a[1]=t.b,a[2]=t.c,a[3]=t.d,a[4]=t.tx,a[5]=t.ty,a[6]=e,a[7]=i,_._matrix=t;var n=_._paramData.getPtrID();return z.syncBufferToRenderThread(_._paramData),r.setGlobalValueEx(Lt.GLOBALVALUE_MATRIX32,14,n,0),z.syncBufferToRenderThread(r),_},s.ID="Transform"}(),function(){function t(){}return v(t,"laya.layagl.ConchCmdReplace"),t.__init__=function(){var t,e=laya.display.cmd,i=laya.layagl.cmdNative;for(t in e)i[t+"Native"]&&(e[t].create=i[t+"Native"].create)},t}()),ut=function(){function n(){this._mesh=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this._ref=1,this.srcRT=null,this._key=new Mt}v(n,"laya.webgl.submit.SubmitTarget");var t=n.prototype;return P.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){var t=dt.mainContext;this._mesh.useMesh(t);var e=this.srcRT;return e&&(this.shaderValue.texture=e._getSource(),this.shaderValue.upload(),this.blend(),x.drawCall++,x.trianglesFaces+=this._numEle/3,dt.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},t.blend=function(){if(Et.activeBlendFunction!==Et.fns[this.blendType]){var t=dt.mainContext;t.enable(3042),Et.fns[this.blendType](t),Et.activeBlendFunction=Et.fns[this.blendType]}},t.getRenderType=function(){return 0},t.releaseRender=function(){if(--this._ref<1){var t=n.POOL;t[t._length++]=this}},t.reUse=function(t,e){return this._startIdx=e,this._ref++,e},n.create=function(t,e,i,_){var r=n.POOL._length?n.POOL[--n.POOL._length]:new n;if(r._mesh=e,r.srcRT=_,r._startIdx=e.indexNum*ft.BYTES_PIDX,r._ref=1,r._key.clear(),r._numEle=0,r.blendType=t._nBlendType,r._key.blendShader=r.blendType,r.shaderValue=i,r.shaderValue.setValue(t._shader2D),t._colorFiler){var a=t._colorFiler;i.defines.add(a.type),i.colorMat=a._mat,i.colorAlpha=a._alpha}return r},n.POOL=((n.POOL=[])._length=0,n.POOL),n}(),lt=function(){function E(){}return v(E,"laya.webgl.shapes.Earcut"),E.earcut=function(t,e,i){i=i||2;var _,r,a,n,s,o,h,u=e&&e.length,l=u?e[0]*i:t.length,c=E.linkedList(t,0,l,i,!0),f=[];if(!c)return f;if(u&&(c=E.eliminateHoles(t,e,c,i)),t.length>80*i){_=a=t[0],r=n=t[1];for(var d=i;d<l;d+=i)(s=t[d])<_&&(_=s),(o=t[d+1])<r&&(r=o),a<s&&(a=s),n<o&&(n=o);h=0!==(h=Math.max(a-_,n-r))?1/h:0}return E.earcutLinked(c,f,i,_,r,h),f},E.linkedList=function(t,e,i,_,r){var a,n;if(r===0<E.signedArea(t,e,i,_))for(a=e;a<i;a+=_)n=E.insertNode(a,t[a],t[a+1],n);else for(a=i-_;e<=a;a-=_)n=E.insertNode(a,t[a],t[a+1],n);return n&&E.equals(n,n.next)&&(E.removeNode(n),n=n.next),n},E.filterPoints=function(t,e){if(!t)return t;e||(e=t);var i,_=t;do{if(i=!1,_.steiner||!E.equals(_,_.next)&&0!==E.area(_.prev,_,_.next))_=_.next;else{if(E.removeNode(_),(_=e=_.prev)===_.next)break;i=!0}}while(i||_!==e);return e},E.earcutLinked=function(t,e,i,_,r,a,n){if(t){!n&&a&&E.indexCurve(t,_,r,a);for(var s,o,h=t;t.prev!==t.next;)if(s=t.prev,o=t.next,a?E.isEarHashed(t,_,r,a):E.isEar(t))e.push(s.i/i),e.push(t.i/i),e.push(o.i/i),E.removeNode(t),t=o.next,h=o.next;else if((t=o)===h){n?1===n?(t=E.cureLocalIntersections(t,e,i),E.earcutLinked(t,e,i,_,r,a,2)):2===n&&E.splitEarcut(t,e,i,_,r,a):E.earcutLinked(E.filterPoints(t,null),e,i,_,r,a,1);break}}},E.isEar=function(t){var e=t.prev,i=t,_=t.next;if(0<=E.area(e,i,_))return!1;for(var r=t.next.next;r!==t.prev;){if(E.pointInTriangle(e.x,e.y,i.x,i.y,_.x,_.y,r.x,r.y)&&0<=E.area(r.prev,r,r.next))return!1;r=r.next}return!0},E.isEarHashed=function(t,e,i,_){var r=t.prev,a=t,n=t.next;if(0<=E.area(r,a,n))return!1;for(var s=r.x<a.x?r.x<n.x?r.x:n.x:a.x<n.x?a.x:n.x,o=r.y<a.y?r.y<n.y?r.y:n.y:a.y<n.y?a.y:n.y,h=r.x>a.x?r.x>n.x?r.x:n.x:a.x>n.x?a.x:n.x,u=r.y>a.y?r.y>n.y?r.y:n.y:a.y>n.y?a.y:n.y,l=E.zOrder(s,o,e,i,_),c=E.zOrder(h,u,e,i,_),f=t.nextZ;f&&f.z<=c;){if(f!==t.prev&&f!==t.next&&E.pointInTriangle(r.x,r.y,a.x,a.y,n.x,n.y,f.x,f.y)&&0<=E.area(f.prev,f,f.next))return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=l;){if(f!==t.prev&&f!==t.next&&E.pointInTriangle(r.x,r.y,a.x,a.y,n.x,n.y,f.x,f.y)&&0<=E.area(f.prev,f,f.next))return!1;f=f.prevZ}return!0},E.cureLocalIntersections=function(t,e,i){var _=t;do{var r=_.prev,a=_.next.next;!E.equals(r,a)&&E.intersects(r,_,_.next,a)&&E.locallyInside(r,a)&&E.locallyInside(a,r)&&(e.push(r.i/i),e.push(_.i/i),e.push(a.i/i),E.removeNode(_),E.removeNode(_.next),_=t=a),_=_.next}while(_!==t);return _},E.splitEarcut=function(t,e,i,_,r,a){var n=t;do{for(var s=n.next.next;s!==n.prev;){if(n.i!==s.i&&E.isValidDiagonal(n,s)){var o=E.splitPolygon(n,s);return n=E.filterPoints(n,n.next),o=E.filterPoints(o,o.next),E.earcutLinked(n,e,i,_,r,a),void E.earcutLinked(o,e,i,_,r,a)}s=s.next}n=n.next}while(n!==t)},E.eliminateHoles=function(t,e,i,_){var r,a,n,s,o,h=[];for(r=0,a=e.length;r<a;r++)n=e[r]*_,s=r<a-1?e[r+1]*_:t.length,(o=E.linkedList(t,n,s,_,!1))===o.next&&(o.steiner=!0),h.push(E.getLeftmost(o));for(h.sort(E.compareX),r=0;r<h.length;r++)E.eliminateHole(h[r],i),i=E.filterPoints(i,i.next);return i},E.compareX=function(t,e){return t.x-e.x},E.eliminateHole=function(t,e){if(e=E.findHoleBridge(t,e)){var i=E.splitPolygon(e,t);E.filterPoints(i,i.next)}},E.findHoleBridge=function(t,e){var i,_=e,r=t.x,a=t.y,n=-1/0;do{if(a<=_.y&&a>=_.next.y&&_.next.y!==_.y){var s=_.x+(a-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(s<=r&&n<s){if((n=s)===r){if(a===_.y)return _;if(a===_.next.y)return _.next}i=_.x<_.next.x?_:_.next}}_=_.next}while(_!==e);if(!i)return null;if(r===n)return i.prev;var o,h=i,u=i.x,l=i.y,c=1/0;for(_=i.next;_!==h;)r>=_.x&&_.x>=u&&r!==_.x&&E.pointInTriangle(a<l?r:n,a,u,l,a<l?n:r,a,_.x,_.y)&&((o=Math.abs(a-_.y)/(r-_.x))<c||o===c&&_.x>i.x)&&E.locallyInside(_,t)&&(i=_,c=o),_=_.next;return i},E.indexCurve=function(t,e,i,_){for(var r=t;null===r.z&&(r.z=E.zOrder(r.x,r.y,e,i,_)),r.prevZ=r.prev,r.nextZ=r.next,(r=r.next)!==t;);r.prevZ.nextZ=null,r.prevZ=null,E.sortLinked(r)},E.sortLinked=function(t){var e,i,_,r,a,n,s,o,h=1;do{for(i=t,a=t=null,n=0;i;){for(n++,_=i,e=s=0;e<h&&(s++,_=_.nextZ);e++);for(o=h;0<s||0<o&&_;)0!==s&&(0===o||!_||i.z<=_.z)?(i=(r=i).nextZ,s--):(_=(r=_).nextZ,o--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=_}a.nextZ=null,h*=2}while(1<n);return t},E.zOrder=function(t,e,i,_,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-_)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1},E.getLeftmost=function(t){for(var e=t,i=t;e.x<i.x&&(i=e),(e=e.next)!==t;);return i},E.pointInTriangle=function(t,e,i,_,r,a,n,s){return 0<=(r-n)*(e-s)-(t-n)*(a-s)&&0<=(t-n)*(_-s)-(i-n)*(e-s)&&0<=(i-n)*(a-s)-(r-n)*(_-s)},E.isValidDiagonal=function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!E.intersectsPolygon(t,e)&&E.locallyInside(t,e)&&E.locallyInside(e,t)&&E.middleInside(t,e)},E.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},E.equals=function(t,e){return t.x===e.x&&t.y===e.y},E.intersects=function(t,e,i,_){return!!(E.equals(t,e)&&E.equals(i,_)||E.equals(t,_)&&E.equals(i,e))||0<E.area(t,e,i)!=0<E.area(t,e,_)&&0<E.area(i,_,t)!=0<E.area(i,_,e)},E.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&E.intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1},E.locallyInside=function(t,e){return E.area(t.prev,t,t.next)<0?0<=E.area(t,e,t.next)&&0<=E.area(t,t.prev,e):E.area(t,e,t.prev)<0||E.area(t,t.next,e)<0},E.middleInside=function(t,e){for(var i=t,_=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(_=!_),(i=i.next)!==t;);return _},E.splitPolygon=function(t,e){var i=new vt(t.i,t.x,t.y),_=new vt(e.i,e.x,e.y),r=t.next,a=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(_.next=i).prev=_,(a.next=_).prev=a,_},E.insertNode=function(t,e,i,_){var r=new vt(t,e,i);return _?(r.next=_.next,(r.prev=_).next.prev=r,_.next=r):(r.prev=r).next=r,r},E.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},E.signedArea=function(t,e,i,_){for(var r=0,a=e,n=i-_;a<i;a+=_)r+=(t[n]-t[a])*(t[a+1]+t[n+1]),n=a;return r},E}(),ct=(function(){function _(){this._paramData=new ParamData(4,!0)}v(_,"laya.layagl.cmdNative.AlphaCmdNative");var t=_.prototype;t.recover=function(){g.recover("AlphaCmd",this)},t.run=function(t,e,i){t.alpha(this._alpha)},E(0,t,"cmdID",function(){return"Alpha"}),E(0,t,"alpha",function(){return this._alpha},function(t){t=(t=1<t?1:t)<0?0:t;var e=16777215;e|=255*(this._alpha=t)<<24,this._paramData._int32Data[0]=e,z.syncBufferToRenderThread(this._paramData)}),_.create=function(t){var e=g.getItemByClass("AlphaCmd",_),i=e._graphicsCmdEncoder=this._commandEncoder;return e.alpha=t,i.setGlobalValueEx(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,15,e._paramData.getPtrID(),0),z.syncBufferToRenderThread(i),e},_.ID="Alpha"}(),function(){function n(t){this.clipInfoID=-1,this._numEle=0,this._ref=1,this._key=new Mt,void 0===t&&(t=1e4),this._renderType=t,this._id=++n.ID}v(n,"laya.webgl.submit.Submit");var t=n.prototype;return P.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.getID=function(){return this._id},t.releaseRender=function(){n.RENDERBASE!=this&&--this._ref<1&&((n.POOL[n._poolSize++]=this).shaderValue.release(),this.shaderValue=null,this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},t.getRenderType=function(){return this._renderType},t.renderSubmit=function(){if(0===this._numEle||!this._mesh||0==this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t._getSource();if(!e)return 1;this.shaderValue.texture=e}var i=dt.mainContext;return this._mesh.useMesh(i),this.shaderValue.upload(),Et.activeBlendFunction!==this._blendFn&&(at.setBlend(i,!0),this._blendFn(i),Et.activeBlendFunction=this._blendFn),i.drawElements(4,this._numEle,5123,this._startIdx),x.drawCall++,x.trianglesFaces+=this._numEle/3,1},t._cloneInit=function(t,e,i,_){t._ref=1,t._mesh=i,t._id=this._id,t._key.copyFrom(this._key),t._parent=this,t._blendFn=this._blendFn,t._renderType=this._renderType,t._startIdx=_*ft.BYTES_PIDX,t._numEle=this._numEle,t.shaderValue=this.shaderValue,this.shaderValue.ref++,this._ref++},t.clone=function(t,e,i){return null},t.reUse=function(t,e){return 0},t.toString=function(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key},n.__init__=function(){var t=n.RENDERBASE=new n(-1);t.shaderValue=new H(0,0),t.shaderValue.ALPHA=1,t._ref=4294967295},n.create=function(t,e,i){var _=n._poolSize?n.POOL[--n._poolSize]:new n;_._ref=1,_._mesh=e,_._key.clear(),_._startIdx=e.indexNum*ft.BYTES_PIDX,_._numEle=0;var r=t._nBlendType;_._blendFn=t._targets?Et.targetFns[r]:Et.fns[r],_.shaderValue=i,_.shaderValue.setValue(t._shader2D);var a=t._shader2D.filters;return a&&_.shaderValue.setFilters(a),_},n.createShape=function(t,e,i,_){var r=n._poolSize?n.POOL[--n._poolSize]:new n;r._mesh=e,r._numEle=i,r._startIdx=2*e.indexNum,r._ref=1,r.shaderValue=_,r.shaderValue.setValue(t._shader2D);var a=t._nBlendType;return r._blendFn=t._targets?Et.targetFns[a]:Et.fns[a],r},n.TYPE_2D=1e4,n.TYPE_CANVAS=10003,n.TYPE_CMDSETRT=10004,n.TYPE_CUSTOM=10005,n.TYPE_BLURRT=10006,n.TYPE_CMDDESTORYPRERT=10007,n.TYPE_DISABLESTENCIL=10008,n.TYPE_OTHERIBVB=10009,n.TYPE_PRIMITIVE=10010,n.TYPE_RT=10011,n.TYPE_BLUR_RT=10012,n.TYPE_TARGET=10013,n.TYPE_CHANGE_VALUE=10014,n.TYPE_SHAPE=10015,n.TYPE_TEXTURE=10016,n.TYPE_FILLTEXTURE=10017,n.KEY_ONCE=-1,n.KEY_FILLRECT=1,n.KEY_DRAWTEXTURE=2,n.KEY_VG=3,n.KEY_TRIANGLES=4,n.RENDERBASE=null,n.ID=1,n.preRender=null,n._poolSize=0,n.POOL=[],n}()),ft=function(){function t(){}return v(t,"laya.webgl.utils.CONST3D2D"),t.BYTES_PE=4,t.BYTES_PIDX=2,t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,t}(),dt=function(){function n(){}return v(n,"laya.webgl.WebGL"),n._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},n._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},n._uint16ArraySlice=function(t){var e,i=arguments,_=0,r=0;if(0===i.length)for(_=this.length,e=new Uint16Array(_),r=0;r<_;r++)e[r]=this[r];else if(2===i.length){var a=i[0],n=i[1];if(a<n)for(_=n-a,e=new Uint16Array(_),r=a;r<n;r++)e[r-a]=this[r];else e=new Uint16Array(0)}return e},n._nativeRender_enable=function(){n.isNativeRender_enable||(n.isNativeRender_enable=!0,e.create=function(t,e){return new ee(t,e,1,!1,!1)},at.__init_native(),Ct.width=s.window.innerWidth,Ct.height=s.window.innerHeight,p.measureText=function(t,e){return f.conchTextCanvas.font=e,f.conchTextCanvas.measureText(t)},p.enableNative=function(){et.uploadShaderUniforms=et.uploadShaderUniformsForNative;var t=I;t.prototype.repaint=t.prototype.repaintForNative,t.prototype.render=t.prototype.renderToNative;var e=_t;if(e.prototype.bind=e.prototype.bindForNative,e.prototype.unBind=e.prototype.unBindForNative,c.isConchApp){Tt=f.GLCommandEncoder,z=f.LayaGLContext;var i=f.CanvasRenderingContext.prototype,_=Dt.prototype;Dt=f.CanvasRenderingContext,i.drawImage=_.drawImage,i.drawTexture=_.drawTexture,i.fillText=_.fillText,i.save=_.save,i.restore=_.restore,i.translate=_.translate,i.scale=_.scale,i.rotate=_.rotate,i.transform=_.transform,i.beginRT=_.beginRT,i.endRT=_.endRT,i.drawCanvas=_.drawCanvas,i.drawTarget=_.drawTarget,i._$get_asBitmap=_._$get_asBitmap,i._$set_asBitmap=_._$set_asBitmap,i.toBase64=_.toBase64,i.getImageData=_.getImageData,E(0,i,"asBitmap",i._$get_asBitmap,i._$set_asBitmap)}Qt.init(),Lt.__init__()},p.drawToCanvas=function(t,e,i,_,r,a){var n=new A(!0);n.size(i,_);var s=n.getContext("2d");s.asBitmap=!0;var o=z.instance.createCommandEncoder(128,64,!1);o.beginEncoding(),o.clearEncoding();var h=z.instance,u=h.getCurrentContext();h.setCurrentContext(s),s.beginRT(),h.save();var l=Qt._tempFloatArrayMatrix;return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=r,l[5]=a,h.setGlobalValue(Lt.GLOBALVALUE_MATRIX32,8,l),t.writeBlockToNative(),h.restore(),h.setCurrentContext(u),h.commitContextToGPU(s),s.endRT(),o.endEncoding(),h.useCommandEncoder(o.getPtrID(),-1,0),n},A.prototype.getTexture=function(){return this._texture||(this._texture=this.context._targets,this._texture.uv=te.flipyuv,this._texture.bitmap=this._texture),this._texture})},n._webglRender_enable=function(){c.isWebGL||(c.isWebGL=!0,p.initRender=function(t,e,i){var _=z.instance=laya.webgl.WebGL.mainContext=function(t){var e,i=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];h.useWebGL2||i.shift();for(var _=0;_<i.length;_++){try{e=t.getContext(i[_],{stencil:h.isStencil,alpha:h.isAlpha,antialias:h.isAntialias,premultipliedAlpha:h.premultipliedAlpha,preserveDrawingBuffer:h.preserveDrawingBuffer})}catch(t){}if(e)return"webgl2"===i[_]&&(laya.webgl.WebGL._isWebGL2=!0),new z,e}return null}(c._mainCanvas.source);if(!_)return!1;t.size(e,i),at.__init__(_),It.__init__(),ct.__init__();var r=new It;c._context=r,t._setContext(r),laya.webgl.WebGL.shaderHighPrecision=!1;try{var a=_.getShaderPrecisionFormat(35632,36338);n.shaderHighPrecision=!!a.precision}catch(t){}return z.instance=_,F.__init__(),Gt.__init__(),H.__init__(),mt.__init__(),Jt.__int__(_),Et._init_(_),!0},e.create=function(t,e){return new ee(t,e,1,!1,!1)},p.createRenderSprite=function(t,e){return new Bt(t,e)},p.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},p.clear=function(t){Ct.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=c.context,i=0==e._submits._length||h.preserveDrawingBuffer?W.create(t).arrColor:P.stage._wgColor;i&&e.clearBG(i[0],i[1],i[2],i[3]),Ct.clear()},p.drawToCanvas=function(t,e,i,_,r,a){r-=t.x,a-=t.y,r|=0,a|=0,i|=0,_|=0;var n=new It;n.size(i,_),n.asBitmap=!0,n._targets.start(),D.renders[e]._fun(t,n,r,a),n.flush(),n._targets.end(),n._targets.restore();var s=n._targets.getData(0,0,i,_);n.destroy();for(var o=new ImageData(i,_),h=4*i,u=(new Uint8Array(h),o.data),l=_-1,c=l*h,f=0;0<=l;l--)u.set(s.subarray(f,f+h),c),c-=h,f+=h;var d=new A(!0);return d.size(i,_),d.getContext("2d").putImageData(o,0,0),d},p.getTexturePixels=function(t,e,i,_,r){return alert("由于编不过，注掉了"),null},t._filter=function(t,e,i,_){var r=e,a=this._next;if(a){var n=t.filters,s=n.length;if(1==s&&32==n[0].type)return e.save(),e.setColorFilter(n[0]),a._fun.call(a,t,e,i,_),void e.restore();var o,h=H.create(1,0),u=C.TEMP,l=r._curMat,c=S.create();l.copyTo(c);var f=0,d=0,E=t._cacheStyle.filterCache||null;if(E&&0==t.getRepaint()){if((t._cacheStyle.hasGlowFilter||!1)&&(f=50,d=25),(o=t.getBounds()).width<=0||o.height<=0)return;o.width+=f,o.height+=f,u.x=o.x*c.a+o.y*c.c,u.y=o.y*c.d+o.x*c.b,o.x=u.x,o.y=u.y,u.x=o.width*c.a+o.height*c.c,u.y=o.height*c.d+o.width*c.b,o.width=u.x,o.height=u.y}else{t._isHaveGlowFilter()&&(f=50,d=25),(o=new M).copyFrom(t.getSelfBounds()),o.x+=t.x,o.y+=t.y,o.x-=t.pivotX+4,o.y-=t.pivotY+4;var A=o.x,D=o.y;if(o.width+=f+8,o.height+=f+8,u.x=o.x*c.a+o.y*c.c,u.y=o.y*c.d+o.x*c.b,o.x=u.x,o.y=u.y,u.x=o.width*c.a+o.height*c.c,u.y=o.height*c.d+o.width*c.b,o.width=u.x,o.height=u.y,o.width<=0||o.height<=0)return;E&&pt.releaseRT(E);var R=pt.getRT(o.width,o.height),m=pt.getRT(o.width,o.height);t._getCacheStyle().filterCache=E,r.pushRT(),r.useRT(R);var T=t.x-A+d,v=t.y-D+d;a._fun.call(a,t,e,T,v),r.useRT(m);for(var P=0;P<s;P++){0!=P&&(r.useRT(R),r.drawTarget(m,0,0,o.width,o.height,S.TEMP.identity(),h,null,Et.TOINT.overlay),r.useRT(m));var p=n[P];switch(p.type){case 16:case 8:p._glRender&&p._glRender.render(R,e,o.width,o.height,p);break;case 32:r.setColorFilter(p),r.drawTarget(R,0,0,o.width,o.height,S.EMPTY.identity(),H.create(1,0)),r.setColorFilter(null)}}r.popRT()}i=i-d-t.x,_=_-d-t.y,u.setTo(i,_),c.transformPoint(u),i=u.x+o.x,_=u.y+o.y,r._drawRenderTexture(m,i,_,o.width,o.height,S.TEMP.identity(),1,te.defuv),c.destroy()}},A.prototype.getTexture=function(){if(!this._texture){var t=new ee;t.loadImageSource(this.source),this._texture=new w(t)}return this._texture},Float32Array.prototype.slice||(Float32Array.prototype.slice=n._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=n._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=n._uint8ArraySlice))},n.enable=function(){return s.__init__(),!!s._supportWebGL&&(c.isConchApp?n._nativeRender_enable():n._webglRender_enable(),!0)},n.onStageResize=function(t,e){null!=n.mainContext&&(n.mainContext.viewport(0,0,t,e),Ct.width=t,Ct.height=e)},n.mainContext=null,n.shaderHighPrecision=!1,n._isWebGL2=!1,n.isNativeRender_enable=!1,n}(),Et=function(){function e(){}return v(e,"laya.webgl.canvas.BlendMode"),e._init_=function(t){e.fns=[e.BlendNormal,e.BlendAdd,e.BlendMultiply,e.BlendScreen,e.BlendOverlay,e.BlendLight,e.BlendMask,e.BlendDestinationOut],e.targetFns=[e.BlendNormalTarget,e.BlendAddTarget,e.BlendMultiplyTarget,e.BlendScreenTarget,e.BlendOverlayTarget,e.BlendLightTarget,e.BlendMask,e.BlendDestinationOut]},e.BlendNormal=function(t){at.setBlendFunc(t,1,771)},e.BlendAdd=function(t){at.setBlendFunc(t,1,772)},e.BlendMultiply=function(t){at.setBlendFunc(t,774,771)},e.BlendScreen=function(t){at.setBlendFunc(t,1,1)},e.BlendOverlay=function(t){at.setBlendFunc(t,1,769)},e.BlendLight=function(t){at.setBlendFunc(t,1,1)},e.BlendNormalTarget=function(t){at.setBlendFunc(t,1,771)},e.BlendAddTarget=function(t){at.setBlendFunc(t,1,772)},e.BlendMultiplyTarget=function(t){at.setBlendFunc(t,774,771)},e.BlendScreenTarget=function(t){at.setBlendFunc(t,1,1)},e.BlendOverlayTarget=function(t){at.setBlendFunc(t,1,769)},e.BlendLightTarget=function(t){at.setBlendFunc(t,1,1)},e.BlendMask=function(t){at.setBlendFunc(t,0,770)},e.BlendDestinationOut=function(t){at.setBlendFunc(t,0,0)},e.activeBlendFunction=null,e.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],e.TOINT={normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1},e.NORMAL="normal",e.ADD="add",e.MULTIPLY="multiply",e.SCREEN="screen",e.OVERLAY="overlay",e.LIGHT="light",e.MASK="mask",e.DESTINATIONOUT="destination-out",e.LIGHTER="lighter",e.fns=[],e.targetFns=[],e}(),At=function(){var _;function t(){this._lastOriX=0,this._lastOriY=0,this.paths=[],this._curPath=null}v(t,"laya.webgl.canvas.Path");var e=t.prototype;return e.beginPath=function(t){this.paths.length=1,this._curPath=this.paths[0]=new _,this._curPath.convex=t},e.closePath=function(){this._curPath.loop=!0},e.newPath=function(){this._curPath=new _,this.paths.push(this._curPath)},e.addPoint=function(t,e){this._curPath.path.push(t,e)},e.push=function(t,e){this._curPath?0<this._curPath.path.length&&(this._curPath=new _,this.paths.push(this._curPath)):(this._curPath=new _,this.paths.push(this._curPath));var i=this._curPath;i.path=t.slice(),i.convex=e},e.reset=function(){this.paths.length=0},t.__init$=function(){_=function(){function t(){this.path=[],this.loop=!1,this.convex=!1}return v(t,""),t}()},t}(),Dt=function(){function t(){this._customCmds=null,this._targets=null,this._width=0,this._height=0,this._cmdEncoder=null}v(t,"laya.layagl.LayaGLRenderingContext");var e=t.prototype;return e.drawTexture=function(t,e,i,_,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===_&&(_=0),void 0===r&&(r=0),this.drawImage(t,e,i,_,r)},e.drawImage=function(t,e,i,_,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===_&&(_=0),void 0===r&&(r=0),this._customCmds.push(a.create.call(this,t,e,i,_,r))},e.fillText=function(t,e,i,_,r,a){this._customCmds.push(u.create.call(this,t,e,i,_||V.defaultFontStr(),r,a))},e.save=function(){this._customCmds.push(O.create.call(this))},e.restore=function(){this._customCmds.push(m.create.call(this))},e.translate=function(t,e){this._customCmds.push(G.create.call(this,t,e))},e.rotate=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._customCmds.push(T.create.call(this,t,e,i))},e.scale=function(t,e,i,_){void 0===i&&(i=0),void 0===_&&(_=0),this._customCmds.push(y.create.call(this,t,e,i,_))},e.transform=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._customCmds.push(U.create.call(this,t,e,i))},e.beginRT=function(){te.pushRT(),this._targets.start(),this.clear()},e.clear=function(){},e.endRT=function(){te.popRT()},e.drawCanvas=function(t,e,i){var _=t.context._targets;this._customCmds.push(r.create.call(this,_,e,i,_.width,_.height))},e.drawTarget=function(t,e,i,_,r,a){var n=new ArrayBuffer(96),s=new Int32Array(n),o=new Float32Array(n),h=0!=r?r:e.width,u=0!=a?a:e.height,l=te.flipyuv,c=0;o[c++]=i,o[c++]=_,o[c++]=l[0],o[c++]=l[1],s[c++]=4294967295,s[c++]=4294967295,o[c++]=i+h,o[c++]=_,o[c++]=l[2],o[c++]=l[3],s[c++]=4294967295,s[c++]=4294967295,o[c++]=i+h,o[c++]=_+u,o[c++]=l[4],o[c++]=l[5],s[c++]=4294967295,s[c++]=4294967295,o[c++]=i,o[c++]=_+u,o[c++]=l[6],o[c++]=l[7],s[c++]=4294967295,s[c++]=4294967295,t.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),t.useVDO(Lt.VDO_MESHQUADTEXTURE),t.uniformEx(Lt.GLOBALVALUE_VIEWS,0),t.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),t.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),t.uniformTexture(0,33984,e._getSource()),t.setRectMesh(1,n),t.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),t.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15)},e.getImageData=function(t,e,i,_,r){var a=this._targets.sourceWidth,n=this._targets.sourceHeight;if(!(t<0||e<0||i<0||_<0||a<i||n<_)){this._cmdEncoder||(this._cmdEncoder=z.instance.createCommandEncoder(128,64,!1));var s=z.instance;this._cmdEncoder.beginEncoding(),this._cmdEncoder.clearEncoding(),te.pushRT(),this._targets.start(),s.readPixelsAsync(t,e,i,_,6408,5121,function(t){r(t)}),this.endRT(),this._cmdEncoder.endEncoding(),s.useCommandEncoder(this._cmdEncoder.getPtrID(),-1,0)}},e.toBase64=function(i,_,r){var a=this._targets.sourceWidth,n=this._targets.sourceHeight;this.getImageData(0,0,a,n,function(t){var e=conchToBase64(i,_,t,a,n);r(e)})},E(0,e,"asBitmap",function(){return!this._targets},function(t){if(t){if(this._targets||(this._targets=new te(this._width,this._height,1,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets=null}),t}(),Rt=(function(){function s(){this._draw_texture_cmd_encoder_=z.instance.createCommandEncoder(64,32,!0)}v(s,"laya.layagl.cmdNative.FillWordsCmdNative");var t=s.prototype;t.createFillText=function(u,t,e,i,_,r){W.create(r).numColor;var a={};a._curMat=new S,a._italicDeg=0,a._drawTextureUseColor=4294967295,a.fillStyle=r,a._fillColor=4294967295,a.setFillColor=function(t){a._fillColor=t},a.getFillColor=function(){return a._fillColor},a.mixRGBandAlpha=function(t){return t},a._drawTextureM=function(t,e,i,_,r,a,n,s){u.blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),u.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),u.useVDO(Lt.VDO_MESHQUADTEXTURE),u.uniformEx(Lt.GLOBALVALUE_VIEWS,0),u.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),u.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),u.uniformTexture(3,33984,t.bitmap._glTexture);var o=new Float32Array([e,i,s[0],s[1],0,0,e+_,i,s[2],s[3],0,0,e+_,i+r,s[4],s[5],0,0,e,i+r,s[6],s[7],0,0]),h=new Int32Array(o.buffer);h[4]=h[10]=h[16]=h[22]=4294967295,h[5]=h[11]=h[17]=h[23]=4294967295,u.setRectMesh(1,o,o.length),u.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),u.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(u)},s.cbook.filltext_native(a,null,t,e,i,_,r,null,0,null)},t.recover=function(){this._graphicsCmdEncoder=null,this.words=null,g.recover("FillWordsCmd",this)},E(0,t,"cmdID",function(){return"FillWords"}),s.create=function(t,e,i,_,r){s.cbook||new Error("Error:charbook not create!");var a=g.getItemByClass("FillWordsCmd",s),n=a._graphicsCmdEncoder=this._commandEncoder;return a.words=t,a.x=e,a.y=i,a.font=_,a.color=r,a._draw_texture_cmd_encoder_.clearEncoding(),a.createFillText(a._draw_texture_cmd_encoder_,t,e,i,_,r),z.syncBufferToRenderThread(a._draw_texture_cmd_encoder_),n.useCommandEncoder(a._draw_texture_cmd_encoder_.getPtrID(),-1,-1),z.syncBufferToRenderThread(n),a},s.ID="FillWords",n(s,["cbook",function(){return this.cbook=gt.charbookInst}])}(),function(){function a(){this._matrix=new S}v(a,"laya.webgl.canvas.save.SaveTransform");var t=a.prototype;return P.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat=this._savematrix,a.POOL[a.POOL._length++]=this},a.save=function(t){var e=t._saveMark;if(2048!=(2048&e._saveuse)){e._saveuse|=2048;var i=a.POOL,_=0<i._length?i[--i._length]:new a;_._savematrix=t._curMat,t._curMat=t._curMat.copyTo(_._matrix);var r=t._save;r[r._length++]=_}},a.POOL=Y._createArray(),a}()),mt=(function(){function T(){this._graphicsCmdEncoder=null,this._paramData=null,this._graphicsCmdEncoder_fill=null,this._paramData_fill=null,this._x=NaN,this._y=NaN,this._paths=null,this._brush=null,this._pen=null,this._vertNum=0,this._startOriX=0,this._startOriY=0,this._lastOriX=0,this._lastOriY=0,this.SEGNUM=32,this.lines_ibBuffer=null,this.lines_vbBuffer=null,this._lines_ibSize=0,this._lines_vbSize=0,this.fill_ibBuffer=null,this.fill_vbBuffer=null,this._fill_ibSize=0,this._fill_vbSize=0,this._cmdCurrentPos=0,this._points=[],this._lines_ibArray=[],this._lines_vbArray=[],this._fill_ibArray=[],this._fill_vbArray=[]}v(T,"laya.layagl.cmdNative.DrawPathCmdNative");var t=T.prototype;t._arcTo=function(t){var e=t[1],i=t[2],_=t[3],r=t[4],a=t[5],n=0,s=0,o=0,h=this._lastOriX-e,u=this._lastOriY-i,l=Math.sqrt(h*h+u*u);if(!(l<=1e-6)){var c=h/l,f=u/l,d=_-e,E=r-i,A=d*d+E*E,D=Math.sqrt(A);if(!(D<=1e-6)){var R=d/D,m=E/D,T=c+R,v=f+m,P=Math.sqrt(T*T+v*v);if(!(P<=1e-6)){var p=T/P,C=v/P,M=Math.acos(p*c+C*f),O=Math.PI/2-M,y=(l=a/Math.tan(O))*c+e,L=l*f+i,S=Math.sqrt(l*l+a*a),g=e+p*S,b=i+C*S,B=0,I=0;if(0<=c*m-f*R){var x=2*O/this.SEGNUM;B=Math.sin(x),I=Math.cos(x)}else x=2*-O/this.SEGNUM,B=Math.sin(x),I=Math.cos(x);var N=this._lastOriX,F=this._lastOriY,V=y-g,w=L-b;for(n=0;n<this.SEGNUM;n++){var U=V*I+w*B,G=-V*B+w*I;s=U+g,o=G+b,(.1<Math.abs(N-s)||.1<Math.abs(F-o))&&(this._points.push(s),this._points.push(o)),V=U,w=G}}}}},t.recover=function(){this._paths=null,this._brush=null,this._pen=null,this._points.length=0,this._lines_ibArray.length=0,this._lines_vbArray.length=0,this._fill_ibArray.length=0,this._fill_vbArray.length=0,g.recover("DrawPathCmd",this)},E(0,t,"cmdID",function(){return"DrawPath"}),E(0,t,"paths",function(){return this._paths},function(t){this._paths=t}),E(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.lines_vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._lines_vbArray[2*_]+t,i++,i++;z.syncBufferToRenderThread(this.lines_vbBuffer)}),E(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.lines_vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)i++,e[i++]=this._lines_vbArray[2*_+1]+t,i++;z.syncBufferToRenderThread(this.lines_vbBuffer)}),E(0,t,"brush",function(){return this._brush},function(t){this._brush||(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=T._DRAW_LINES_FILL_CMD_ENCODER_.getPtrID(),z.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._brush=t;var e=this._vertNum,i=lt.earcut(this._points,null,2);if(0<i.length){(!this.fill_ibBuffer||this.fill_ibBuffer.getByteLength()<2*i.length)&&(this.fill_ibBuffer=new ParamData(2*i.length,!0,!0)),this._fill_ibSize=2*i.length;for(var _=this.fill_ibBuffer._int16Data,r=0,a=0;a<i.length;a++)_[r++]=i[a]}var n=W.create(t.fillStyle).numColor;(!this.fill_vbBuffer||this.fill_vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.fill_vbBuffer=new ParamData(3*e*4,!0)),this._fill_vbSize=3*this._vertNum*4;for(var s=this.fill_vbBuffer._float32Data,o=this.fill_vbBuffer._int32Data,h=0,u=0;u<this._vertNum;u++)s[h++]=this._points[2*u]+this.x,s[h++]=this._points[2*u+1]+this.y,o[h++]=n;var l=this._paramData._int32Data;l[T._PARAM_FILL_VB_POS_]=this.fill_vbBuffer.getPtrID(),l[T._PARAM_FILL_IB_POS_]=this.fill_ibBuffer.getPtrID(),l[T._PARAM_FILL_VB_SIZE_POS_]=this._fill_vbSize,l[T._PARAM_FILL_IB_SIZE_POS_]=this._fill_ibSize,z.syncBufferToRenderThread(this.fill_vbBuffer),z.syncBufferToRenderThread(this.fill_ibBuffer),z.syncBufferToRenderThread(this._paramData)}),E(0,t,"pen",function(){return this._pen},function(t){this._pen=t,this._lines_ibArray.length=0,this._lines_vbArray.length=0,Pt.createLine2(this._points,this._lines_ibArray,t.lineWidth,0,this._lines_vbArray,!1);var e=W.create(t.strokeStyle).numColor,i=this._vertNum;(!this.lines_vbBuffer||this.lines_vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.lines_vbBuffer=new ParamData(3*i*4,!0)),this._lines_vbSize=3*this._vertNum*4;for(var _=this.lines_vbBuffer._float32Data,r=this.lines_vbBuffer._int32Data,a=0,n=0;n<this._vertNum;n++)_[a++]=this._lines_vbArray[2*n]+this.x,_[a++]=this._lines_vbArray[2*n+1]+this.y,r[a++]=e;(!this.lines_ibBuffer||this.lines_ibBuffer.getByteLength()<3*(this._vertNum-2)*2)&&(this.lines_ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._lines_ibSize=3*(this._vertNum-2)*2;for(var s=this.lines_ibBuffer._int16Data,o=0;o<3*(this._vertNum-2);o++)s[o]=this._lines_ibArray[o];(r=this._paramData._int32Data)[T._PARAM_LINES_VB_POS_]=this.lines_vbBuffer.getPtrID(),r[T._PARAM_LINES_IB_POS_]=this.lines_ibBuffer.getPtrID(),r[T._PARAM_LINES_VB_SIZE_POS_]=this._lines_vbSize,r[T._PARAM_LINES_IB_SIZE_POS_]=this._lines_ibSize,z.syncBufferToRenderThread(this.lines_vbBuffer),z.syncBufferToRenderThread(this.lines_ibBuffer),z.syncBufferToRenderThread(this._paramData)}),T.create=function(t,e,i,_,r){var a=g.getItemByClass("DrawPathCmd",T);a._graphicsCmdEncoder=this._commandEncoder,T._DRAW_LINES_CMD_ENCODER_||((T._DRAW_LINES_CMD_ENCODER_=z.instance.createCommandEncoder(188,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),T._DRAW_LINES_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWVG),T._DRAW_LINES_CMD_ENCODER_.useVDO(Lt.VDO_MESHVG),T._DRAW_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),T._DRAW_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),T._DRAW_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),T._DRAW_LINES_CMD_ENCODER_.setMeshExByParamData(4*T._PARAM_LINES_VB_POS_,4*T._PARAM_LINE_VB_OFFSET_POS_,4*T._PARAM_LINES_VB_SIZE_POS_,4*T._PARAM_LINES_IB_POS_,4*T._PARAM_LINE_IB_OFFSET_POS_,4*T._PARAM_LINES_IB_SIZE_POS_,4*T._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_),T._DRAW_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),T._DRAW_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(T._DRAW_LINES_CMD_ENCODER_)),T._DRAW_FILL_CMD_ENCODER_||((T._DRAW_FILL_CMD_ENCODER_=z.instance.createCommandEncoder(168,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),T._DRAW_FILL_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWVG),T._DRAW_FILL_CMD_ENCODER_.useVDO(Lt.VDO_MESHVG),T._DRAW_FILL_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),T._DRAW_FILL_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),T._DRAW_FILL_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),T._DRAW_FILL_CMD_ENCODER_.setMeshExByParamData(4*T._PARAM_FILL_VB_POS_,4*T._PARAM_FILL_VB_OFFSET_POS_,4*T._PARAM_FILL_VB_SIZE_POS_,4*T._PARAM_FILL_IB_POS_,4*T._PARAM_FILL_IB_OFFSET_POS_,4*T._PARAM_FILL_IB_SIZE_POS_,4*T._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_),T._DRAW_FILL_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),T._DRAW_FILL_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(T._DRAW_FILL_CMD_ENCODER_)),T._DRAW_LINES_FILL_CMD_ENCODER_||((T._DRAW_LINES_FILL_CMD_ENCODER_=z.instance.createCommandEncoder(244,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),T._DRAW_LINES_FILL_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWVG),T._DRAW_LINES_FILL_CMD_ENCODER_.useVDO(Lt.VDO_MESHVG),T._DRAW_LINES_FILL_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),T._DRAW_LINES_FILL_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),T._DRAW_LINES_FILL_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),T._DRAW_LINES_FILL_CMD_ENCODER_.setMeshExByParamData(4*T._PARAM_FILL_VB_POS_,4*T._PARAM_FILL_VB_OFFSET_POS_,4*T._PARAM_FILL_VB_SIZE_POS_,4*T._PARAM_FILL_IB_POS_,4*T._PARAM_FILL_IB_OFFSET_POS_,4*T._PARAM_FILL_IB_SIZE_POS_,4*T._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_),T._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),T._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),T._DRAW_LINES_FILL_CMD_ENCODER_.setMeshExByParamData(4*T._PARAM_LINES_VB_POS_,4*T._PARAM_LINE_VB_OFFSET_POS_,4*T._PARAM_LINES_VB_SIZE_POS_,4*T._PARAM_LINES_IB_POS_,4*T._PARAM_LINE_IB_OFFSET_POS_,4*T._PARAM_LINES_IB_SIZE_POS_,4*T._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),T._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),T._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(T._DRAW_LINES_FILL_CMD_ENCODER_)),a._paramData||(a._paramData=new ParamData(60,!0)),a._x=t,a._y=e,a._paths=i,a._brush=_,a._pen=r;for(var n=0,s=i.length;n<s;n++){var o=i[n];switch(0==n&&(a._startOriX=o[1],a._startOriY=o[2]),o[0]){case"moveTo":case"lineTo":a._lastOriX=o[1],a._lastOriY=o[2],a._points.push(o[1]),a._points.push(o[2]);break;case"arcTo":a._arcTo(o);break;case"closePath":a._points.push(a._startOriX),a._points.push(a._startOriY)}}if(a._vertNum=a._points.length,r){Pt.createLine2(a._points,a._lines_ibArray,r.lineWidth,0,a._lines_vbArray,!1);var h=W.create(r.strokeStyle),u=h.numColor,l=a._vertNum;(!a.lines_vbBuffer||a.lines_vbBuffer.getByteLength()<3*a._vertNum*4)&&(a.lines_vbBuffer=new ParamData(3*l*4,!0)),a._lines_vbSize=3*a._vertNum*4;var c=a.lines_vbBuffer._float32Data,f=a.lines_vbBuffer._int32Data,d=0;for(n=0;n<a._vertNum;n++)c[d++]=a._lines_vbArray[2*n]+t,c[d++]=a._lines_vbArray[2*n+1]+e,f[d++]=u;(!a.lines_ibBuffer||a.lines_ibBuffer.getByteLength()<3*(a._vertNum-2)*2)&&(a.lines_ibBuffer=new ParamData(3*(l-2)*2,!0,!0)),a._lines_ibSize=3*(a._vertNum-2)*2;for(var E=a.lines_ibBuffer._int16Data,A=0;A<3*(a._vertNum-2);A++)E[A]=a._lines_ibArray[A]}if(_){l=a._vertNum;var D=lt.earcut(a._points,null,2);if(0<D.length){(!a.fill_ibBuffer||a.fill_ibBuffer.getByteLength()<2*D.length)&&(a.fill_ibBuffer=new ParamData(2*D.length,!0,!0)),a._fill_ibSize=2*D.length,E=a.fill_ibBuffer._int16Data;var R=0;for(A=0;A<D.length;A++)E[R++]=D[A]}u=(h=W.create(_.fillStyle)).numColor,(!a.fill_vbBuffer||a.fill_vbBuffer.getByteLength()<3*a._vertNum*4)&&(a.fill_vbBuffer=new ParamData(3*l*4,!0)),a._fill_vbSize=3*a._vertNum*4,c=a.fill_vbBuffer._float32Data;var m=a.fill_vbBuffer._int32Data;for(m=a.fill_vbBuffer._int32Data,n=d=0;n<a._vertNum;n++)c[d++]=a._points[2*n]+t,c[d++]=a._points[2*n+1]+e,m[d++]=u}a._paramData._float32Data;return(f=a._paramData._int32Data)[0]=1,r&&(f[T._PARAM_LINES_VB_POS_]=a.lines_vbBuffer.getPtrID(),f[T._PARAM_LINES_IB_POS_]=a.lines_ibBuffer.getPtrID(),f[T._PARAM_LINES_VB_SIZE_POS_]=a._lines_vbSize,f[T._PARAM_LINES_IB_SIZE_POS_]=a._lines_ibSize,f[T._PARAM_LINE_VB_OFFSET_POS_]=0,f[T._PARAM_LINE_IB_OFFSET_POS_]=0,f[T._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,z.syncBufferToRenderThread(a.lines_vbBuffer),z.syncBufferToRenderThread(a.lines_ibBuffer)),_&&(f[T._PARAM_FILL_VB_POS_]=a.fill_vbBuffer.getPtrID(),f[T._PARAM_FILL_IB_POS_]=a.fill_ibBuffer.getPtrID(),f[T._PARAM_FILL_VB_SIZE_POS_]=a._fill_vbSize,f[T._PARAM_FILL_IB_SIZE_POS_]=a._fill_ibSize,f[T._PARAM_FILL_VB_OFFSET_POS_]=0,f[T._PARAM_FILL_IB_OFFSET_POS_]=0,f[T._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_]=0,z.syncBufferToRenderThread(a.fill_vbBuffer),z.syncBufferToRenderThread(a.fill_ibBuffer)),z.syncBufferToRenderThread(a._paramData),_&&r?a._cmdCurrentPos=a._graphicsCmdEncoder.useCommandEncoder(T._DRAW_LINES_FILL_CMD_ENCODER_.getPtrID(),a._paramData.getPtrID(),-1):_&&!r?a._cmdCurrentPos=a._graphicsCmdEncoder.useCommandEncoder(T._DRAW_FILL_CMD_ENCODER_.getPtrID(),a._paramData.getPtrID(),-1):!_&&r&&(a._cmdCurrentPos=a._graphicsCmdEncoder.useCommandEncoder(T._DRAW_LINES_CMD_ENCODER_.getPtrID(),a._paramData.getPtrID(),-1)),z.syncBufferToRenderThread(a._graphicsCmdEncoder),a},T.ID="DrawPath",T._DRAW_LINES_CMD_ENCODER_=null,T._DRAW_LINES_FILL_CMD_ENCODER_=null,T._DRAW_FILL_CMD_ENCODER_=null,T._PARAM_LINES_VB_POS_=1,T._PARAM_LINES_IB_POS_=2,T._PARAM_LINES_VB_SIZE_POS_=3,T._PARAM_LINES_IB_SIZE_POS_=4,T._PARAM_FILL_VB_POS_=5,T._PARAM_FILL_IB_POS_=6,T._PARAM_FILL_VB_SIZE_POS_=7,T._PARAM_FILL_IB_SIZE_POS_=8,T._PARAM_FILL_VB_OFFSET_POS_=9,T._PARAM_FILL_IB_OFFSET_POS_=10,T._PARAM_LINE_VB_OFFSET_POS_=11,T._PARAM_LINE_IB_OFFSET_POS_=12,T._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_=13,T._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=14}(),function(){function t(){this.ALPHA=1,this.shaderType=0,this.defines=new Gt,this.fillStyle=K.DEFAULT,this.strokeStyle=K.DEFAULT}return v(t,"laya.webgl.shader.d2.Shader2D"),t.prototype.destroy=function(){this.defines=null,this.filters=null},t.__init__=function(){var t,e;t="/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(posuv.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#else\n\tgl_Position =vec4((posuv.x/size.x-0.5)*2.0,(0.5-posuv.y/size.y)*2.0,0.,1.0);\n#endif\n  \n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = posuv.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}",e="/*\n\ttexture和fillrect使用的。\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n//FILLTEXTURE\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}",$t.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}",$t.preCompile2D(0,4,t,e,null),t="/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(posuv.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#else\n\tgl_Position =vec4((posuv.x/size.x-0.5)*2.0,(0.5-posuv.y/size.y)*2.0,0.,1.0);\n#endif\n  \n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = posuv.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}",e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n\n#import?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n\n#import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_uniform;\n\n#import?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n\n#import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_uniform;\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   \n   #import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_logic;\n   \n   #import?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   \n   #import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_logic;\n   \n   #import?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$t.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",$t.preCompile2D(0,512,t,e,null)},t}()),Tt=function(){function t(t,e,i,_){this._idata=[]}v(t,"laya.layagl.CommandEncoder");var e=t.prototype;return e.getArrayData=function(){return this._idata},e.getPtrID=function(){return 0},e.beginEncoding=function(){},e.endEncoding=function(){},e.clearEncoding=function(){this._idata.length=0},e.getCount=function(){return this._idata.length},e.add_ShaderValue=function(t){this._idata.push(t)},e.addShaderUniform=function(t){this.add_ShaderValue(t)},t}(),vt=(function(){function D(){this._graphicsCmdEncoder=null,this._paramData=null,this._fromX=NaN,this._fromY=NaN,this._toX=NaN,this._toY=NaN,this._lineColor=null,this._lineWidth=NaN,this._vid=0}v(D,"laya.layagl.cmdNative.DrawLineCmdNative");var t=D.prototype;t.recover=function(){g.recover("DrawLineCmd",this)},E(0,t,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t;var e=W.create(this.lineColor).numColor,i=this._paramData._int32Data,_=D._PARAM_VB_POS_;_++,_++,i[_++]=e,_++,_++,i[_++]=e,_++,_++,i[_++]=e,_++,_++,i[_++]=e,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"cmdID",function(){return"DrawLine"}),E(0,t,"toY",function(){return this._toY},function(t){this._toY=t;var e=[this._fromX,this._fromY,this._toX,this._toY],i=[],_=[];Pt.createLine2(e,_,this._lineWidth,0,i,!1);var r=this._paramData._float32Data,a=(this._paramData._int32Data,this._paramData._int16Data),n=D._PARAM_VB_POS_;r[n++]=i[0],r[n++]=i[1],n++,r[n++]=i[2],r[n++]=i[3],n++,r[n++]=i[4],r[n++]=i[5],n++,r[n++]=i[6],r[n++]=i[7],n++;var s=2*D._PARAM_IB_POS_;a[s++]=_[0],a[s++]=_[1],a[s++]=_[2],a[s++]=_[3],a[s++]=_[4],a[s++]=_[5],z.syncBufferToRenderThread(this._paramData)}),E(0,t,"fromX",function(){return this._fromX},function(t){this._fromX=t;var e=[this._fromX,this._fromY,this._toX,this._toY],i=[],_=[];Pt.createLine2(e,_,this._lineWidth,0,i,!1);var r=this._paramData._float32Data,a=(this._paramData._int32Data,this._paramData._int16Data),n=D._PARAM_VB_POS_;r[n++]=i[0],r[n++]=i[1],n++,r[n++]=i[2],r[n++]=i[3],n++,r[n++]=i[4],r[n++]=i[5],n++,r[n++]=i[6],r[n++]=i[7],n++;var s=2*D._PARAM_IB_POS_;a[s++]=_[0],a[s++]=_[1],a[s++]=_[2],a[s++]=_[3],a[s++]=_[4],a[s++]=_[5],z.syncBufferToRenderThread(this._paramData)}),E(0,t,"vid",function(){return this._vid},function(t){this._vid=t}),E(0,t,"toX",function(){return this._toX},function(t){this._toX=t;var e=[this._fromX,this._fromY,this._toX,this._toY],i=[],_=[];Pt.createLine2(e,_,this._lineWidth,0,i,!1);var r=this._paramData._float32Data,a=(this._paramData._int32Data,this._paramData._int16Data),n=D._PARAM_VB_POS_;r[n++]=i[0],r[n++]=i[1],n++,r[n++]=i[2],r[n++]=i[3],n++,r[n++]=i[4],r[n++]=i[5],n++,r[n++]=i[6],r[n++]=i[7],n++;var s=2*D._PARAM_IB_POS_;a[s++]=_[0],a[s++]=_[1],a[s++]=_[2],a[s++]=_[3],a[s++]=_[4],a[s++]=_[5],z.syncBufferToRenderThread(this._paramData)}),E(0,t,"fromY",function(){return this._fromY},function(t){this._fromY=t;var e=[this._fromX,this._fromY,this._toX,this._toY],i=[],_=[];Pt.createLine2(e,_,this._lineWidth,0,i,!1);var r=this._paramData._float32Data,a=(this._paramData._int32Data,this._paramData._int16Data),n=D._PARAM_VB_POS_;r[n++]=i[0],r[n++]=i[1],n++,r[n++]=i[2],r[n++]=i[3],n++,r[n++]=i[4],r[n++]=i[5],n++,r[n++]=i[6],r[n++]=i[7],n++;var s=2*D._PARAM_IB_POS_;a[s++]=_[0],a[s++]=_[1],a[s++]=_[2],a[s++]=_[3],a[s++]=_[4],a[s++]=_[5],z.syncBufferToRenderThread(this._paramData)}),E(0,t,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t;var e=[this._fromX,this._fromY,this._toX,this._toY],i=[],_=[];Pt.createLine2(e,_,this.lineWidth,0,i,!1);var r=this._paramData._float32Data,a=(this._paramData._int32Data,this._paramData._int16Data),n=D._PARAM_VB_POS_;r[n++]=i[0],r[n++]=i[1],n++,r[n++]=i[2],r[n++]=i[3],n++,r[n++]=i[4],r[n++]=i[5],n++,r[n++]=i[6],r[n++]=i[7],n++;var s=2*D._PARAM_IB_POS_;a[s++]=_[0],a[s++]=_[1],a[s++]=_[2],a[s++]=_[3],a[s++]=_[4],a[s++]=_[5],z.syncBufferToRenderThread(this._paramData)}),D.create=function(t,e,i,_,r,a,n){var s=g.getItemByClass("DrawLineCmd",D);s._graphicsCmdEncoder=this._commandEncoder,D._DRAW_LINE_CMD_ENCODER_||((D._DRAW_LINE_CMD_ENCODER_=z.instance.createCommandEncoder(152,32,!0)).useProgramEx(Lt.PROGRAMEX_DRAWVG),D._DRAW_LINE_CMD_ENCODER_.useVDO(Lt.VDO_MESHVG),D._DRAW_LINE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),D._DRAW_LINE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),D._DRAW_LINE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),D._DRAW_LINE_CMD_ENCODER_.setMeshByParamData(4*D._PARAM_VB_POS_,4*D._PARAM_VB_OFFSET_POS_,4,4*D._PARAM_IB_POS_,4*D._PARAM_IB_OFFSET_POS_,8,4*D._PARAM_INDEX_ELEMENT_OFFSET_POS_),D._DRAW_LINE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),D._DRAW_LINE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(D._DRAW_LINE_CMD_ENCODER_)),s._paramData||(s._paramData=new ParamData(96,!0)),s._fromX=t,s._fromY=e,s._toX=i,s._toY=_,s._lineColor=r,s._lineWidth=a,s._vid=n;var o=W.create(r).numColor,h=[t,e,i,_],u=[],l=[];Pt.createLine2(h,l,a,0,u,!1);var c=s._paramData._float32Data,f=s._paramData._int32Data,d=s._paramData._int16Data;f[0]=1,f[1]=48,f[2]=12,f[D._PARAM_VB_OFFSET_POS_]=0,f[D._PARAM_IB_OFFSET_POS_]=0,f[D._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0;var E=D._PARAM_VB_POS_;c[E++]=u[0],c[E++]=u[1],f[E++]=o,c[E++]=u[2],c[E++]=u[3],f[E++]=o,c[E++]=u[4],c[E++]=u[5],f[E++]=o,c[E++]=u[6],c[E++]=u[7],f[E++]=o;var A=2*D._PARAM_IB_POS_;return d[A++]=l[0],d[A++]=l[1],d[A++]=l[2],d[A++]=l[3],d[A++]=l[4],d[A++]=l[5],c[D._PARAM_LINECOLOR_POS_]=r||4278190335,c[D._PARAM_LINEWIDTH_POS_]=a,c[D._PARAM_VID_POS_]=n,z.syncBufferToRenderThread(s._paramData),s._graphicsCmdEncoder.useCommandEncoder(D._DRAW_LINE_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1),z.syncBufferToRenderThread(s._graphicsCmdEncoder),s},D.ID="DrawLine",D._DRAW_LINE_CMD_ENCODER_=null,D._PARAM_VB_POS_=3,D._PARAM_IB_POS_=15,D._PARAM_LINECOLOR_POS_=18,D._PARAM_LINEWIDTH_POS_=19,D._PARAM_VID_POS_=20,D._PARAM_VB_OFFSET_POS_=21,D._PARAM_IB_OFFSET_POS_=22,D._PARAM_INDEX_ELEMENT_OFFSET_POS_=23}(),function(){function h(){this._draw_texture_cmd_encoder_=z.instance.createCommandEncoder(64,32,!0)}v(h,"laya.layagl.cmdNative.FillBorderWordsCmdNative");var t=h.prototype;t.createFillBorderText=function(u,t,e,i,_,r,a,n){W.create(r).numColor;var s={};s._curMat=new S,s._italicDeg=0,s._drawTextureUseColor=4294967295,s.fillStyle=r,s._fillColor=4294967295,s.setFillColor=function(t){s._fillColor=t},s.getFillColor=function(){return s._fillColor},s.mixRGBandAlpha=function(t){return t},s._drawTextureM=function(t,e,i,_,r,a,n,s){u.blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),u.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),u.useVDO(Lt.VDO_MESHQUADTEXTURE),u.uniformEx(Lt.GLOBALVALUE_VIEWS,0),u.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),u.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),u.uniformTexture(3,33984,t.bitmap._glTexture);var o=new Float32Array([e,i,s[0],s[1],0,0,e+_,i,s[2],s[3],0,0,e+_,i+r,s[4],s[5],0,0,e,i+r,s[6],s[7],0,0]),h=new Int32Array(o.buffer);h[4]=h[10]=h[16]=h[22]=4294967295,h[5]=h[11]=h[17]=h[23]=4294967295,u.setRectMesh(1,o,o.length),u.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),u.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(u)},h.cbook.filltext_native(s,null,t,e,i,_,r,a,n,null,0)},t.recover=function(){this._graphicsCmdEncoder=null,this.words=null,g.recover("FillBorderWordsCmd",this)},E(0,t,"cmdID",function(){return"FillBorderWords"}),h.create=function(t,e,i,_,r,a,n){h.cbook||new Error("Error:charbook not create!");var s=g.getItemByClass("FillBorderWordsCmd",h),o=s._graphicsCmdEncoder=this._commandEncoder;return s.words=t,s.x=e,s.y=i,s.font=_,s.color=r,s.strokeColor=a,s.strokeWidth=n,s._draw_texture_cmd_encoder_.clearEncoding(),s.createFillBorderText(s._draw_texture_cmd_encoder_,t,e,i,_,r,a,n),z.syncBufferToRenderThread(s._draw_texture_cmd_encoder_),o.useCommandEncoder(s._draw_texture_cmd_encoder_.getPtrID(),-1,-1),z.syncBufferToRenderThread(o),s},h.ID="FillBorderWords",n(h,["cbook",function(){return this.cbook=gt.charbookInst}])}(),function(){function t(t,e,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return v(t,"laya.webgl.shapes.EarcutNode"),t}()),Pt=function(){function N(){}return v(N,"laya.webgl.shapes.BasePoly"),N.createLine2=function(t,e,i,_,r,a,n){if(t.length<4)return null;var s=N.tempData.length>t.length+2?N.tempData:new Array(t.length+2);s[0]=t[0],s[1]=t[1];var o=2,h=0,u=t.length;for(h=2;h<u;h+=2).01<Math.abs(t[h]-t[h-2])+Math.abs(t[h+1]-t[h-1])&&(s[o++]=t[h],s[o++]=t[h+1]);a&&.01<Math.abs(t[0]-s[o-2])+Math.abs(t[1]-s[o-1])&&(s[o++]=t[0],s[o++]=t[1]);var l=r;u=o/2;var c,f,d,E,A,D,R,m,T,v,P,p,C,M,O,y,L,S,g,b,B=i/2;d=s[0],E=s[1],v=d-(A=s[2]);var I=T=(T=-(E-(D=s[3])))/(b=Math.sqrt(T*T+v*v))*B,x=v=v/b*B;for(n&&(T=n.a*I+n.c*x,v=n.b*I+n.d*x),l.push(d-T,E-v,d+T,E+v),h=1;h<u-1;h++)d=s[2*(h-1)],E=s[2*(h-1)+1],A=s[2*h],D=s[2*h+1],R=s[2*(h+1)],m=s[2*(h+1)+1],v=d-A,T=(T=-(E-D))/(b=Math.sqrt(T*T+v*v))*B,v=v/b*B,n&&(I=T,x=v,T=n.a*I+n.c*x,v=n.b*I+n.d*x),p=A-R,P=(P=-(D-m))/(b=Math.sqrt(P*P+p*p))*B,p=p/b*B,n&&(I=P,x=p,P=n.a*I+n.c*x,p=n.b*I+n.d*x),O=(-T+d)*(-v+D)-(-T+A)*(-v+E),S=(-P+R)*(-p+D)-(-P+A)*(-p+m),g=(C=-v+E-(-v+D))*(L=-P+A-(-P+R))-(y=-p+m-(-p+D))*(M=-T+A-(-T+d)),Math.abs(g)<.1?(g+=10.1,l.push(A-T,D-v,A+T,D+v)):(((c=(M*S-L*O)/g)-A)*(c-A)+((f=(y*O-C*S)/g)-D)+(f-D),l.push(c,f,A-(c-A),D-(f-D)));for(d=s[o-4],E=s[o-3],v=d-(A=s[o-2]),T=(T=-(E-(D=s[o-1])))/(b=Math.sqrt(T*T+v*v))*B,v=v/b*B,n&&(I=T,x=v,T=n.a*I+n.c*x,v=n.b*I+n.d*x),l.push(A-T,D-v,A+T,D+v),h=1;h<u;h++)e.push(_+2*(h-1),_+2*(h-1)+1,_+2*h+1,_+2*h+1,_+2*h,_+2*(h-1));return l},N.createLineTriangle=function(t,e,i,_,r,a,n){var s=t.slice(),o=s.length,h=s[0],u=s[1],l=s[2],c=(s[2],0),f=0,d=0,E=0,A=o/2;if(!(A<=1)&&2!=A){for(var D=new Array(4*A),R=0,m=0,T=0;T<A-1;T++)h=s[m++],u=s[m++],l=s[m++],E=s[m++]-u,0!=(d=l-h)&&0!=E&&.001<(c=Math.sqrt(d*d+E*E))&&(D[f=4*R]=h,D[f+1]=u,D[f+2]=d/c,D[f+3]=E/c,R++);for(_?(h=s[o-2],u=s[o-1],l=s[0],E=s[1]-u,0!=(d=l-h)&&0!=E&&.001<(c=Math.sqrt(d*d+E*E))&&(D[f=4*R]=h,D[f+1]=u,D[f+2]=d/c,D[f+3]=E/c,R++)):(D[f=4*R]=h,D[f+1]=u,D[f+2]=d/c,D[f+3]=E/c,R++),T=m=0;T<A;T++){h=s[m],u=s[m+1],l=s[m+2],s[m+3];s[m+4],s[m+5]}}},n(N,["tempData",function(){return this.tempData=new Array(256)}]),N}(),pt=(function(){function D(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=NaN,this._y=NaN,this._width=NaN,this._height=NaN,this._matrix=null,this._alpha=NaN,this._color=null,this._blendMode=null,this._cmdCurrentPos=0,this._blend_src=0,this._blend_dest=0}v(D,"laya.layagl.cmdNative.DrawTextureCmdNative");var t=D.prototype;t.recover=function(){this._texture=null,g.recover("DrawTextureCmd",this)},t._setBlendMode=function(t){switch(t){case"normal":this._blend_src=1,this._blend_dest=771;break;case"add":this._blend_src=1,this._blend_dest=772;break;case"multiply":this._blend_src=774,this._blend_dest=771;break;case"screen":case"light":this._blend_src=1,this._blend_dest=1;break;case"overlay":this._blend_src=1,this._blend_dest=769;break;case"destination-out":this._blend_src=0,this._blend_dest=0;break;case"mask":this._blend_src=0,this._blend_dest=770;break;default:alert("_setBlendMode Unknown type")}},t._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},E(0,t,"cmdID",function(){return"DrawTexture"}),E(0,t,"matrix",function(){return this._matrix},function(t){this._matrix||(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.getPtrID(),z.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._matrix=t;var e=this._paramData._float32Data;e[D._PARAM_MATRIX_POS_]=t.a,e[D._PARAM_MATRIX_POS_+1]=t.b,e[D._PARAM_MATRIX_POS_+2]=t.c,e[D._PARAM_MATRIX_POS_+3]=t.d,e[D._PARAM_MATRIX_POS_+4]=t.tx,e[D._PARAM_MATRIX_POS_+5]=t.ty,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"y",function(){return this._y},function(t){this._y=t;var e=this._paramData._float32Data;e[D._PARAM_VB_POS_+1]=this._y,e[D._PARAM_VB_POS_+7]=this._y,e[D._PARAM_VB_POS_+13]=this._y+this._height,e[D._PARAM_VB_POS_+19]=this._y+this._height,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"texture",function(){return this._texture},function(t){if(t&&t.url){this._texture=t,this._paramData._int32Data[D._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id;var e=this._paramData._float32Data,i=this.texture.uv;e[D._PARAM_VB_POS_+2]=i[0],e[D._PARAM_VB_POS_+3]=i[1],e[D._PARAM_VB_POS_+8]=i[2],e[D._PARAM_VB_POS_+9]=i[3],e[D._PARAM_VB_POS_+14]=i[4],e[D._PARAM_VB_POS_+15]=i[5],e[D._PARAM_VB_POS_+20]=i[6],e[D._PARAM_VB_POS_+21]=i[7],z.syncBufferToRenderThread(this._paramData)}}),E(0,t,"width",function(){return this._width},function(t){this._width=t;var e=this._paramData._float32Data;e[D._PARAM_VB_POS_]=this._x,e[D._PARAM_VB_POS_+6]=this._x+this._width,e[D._PARAM_VB_POS_+12]=this._x+this._width,e[D._PARAM_VB_POS_+18]=this._x,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"x",function(){return this._x},function(t){this._x=t;var e=this._paramData._float32Data;e[D._PARAM_VB_POS_]=this._x,e[D._PARAM_VB_POS_+6]=this._x+this._width,e[D._PARAM_VB_POS_+12]=this._x+this._width,e[D._PARAM_VB_POS_+18]=this._x,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"height",function(){return this._height},function(t){this._height=t;var e=this._paramData._float32Data;e[D._PARAM_VB_POS_+1]=this._y,e[D._PARAM_VB_POS_+7]=this._y,e[D._PARAM_VB_POS_+13]=this._y+this._height,e[D._PARAM_VB_POS_+19]=this._y+this._height,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"alpha",function(){return this._alpha},function(t){this._alpha=t}),D.create=function(t,e,i,_,r,a,n,s,o){var h=g.getItemByClass("DrawTextureCmd",D);h._graphicsCmdEncoder=this._commandEncoder,D._DRAW_TEXTURE_CMD_ENCODER_||((D._DRAW_TEXTURE_CMD_ENCODER_=z.instance.createCommandEncoder(188,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),D._DRAW_TEXTURE_CMD_ENCODER_.blendFuncByParamData(4*D._PARAM_BLEND_SRC_POS_,4*D._PARAM_BLEND_DEST_POS_),D._DRAW_TEXTURE_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),D._DRAW_TEXTURE_CMD_ENCODER_.useVDO(Lt.VDO_MESHQUADTEXTURE),D._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),D._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),D._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),D._DRAW_TEXTURE_CMD_ENCODER_.uniformTextureByParamData(4*D._PARAM_UNIFORM_LOCATION_POS_,4*D._PARAM_TEX_LOCATION_POS_,4*D._PARAM_TEXTURE_POS_),D._DRAW_TEXTURE_CMD_ENCODER_.setRectMeshByParamData(4*D._PARAM_RECT_NUM_POS_,4*D._PARAM_VB_POS_,4*D._PARAM_VB_SIZE_POS_),D._DRAW_TEXTURE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),D._DRAW_TEXTURE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(D._DRAW_TEXTURE_CMD_ENCODER_)),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_||((D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_=z.instance.createCommandEncoder(224,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.blendFuncByParamData(4*D._PARAM_BLEND_SRC_POS_,4*D._PARAM_BLEND_DEST_POS_),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.useVDO(Lt.VDO_MESHQUADTEXTURE),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.save(),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.setGlobalValueByParamData(Lt.GLOBALVALUE_MATRIX32,7,4*D._PARAM_MATRIX_POS_),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformTextureByParamData(4*D._PARAM_UNIFORM_LOCATION_POS_,4*D._PARAM_TEX_LOCATION_POS_,4*D._PARAM_TEXTURE_POS_),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.setRectMeshByParamData(4*D._PARAM_RECT_NUM_POS_,4*D._PARAM_VB_POS_,4*D._PARAM_VB_SIZE_POS_),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.restore(),z.syncBufferToRenderThread(D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_)),h._paramData||(h._paramData=new ParamData(148,!0)),h._texture=t,h._x=e,h._y=i,h._width=_,h._height=r,h._matrix=a,h._alpha=n,h._color=s,h._blendMode=o;var u=0!=_?_:t.bitmap.width,l=0!=r?r:t.bitmap.height,c=t.uv,f=h._paramData._float32Data,d=h._paramData._int32Data;d[D._PARAM_UNIFORM_LOCATION_POS_]=3,d[D._PARAM_TEX_LOCATION_POS_]=33984,d[D._PARAM_TEXTURE_POS_]=t.bitmap._glTexture.id,d[D._PARAM_RECT_NUM_POS_]=1,d[D._PARAM_VB_SIZE_POS_]=96,o?(h._setBlendMode(o),d[D._PARAM_BLEND_SRC_POS_]=h._blend_src,d[D._PARAM_BLEND_DEST_POS_]=h._blend_dest):(d[D._PARAM_BLEND_SRC_POS_]=-1,d[D._PARAM_BLEND_DEST_POS_]=-1);var E=4294967295;n&&(E=h._mixRGBandAlpha(E,n));var A=D._PARAM_VB_POS_;return f[A++]=e,f[A++]=i,f[A++]=c[0],f[A++]=c[1],d[A++]=E,d[A++]=4294967295,f[A++]=e+u,f[A++]=i,f[A++]=c[2],f[A++]=c[3],d[A++]=E,d[A++]=4294967295,f[A++]=e+u,f[A++]=i+l,f[A++]=c[4],f[A++]=c[5],d[A++]=E,d[A++]=4294967295,f[A++]=e,f[A++]=i+l,f[A++]=c[6],f[A++]=c[7],d[A++]=E,d[A++]=4294967295,a&&(f[D._PARAM_MATRIX_POS_]=a.a,f[D._PARAM_MATRIX_POS_+1]=a.b,f[D._PARAM_MATRIX_POS_+2]=a.c,f[D._PARAM_MATRIX_POS_+3]=a.d,f[D._PARAM_MATRIX_POS_+4]=a.tx,f[D._PARAM_MATRIX_POS_+5]=a.ty),z.syncBufferToRenderThread(h._paramData),h._cmdCurrentPos=a?h._graphicsCmdEncoder.useCommandEncoder(D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.getPtrID(),h._paramData.getPtrID(),-1):h._graphicsCmdEncoder.useCommandEncoder(D._DRAW_TEXTURE_CMD_ENCODER_.getPtrID(),h._paramData.getPtrID(),-1),z.syncBufferToRenderThread(h._graphicsCmdEncoder),h},D.ID="DrawTexture",D._DRAW_TEXTURE_CMD_ENCODER_=null,D._DRAW_TEXTURE_CMD_ENCODER_MATRIX_=null,D._PARAM_UNIFORM_LOCATION_POS_=0,D._PARAM_TEX_LOCATION_POS_=1,D._PARAM_TEXTURE_POS_=2,D._PARAM_RECT_NUM_POS_=3,D._PARAM_VB_SIZE_POS_=4,D._PARAM_VB_POS_=5,D._PARAM_MATRIX_POS_=29,D._PARAM_BLEND_SRC_POS_=35,D._PARAM_BLEND_DEST_POS_=36}(),function(){function i(){this._graphicsCmdEncoder=null}v(i,"laya.layagl.cmdNative.RestoreCmdNative");var t=i.prototype;t.recover=function(){g.recover("RestoreCmd",this)},E(0,t,"cmdID",function(){return"Restore"}),i.create=function(){var t=g.getItemByClass("RestoreCmd",i),e=t._graphicsCmdEncoder=this._commandEncoder;return e.restore(),z.syncBufferToRenderThread(e),t},i.ID="Restore"}(),function(){function a(){}return v(a,"laya.webgl.resource.WebGLRTMgr"),a.getRT=function(t,e){e|=0,1e4<=(t|=0)&&console.error("getRT error! w too big");var i,_=1e4*e+t,r=a.dict[_];return r&&0<r.length?(i=r.pop())._mgrKey=_:(i=new te(t,e,1,-1))._mgrKey=_,i},a.releaseRT=function(t){if(!(t._mgrKey<=0)){var e=a.dict[t._mgrKey];!e&&(e=[],a.dict[t._mgrKey]=e),t._mgrKey=0,e.push(t)}},a.dict={},a}()),Ct=(function(){function h(){this._graphicsCmdEncoder=null,this._paramData=null,this.vbBuffer=null,this._template=null,this._floatCountPerVertex=29,this._firstNewElement=0,this._firstFreeElement=0,this._firstActiveElement=0,this._firstRetiredElement=0,this._maxParticleNum=0}v(h,"laya.layagl.cmdNative.DrawParticleCmdNative");var t=h.prototype;t.updateParticle=function(){if(this._template.texture){this._template.updateParticleForNative();var t=this._template.sv,e=this._paramData._int32Data,i=this._paramData._float32Data;i[h._PARAM_CURRENTTIME_POS_]=t.u_CurrentTime,i[h._PARAM_DURATION_POS_]=t.u_Duration,i[h._PARAM_ENDVEL_POS_]=t.u_EndVelocity,i[h._PARAM_GRAVITY_POS_]=t.u_Gravity[0],i[h._PARAM_GRAVITY_POS_+1]=t.u_Gravity[1],i[h._PARAM_GRAVITY_POS_+2]=t.u_Gravity[2],t.size[0]=Ct.width,t.size[1]=Ct.height,i[h._PARAM_SIZE_POS_]=t.size[0],i[h._PARAM_SIZE_POS_+1]=t.size[1],i[h._PARAM_MAT_POS_]=1,i[h._PARAM_MAT_POS_+1]=0,i[h._PARAM_MAT_POS_+2]=0,i[h._PARAM_MAT_POS_+3]=0,i[h._PARAM_MAT_POS_+4]=0,i[h._PARAM_MAT_POS_+5]=1,i[h._PARAM_MAT_POS_+6]=0,i[h._PARAM_MAT_POS_+7]=0,i[h._PARAM_MAT_POS_+8]=0,i[h._PARAM_MAT_POS_+9]=0,i[h._PARAM_MAT_POS_+10]=1,i[h._PARAM_MAT_POS_+11]=0,i[h._PARAM_MAT_POS_+12]=0,i[h._PARAM_MAT_POS_+13]=0,i[h._PARAM_MAT_POS_+14]=0,i[h._PARAM_MAT_POS_+15]=1,e[h._PARAM_TEXTURE_LOC_POS_]=33984,e[h._PARAM_TEXTURE_POS_]=this._template.texture.bitmap._glTexture.id,this.vbBuffer=this._template.getConchMesh(),this._firstNewElement=this._template.getFirstNewElement(),this._firstFreeElement=this._template.getFirstFreeElement(),this._firstActiveElement=this._template.getFirstActiveElement(),this._firstRetiredElement=this._template.getFirstRetiredElement();var _=0,r=0,a=0,n=0,s=0,o=0;this._firstActiveElement!=this._firstFreeElement&&(this._firstActiveElement<this._firstFreeElement?(e[h._PARAM_REGDATA_POS_]=1,s=this._firstFreeElement-this._firstActiveElement,_=(this._firstFreeElement-this._firstActiveElement)*this._floatCountPerVertex*4*4,a=this._firstActiveElement*this._floatCountPerVertex*4*4):(e[h._PARAM_REGDATA_POS_]=0,s=this._maxParticleNum-this._firstActiveElement,_=(this._maxParticleNum-this._firstActiveElement)*this._floatCountPerVertex*4*4,a=this._firstActiveElement*this._floatCountPerVertex*4*4,0<this._firstFreeElement?(o=this._firstFreeElement,r=this._firstFreeElement*this._floatCountPerVertex*4*4,n=0):e[h._PARAM_REGDATA_POS_]=1)),e[h._PARAM_VB1_POS_]=this.vbBuffer.getPtrID(),e[h._PARAM_RECT1_NUM_POS_]=s,e[h._PARAM_VB1_SIZE_POS_]=_,e[h._PARAM_VB1_OFFSET_POS_]=a,z.syncBufferToRenderThread(this.vbBuffer),0<r&&(e[h._PARAM_VB2_POS_]=this.vbBuffer.getPtrID(),e[h._PARAM_RECT2_NUM_POS_]=o,e[h._PARAM_VB2_SIZE_POS_]=r,e[h._PARAM_VB2_OFFSET_POS_]=n),z.syncBufferToRenderThread(this._paramData),this._template.addDrawCounter()}},t.recover=function(){this._template=null,g.recover("DrawParticleCmd",this)},E(0,t,"cmdID",function(){return"DrawParticleCmd"}),h.create=function(t){var e=g.getItemByClass("DrawParticleCmd",h);e._graphicsCmdEncoder=this._commandEncoder,h._DRAW_PARTICLE_CMD_ENCODER_||((h._DRAW_PARTICLE_CMD_ENCODER_=z.instance.createCommandEncoder(284,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),h._DRAW_PARTICLE_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWPARTICLE),h._DRAW_PARTICLE_CMD_ENCODER_.useVDO(Lt.VDO_MESHPARTICLE),h._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(0,4*h._PARAM_CURRENTTIME_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(1,4*h._PARAM_DURATION_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(2,4*h._PARAM_ENDVEL_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(3,4*h._PARAM_GRAVITY_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(4,4*h._PARAM_SIZE_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(5,4*h._PARAM_MAT_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.uniformTextureByParamData(4*h._PARAM_TEXTURE_UNIFORMLOC_POS_,4*h._PARAM_TEXTURE_LOC_POS_,4*h._PARAM_TEXTURE_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.setRectMeshExByParamData(4*h._PARAM_RECT1_NUM_POS_,4*h._PARAM_VB1_POS_,4*h._PARAM_VB1_SIZE_POS_,4*h._PARAM_VB1_OFFSET_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,1,7),h._DRAW_PARTICLE_CMD_ENCODER_.loadDataToRegByParamData(0,4*h._PARAM_REGDATA_POS_,4),h._DRAW_PARTICLE_CMD_ENCODER_.ifGreater0(0,2),h._DRAW_PARTICLE_CMD_ENCODER_.setRectMeshExByParamData(4*h._PARAM_RECT2_NUM_POS_,4*h._PARAM_VB2_POS_,4*h._PARAM_VB2_SIZE_POS_,4*h._PARAM_VB2_OFFSET_POS_),h._DRAW_PARTICLE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,1,7),z.syncBufferToRenderThread(h._DRAW_PARTICLE_CMD_ENCODER_)),e._paramData||(e._paramData=new ParamData(144,!0)),e._template=t,e._maxParticleNum=t.settings.maxPartices;var i=e._paramData._int32Data,_=(t._sv,e._paramData._float32Data),r=0;for(_[h._PARAM_CURRENTTIME_POS_]=-1,_[h._PARAM_DURATION_POS_]=-1,_[h._PARAM_ENDVEL_POS_]=-1,_[h._PARAM_GRAVITY_POS_]=-1,_[h._PARAM_GRAVITY_POS_+1]=-1,_[h._PARAM_GRAVITY_POS_+2]=-1,_[h._PARAM_SIZE_POS_]=-1,_[h._PARAM_SIZE_POS_+1]=-1,r=0;r<16;r++)_[h._PARAM_MAT_POS_+r]=-1;return i[h._PARAM_TEXTURE_LOC_POS_]=-1,i[h._PARAM_TEXTURE_POS_]=-1,i[h._PARAM_TEXTURE_UNIFORMLOC_POS_]=6,i[h._PARAM_REGDATA_POS_]=0,i[h._PARAM_VB1_POS_]=-1,i[h._PARAM_VB2_POS_]=-1,i[h._PARAM_VB1_SIZE_POS_]=-1,i[h._PARAM_VB2_SIZE_POS_]=-1,i[h._PARAM_RECT1_NUM_POS_]=-1,i[h._PARAM_RECT2_NUM_POS_]=-1,z.syncBufferToRenderThread(e._paramData),e._graphicsCmdEncoder.useCommandEncoder(h._DRAW_PARTICLE_CMD_ENCODER_.getPtrID(),e._paramData.getPtrID(),-1),z.syncBufferToRenderThread(e._graphicsCmdEncoder),e},h.ID="DrawParticleCmd",h._DRAW_PARTICLE_CMD_ENCODER_=null,h._PARAM_VB1_POS_=0,h._PARAM_VB2_POS_=1,h._PARAM_VB1_SIZE_POS_=2,h._PARAM_VB2_SIZE_POS_=3,h._PARAM_CURRENTTIME_POS_=4,h._PARAM_DURATION_POS_=5,h._PARAM_ENDVEL_POS_=6,h._PARAM_GRAVITY_POS_=7,h._PARAM_SIZE_POS_=10,h._PARAM_MAT_POS_=12,h._PARAM_TEXTURE_LOC_POS_=28,h._PARAM_TEXTURE_POS_=29,h._PARAM_REGDATA_POS_=30,h._PARAM_TEXTURE_UNIFORMLOC_POS_=31,h._PARAM_RECT1_NUM_POS_=32,h._PARAM_RECT2_NUM_POS_=33,h._PARAM_VB1_OFFSET_POS_=34,h._PARAM_VB2_OFFSET_POS_=35}(),function(){function r(){}return v(r,"laya.webgl.utils.RenderState2D"),r.mat2MatArray=function(t,e){var i=t,_=e;return _[0]=i.a,_[1]=i.b,_[2]=r.EMPTYMAT4_ARRAY[2],_[3]=r.EMPTYMAT4_ARRAY[3],_[4]=i.c,_[5]=i.d,_[6]=r.EMPTYMAT4_ARRAY[6],_[7]=r.EMPTYMAT4_ARRAY[7],_[8]=r.EMPTYMAT4_ARRAY[8],_[9]=r.EMPTYMAT4_ARRAY[9],_[10]=r.EMPTYMAT4_ARRAY[10],_[11]=r.EMPTYMAT4_ARRAY[11],_[12]=i.tx,_[13]=i.ty,_[14]=r.EMPTYMAT4_ARRAY[14],_[15]=r.EMPTYMAT4_ARRAY[15],e},r.restoreTempArray=function(){r.TEMPMAT4_ARRAY[0]=1,r.TEMPMAT4_ARRAY[1]=0,r.TEMPMAT4_ARRAY[4]=0,r.TEMPMAT4_ARRAY[5]=1,r.TEMPMAT4_ARRAY[12]=0,r.TEMPMAT4_ARRAY[13]=0},r.clear=function(){r.worldScissorTest=!1,r.worldAlpha=1},r._MAXSIZE=99999999,r.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.worldMatrix4=r.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.worldAlpha=1,r.worldScissorTest=!1,r.worldShaderDefines=null,r.worldFilters=null,r.width=0,r.height=0,n(r,["worldMatrix",function(){return this.worldMatrix=new S}]),r}()),Mt=(function(){function r(){this._renderType=0,this._repaint=0,this._x=NaN,this._y=NaN}v(r,"laya.layagl.QuickTestTool");var t=r.prototype;t.render=function(t,e,i){x.spriteCount++,r._addType(this._renderType),r.showRenderTypeInfo(this._renderType),D.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0},t._stageRender=function(t,e,i){r._countStart(),r._PreStageRender.call(P.stage,t,e,i),r._countEnd()},r.getMCDName=function(t){return r._typeToNameDic[t]},r.showRenderTypeInfo=function(t,e){if(void 0===e&&(e=!1),e||!r.showedDic[t]){if(r.showedDic[t]=!0,!r._rendertypeToStrDic[t]){var i=[],_=0;for(_=1;_<=t;)_&t&&i.push(r.getMCDName(_&t)),_<<=1;r._rendertypeToStrDic[t]=i.join(",")}console.log("cmd:",r._rendertypeToStrDic[t])}},r.__init__=function(){r._typeToNameDic[1]="ALPHA",r._typeToNameDic[2]="TRANSFORM",r._typeToNameDic[256]="TEXTURE",r._typeToNameDic[512]="GRAPHICS",r._typeToNameDic[4096]="ONECHILD",r._typeToNameDic[8192]="CHILDS",r._typeToNameDic[3]="TRANSFORM|ALPHA",r._typeToNameDic[8]="CANVAS",r._typeToNameDic[4]="BLEND",r._typeToNameDic[16]="FILTERS",r._typeToNameDic[32]="MASK",r._typeToNameDic[64]="CLIP",r._typeToNameDic[1024]="LAYAGL3D"},r._countStart=function(){var t;for(t in r._countDic)r._countDic[t]=0},r._countEnd=function(){60<++r._i&&(r.showCountInfo(),r._i=0)},r._addType=function(t){r._countDic[t]?r._countDic[t]+=1:r._countDic[t]=1},r.showCountInfo=function(){var t;for(t in console.log("==================="),r._countDic)console.log("count:"+r._countDic[t]),r.showRenderTypeInfo(t,!0)},r.enableQuickTest=function(){r.__init__(),B.prototype.render=r.prototype.render,r._PreStageRender=I.prototype.render,I.prototype.render=r.prototype._stageRender},r.showedDic={},r._rendertypeToStrDic={},r._typeToNameDic={},r._PreStageRender=null,r._countDic={},r._i=0}(),function(){function t(){this.blendShader=0,this.submitType=0,this.other=0,this.clear()}v(t,"laya.webgl.submit.SubmitKey");var e=t.prototype;return e.clear=function(){this.submitType=-1,this.blendShader=this.other=0},e.copyFrom=function(t){this.other=t.other,this.blendShader=t.blendShader,this.submitType=t.submitType},e.copyFrom2=function(t,e,i){this.blendShader=t.blendShader,this.other=i,this.submitType=e},e.equal3_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},e.equal4_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},e.equal_3=function(t){return this.submitType===t.submitType&&this.blendShader===t.blendShader},e.equal=function(t){return this.other===t.other&&this.submitType===t.submitType&&this.blendShader===t.blendShader},t}()),Ot=(function(){function l(){this._graphicsCmdEncoder=null,this._index=0,this._text=null,this._x=NaN,this._y=NaN,this._font=null,this._color=null,this._strokeColor=null,this._strokeWidth=0,this._textAlign=null,this._draw_texture_cmd_encoder_=z.instance.createCommandEncoder(64,32,!0)}v(l,"laya.layagl.cmdNative.FillBorderTextCmdNative");var t=l.prototype;t.createFillBorderText=function(u,t,e,i,_,r,a,n,s){W.create(r).numColor;var o={};o._curMat=new S,o._italicDeg=0,o._drawTextureUseColor=4294967295,o.fillStyle=r,o._fillColor=4294967295,o.setFillColor=function(t){o._fillColor=t},o.getFillColor=function(){return o._fillColor},o.mixRGBandAlpha=function(t){return t},o._drawTextureM=function(t,e,i,_,r,a,n,s){u.blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),u.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),u.useVDO(Lt.VDO_MESHQUADTEXTURE),u.uniformEx(Lt.GLOBALVALUE_VIEWS,0),u.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),u.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),u.uniformTexture(3,33984,t.bitmap._glTexture);var o=new Float32Array([e,i,s[0],s[1],0,0,e+_,i,s[2],s[3],0,0,e+_,i+r,s[4],s[5],0,0,e,i+r,s[6],s[7],0,0]),h=new Int32Array(o.buffer);h[4]=h[10]=h[16]=h[22]=4294967295,h[5]=h[11]=h[17]=h[23]=4294967295,u.setRectMesh(1,o,o.length),u.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),u.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(u)},l.cbook.filltext_native(o,t,null,e,i,_,r,a,n,s)},t.recover=function(){this._graphicsCmdEncoder=null,g.recover("FillBorderTextCmd",this)},E(0,t,"text",function(){return this._text},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._text=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),z.syncBufferToRenderThread(e)}),E(0,t,"cmdID",function(){return"FillBorderText"}),E(0,t,"font",function(){return this._font},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._font=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),z.syncBufferToRenderThread(e)}),E(0,t,"color",function(){return this._color},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._color=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),z.syncBufferToRenderThread(e)}),E(0,t,"textAlign",function(){return this._textAlign},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._textAlign=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),z.syncBufferToRenderThread(e)}),E(0,t,"x",function(){return this._x},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._x=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),z.syncBufferToRenderThread(e)}),E(0,t,"y",function(){return this._y},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._y=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),z.syncBufferToRenderThread(e)}),l.create=function(t,e,i,_,r,a,n,s){l.cbook||new Error("Error:charbook not create!");var o=g.getItemByClass("FillBorderTextCmd",l),h=o._graphicsCmdEncoder=this._commandEncoder;return o._text=t,o._x=e,o._y=i,o._font=_,o._color=r,o._strokeColor=a,o._strokeWidth=n,o._textAlign=s,o._draw_texture_cmd_encoder_.clearEncoding(),o.createFillBorderText(o._draw_texture_cmd_encoder_,t,e,i,_,r,a,n,s),z.syncBufferToRenderThread(o._draw_texture_cmd_encoder_),h.useCommandEncoder(o._draw_texture_cmd_encoder_.getPtrID(),-1,-1),z.syncBufferToRenderThread(h),o},l.ID="FillBorderText",n(l,["cbook",function(){return this.cbook=gt.charbookInst}])}(),function(){function _(t,e,i,_,r,a,n){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===_&&(_=1),void 0===r&&(r=0),void 0===a&&(a=0),this._nums=n=n||new Float32Array(6),n[0]=t,n[1]=e,n[2]=i,n[3]=_,n[4]=r,n[5]=a,this._checkTransform()}v(_,"laya.layagl.MatrixConch");var t=_.prototype;return t.identity=function(){var t=this._nums;return t[0]=t[3]=1,t[1]=t[4]=t[5]=t[2]=0,this._bTransform=!1,this},t._checkTransform=function(){var t=this._nums;return this._bTransform=1!==t[0]||0!==t[1]||0!==t[2]||1!==t[3]},t.setTranslate=function(t,e){return this._nums[4]=t,this._nums[5]=e,this},t.translate=function(t,e){return this._nums[4]+=t,this._nums[5]+=e,this},t.scale=function(t,e){var i=this._nums;return i[0]*=t,i[3]*=e,i[2]*=t,i[1]*=e,i[4]*=t,i[5]*=e,this._bTransform=!0,this},t.rotate=function(t){var e=this._nums,i=Math.cos(t),_=Math.sin(t),r=e[0],a=e[2],n=e[4];return e[0]=r*i-e[1]*_,e[1]=r*_+e[1]*i,e[2]=a*i-e[3]*_,e[3]=a*_+e[3]*i,e[4]=n*i-e[5]*_,e[5]=n*_+e[5]*i,this._bTransform=!0,this},t.skew=function(t,e){var i=this._nums,_=Math.tan(t),r=Math.tan(e),a=i[0],n=i[1];return i[0]+=r*i[2],i[1]+=r*i[3],i[2]+=_*a,i[3]+=_*n,this},t.invertTransformPoint=function(t){var e=this._nums,i=e[0],_=e[1],r=e[2],a=e[3],n=e[4],s=i*a-_*r,o=a/s,h=-_/s,u=-r/s,l=i/s,c=(r*e[5]-a*n)/s,f=-(i*e[5]-_*n)/s;return t.setTo(o*t.x+u*t.y+c,h*t.x+l*t.y+f)},t.transformPoint=function(t){var e=this._nums;return t.setTo(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},t.transformPointN=function(t){var e=this._nums;return t.setTo(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y)},t.getScaleX=function(){var t=this._nums;return 0===t[1]?this.a:Math.sqrt(t[0]*t[0]+t[1]*t[1])},t.getScaleY=function(){var t=this._nums;return 0===t[2]?t[3]:Math.sqrt(t[2]*t[2]+t[3]*t[3])},t.invert=function(){var t=this._nums,e=t[0],i=t[1],_=t[2],r=t[3],a=t[4],n=e*r-i*_;return t[0]=r/n,t[1]=-i/n,t[2]=-_/n,t[3]=e/n,t[4]=(_*this.ty-r*a)/n,t[5]=-(e*this.ty-i*a)/n,this},t.setTo=function(t,e,i,_,r,a){var n=this._nums;return n[0]=t,n[1]=e,n[2]=i,n[3]=_,n[4]=r,n[5]=a,this},t.concat=function(t){var e=this._nums,i=t._nums,_=e[0],r=e[2],a=e[4];return e[0]=_*i[0]+e[1]*i[2],e[1]=_*i[1]+e[1]*i[3],e[2]=r*i[0]+e[3]*i[2],e[3]=r*i[1]+e[3]*i[3],e[4]=a*i[0]+e[5]*i[2]+i[4],e[5]=a*i[1]+e[5]*i[3]+i[5],this},t.scaleEx=function(t,e){var i=this._nums,_=i[0],r=i[1],a=i[2],n=i[3];0!==r||0!==a?(i[0]=t*_,i[1]=t*r,i[2]=e*a):(i[0]=t*_,i[1]=0*n,i[2]=0*_),i[3]=e*n,this._bTransform=!0},t.rotateEx=function(t){var e=this._nums,i=Math.cos(t),_=Math.sin(t),r=e[0],a=e[1],n=e[2],s=e[3];0!==a||0!==n?(e[0]=i*r+_*n,e[1]=i*a+_*s,e[2]=-_*r+i*n,e[3]=-_*a+i*s):(e[0]=i*r,e[1]=_*s,e[2]=-_*r,e[3]=i*s),this._bTransform=!0},t.clone=function(){var t=this._nums,e=_.create(),i=e._nums;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],e._bTransform=this._bTransform,e},t.copyTo=function(t){var e=this._nums,i=t._nums;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],t._bTransform=this._bTransform,t},t.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},t.destroy=function(){this.recover()},t.recover=function(){_._pool.push(this)},E(0,t,"a",function(){return this._nums[0]},function(t){this._nums[0]=t}),E(0,t,"b",function(){return this._nums[1]},function(t){this._nums[1]=t}),E(0,t,"c",function(){return this._nums[2]},function(t){this._nums[2]=t}),E(0,t,"d",function(){return this._nums[3]},function(t){this._nums[3]=t}),E(0,t,"tx",function(){return this._nums[4]},function(t){this._nums[4]=t}),E(0,t,"ty",function(){return this._nums[5]},function(t){this._nums[5]=t}),_.mul=function(t,e,i){var _=t._nums,r=e._nums,a=i._nums,n=_[0],s=_[1],o=_[2],h=_[3],u=_[4],l=_[5],c=r[0],f=r[1],d=r[2],E=r[3],A=r[4],D=r[5];return 0!==f||0!==d?(a[0]=n*c+s*d,a[1]=n*f+s*E,a[2]=o*c+h*d,a[3]=o*f+h*E,a[4]=c*u+d*l+A,a[5]=f*u+E*l+D):(a[0]=n*c,a[1]=s*E,a[2]=o*c,a[3]=h*E,a[4]=c*u+A,a[5]=E*l+D),i},_.mul16=function(t,e,i){var _=t._nums,r=e._nums,a=_[0],n=_[1],s=_[2],o=_[3],h=_[4],u=_[5],l=r[0],c=r[1],f=r[2],d=r[3],E=r[4],A=r[5];return 0!==c||0!==f?(i[0]=a*l+n*f,i[1]=a*c+n*d,i[4]=s*l+o*f,i[5]=s*c+o*d,i[12]=l*h+f*u+E,i[13]=c*h+d*u+A):(i[0]=a*l,i[1]=n*d,i[4]=s*l,i[5]=o*d,i[12]=l*h+E,i[13]=d*u+A),i},_.create=function(t){var e;return _._pool.length?(e=_._pool.pop(),t&&(e._nums=t),e.identity(),e):new _(1,0,0,1,0,0,t)},_.A=0,_.B=1,_.C=2,_.D=3,_.TX=4,_.TY=5,_.EMPTY=new _,_.TEMP=new _,_._pool=[],_}()),yt=function(){function t(t){this._par=null,this._loaded=!0,this.bitmap={},this.bitmap.id=t.id,this._par=t}return v(t,"laya.webgl.resource.CharInternalTexture"),t.prototype._getSource=function(){return this._par._source},t}(),Lt=function(){function e(){}return v(e,"laya.layagl.LayaNative2D"),e._init_simple_texture_cmdEncoder_=function(){(e._SIMPLE_TEXTURE_CMDENCODER_=z.instance.createCommandEncoder(172,32,!0)).useProgramEx(laya.layagl.LayaNative2D.PROGRAMEX_DRAWTEXTURE),e._SIMPLE_TEXTURE_CMDENCODER_.useVDO(laya.layagl.LayaNative2D.VDO_MESHQUADTEXTURE),e._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_VIEWS,0),e._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR,1),e._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_POS,2),e._SIMPLE_TEXTURE_CMDENCODER_.uniformTextureByParamData(0,4,8),e._SIMPLE_TEXTURE_CMDENCODER_.blendFuncByGlobalValue(laya.layagl.LayaNative2D.GLOBALVALUE_BLENDFUNC_SRC,laya.layagl.LayaNative2D.GLOBALVALUE_BLENDFUNC_DEST),e._SIMPLE_TEXTURE_CMDENCODER_.setRectMeshByParamData(12,20,16),e._SIMPLE_TEXTURE_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_MATRIX32,0,7),e._SIMPLE_TEXTURE_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(e._SIMPLE_TEXTURE_CMDENCODER_)},e._init_simple_rect_cmdEncoder_=function(){(e._SIMPLE_RECT_CMDENCODER_=z.instance.createCommandEncoder(136,32,!0)).useProgramEx(laya.layagl.LayaNative2D.PROGRAMEX_DRAWTEXTURE),e._SIMPLE_RECT_CMDENCODER_.useVDO(laya.layagl.LayaNative2D.VDO_MESHQUADTEXTURE),e._SIMPLE_RECT_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_VIEWS,0),e._SIMPLE_RECT_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR,1),e._SIMPLE_RECT_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_POS,2),e._SIMPLE_RECT_CMDENCODER_.setRectMeshByParamData(0,8,4),e._SIMPLE_RECT_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_MATRIX32,0,7),e._SIMPLE_RECT_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(e._SIMPLE_RECT_CMDENCODER_)},e._init_rect_border_cmdEncoder_=function(){(e._RECT_BORDER_CMD_ENCODER_=z.instance.createCommandEncoder(152,32,!0)).useProgramEx(laya.layagl.LayaNative2D.PROGRAMEX_DRAWVG),e._RECT_BORDER_CMD_ENCODER_.useVDO(laya.layagl.LayaNative2D.VDO_MESHVG),e._RECT_BORDER_CMD_ENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_VIEWS,0),e._RECT_BORDER_CMD_ENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR,1),e._RECT_BORDER_CMD_ENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_POS,2),e._RECT_BORDER_CMD_ENCODER_.setMeshByParamData(20,0,4,140,8,12,16),e._RECT_BORDER_CMD_ENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_MATRIX32,0,7),e._RECT_BORDER_CMD_ENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(e._RECT_BORDER_CMD_ENCODER_)},e.__init__=function(){if(c.isConchApp){var t=z.instance;e.GLOBALVALUE_MATRIX32=t.addGlobalValueDefine(0,5126,6,new Float32Array([1,0,0,1,0,0])),e.GLOBALVALUE_DRAWTEXTURE_COLOR=t.addGlobalValueDefine(0,5124,1,new Uint32Array([4294967295])),e.GLOBALVALUE_ITALICDEG=t.addGlobalValueDefine(0,5126,1,new Float32Array([0])),e.GLOBALVALUE_CLIP_MAT_DIR=t.addGlobalValueDefine(0,5126,4,new Float32Array([1e6,0,0,1e6])),e.GLOBALVALUE_CLIP_MAT_POS=t.addGlobalValueDefine(0,5126,2,new Float32Array([0,0])),e.GLOBALVALUE_BLENDFUNC_SRC=t.addGlobalValueDefine(0,5124,1,new Int32Array([1])),e.GLOBALVALUE_BLENDFUNC_DEST=t.addGlobalValueDefine(0,5124,1,new Int32Array([771])),e.GLOBALVALUE_COLORFILTER_COLOR=t.addGlobalValueDefine(0,5126,16,new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])),e.GLOBALVALUE_COLORFILTER_ALPHA=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,1])),e.GLOBALVALUE_BLURFILTER_STRENGTH=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),e.GLOBALVALUE_BLURFILTER_BLURINFO=t.addGlobalValueDefine(0,5126,2,new Float32Array([0,0])),e.GLOBALVALUE_GLOWFILTER_COLOR=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),e.GLOBALVALUE_GLOWFILTER_BLURINFO1=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),e.GLOBALVALUE_GLOWFILTER_BLURINFO2=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),t.endGlobalValueDefine(),e.PROGRAMEX_DRAWTEXTURE=z.instance.createProgramEx("/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(posuv.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#else\n\tgl_Position =vec4((posuv.x/size.x-0.5)*2.0,(0.5-posuv.y/size.y)*2.0,0.,1.0);\n#endif\n  \n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = posuv.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}","/*\n\ttexture和fillrect使用的。\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n//FILLTEXTURE\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}","posuv,attribColor,attribFlags","size,clipMatDir,clipMatPos,texture,colorMat,colorAlpha,strength_sig2_2sig2_gauss1,blurInfo,u_color,u_blurInfo1,u_blurInfo2"),e.PROGRAMEX_DRAWVG=z.instance.createProgramEx("attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}","precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}","position,attribColor","size,clipMatDir,clipMatPos"),e.PROGRAMEX_DRAWPARTICLE=z.instance.createProgramEx("attribute vec4 a_CornerTextureCoordinate;\nattribute vec3 a_Position;\nattribute vec3 a_Velocity;\nattribute vec4 a_StartColor;\nattribute vec4 a_EndColor;\nattribute vec3 a_SizeRotation;\nattribute vec2 a_Radius;\nattribute vec4 a_Radian;\nattribute float a_AgeAddScale;\nattribute float a_Time;\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\n\nuniform float u_CurrentTime;\nuniform float u_Duration;\nuniform float u_EndVelocity;\nuniform vec3 u_Gravity;\n\nuniform vec2 size;\nuniform mat4 u_mmat;\n\nvec4 ComputeParticlePosition(in vec3 position, in vec3 velocity,in float age,in float normalizedAge)\n{\n\n   float startVelocity = length(velocity);//起始标量速度\n   float endVelocity = startVelocity * u_EndVelocity;//结束标量速度\n\n   float velocityIntegral = startVelocity * normalizedAge +(endVelocity - startVelocity) * normalizedAge *normalizedAge/2.0;//计算当前速度的标量（单位空间），vt=v0*t+(1/2)*a*(t^2)\n   \n   vec3 addPosition = normalize(velocity) * velocityIntegral * u_Duration;//计算受自身速度影响的位置，转换标量到矢量    \n   addPosition += u_Gravity * age * normalizedAge;//计算受重力影响的位置\n   \n   float radius=mix(a_Radius.x, a_Radius.y, normalizedAge); //计算粒子受半径和角度影响（无需计算角度和半径时，可用宏定义优化屏蔽此计算）\n   float radianHorizontal =mix(a_Radian.x,a_Radian.z,normalizedAge);\n   float radianVertical =mix(a_Radian.y,a_Radian.w,normalizedAge);\n   \n   float r =cos(radianVertical)* radius;\n   addPosition.y += sin(radianVertical) * radius;\n\t\n   addPosition.x += cos(radianHorizontal) *r;\n   addPosition.z += sin(radianHorizontal) *r;\n  \n   addPosition.y=-addPosition.y;//2D粒子位置更新需要取负，2D粒子坐标系Y轴正向朝上\n   position+=addPosition;\n   return  vec4(position,1.0);\n}\n\nfloat ComputeParticleSize(in float startSize,in float endSize, in float normalizedAge)\n{    \n    float size = mix(startSize, endSize, normalizedAge);\n    return size;\n}\n\nmat2 ComputeParticleRotation(in float rot,in float age)\n{    \n    float rotation =rot * age;\n    //计算2x2旋转矩阵.\n    float c = cos(rotation);\n    float s = sin(rotation);\n    return mat2(c, -s, s, c);\n}\n\nvec4 ComputeParticleColor(in vec4 startColor,in vec4 endColor,in float normalizedAge)\n{\n\tvec4 color=mix(startColor,endColor,normalizedAge);\n    //硬编码设置，使粒子淡入很快，淡出很慢,6.7的缩放因子把置归一在0到1之间，可以谷歌x*(1-x)*(1-x)*6.7的制图表\n    color.a *= normalizedAge * (1.0-normalizedAge) * (1.0-normalizedAge) * 6.7;\n   \n    return color;\n}\n\nvoid main()\n{\n   float age = u_CurrentTime - a_Time;\n   age *= 1.0 + a_AgeAddScale;\n   float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n   gl_Position = ComputeParticlePosition(a_Position, a_Velocity, age, normalizedAge);//计算粒子位置\n   float pSize = ComputeParticleSize(a_SizeRotation.x,a_SizeRotation.y, normalizedAge);\n   mat2 rotation = ComputeParticleRotation(a_SizeRotation.z, age);\n\t\n    mat4 mat=u_mmat;\n    gl_Position=vec4((mat*gl_Position).xy,0.0,1.0);\n    gl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize*vec2(mat[0][0],mat[1][1]);\n    gl_Position=vec4((gl_Position.x/size.x-0.5)*2.0,(0.5-gl_Position.y/size.y)*2.0,0.0,1.0);\n   \n   v_Color = ComputeParticleColor(a_StartColor,a_EndColor, normalizedAge);\n   v_TextureCoordinate =a_CornerTextureCoordinate.zw;\n}\n\n","#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\n\nvoid main()\n{\t\n\tgl_FragColor=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\tgl_FragColor.xyz *= v_Color.w;\n}","a_CornerTextureCoordinate,a_Position,a_Velocity,a_StartColor,a_EndColor,a_SizeRotation,a_Radius,a_Radian,a_AgeAddScale,a_Time","u_CurrentTime,u_Duration,u_EndVelocity,u_Gravity,size,u_mmat,u_texture"),e.VDO_MESHQUADTEXTURE=t.createVDO(new Int32Array([5126,0,4,24,5121,16,4,24,5121,20,4,24])),e.VDO_MESHVG=t.createVDO(new Int32Array([5126,0,2,12,5121,8,4,12])),e.VDO_MESHPARTICLE=t.createVDO(new Int32Array([5126,0,4,116,5126,16,3,116,5126,28,3,116,5126,40,4,116,5126,56,4,116,5126,72,3,116,5126,84,2,116,5126,92,4,116,5126,108,1,116,5126,112,1,116])),e._init_simple_texture_cmdEncoder_(),e._init_simple_rect_cmdEncoder_(),e._init_rect_border_cmdEncoder_(),e.SHADER_MACRO_COLOR_FILTER=z.instance.defineShaderMacro("#define COLOR_FILTER",[{uname:4,id:e.GLOBALVALUE_COLORFILTER_COLOR},{uname:5,id:e.GLOBALVALUE_COLORFILTER_ALPHA}]),e.SHADER_MACRO_BLUR_FILTER=z.instance.defineShaderMacro("#define BLUR_FILTER",[{uname:6,id:e.GLOBALVALUE_BLURFILTER_STRENGTH},{uname:7,id:e.GLOBALVALUE_BLURFILTER_BLURINFO}]),e.SHADER_MACRO_GLOW_FILTER=z.instance.defineShaderMacro("#define GLOW_FILTER",[{uname:8,id:e.GLOBALVALUE_GLOWFILTER_COLOR},{uname:9,id:e.GLOBALVALUE_GLOWFILTER_BLURINFO1},{uname:10,id:e.GLOBALVALUE_GLOWFILTER_BLURINFO2}]),St.__init__(),St.__init_END_(),new gt,it.charRender=new kt}},e._SIMPLE_TEXTURE_CMDENCODER_=null,e._SIMPLE_RECT_CMDENCODER_=null,e._RECT_BORDER_CMD_ENCODER_=null,e.PROGRAMEX_DRAWTEXTURE=0,e.PROGRAMEX_DRAWVG=0,e.PROGRAMEX_DRAWRECT=0,e.PROGRAMEX_DRAWPARTICLE=0,e.VDO_MESHQUADTEXTURE=0,e.VDO_MESHVG=0,e.VDO_MESHPARTICLE=0,e.GLOBALVALUE_VIEWS=0,e.GLOBALVALUE_MATRIX32=0,e.GLOBALVALUE_DRAWTEXTURE_COLOR=0,e.GLOBALVALUE_ITALICDEG=0,e.GLOBALVALUE_CLIP_MAT_DIR=0,e.GLOBALVALUE_CLIP_MAT_POS=0,e.GLOBALVALUE_BLENDFUNC_SRC=0,e.GLOBALVALUE_BLENDFUNC_DEST=0,e.GLOBALVALUE_COLORFILTER_COLOR=0,e.GLOBALVALUE_COLORFILTER_ALPHA=0,e.GLOBALVALUE_BLURFILTER_STRENGTH=0,e.GLOBALVALUE_BLURFILTER_BLURINFO=0,e.SHADER_MACRO_COLOR_FILTER=0,e.SHADER_MACRO_BLUR_FILTER=0,e.SHADER_MACRO_GLOW_FILTER=0,e.GLOBALVALUE_GLOWFILTER_COLOR=0,e.GLOBALVALUE_GLOWFILTER_BLURINFO1=0,e.GLOBALVALUE_GLOWFILTER_BLURINFO2=0,e}(),St=function(){function s(){this._commStr="",this._commandEncoder=null,this._id=0,this._commandEncoder=z.instance.createCommandEncoder(64,16,!1)}return v(s,"laya.layagl.LayaGLTemplate"),s.prototype.addComd=function(t,e){this._commStr+=t+"("+e+");",this._commandEncoder[t].apply(this._commandEncoder,e)},s.createByRenderType=function(t){var e=s.GLS[t]=new s;c.isConchApp&&z.instance.setGLTemplate(t,e._commandEncoder.getPtrID());for(var i=1;i<=8192;){if(t&i&&s.__FUN_PARAM__[i])for(var _=s.__FUN_PARAM__[i],r=0,a=_.length;r<a;r++){var n=_[r];e.addComd(n.func,n.args)}i<<=1}return e._id=t,console.log("template="+e._commStr),e},s.createByRenderTypeEnd=function(t){var e=s.GLSE[t]=new s;c.isConchApp&&z.instance.setEndGLTemplate(t,e._commandEncoder.getPtrID());for(var i=8192;1<i;){if(t&i&&s.__FUN_PARAM_END_[i])for(var _=s.__FUN_PARAM_END_[i],r=0,a=_.length;r<a;r++){var n=_[r];e.addComd(n.func,n.args)}i>>=1}return e._id=t,console.log("templateEnd="+e._commStr),e},s.__init__=function(){s.__FUN_PARAM__[1]=[{func:"setGlobalValueByParamData",args:[Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,15,88]}],s.__FUN_PARAM__[2]=[{func:"calcLocalMatrix32",args:[60,64,24,28,32,36,40,44,48,52,56]},{func:"setGlobalValueByParamData",args:[Lt.GLOBALVALUE_MATRIX32,7,64]}],s.__FUN_PARAM__[4]=[{func:"setGlobalValueByParamData",args:[Lt.GLOBALVALUE_BLENDFUNC_SRC,8,284]},{func:"setGlobalValueByParamData",args:[Lt.GLOBALVALUE_BLENDFUNC_DEST,8,288]}],s.__FUN_PARAM__[256]=[{func:"useCommandEncoderByParamData",args:[96,100,1]}],s.__FUN_PARAM__[512]=[{func:"callbackJSByParamData",args:[216,272]},{func:"useCommandEncoderByParamData",args:[92,-1,1]}],s.__FUN_PARAM__[1024]=[{func:"callbackJSByParamData",args:[216,248]},{func:"useCommandEncoderByParamData",args:[104,-1,3]}],s.__FUN_PARAM__[2048]=[{func:"callbackJSByParamData",args:[216,220]},{func:"useCommandEncoderByParamData",args:[108,-1,1]}],s.__FUN_PARAM__[64]=[{func:"setClipByParamData",args:[Lt.GLOBALVALUE_CLIP_MAT_DIR,Lt.GLOBALVALUE_CLIP_MAT_POS,Lt.GLOBALVALUE_MATRIX32,112]},{func:"setGlobalValueByParamData",args:[Lt.GLOBALVALUE_MATRIX32,9,128]}],s.__FUN_PARAM__[16]=[{func:"callbackJSByParamData",args:[216,260]},{func:"useCommandEncoderByParamData",args:[256,-1,0]}],s.__FUN_PARAM__[32]=[{func:"callbackJSByParamData",args:[216,276]},{func:"useCommandEncoderByParamData",args:[280,-1,0]}],s.__FUN_PARAM__[8]=[{func:"callbackJSByParamData",args:[216,224]},{func:"loadDataToRegByParamData",args:[0,252,4]},{func:"ifGreater0",args:[0,2147483647]},{func:"useCommandEncoderByParamData",args:[232,-1,0]}],s.__FUN_PARAM__[128]=[{func:"useCommandEncoderByParamData",args:[292,296,1]},{func:"useCommandEncoderByParamData",args:[300,304,1]}]},s.__init_END_=function(){s.__FUN_PARAM_END_[16]=[{func:"loadDataToRegByParamData",args:[0,252,4]},{func:"ifGreater0",args:[0,2]},{func:"callbackJSByParamData",args:[216,268]},{func:"useCommandEncoderByParamData",args:[264,-1,1]}],s.__FUN_PARAM_END_[8]=[{func:"callbackJSByParamData",args:[216,228]},{func:"useCommandEncoderByParamData",args:[236,-1,0]},{func:"useCommandEncoderByParamData",args:[240,244,1]}]},s.GLS=[],s.GLSE=[],s.__FUN_PARAM__=[],s.__FUN_PARAM_END_=[],s}(),gt=function(){var t;function G(){this.fontPages=[],this.fontPagesName=[],this._curPage=null,this.tempUV=[0,0,1,0,1,1,0,1],this.fontScaleX=1,this.fontScaleY=1,this._curStrPos=0,this.tempMat=new S;var t=!1,e=P.MiniAdpter;e&&e.systemInfo&&e.systemInfo.system&&(t="ios 10.1.1"===e.systemInfo.system.toLowerCase()),!s.onMiniGame||s.onAndroid||t||(G.isWan1Wan=!0),G.charbookInst=this,it.charRender=c.isConchApp?new kt:new Wt}v(G,"laya.webgl.resource.CharBook");var e=G.prototype;return e.selectFont=function(t,e){var i,_=Math.max(this.fontScaleX,this.fontScaleY),r=e*_;if(t===G._lastFont&&r===G._lastFontSz)i=G._lastCharPage;else{var a=it.getBmpSize(e)*_,n=t+Math.floor(a/G.gridSize),s=this.fontPagesName.indexOf(n);if(s<0){var o=new it(t,a,c.isConchApp?0:Math.ceil(e/4));this.fontPages.push(o),this.fontPagesName.push(n),i=o}else i=this.fontPages[s];i.selectSize(e,a),G._lastFont=t,G._lastFontSz=r,G._lastCharPage=i}return i},e.isEmoji=function(t){return G._emojiReg.test(t)},e.getNextChar=function(t){var e=t.length,i=this._curStrPos;if(e<=i)return null;for(var _=i,r=0;_<e;_++){var a=t.charCodeAt(_);if(55296!=(55296&a))if(65038!==a&&65039!==a){if(8205!=a){if(1==r)break;_++;break}r=1}else r=1;else r=1}return this._curStrPos=_,t.substring(i,_)},e.hasFreedText=function(t,e){if(t&&0<t.length)for(var i=e,_=t.length;i<_;i++){var r=t[i];if(r)for(var a=0,n=r.length;a<n;a++){if(r[a].ri.tex.__destroyed)return!0}}return!1},e._fast_filltext=function(t,e,i,_,r,a,n,s,o,h,u){if(void 0===u&&(u=0),!(e&&e.length<1||i&&i.length<1)){if(G._curFont=a._font,this.fontScaleX=this.fontScaleY=1,G.scaleFontWithCtx){var l=t.getMatScaleX(),c=t.getMatScaleY();if(l<1e-4||c<.1)return;1<l&&(this.fontScaleX=l),1<c&&(this.fontScaleY=c)}a._italic&&(t._italicDeg=12),this._curPage=this.selectFont(a._family,a._size);var f=_,d=e,E=e,A=0,D=!i&&e instanceof laya.utils.WordText,R=!!i,m=G.cacheRenderInfoInWordText&&D?d.pageChars:[];switch(D?(E=d._text,(A=d.width)<0&&(A=d.width=this._curPage.getWidth(E))):A=this._curPage.getWidth(E),h){case b.ENUM_TEXTALIGN_CENTER:f=_-A/2;break;case b.ENUM_TEXTALIGN_RIGHT:f=_-A;break;default:f=_}d&&d.lastGCCnt!=this._curPage.gcCnt&&(d.lastGCCnt=this._curPage.gcCnt,D&&this.hasFreedText(m,d.startID)&&(m=d.pageChars=[]));var T=D?d.startID:0,v=D?d.startIDStroke:0;if(!m||m.length<1){var P=null;G.scaleFontWithCtx&&(it.charRender.scale(Math.max(this.fontScaleX,1),Math.max(this.fontScaleY,1)),(1<this.fontScaleX||1<this.fontScaleY)&&(P=""+(10*this.fontScaleX|0)+(10*this.fontScaleY|0))),v=T=-1;var p,C=0,M=0;if(this._curStrPos=0,R){var O=i[this._curStrPos++];p=O.char,C=O.x,M=O.y}else p=this.getNextChar(E);for(var y=a._bold;p;){var L,S=this.isEmoji(p);if((L=this._curPage.getChar(p,o,a._size,n,s,y,!1,P)).isSpace);else{var g=m[L.tex.id];g||(m[L.tex.id]=g=[],(T<0||T>L.tex.id)&&(T=L.tex.id)),g.push({ri:L,isEmoji:S,x:C,y:M,color:"#"+(16777215&n).toString(16),nColor:n,w:L.bmpWidth/this.fontScaleX,h:L.bmpHeight/this.fontScaleY})}R?(O=i[this._curStrPos++])?(p=O.char,C=O.x,M=O.y):p=null:(p=this.getNextChar(E),C+=L.width)}D&&(d.startID=T,d.startIDStroke=v)}this._drawResortedWords(t,f,m,T,r),t._italicDeg=0}},e.fillWords=function(t,e,i,_,r,a,n,s){if(e&&!(e.length<=0)){var o=W.create(a).numColor,h=n?W.create(n).numColor:0;G._curFont=r;var u=X.Parse(r);this._fast_filltext(t,null,e,i,_,u,o,h,s,0,0)}},e.filltext=function(t,e,i,_,r,a,n,s,o,h){if(void 0===h&&(h=0),!(e.length<=0)){var u=W.create(a).numColor,l=n?W.create(n).numColor:0;G._curFont=r;var c=X.Parse(r),f=0;switch(o){case"center":f=b.ENUM_TEXTALIGN_CENTER;break;case"right":f=b.ENUM_TEXTALIGN_RIGHT}this._fast_filltext(t,e,null,i,_,c,u,l,s,f,h)}},e.filltext_native=function(t,e,i,_,r,a,n,s,o,h,u){if(void 0===u&&(u=0),!(e&&e.length<=0)){var l=W.create(n).numColor,c=s?W.create(s).numColor:0;if(G._curFont=a,this.fontScaleX=this.fontScaleY=1,G.scaleFontWithCtx){var f=t._curMat.getScaleX(),d=t._curMat.getScaleY();if(f<1e-4||d<.1)return;this.fontScaleX=f,this.fontScaleY=d,it.charRender.scale(this.fontScaleX,this.fontScaleY)}var E=X.Parse(a),A=E._family,D=E._bold;E._italic&&(t._italicDeg=12),this._curPage=this.selectFont(A,E._size*this.fontScaleX);var R=_,m=e,T=e,v=0,P=!i&&T instanceof laya.utils.WordText,p=!!i,C=G.cacheRenderInfoInWordText&&P?m.pageChars:[];switch(P?(T=m.toString(),(v=m.width)<0&&(v=m.width=this._curPage.getWidth(T))):v=this._curPage.getWidth(T),h){case"center":R=_-v/2;break;case"right":R=_-v;break;default:R=_}if(C){for(var M=!1,O=0,y=C.length;O<y;O++){var L=C[O];if(L){for(var S=0,g=L.length;S<g;S++){if(L[S].ri.tex.__destroyed){M=!0;break}}if(M)break}}M&&(C=m.pageChars=[])}if(!C||C.length<=0){var b=null;G.scaleFontWithCtx&&(it.charRender.scale(Math.max(this.fontScaleX,1),Math.max(this.fontScaleY,1)),(1<this.fontScaleX||1<this.fontScaleY)&&(b=""+(10*this.fontScaleX|0)+(10*this.fontScaleY|0)));var B,I=0,x=0;if(this._curStrPos=0,p){var N=i[this._curStrPos++];B=N.char,I=N.x,x=N.y}else B=this.getNextChar(T);for(D=E._bold;B;){var F,V=this.isEmoji(B);if((F=this._curPage.getChar(B,o,E._size,l,c,D,!1,b)).isSpace);else{var w=C[F.tex.id];w||(C[F.tex.id]=w=[]),w.push({ri:F,isEmoji:V,x:I,y:x,color:n,nColor:l})}p?(N=i[this._curStrPos++])?(B=N.char,I=N.x,x=N.y):B=null:(I+=F.width,B=this.getNextChar(T))}}var U=t._drawTextureUseColor;this._drawResortedWords_native(t,R,C,r),t._drawTextureUseColor=U,t._italicDeg=0}},e._drawResortedWords=function(t,e,i,_,r){var a=t.getFillColor();t.setFillColor(t.mixRGBandAlpha(16777215)),e-=this._curPage.margin_left,r-=this._curPage.margin_top;for(var n=_,s=i.length;n<s;n++){var o=i[n];if(o){var h=o.length;if(!(h<=0)){t._useNewTex2DSubmit(o[0].ri.tex.texture,4*h);for(var u=0;u<h;u++){var l=o[u],c=l.ri;c.isSpace||(c.touch(),t._drawTexRect(e+l.x,r+l.y,l.w,l.h,c.uv),t.touches&&t.touches.push(c))}}}}t.setFillColor(a),t._curSubmit._key.other=-1},e._drawResortedWords_native=function(t,e,i,_){for(var r=0,a=0,n=i.length;a<n;a++){var s=i[a];if(s)for(var o=0,h=s.length;o<h;o++){var u=s[o],l=u.ri;l.isSpace||(t._drawTextureUseColor=!G.getFontBmpWithColor&&!u.isEmoji,r!=u.nColor&&(t.fillStyle=u.color,r=u.nColor),l.touch(),this._drawCharRenderInfo(t,u.ri,e+u.x,u.y+_))}}},e._drawCharRenderInfo=function(t,e,i,_){t._drawTextureM(e.tex.texture,i-this._curPage.margin_left,_-this._curPage.margin_top,e.bmpWidth,e.bmpHeight,null,1,e.uv),t.touches&&t.touches.push(e)},e.GC=function(){var t=this.fontPages.length;if(t){var e=x.loopCount%t;this.fontPages[e].removeLRU()}},G.textureWidth=512,G.cacheRenderInfoInWordText=!0,G.scaleFontWithCtx=!0,G.getFontBmpWithColor=!0,G.gridSize=16,G.debug=!1,G._curFont=null,G.charbookInst=null,G._fontMem=0,G._lastFont=null,G._lastFontSz=0,G._lastCharPage=null,G.isWan1Wan=!1,n(G,["_emojiReg",function(){return this._emojiReg=/(?:0\u20E3|1\u20E3|2\u20E3|3\u20E3|4\u20E3|5\u20E3|6\u20E3|7\u20E3|8\u20E3|9\u20E3|#\u20E3|\*\u20E3|\uD83C(?:\uDDE6\uD83C(?:\uDDE8|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDEE|\uDDF1|\uDDF2|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFC|\uDDFD|\uDDFF)|\uDDE7\uD83C(?:\uDDE6|\uDDE7|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDEF|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFB|\uDDFC|\uDDFE|\uDDFF)|\uDDE8\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF5|\uDDF7|\uDDFA|\uDDFB|\uDDFC|\uDDFD|\uDDFE|\uDDFF)|\uDDE9\uD83C(?:\uDDEA|\uDDEC|\uDDEF|\uDDF0|\uDDF2|\uDDF4|\uDDFF)|\uDDEA\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEC|\uDDED|\uDDF7|\uDDF8|\uDDF9|\uDDFA)|\uDDEB\uD83C(?:\uDDEE|\uDDEF|\uDDF0|\uDDF2|\uDDF4|\uDDF7)|\uDDEC\uD83C(?:\uDDE6|\uDDE7|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDF1|\uDDF2|\uDDF3|\uDDF5|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFC|\uDDFE)|\uDDED\uD83C(?:\uDDF0|\uDDF2|\uDDF3|\uDDF7|\uDDF9|\uDDFA)|\uDDEE\uD83C(?:\uDDE8|\uDDE9|\uDDEA|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9)|\uDDEF\uD83C(?:\uDDEA|\uDDF2|\uDDF4|\uDDF5)|\uDDF0\uD83C(?:\uDDEA|\uDDEC|\uDDED|\uDDEE|\uDDF2|\uDDF3|\uDDF5|\uDDF7|\uDDFC|\uDDFE|\uDDFF)|\uDDF1\uD83C(?:\uDDE6|\uDDE7|\uDDE8|\uDDEE|\uDDF0|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFB|\uDDFE)|\uDDF2\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF5|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFB|\uDDFC|\uDDFD|\uDDFE|\uDDFF)|\uDDF3\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEB|\uDDEC|\uDDEE|\uDDF1|\uDDF4|\uDDF5|\uDDF7|\uDDFA|\uDDFF)|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C(?:\uDDE6|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF7|\uDDF8|\uDDF9|\uDDFC|\uDDFE)|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C(?:\uDDEA|\uDDF4|\uDDF8|\uDDFA|\uDDFC)|\uDDF8\uD83C(?:\uDDE6|\uDDE7|\uDDE8|\uDDE9|\uDDEA|\uDDEC|\uDDED|\uDDEE|\uDDEF|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF7|\uDDF8|\uDDF9|\uDDFB|\uDDFD|\uDDFE|\uDDFF)|\uDDF9\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEB|\uDDEC|\uDDED|\uDDEF|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF7|\uDDF9|\uDDFB|\uDDFC|\uDDFF)|\uDDFA\uD83C(?:\uDDE6|\uDDEC|\uDDF2|\uDDF8|\uDDFE|\uDDFF)|\uDDFB\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEC|\uDDEE|\uDDF3|\uDDFA)|\uDDFC\uD83C(?:\uDDEB|\uDDF8)|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C(?:\uDDEA|\uDDF9)|\uDDFF\uD83C(?:\uDDE6|\uDDF2|\uDDFC)))|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2692-\u2694\u2696\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD79\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED0\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3]|\uD83E[\uDD10-\uDD18\uDD80-\uDD84\uDDC0]/g},"_uint32",function(){return this._uint32=new Uint32Array(1)},"trash",function(){return this.trash=new t(G.textureWidth)}]),G.__init$=function(){t=function(){function t(t){this.poolLen=0,this.cleanTm=0,this.texW=0,this.pool=new Array(10),this.texW=t}v(t,"");var e=t.prototype;return e.getAPage=function(t){if(0<this.poolLen){var e=this.pool[--this.poolLen];return e.setGridNum(t),0<this.poolLen&&this.clean(),e}return new Zt(this.texW,this.texW,t)},e.discardPage=function(t){this.clean(),t&&(this.poolLen>=this.pool.length&&(this.pool=this.pool.concat(new Array(10))),t.reset(),this.pool[this.poolLen++]=t)},e.clean=function(){var t=P.stage.getFrameTm();if(0===this.cleanTm&&(this.cleanTm=t),3e4<t-this.cleanTm){for(var e=0;e<this.poolLen;e++){var i=this.pool[e];2e4<t-i._discardTm&&(i.destroy(),this.pool[e]=this.pool[this.poolLen-1],this.poolLen--,e--)}this.cleanTm=t}},t}()},G}(),bt=function(){function r(){this.fun=null,this._this=null,this.args=null,this._ref=1,this._key=new Mt}v(r,"laya.webgl.submit.SubmitCMD");var t=r.prototype;return P.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){return this.fun.apply(this._this,this.args),1},t.getRenderType=function(){return 0},t.reUse=function(t,e){return this._ref++,e},t.releaseRender=function(){if(--this._ref<1){var t=r.POOL;t[t._length++]=this}},t.clone=function(t,e,i){return null},r.create=function(t,e,i){var _=r.POOL._length?r.POOL[--r.POOL._length]:new r;return _.fun=e,_.args=t,_._this=i,_._ref=1,_._key.clear(),_},r.POOL=((r.POOL=[])._length=0,r.POOL),r}(),Bt=(function(){function A(){this._graphicsCmdEncoder=null,this._paramData=null,this._x=NaN,this._y=NaN,this._points=null,this._lineColor=null,this._lineWidth=NaN,this._vid=0,this._vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this._ibSize=0,this._vbSize=0,this._ibArray=[],this._vbArray=[]}v(A,"laya.layagl.cmdNative.DrawLinesCmdNative");var t=A.prototype;t.recover=function(){this._points=null,this._lineColor=null,this._ibArray.length=0,this._vbArray.length=0,g.recover("DrawLinesCmd",this)},E(0,t,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t;for(var e=W.create(this._lineColor).numColor,i=this.vbBuffer._int32Data,_=0,r=0;r<this._vertNum;r++)_++,_++,i[_++]=e;z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"points",function(){return this._points},function(t){this._points=t,this._ibArray.length=0,this._vbArray.length=0,Pt.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);var e=W.create(this._lineColor).numColor;this._vertNum=this._points.length;var i=this._vertNum;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*i*4,!0)),this._vbSize=3*this._vertNum*4;for(var _=this.vbBuffer._float32Data,r=this.vbBuffer._int32Data,a=0,n=0;n<this._vertNum;n++)_[a++]=this._vbArray[2*n]+this.x,_[a++]=this._vbArray[2*n+1]+this.y,r[a++]=e;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*(this._vertNum-2)*2)&&(this.ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._ibSize=3*(this._vertNum-2)*2;for(var s=this.ibBuffer._int16Data,o=0;o<3*(this._vertNum-2);o++)s[o]=this._ibArray[o];(r=this._paramData._int32Data)[A._PARAM_VB_SIZE_POS_]=this._vbSize,r[A._PARAM_IB_SIZE_POS_]=this._ibSize,z.syncBufferToRenderThread(this.ibBuffer),z.syncBufferToRenderThread(this.vbBuffer),z.syncBufferToRenderThread(this._paramData)}),E(0,t,"cmdID",function(){return"DrawLines"}),E(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._vbArray[2*_]+this._x,i++,i++;z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"vid",function(){return this._vid},function(t){this._vid=t}),E(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)i++,e[i++]=this._vbArray[2*_+1]+this._y,i++;z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t,this._ibArray.length=0,this._vbArray.length=0,Pt.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._vbArray[2*_]+this.x,e[i++]=this._vbArray[2*_+1]+this.y,i++;z.syncBufferToRenderThread(this.vbBuffer)}),A.create=function(t,e,i,_,r,a){var n=g.getItemByClass("DrawLinesCmd",A);n._graphicsCmdEncoder=this._commandEncoder,A._DRAW_LINES_CMD_ENCODER_||((A._DRAW_LINES_CMD_ENCODER_=z.instance.createCommandEncoder(152,32,!0)).useProgramEx(Lt.PROGRAMEX_DRAWVG),A._DRAW_LINES_CMD_ENCODER_.useVDO(Lt.VDO_MESHVG),A._DRAW_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),A._DRAW_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),A._DRAW_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),A._DRAW_LINES_CMD_ENCODER_.setMeshExByParamData(4*A._PARAM_VB_POS_,4*A._PARAM_VB_OFFSET_POS_,4*A._PARAM_VB_SIZE_POS_,4*A._PARAM_IB_POS_,4*A._PARAM_IB_OFFSET_POS_,4*A._PARAM_IB_SIZE_POS_,4*A._PARAM_INDEX_ELEMENT_OFFSET_POS_),A._DRAW_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),A._DRAW_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(A._DRAW_LINES_CMD_ENCODER_)),n._paramData||(n._paramData=new ParamData(44,!0)),n._x=t,n._y=e,n._points=i,n._lineColor=_,n._lineWidth=r,n._vid=a,Pt.createLine2(i,n._ibArray,r,0,n._vbArray,!1);var s=W.create(_).numColor;n._vertNum=i.length;var o=n._vertNum;(!n.vbBuffer||n.vbBuffer.getByteLength()<3*n._vertNum*4)&&(n.vbBuffer=new ParamData(3*o*4,!0)),n._vbSize=3*n._vertNum*4;for(var h=n.vbBuffer._float32Data,u=n.vbBuffer._int32Data,l=0,c=0;c<n._vertNum;c++)h[l++]=n._vbArray[2*c]+t,h[l++]=n._vbArray[2*c+1]+e,u[l++]=s;(!n.ibBuffer||n.ibBuffer.getByteLength()<3*(n._vertNum-2)*2)&&(n.ibBuffer=new ParamData(3*(o-2)*2,!0,!0)),n._ibSize=3*(n._vertNum-2)*2;for(var f=n.ibBuffer._int16Data,d=0;d<3*(n._vertNum-2);d++)f[d]=n._ibArray[d];var E=n._paramData._float32Data;return(u=n._paramData._int32Data)[0]=1,u[A._PARAM_VB_POS_]=n.vbBuffer.getPtrID(),u[A._PARAM_IB_POS_]=n.ibBuffer.getPtrID(),E[A._PARAM_LINECOLOR_POS_]=_||4278190335,E[A._PARAM_LINEWIDTH_POS_]=r,E[A._PARAM_VID_POS_]=a,u[A._PARAM_VB_SIZE_POS_]=n._vbSize,u[A._PARAM_IB_SIZE_POS_]=n._ibSize,u[A._PARAM_VB_OFFSET_POS_]=0,u[A._PARAM_IB_OFFSET_POS_]=0,u[A._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,z.syncBufferToRenderThread(n.vbBuffer),z.syncBufferToRenderThread(n.ibBuffer),z.syncBufferToRenderThread(n._paramData),n._graphicsCmdEncoder.useCommandEncoder(A._DRAW_LINES_CMD_ENCODER_.getPtrID(),n._paramData.getPtrID(),-1),z.syncBufferToRenderThread(n._graphicsCmdEncoder),n},A.ID="DrawLines",A._DRAW_LINES_CMD_ENCODER_=null,A._PARAM_VB_POS_=1,A._PARAM_IB_POS_=2,A._PARAM_LINECOLOR_POS_=3,A._PARAM_LINEWIDTH_POS_=4,A._PARAM_VID_POS_=5,A._PARAM_VB_SIZE_POS_=6,A._PARAM_IB_SIZE_POS_=7,A._PARAM_VB_OFFSET_POS_=8,A._PARAM_IB_OFFSET_POS_=9,A._PARAM_INDEX_ELEMENT_OFFSET_POS_=10}(),function(){function c(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=NaN,this._y=NaN,this._width=NaN,this._height=NaN}v(c,"laya.layagl.cmdNative.DrawImageCmdNative");var t=c.prototype;t.recover=function(){this._graphicsCmdEncoder=null,g.recover("DrawImageCmd",this)},E(0,t,"cmdID",function(){return"DrawImage"}),E(0,t,"y",function(){return this._y},function(t){this._y=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_+1]=this._y,e[c._PARAM_VB_POS_+7]=this._y,e[c._PARAM_VB_POS_+13]=this._y+this._height,e[c._PARAM_VB_POS_+19]=this._y+this._height,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"texture",function(){return this._texture},function(t){this._texture=t,this._paramData._int32Data[c._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id;var e=this._paramData._float32Data,i=this._texture.uv;e[c._PARAM_VB_POS_+2]=i[0],e[c._PARAM_VB_POS_+3]=i[1],e[c._PARAM_VB_POS_+8]=i[2],e[c._PARAM_VB_POS_+9]=i[3],e[c._PARAM_VB_POS_+14]=i[4],e[c._PARAM_VB_POS_+15]=i[5],e[c._PARAM_VB_POS_+20]=i[6],e[c._PARAM_VB_POS_+21]=i[7],z.syncBufferToRenderThread(this._paramData)}),E(0,t,"width",function(){return this._width},function(t){this._width=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_]=this._x,e[c._PARAM_VB_POS_+6]=this._x+this._width,e[c._PARAM_VB_POS_+12]=this._x+this._width,e[c._PARAM_VB_POS_+18]=this._x,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"x",function(){return this._x},function(t){this._x=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_]=this._x,e[c._PARAM_VB_POS_+6]=this._x+this._width,e[c._PARAM_VB_POS_+12]=this._x+this._width,e[c._PARAM_VB_POS_+18]=this._x,z.syncBufferToRenderThread(this._paramData)}),E(0,t,"height",function(){return this._height},function(t){this._height=t;var e=this._paramData._float32Data;e[c._PARAM_VB_POS_+1]=this._y,e[c._PARAM_VB_POS_+7]=this._y,e[c._PARAM_VB_POS_+13]=this._y+this._height,e[c._PARAM_VB_POS_+19]=this._y+this._height,z.syncBufferToRenderThread(this._paramData)}),c.create=function(t,e,i,_,r){var a=g.getItemByClass("DrawImageCmd",c);a._graphicsCmdEncoder=this._commandEncoder,c._DRAW_IMAGE_CMD_ENCODER_||((c._DRAW_IMAGE_CMD_ENCODER_=z.instance.createCommandEncoder(172,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),c._DRAW_IMAGE_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWTEXTURE),c._DRAW_IMAGE_CMD_ENCODER_.useVDO(Lt.VDO_MESHQUADTEXTURE),c._DRAW_IMAGE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),c._DRAW_IMAGE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),c._DRAW_IMAGE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),c._DRAW_IMAGE_CMD_ENCODER_.uniformTextureByParamData(0,4,4*c._PARAM_TEXTURE_POS_),c._DRAW_IMAGE_CMD_ENCODER_.setRectMeshByParamData(12,4*c._PARAM_VB_POS_,16),c._DRAW_IMAGE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),c._DRAW_IMAGE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(c._DRAW_IMAGE_CMD_ENCODER_)),a._paramData||(a._paramData=new ParamData(116,!0)),a._texture=t,a._x=e,a._y=i,a._width=_,a._height=r;var n=a._paramData._float32Data,s=a._paramData._int32Data;s[0]=3,s[1]=33984,s[c._PARAM_TEXTURE_POS_]=t.getIsReady()?t.bitmap._glTexture.id:0,s[3]=1,s[4]=96;var o=0!=_?_:t.bitmap.width,h=0!=r?r:t.bitmap.height,u=t.uv,l=c._PARAM_VB_POS_;return n[l++]=e,n[l++]=i,n[l++]=u[0],n[l++]=u[1],s[l++]=4294967295,s[l++]=4294967295,n[l++]=e+o,n[l++]=i,n[l++]=u[2],n[l++]=u[3],s[l++]=4294967295,s[l++]=4294967295,n[l++]=e+o,n[l++]=i+h,n[l++]=u[4],n[l++]=u[5],s[l++]=4294967295,s[l++]=4294967295,n[l++]=e,n[l++]=i+h,n[l++]=u[6],n[l++]=u[7],s[l++]=4294967295,s[l++]=4294967295,z.syncBufferToRenderThread(a._paramData),a._graphicsCmdEncoder.useCommandEncoder(c._DRAW_IMAGE_CMD_ENCODER_.getPtrID(),a._paramData.getPtrID(),-1),z.syncBufferToRenderThread(a._graphicsCmdEncoder),a},c.ID="DrawImage",c._DRAW_IMAGE_CMD_ENCODER_=null,c._PARAM_TEXTURE_POS_=2,c._PARAM_VB_POS_=5}(),function(){function y(){this._graphicsCmdEncoder=null,this._paramData=null,this._paramID=null,this._x=NaN,this._y=NaN,this._radius=NaN,this._fillColor=null,this._lineColor=null,this._lineWidth=NaN,this._vertNum=0,this._line_vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this.line_ibBuffer=null,this.line_vbBuffer=null,this._ibSize=0,this._vbSize=0,this._line_ibSize=0,this._line_vbSize=0,this._cmdCurrentPos=0,this._points=[],this._linePoints=[],this._line_vbArray=[],this._line_ibArray=[]}v(y,"laya.layagl.cmdNative.DrawCircleCmdNative");var t=y.prototype;t._arc=function(t,e,i,_,r){void 0===_&&(_=!1),void 0===r&&(r=!0);var a,n=[],s=0,o=0,h=0,u=0,l=0,c=0,f=0;if(o=2*Math.PI-0,_)if(Math.abs(o)>=2*Math.PI)o=2*-Math.PI;else for(;0<o;)o-=2*Math.PI;else if(Math.abs(o)>=2*Math.PI)o=2*Math.PI;else for(;o<0;)o+=2*Math.PI;a=o/(f=i<101?Math.max(10,o*i/5):i<201?Math.max(10,o*i/20):Math.max(10,o*i/40))/2,h=Math.abs(4/3*(1-Math.cos(a))/Math.sin(a)),_&&(h=-h);for(c=0;c<=f;c++)s=0+o*(c/f),u=t+Math.cos(s)*i,l=e+Math.sin(s)*i,n.push(u),n.push(l);return n},t.recover=function(){this._fillColor=null,this._lineColor=null,this._points.length=0,this._linePoints.length=0,this._line_vbArray.length=0,this._line_ibArray.length=0,g.recover("DrawCircleCmd",this)},E(0,t,"lineColor",function(){return this._lineColor},function(t){!this._lineColor&&this._lineWidth&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=y._DRAW_CIRCLE_LINES_CMD_ENCODER_.getPtrID(),z.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineColor=t,this._linePoints.length=0,this._line_ibArray.length=0;for(var e=this._line_vbArray.length=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Pt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var i=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var _=this.line_ibBuffer._int16Data,r=0,a=0;a<3*(this._line_vertNum-2);a++)_[r++]=this._line_ibArray[a];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*i*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var n=W.create(t).numColor,s=this.line_vbBuffer._float32Data,o=this.line_vbBuffer._int32Data,h=0;for(e=0;e<this._line_vertNum;e++)s[h++]=this._line_vbArray[2*e]+this.x,s[h++]=this._line_vbArray[2*e+1]+this.y,o[h++]=n;var u=this._paramData._int32Data;u[y._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),u[y._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),u[y._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,u[y._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,z.syncBufferToRenderThread(this.line_vbBuffer),z.syncBufferToRenderThread(this.line_ibBuffer),z.syncBufferToRenderThread(this._paramData)}),E(0,t,"cmdID",function(){return"DrawCircle"}),E(0,t,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t;for(var e=W.create(this._fillColor).numColor,i=this.vbBuffer._int32Data,_=0,r=0;r<this._vertNum;r++)_++,_++,i[_++]=e;z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)e[i++]=this._points[2*_]+this._x,i++,i++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(_=i=0;_<this._line_vertNum;_++)r[i++]=this._line_vbArray[2*_]+this._x,i++,i++;z.syncBufferToRenderThread(this.line_vbBuffer)}z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,i=0,_=0;_<this._vertNum;_++)i++,e[i++]=this._points[2*_+1]+this._y,i++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(_=i=0;_<this._line_vertNum;_++)i++,r[i++]=this._line_vbArray[2*_+1]+this._y,i++;z.syncBufferToRenderThread(this.line_vbBuffer)}z.syncBufferToRenderThread(this.vbBuffer)}),E(0,t,"radius",function(){return this._radius},function(t){this._points=this._arc(0,0,t),this._vertNum=this._points.length/2;var e=this._vertNum,i=0;this._linePoints.length=0,this._line_ibArray.length=0;this._line_vbArray.length=0;var _=this._vertNum-2;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*_*2)&&(this.ibBuffer=new ParamData(3*_*2,!0,!0)),this._ibSize=3*_*2;for(var r=this.ibBuffer._int16Data,a=0,n=0;n<_;n++)r[a++]=0,r[a++]=n+1+0,r[a++]=n+2+0;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*e*4,!0)),this._vbSize=3*this._vertNum*4;for(var s=W.create(this._fillColor).numColor,o=this.vbBuffer._float32Data,h=this.vbBuffer._int32Data,u=0,l=0;l<this._vertNum;l++)o[u++]=this._points[2*l]+this._x,o[u++]=this._points[2*l+1]+this._y,h[u++]=s;if(this._lineColor){for(l=0;l<this._points.length;l++)this._linePoints.push(this._points[l]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Pt.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,i=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var c=this.line_ibBuffer._int16Data,f=a=0;f<3*(this._line_vertNum-2);f++)c[a++]=this._line_ibArray[f];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*i*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var d=W.create(this._lineColor).numColor,E=this.line_vbBuffer._float32Data,A=this.line_vbBuffer._int32Data;for(l=u=0;l<this._line_vertNum;l++)E[u++]=this._line_vbArray[2*l]+this._x,E[u++]=this._line_vbArray[2*l+1]+this._y,A[u++]=d}var D=this._paramData._int32Data;D[y._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),D[y._PARAM_IB_POS_]=this.ibBuffer.getPtrID(),D[y._PARAM_VB_SIZE_POS_]=this._vbSize,D[y._PARAM_IB_SIZE_POS_]=this._ibSize,z.syncBufferToRenderThread(this.vbBuffer),z.syncBufferToRenderThread(this.ibBuffer),this._lineColor&&(D[y._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),D[y._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),D[y._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,D[y._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,z.syncBufferToRenderThread(this.line_vbBuffer),z.syncBufferToRenderThread(this.line_ibBuffer)),z.syncBufferToRenderThread(this._paramData)}),E(0,t,"lineWidth",function(){return this._lineWidth},function(t){!this._lineWidth&&this._lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=y._DRAW_CIRCLE_LINES_CMD_ENCODER_.getPtrID(),z.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=t,this._linePoints.length=0,this._line_ibArray.length=0;for(var e=this._line_vbArray.length=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Pt.createLine2(this._linePoints,this._line_ibArray,t,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var i=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(i-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var _=this.line_ibBuffer._int16Data,r=0,a=0;a<3*(this._line_vertNum-2);a++)_[r++]=this._line_ibArray[a];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*i*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var n=W.create(this._lineColor).numColor,s=this.line_vbBuffer._float32Data,o=this.line_vbBuffer._int32Data,h=0;for(e=0;e<this._line_vertNum;e++)s[h++]=this._line_vbArray[2*e]+this.x,s[h++]=this._line_vbArray[2*e+1]+this.y,o[h++]=n;var u=this._paramData._int32Data;u[y._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),u[y._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),u[y._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,u[y._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,z.syncBufferToRenderThread(this.line_vbBuffer),z.syncBufferToRenderThread(this.line_ibBuffer),z.syncBufferToRenderThread(this._paramData)}),y.create=function(t,e,i,_,r,a,n){var s=g.getItemByClass("DrawCircleCmd",y);s._graphicsCmdEncoder=this._commandEncoder,y._DRAW_CIRCLE_LINES_CMD_ENCODER_||((y._DRAW_CIRCLE_LINES_CMD_ENCODER_=z.instance.createCommandEncoder(244,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWVG),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.useVDO(Lt.VDO_MESHVG),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_VB_POS_,4*y._PARAM_VB_OFFSET_POS_,4*y._PARAM_VB_SIZE_POS_,4*y._PARAM_IB_POS_,4*y._PARAM_IB_OFFSET_POS_,4*y._PARAM_IB_SIZE_POS_,4*y._PARAM_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_LINE_VB_POS_,4*y._PARAM_LINE_VB_OFFSET_POS_,4*y._PARAM_LINE_VB_SIZE_POS_,4*y._PARAM_LINE_IB_POS_,4*y._PARAM_LINE_IB_OFFSET_POS_,4*y._PARAM_LINE_IB_SIZE_POS_,4*y._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(y._DRAW_CIRCLE_LINES_CMD_ENCODER_)),y._DRAW_CIRCLE_CMD_ENCODER_||((y._DRAW_CIRCLE_CMD_ENCODER_=z.instance.createCommandEncoder(168,32,!0)).blendFuncByGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,Lt.GLOBALVALUE_BLENDFUNC_DEST),y._DRAW_CIRCLE_CMD_ENCODER_.useProgramEx(Lt.PROGRAMEX_DRAWVG),y._DRAW_CIRCLE_CMD_ENCODER_.useVDO(Lt.VDO_MESHVG),y._DRAW_CIRCLE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_VIEWS,0),y._DRAW_CIRCLE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_DIR,1),y._DRAW_CIRCLE_CMD_ENCODER_.uniformEx(Lt.GLOBALVALUE_CLIP_MAT_POS,2),y._DRAW_CIRCLE_CMD_ENCODER_.setMeshExByParamData(4*y._PARAM_VB_POS_,4*y._PARAM_VB_OFFSET_POS_,4*y._PARAM_VB_SIZE_POS_,4*y._PARAM_IB_POS_,4*y._PARAM_IB_OFFSET_POS_,4*y._PARAM_IB_SIZE_POS_,4*y._PARAM_INDEX_ELEMENT_OFFSET_POS_),y._DRAW_CIRCLE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_MATRIX32,0,7),y._DRAW_CIRCLE_CMD_ENCODER_.modifyMesh(Lt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),z.syncBufferToRenderThread(y._DRAW_CIRCLE_CMD_ENCODER_)),s._paramData||(s._paramData=new ParamData(72,!0)),s._x=t,s._y=e,s._radius=i,s._fillColor=_,s._lineColor=r,s._lineWidth=a,s._points=s._arc(0,0,i),s._vertNum=s._points.length/2;var o=s._vertNum,h=s._vertNum-2;(!s.ibBuffer||s.ibBuffer.getByteLength()<3*h*2)&&(s.ibBuffer=new ParamData(3*h*2,!0,!0)),s._ibSize=3*h*2;for(var u=s.ibBuffer._int16Data,l=0,c=0;c<h;c++)u[l++]=0,u[l++]=c+1+0,u[l++]=c+2+0;var f=W.create(_).numColor;(!s.vbBuffer||s.vbBuffer.getByteLength()<3*s._vertNum*4)&&(s.vbBuffer=new ParamData(3*o*4,!0)),s._vbSize=3*s._vertNum*4;for(var d=s.vbBuffer._float32Data,E=s.vbBuffer._int32Data,A=0,D=0;D<s._vertNum;D++)d[A++]=s._points[2*D]+t,d[A++]=s._points[2*D+1]+e,E[A++]=f;var R=0;for(D=0;D<s._points.length;D++)s._linePoints.push(s._points[D]);if(s._linePoints.push(s._points[0]),s._linePoints.push(s._points[1]),r){Pt.createLine2(s._linePoints,s._line_ibArray,a,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,R=s._line_vertNum,(!s.line_ibBuffer||s.line_ibBuffer.getByteLength()<3*(s._line_vertNum-2)*2)&&(s.line_ibBuffer=new ParamData(3*(R-2)*2,!0,!0)),s._line_ibSize=3*(s._line_vertNum-2)*2;for(var m=s.line_ibBuffer._int16Data,T=l=0;T<3*(s._line_vertNum-2);T++)m[l++]=s._line_ibArray[T];(!s.line_vbBuffer||s.line_vbBuffer.getByteLength()<3*s._line_vertNum*4)&&(s.line_vbBuffer=new ParamData(3*R*4,!0)),s._line_vbSize=3*s._line_vertNum*4;var v=W.create(r),P=v.numColor,p=s.line_vbBuffer._float32Data,C=s.line_vbBuffer._int32Data;for(D=A=0;D<s._line_vertNum;D++)p[A++]=s._line_vbArray[2*D]+t,p[A++]=s._line_vbArray[2*D+1]+e,C[A++]=P}else{s._lineWidth=1;for(Pt.createLine2(s._linePoints,s._line_ibArray,s._lineWidth,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,R=s._line_vertNum,(!s.line_ibBuffer||s.line_ibBuffer.getByteLength()<3*(s._line_vertNum-2)*2)&&(s.line_ibBuffer=new ParamData(3*(R-2)*2,!0,!0)),s._line_ibSize=3*(s._line_vertNum-2)*2,m=s.line_ibBuffer._int16Data,T=l=0;T<3*(s._line_vertNum-2);T++)m[l++]=s._line_ibArray[T];for((!s.line_vbBuffer||s.line_vbBuffer.getByteLength()<3*s._line_vertNum*4)&&(s.line_vbBuffer=new ParamData(3*R*4,!0)),s._line_vbSize=3*s._line_vertNum*4,P=(v=W.create("#FFFFFF")).numColor,p=s.line_vbBuffer._float32Data,C=s.line_vbBuffer._int32Data,D=A=0;D<s._line_vertNum;D++)p[A++]=s._line_vbArray[2*D]+t,p[A++]=s._line_vbArray[2*D+1]+e,C[A++]=P}var M=s._paramData._float32Data,O=s._paramData._int32Data;return O[0]=1,O[1]=32,O[y._PARAM_VB_POS_]=s.vbBuffer.getPtrID(),O[y._PARAM_IB_POS_]=s.ibBuffer.getPtrID(),O[y._PARAM_VB_SIZE_POS_]=s._vbSize,O[y._PARAM_IB_SIZE_POS_]=s._ibSize,O[y._PARAM_VB_OFFSET_POS_]=0,O[y._PARAM_IB_OFFSET_POS_]=0,O[y._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,z.syncBufferToRenderThread(s.vbBuffer),z.syncBufferToRenderThread(s.ibBuffer),O[y._PARAM_LINE_VB_POS_]=s.line_vbBuffer.getPtrID(),O[y._PARAM_LINE_IB_POS_]=s.line_ibBuffer.getPtrID(),M[y._PARAM_LINECOLOR_POS_]=r,M[y._PARAM_LINEWIDTH_POS_]=a,O[y._PARAM_LINE_VB_SIZE_POS_]=s._line_vbSize,O[y._PARAM_LINE_IB_SIZE_POS_]=s._line_ibSize,O[y._PARAM_LINE_VB_OFFSET_POS_]=0,O[y._PARAM_LINE_IB_OFFSET_POS_]=0,O[y._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,z.syncBufferToRenderThread(s.line_vbBuffer),z.syncBufferToRenderThread(s.line_ibBuffer),z.syncBufferToRenderThread(s._paramData),s._cmdCurrentPos=r?s._graphicsCmdEncoder.useCommandEncoder(y._DRAW_CIRCLE_LINES_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1):s._graphicsCmdEncoder.useCommandEncoder(y._DRAW_CIRCLE_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1),z.syncBufferToRenderThread(s._graphicsCmdEncoder),s},y.ID="DrawCircle",y._DRAW_CIRCLE_CMD_ENCODER_=null,y._DRAW_CIRCLE_LINES_CMD_ENCODER_=null,y._PARAM_VB_POS_=2,y._PARAM_IB_POS_=3,y._PARAM_LINE_VB_POS_=4,y._PARAM_LINE_IB_POS_=5,y._PARAM_LINECOLOR_POS_=6,y._PARAM_LINEWIDTH_POS_=7,y._PARAM_VB_SIZE_POS_=8,y._PARAM_IB_SIZE_POS_=9,y._PARAM_LINE_VB_SIZE_POS_=10,y._PARAM_LINE_IB_SIZE_POS_=11,y._PARAM_VB_OFFSET_POS_=12,y._PARAM_IB_OFFSET_POS_=13,y._PARAM_LINE_VB_OFFSET_POS_=14,y._PARAM_LINE_IB_OFFSET_POS_=15,y._PARAM_INDEX_ELEMENT_OFFSET_POS_=16,y._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=17}(),function(t){function i(t,e){i.__super.call(this,t,e)}v(i,"laya.webgl.utils.RenderSprite3D",D);var e=i.prototype;return e.onCreate=function(t){switch(t){case 4:return void(this._fun=this._blend)}},e._mask=function(t,e,i,_){var r=this._next,a=t.mask,n=e;if(a){n.save();var s=n.globalCompositeOperation,o=new M;if(o.copyFrom(a.getBounds()),o.width=Math.round(o.width),o.height=Math.round(o.height),o.x=Math.round(o.x),o.y=Math.round(o.y),0<o.width&&0<o.height){var h=o.width,u=o.height,l=pt.getRT(h,u);n.breakNextMerge(),n.pushRT(),n.addRenderObject(bt.create([n,l,h,u],laya.webgl.utils.RenderSprite3D.tmpTarget,this)),a.render(n,-o.x,-o.y),n.breakNextMerge(),n.popRT(),n.save(),n.clipRect(i+o.x-t.getStyle().pivotX,_+o.y-t.getStyle().pivotY,h,u),r._fun.call(r,t,n,i,_),n.restore(),s=n.globalCompositeOperation,n.addRenderObject(bt.create(["mask"],laya.webgl.utils.RenderSprite3D.setBlendMode,this));var c=H.create(1,0),f=w.INV_UV;n.drawTarget(l,i+o.x-t.getStyle().pivotX,_+o.y-t.getStyle().pivotY,h,u,S.TEMP.identity(),c,f,6),n.addRenderObject(bt.create([l],laya.webgl.utils.RenderSprite3D.recycleTarget,this)),n.addRenderObject(bt.create([s],laya.webgl.utils.RenderSprite3D.setBlendMode,this))}n.restore()}else r._fun.call(r,t,e,i,_)},e._blend=function(t,e,i,_){var r=t._style,a=this._next;r.blendMode?(e.save(),e.globalCompositeOperation=r.blendMode,a._fun.call(a,t,e,i,_),e.restore()):a._fun.call(a,t,e,i,_)},i.tmpTarget=function(t,e,i,_){e.start(),e.clear(0,0,0,0)},i.recycleTarget=function(t){pt.releaseRT(t)},i.setBlendMode=function(t){var e=dt.mainContext;Et.targetFns[Et.TOINT[t]](e)},n(i,["tempUV",function(){return this.tempUV=new Array(8)}]),i}()),It=function(t){var i;function z(){if(this._drawTriUseAbsMatrix=!1,this._id=++z._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._renderCount=0,this._isConvexCmd=!0,this._submits=null,this._curSubmit=null,this.meshlist=[],this._clipInfoID=0,this._lastMatScaleX=1,this._lastMatScaleY=1,this._lastMat_a=1,this._lastMat_b=0,this._lastMat_c=0,this._lastMat_d=1,this._nBlendType=0,this._saveMark=null,this._drawTextureUseColor=!1,this._italicDeg=0,this._lastTex=null,this._fillColor=0,this._flushCnt=0,this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,z.__super.call(this),this._width=99999999,this._height=99999999,this._submitKey=new Mt,this._transedPoints=new Array(8),this._temp4Points=new Array(8),this._clipRect=z.MAXCLIPRECT,this._globalClipMatrix=new S(99999999,0,0,99999999,0,0),this._shader2D=new mt,this.mOutPoint,z._contextcount++,!z.defTexture){var t=new ee(2,2);t.setPixels(new Uint8Array(16)),z.defTexture=new w(t)}this._lastTex=z.defTexture,this.clear()}v(z,"laya.webgl.canvas.WebGLContext2D",b);var e=z.prototype;return e.clearBG=function(t,e,i,_){var r=dt.mainContext;r.clearColor(t,e,i,_),r.clear(16384)},e._getSubmits=function(){return this._submits},e._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path=null,this._save=null;var i;for(t=0,i=this.meshlist.length;t<i;t++){this.meshlist[t].destroy()}this.meshlist.length=0,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}},e.destroy=function(){--z._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._mesh.destroy()},e.clear=function(){this._submits||(this._other=i.DEFAULT,this._curMat=S.create(),this._mesh=Vt.getAMesh(),this.meshlist.push(this._mesh),this._pathMesh=wt.getAMesh(),this.meshlist.push(this._pathMesh),this._triangleMesh=Ut.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits=[],this._save=[$.Create(this)],this._save.length=10,this._shader2D=new mt),this._submitKey.clear(),this._mesh.clearVB(),this._renderCount++,this._drawCount=1,this._other=i.DEFAULT,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=z.MAXCLIPRECT,this._curSubmit=ct.RENDERBASE,ct.RENDERBASE._ref=16777215,ct.RENDERBASE._numEle=0,this._shader2D.fillStyle=this._shader2D.strokeStyle=K.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},e.size=function(t,e){this._width==t&&this._height==e||(this._width=t,this._height=e,this._targets&&(this._targets.destroy(),this._targets=new te(t,e,1,-1)),c._context==this&&(dt.mainContext.viewport(0,0,t,e),Ct.width=t,Ct.height=e)),0===t&&0===e&&this._releaseMem()},e.getMatScaleX=function(){return this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b||(this._lastMatScaleX=this._curMat.getScaleX(),this._lastMat_a=this._curMat.a,this._lastMat_b=this._curMat.b),this._lastMatScaleX},e.getMatScaleY=function(){return this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d||(this._lastMatScaleY=this._curMat.getScaleY(),this._lastMat_c=this._curMat.c,this._lastMat_d=this._curMat.d),this._lastMatScaleY},e.setFillColor=function(t){this._fillColor=t},e.getFillColor=function(){return this._fillColor},e.translate=function(t,e){0===t&&0===e||(ot.save(this),this._curMat._bTransform?(Rt.save(this),this._curMat.tx+=t*this._curMat.a+e*this._curMat.c,this._curMat.ty+=t*this._curMat.b+e*this._curMat.d):(this._curMat.tx=t,this._curMat.ty=e))},e.save=function(){this._save[this._save._length++]=$.Create(this)},e.restore=function(){var t=this._save._length,e=this._nBlendType;if(!(t<1)){for(var i=t-1;0<=i;i--){var _=this._save[i];if(_.restore(this),_.isSaveMark())return void(this._save._length=i)}e!=this._nBlendType&&(this._curSubmit=ct.RENDERBASE)}},e.fillText=function(t,e,i,_,r,a){this._fillText(t,null,e,i,_,r,null,0,null)},e._fillText=function(t,e,i,_,r,a,n,s,o,h){void 0===h&&(h=0),t?z._charBook.filltext(this,t,i,_,r,a,n,s,o,h):e&&z._charBook.fillWords(this,e,i,_,r,a,n,s)},e._fast_filltext=function(t,e,i,_,r,a,n,s,o){void 0===o&&(o=0),z._charBook._fast_filltext(this,t,null,e,i,_,r,a,n,s,o)},e.fillWords=function(t,e,i,_,r){this._fillText(null,t,e,i,_,r,null,-1,null,0)},e.fillBorderWords=function(t,e,i,_,r,a,n){this._fillBorderText(null,t,e,i,_,r,a,n,null)},e.drawText=function(t,e,i,_,r,a){this._fillText(t,null,e,i,_,W.create(r).strColor,null,-1,a)},e.strokeWord=function(t,e,i,_,r,a,n){this._fillText(t,null,e,i,_,null,W.create(r).strColor,a||1,n)},e.fillBorderText=function(t,e,i,_,r,a,n,s){this._fillBorderText(t,null,e,i,_,W.create(r).strColor,W.create(a).strColor,n,s)},e._fillBorderText=function(t,e,i,_,r,a,n,s,o){this._fillText(t,e,i,_,r,a,n,s||1,o)},e._fillRect=function(t,e,i,_,r){var a=this._curSubmit,n=a&&2===a._key.submitType&&a._key.blendShader===this._submitKey.blendShader;65535<this._mesh.vertNum+4&&(this._mesh=Vt.getAMesh(),this.meshlist.push(this._mesh),n=!1),n&&(n=n&&this.isSameClipInfo(a)),this.transformQuad(t,e,i,_,0,this._curMat,this._transedPoints),this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,w.NO_UV,r,!1),n||(a=this._curSubmit=Yt.create(this,this._mesh,H.create(1,0)),this._submits[this._submits._length++]=a,this.copyClipInfo(a,this._globalClipMatrix),a.shaderValue.textureHost=this._lastTex,a._key.copyFrom2(this._submitKey,2,this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1),a._renderType=10016),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},e.fillRect=function(t,e,i,_,r){var a=r?K.create(r):this._shader2D.fillStyle,n=this.mixRGBandAlpha(a.toInt());this._fillRect(t,e,i,_,n)},e.fillTexture=function(t,e,i,_,r,a,n,s){if(t._getSource()){var o=this._curSubmit;65535<this._mesh.vertNum+4&&(this._mesh=Vt.getAMesh(),this.meshlist.push(this._mesh),!1);t.bitmap;var h=!0,u=!0;switch(a){case"repeat":break;case"repeat-x":u=!1;break;case"repeat-y":h=!1;break;case"no-repeat":h=u=!1}var l=this._temp4Points,c=0,f=0,d=0,E=0,A=0,D=0;if(n.x<0?(d=e,c=-n.x%t.width/t.width):d=e+n.x,n.y<0?(E=i,f=-n.y%t.height/t.height):E=i+n.y,A=e+_,D=i+r,!h&&(A=Math.min(A,e+n.x+t.width)),!u&&(D=Math.min(D,i+n.y+t.height)),!(A<e||D<i||A<d||D<E)){var R=(A-e-n.x)/t.width,m=(D-i-n.y)/t.height;if(this.transformQuad(d,E,A-d,D-E,0,this._curMat,this._transedPoints),l[0]=c,l[1]=f,l[2]=R,l[3]=f,l[4]=R,l[5]=m,l[6]=c,l[7]=m,!this.clipedOff(this._transedPoints)){var T=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA);this._mesh.addQuad(this._transedPoints,l,T,!0);var v=H.create(1,0);v.defines.add(256),v.u_TexRange=t.uvrect,o=this._curSubmit=Yt.create(this,this._mesh,v),this._submits[this._submits._length++]=o,this.copyClipInfo(o,this._globalClipMatrix),o.shaderValue.textureHost=t,o._renderType=10016,this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4}this.breakNextMerge()}}else this.sprite&&P.systemTimer.callLater(this,this._repaintSprite)},e.setColorFilter=function(t){Y.save(this,8388608,this,!0),this._colorFiler=t,this._curSubmit=ct.RENDERBASE},e.drawTexture=function(t,e,i,_,r){this._drawTextureM(t,e,i,_,r,null,1,null)},e.drawTextures=function(t,e,i,_){if(t._getSource())for(var r=e.length/2,a=0,n=0;n<r;n++)this._inner_drawTexture(t,t.bitmap.id,e[a++]+i,e[a++]+_,0,0,null,null,1);else this.sprite&&P.systemTimer.callLater(this,this._repaintSprite)},e._drawTextureAddSubmit=function(t,e){var i=null;i=Yt.create(this,this._mesh,H.create(1,0)),(this._submits[this._submits._length++]=i).shaderValue.textureHost=e,i._key.copyFrom2(this._submitKey,2,t),i._renderType=10016,this._curSubmit=i},e._drawTextureM=function(t,e,i,_,r,a,n,s){return t._getSource()?this._inner_drawTexture(t,t.bitmap.id,e,i,_,r,a,s,n):(this.sprite&&P.systemTimer.callLater(this,this._repaintSprite),!1)},e._drawRenderTexture=function(t,e,i,_,r,a,n,s){return this._inner_drawTexture(t,-1,e,i,_,r,a,s,1)},e.submitDebugger=function(){this._submits[this._submits._length++]=bt.create([],function(){},this)},e.copyClipInfo=function(t,e){var i=t.shaderValue.clipMatDir;i[0]=e.a,i[1]=e.b,i[2]=e.c,i[3]=e.d;var _=t.shaderValue.clipMatPos;_[0]=e.tx,_[1]=e.ty,t.clipInfoID=this._clipInfoID},e.isSameClipInfo=function(t){return t.clipInfoID===this._clipInfoID},e._useNewTex2DSubmit=function(t,e){65535<this._mesh.vertNum+e&&(this._mesh=Vt.getAMesh(),this.meshlist.push(this._mesh));var i=Yt.create(this,this._mesh,H.create(1,0));this._submits[this._submits._length++]=this._curSubmit=i,i.shaderValue.textureHost=t,this.copyClipInfo(i,this._globalClipMatrix)},e._drawTexRect=function(t,e,i,_,r){this.transformQuad(t,e,i,_,this._italicDeg,this._curMat,this._transedPoints);var a=this._transedPoints;a[0]=a[0]+.5|0,a[1]=a[1]+.5|0,a[2]=a[2]+.5|0,a[3]=a[3]+.5|0,a[4]=a[4]+.5|0,a[5]=a[5]+.5|0,a[6]=a[6]+.5|0,a[7]=a[7]+.5|0,this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,r,this._fillColor,!0),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},e._inner_drawTexture=function(t,e,i,_,r,a,n,s,o){var h=this._curSubmit._key;if(s=s||t._uv,4===h.submitType&&h.other===e){var u=z._drawTexToDrawTri_Vert;return u[0]=i,u[1]=_,u[2]=i+r,u[3]=_,u[4]=i+r,u[5]=_+a,u[6]=i,u[7]=_+a,this._drawTriUseAbsMatrix=!0,this.drawTriangles(t,0,0,u,s,z._drawTexToDrawTri_Index,n,o,null,"normal"),!(this._drawTriUseAbsMatrix=!1)}this._drawCount++;var l=0<=e&&2===h.submitType&&h.other===e;l&&(l=l&&this.isSameClipInfo(this._curSubmit)),this._lastTex=t;var c=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*o);if(65535<this._mesh.vertNum+4&&(this._mesh=Vt.getAMesh(),this.meshlist.push(this._mesh),l=!1),this.transformQuad(i,_,r||t.width,a||t.height,this._italicDeg,n||this._curMat,this._transedPoints),!this.clipedOff(this._transedPoints)){if(this._mesh.addQuad(this._transedPoints,s,c,!0),!l){var f=Yt.create(this,this._mesh,H.create(1,0));this._submits[this._submits._length++]=this._curSubmit=f,f.shaderValue.textureHost=t,f._key.other=e,this.copyClipInfo(f,this._globalClipMatrix)}return this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,!0}return!1},e.transform4Points=function(t,e,i){var _=e.tx,r=e.ty;e._bTransform?(i[0]=t[0]*e.a+t[1]*e.c+_,i[1]=t[0]*e.b+t[1]*e.d+r,i[2]=t[2]*e.a+t[3]*e.c+_,i[3]=t[2]*e.b+t[3]*e.d+r,i[4]=t[4]*e.a+t[5]*e.c+_,i[5]=t[4]*e.b+t[5]*e.d+r,i[6]=t[6]*e.a+t[7]*e.c+_,i[7]=t[6]*e.b+t[7]*e.d+r):(i[0]=t[0]+_,i[1]=t[1]+r,i[2]=t[2]+_,i[3]=t[3]+r,i[4]=t[4]+_,i[5]=t[5]+r,i[6]=t[6]+_,i[7]=t[7]+r)},e.clipedOff=function(t){return this._clipRect.width<=0||this._clipRect.height<=0},e.transformQuad=function(t,e,i,_,r,a,n){var s=0;0!=r&&(s=Math.tan(r*Math.PI/180)*_);var o=t+i,h=e+_;this._temp4Points[0]=t+s,this._temp4Points[1]=e,this._temp4Points[2]=o+s,this._temp4Points[3]=e,this._temp4Points[4]=o,this._temp4Points[5]=h,this._temp4Points[6]=t,this._temp4Points[7]=h,this.transform4Points(this._temp4Points,a,n)},e.pushRT=function(){this.addRenderObject(bt.create(null,te.pushRT,this))},e.popRT=function(){this.addRenderObject(bt.create(null,te.popRT,this)),this.breakNextMerge()},e.useRT=function(t){this.addRenderObject(bt.create([t],function(t){if(!t)throw"error useRT";t.start(),t.clear(0,0,0,0)},this)),this.breakNextMerge()},e.RTRestore=function(t){this.addRenderObject(bt.create([t],function(t){t.restore()},this)),this.breakNextMerge()},e.breakNextMerge=function(){this._curSubmit=ct.RENDERBASE},e._repaintSprite=function(){this.sprite&&this.sprite.repaint()},e.drawTextureWithTransform=function(t,e,i,_,r,a,n,s,o,h){if(a){var u=this._curMat;z._tmpMatrix.a=a.a,z._tmpMatrix.b=a.b,z._tmpMatrix.c=a.c,z._tmpMatrix.d=a.d,z._tmpMatrix.tx=a.tx+n,z._tmpMatrix.ty=a.ty+s,z._tmpMatrix._bTransform=a._bTransform,a&&u._bTransform?(S.mul(z._tmpMatrix,u,z._tmpMatrix),(a=z._tmpMatrix)._bTransform=!0):a=z._tmpMatrix,this._drawTextureM(t,e,i,_,r,a,o,null)}else this._drawTextureM(t,e+n,i+s,_,r,null,o,null)},e._flushToTarget=function(t,e){Ct.worldScissorTest=!1,dt.mainContext.disable(3089);var i=Ct.worldAlpha,_=Ct.worldMatrix4,r=Ct.worldMatrix;Ct.worldShaderDefines;Ct.worldMatrix=S.EMPTY,Ct.restoreTempArray(),Ct.worldMatrix4=Ct.TEMPMAT4_ARRAY,Ct.worldAlpha=1,Ht.activeShader=null,e.start(),e.clear(0,0,0,0),t._curSubmit=ct.RENDERBASE,t.flush(),t.clear(),e.restore(),t._curSubmit=ct.RENDERBASE,Ht.activeShader=null,Ct.worldAlpha=i,Ct.worldMatrix4=_,Ct.worldMatrix=r},e.drawCanvas=function(t,e,i,_,r){var a,n=t.context;if(n._targets)0<n._submits._length&&(a=bt.create([n,n._targets],this._flushToTarget,this),this._submits[this._submits._length++]=a),this._drawRenderTexture(n._targets,e,i,_,r,null,1,te.flipyuv),this._curSubmit=ct.RENDERBASE;else{n.touches&&n.touches.forEach(function(t){t.touch()}),a=zt.create(n,this._shader2D.ALPHA,this._shader2D.filters),(this._submits[this._submits._length++]=a)._key.clear();var s=_/t.width,o=r/t.height,h=a._matrix;this._curMat.copyTo(h),1!=s&&1!=o&&h.scale(s,o);var u=h.tx,l=h.ty;h.tx=h.ty=0,h.transformPoint(C.TEMP.setTo(e,i)),h.translate(C.TEMP.x+u,C.TEMP.y+l),this._curSubmit=ct.RENDERBASE}},e.drawTarget=function(t,e,i,_,r,a,n,s,o){void 0===o&&(o=-1),this._drawCount++;this.mixRGBandAlpha(this._drawTextureUseColor?this.fillStyle?this.fillStyle.toInt():0:4294967295);if(65535<this._mesh.vertNum+4&&(this._mesh=Vt.getAMesh(),this.meshlist.push(this._mesh)),this.transformQuad(e,i,_,r,0,a||this._curMat,this._transedPoints),!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,s||w.DEF_UV,4294967295,!0);var h=this._curSubmit=ut.create(this,this._mesh,n,t);return h.blendType=-1==o?this._nBlendType:o,this.copyClipInfo(h,this._globalClipMatrix),h._numEle=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._maxNumEle=Math.max(this._maxNumEle,h._numEle),this._submits[this._submits._length++]=h,this._curSubmit=ct.RENDERBASE,!0}return this._curSubmit=ct.RENDERBASE,!1},e.drawTriangles=function(t,e,i,_,r,a,n,s,o,h){if(t._getSource()){this._drawCount++;var u=null,l=!1;o&&(u=this._colorFiler,this._colorFiler=o,this._curSubmit=ct.RENDERBASE,l=u!=o);var c=Et.TOINT[h]||0,f=t.bitmap,d=this._curSubmit._key,E=4===d.submitType&&d.other===f.id&&d.blendShader==c,A=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*s),D=_.length/2,R=a.length;if(65535<this._triangleMesh.vertNum+D&&(this._triangleMesh=Ut.getAMesh(),this.meshlist.push(this._triangleMesh),E=!1),!E){var m=this._curSubmit=Yt.create(this,this._triangleMesh,H.create(1,0));m.shaderValue.textureHost=t,m._renderType=10016,m._key.blendShader=c,m._blendFn=this._targets?Et.targetFns[c]:Et.fns[c],m._key.submitType=4,m._key.other=f.id,this.copyClipInfo(m,this._globalClipMatrix),this._submits[this._submits._length++]=m}n?(z._tmpMatrix.a=n.a,z._tmpMatrix.b=n.b,z._tmpMatrix.c=n.c,z._tmpMatrix.d=n.d,z._tmpMatrix.tx=n.tx+e,z._tmpMatrix.ty=n.ty+i):(z._tmpMatrix.a=1,z._tmpMatrix.b=0,z._tmpMatrix.c=0,z._tmpMatrix.d=1,z._tmpMatrix.tx=e,z._tmpMatrix.ty=i),this._drawTriUseAbsMatrix||S.mul(z._tmpMatrix,this._curMat,z._tmpMatrix),this._triangleMesh.addData(_,r,a,z._tmpMatrix,A,this),this._curSubmit._numEle+=R,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),l&&(this._colorFiler=u,this._curSubmit=ct.RENDERBASE)}else this.sprite&&P.systemTimer.callLater(this,this._repaintSprite)},e.transform=function(t,e,i,_,r,a){Rt.save(this),S.mul(S.TEMP.setTo(t,e,i,_,r,a),this._curMat,this._curMat),this._curMat._checkTransform()},e._transformByMatrix=function(t,e,i){t.setTranslate(e,i),S.mul(t,this._curMat,this._curMat),t.setTranslate(0,0),this._curMat._bTransform=!0},e.setTransformByMatrix=function(t){t.copyTo(this._curMat)},e.rotate=function(t){Rt.save(this),this._curMat.rotateEx(t)},e.scale=function(t,e){Rt.save(this),this._curMat.scaleEx(t,e)},e.clipRect=function(t,e,i,_){j.save(this),this._clipRect==z.MAXCLIPRECT?this._clipRect=new M(t,e,i,_):(this._clipRect.width=i,this._clipRect.height=_,this._clipRect.x=t,this._clipRect.y=e),z._clipID_Gen++,z._clipID_Gen%=1e4,this._clipInfoID=z._clipID_Gen;var r=this._globalClipMatrix,a=r.tx,n=r.ty,s=a+r.a,o=n+r.d;if(99999999<=this._clipRect.width?(r.a=r.d=99999999,r.b=r.c=r.tx=r.ty=0):this._curMat._bTransform?(r.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx,r.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty,r.a=this._clipRect.width*this._curMat.a,r.b=this._clipRect.width*this._curMat.b,r.c=this._clipRect.height*this._curMat.c,r.d=this._clipRect.height*this._curMat.d):(r.tx=this._clipRect.x+this._curMat.tx,r.ty=this._clipRect.y+this._curMat.ty,r.a=this._clipRect.width,r.b=r.c=0,r.d=this._clipRect.height),0<r.a&&0<r.d){var h=r.tx+r.a,u=r.ty+r.d;h<=a||u<=n||r.tx>=s||r.ty>=o?(r.a=-.1,r.d=-.1):(r.tx<a&&(r.a-=a-r.tx,r.tx=a),s<h&&(r.a-=h-s),r.ty<n&&(r.d-=n-r.ty,r.ty=n),o<u&&(r.d-=u-o),r.a<=0&&(r.a=-.1),r.d<=0&&(r.d=-.1))}},e.drawMesh=function(t,e,i,_,r,a,n,s,o){void 0===o&&(o=0)},e.addRenderObject=function(t){this._submits[this._submits._length++]=t},e.submitElement=function(t,e){c._context;var i=this._submits,_=i._length;e<0&&(e=i._length);for(var r=ct.RENDERBASE;t<e;)this._renderNextSubmitIndex=t+1,i[t]!==ct.RENDERBASE?(ct.preRender=r,t+=(r=i[t]).renderSubmit()):t++;return _},e.flush=function(){var t=this.submitElement(0,this._submits._length);this._path&&this._path.reset(),Z.instance&&Z.getInstance().reset(),this._curSubmit=ct.RENDERBASE;for(var e=0,i=this.meshlist.length;e<i;e++){var _=this.meshlist[e];_.canReuse?_.releaseMesh():_.destroy()}return this.meshlist.length=0,this._mesh=Vt.getAMesh(),this._pathMesh=wt.getAMesh(),this._triangleMesh=Ut.getAMesh(),this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh),this._flushCnt++,this._flushCnt%600==0&&c._context==this&&gt.charbookInst&&gt.charbookInst.GC(),t},e.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=k.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},e.beginPath=function(t){void 0===t&&(t=!1),this._getPath().beginPath(t)},e.closePath=function(){this._path.closePath()},e.addPath=function(t,e,i,_,r){var a=0,n=this._curMat;if(this._curMat._bTransform)for(var s=0,o=t.length/2;s<o;s++){var h=t[a]+_,u=t[a+1]+r;t[a]=h*n.a+u*n.c+n.tx,t[a+1]=h*n.b+u*n.d+n.ty,a+=2}else if(0!=n.tx||0!=n.ty||_||r)for(s=0,o=t.length/2;s<o;s++){var l=t[a]+_,c=t[a+1]+r;t[a]=l+n.tx,t[a+1]=c+n.ty,a+=2}else;this._getPath().push(t,i)},e.fill=function(){var t=this._getPath(),e=this._curSubmit,i=3===e._key.submitType&&e._key.blendShader===this._submitKey.blendShader;i&&(i=i&&this.isSameClipInfo(e)),i||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var _,r=this.mixRGBandAlpha(this.fillStyle.toInt()),a=0,n=0,s=t.paths.length;n<s;n++){var o=t.paths[n],h=o.path.length/2;if(!(h<3||3==h&&!o.convex)){65535<this._pathMesh.vertNum+h&&(this._curSubmit._numEle+=a,a=0,this._pathMesh=wt.getAMesh(),this._curSubmit=this.addVGSubmit(this._pathMesh));var u=this._pathMesh.vertNum;if(o.convex){var l=h-2;_=new Array(3*l);for(var c=0,f=0;f<l;f++)_[c++]=u,_[c++]=f+1+u,_[c++]=f+2+u}else if(_=lt.earcut(o.path,null,2),0<u)for(var d=0;d<_.length;d++)_[d]+=u;this._pathMesh.addVertAndIBToMesh(this,o.path,r,_),a+=_.length}}this._curSubmit._numEle+=a},e.addVGSubmit=function(t){var e=ct.createShape(this,t,0,H.create(4,0));return e._key.blendShader=this._submitKey.blendShader,e._key.submitType=3,this._submits[this._submits._length++]=e,this.copyClipInfo(e,this._globalClipMatrix),e},e.stroke=function(){if(0<this.lineWidth){var t=this.mixRGBandAlpha(this.strokeStyle._color.numColor),e=this._getPath(),i=this._curSubmit,_=3===i._key.submitType&&i._key.blendShader===this._submitKey.blendShader;_&&(_=_&&this.isSameClipInfo(i)),_||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var r=0,a=0,n=e.paths.length;a<n;a++){var s=e.paths[a];if(!(s.path.length<=0)){var o=[],h=[],u=2*s.path.length;u<2||(65535<this._pathMesh.vertNum+u&&(this._curSubmit._numEle+=r,r=0,this._pathMesh=wt.getAMesh(),this.meshlist.push(this._pathMesh),this._curSubmit=this.addVGSubmit(this._pathMesh)),Pt.createLine2(s.path,o,this.lineWidth,this._pathMesh.vertNum,h,s.loop,this._curMat),this._pathMesh.addVertAndIBToMesh(this,h,t,o),r+=o.length)}}this._curSubmit._numEle+=r}},e.moveTo=function(t,e,i){void 0===i&&(i=!0);var _=this._getPath();if(_.newPath(),_._lastOriX=t,_._lastOriY=e,i){var r=t,a=e;t=this._curMat.a*r+this._curMat.c*a+this._curMat.tx,e=this._curMat.b*r+this._curMat.d*a+this._curMat.ty}_.addPoint(t,e)},e.lineTo=function(t,e,i){void 0===i&&(i=!0);var _=this._getPath();if(!(Math.abs(t-_._lastOriX)<.001&&Math.abs(e-_._lastOriY)<.001)){if(_._lastOriX=t,_._lastOriY=e,i){var r=t,a=e;t=this._curMat.a*r+this._curMat.c*a+this._curMat.tx,e=this._curMat.b*r+this._curMat.d*a+this._curMat.ty}_.addPoint(t,e)}},e.arcTo=function(t,e,i,_,r){var a=0,n=0,s=0,o=this._path._lastOriX-t,h=this._path._lastOriY-e,u=Math.sqrt(o*o+h*h);if(!(u<=1e-6)){var l=o/u,c=h/u,f=i-t,d=_-e,E=f*f+d*d,A=Math.sqrt(E);if(!(A<=1e-6)){var D=f/A,R=d/A,m=l+D,T=c+R,v=Math.sqrt(m*m+T*T);if(!(v<=1e-6)){var P=m/v,p=T/v,C=Math.acos(P*l+p*c),M=Math.PI/2-C,O=(u=r/Math.tan(M))*l+t,y=u*c+e,L=Math.sqrt(u*u+r*r),S=t+P*L,g=e+p*L,b=0,B=0;if(0<=l*R-c*D){var I=2*M/z.SEGNUM;b=Math.sin(I),B=Math.cos(I)}else I=2*-M/z.SEGNUM,b=Math.sin(I),B=Math.cos(I);var x=this._path._lastOriX,N=this._path._lastOriY,F=O,V=y;(.1<Math.abs(F-this._path._lastOriX)||.1<Math.abs(V-this._path._lastOriY))&&(n=this._curMat.a*F+this._curMat.c*V+this._curMat.tx,s=this._curMat.b*F+this._curMat.d*V+this._curMat.ty,x=F,N=V,this._path.addPoint(n,s));var w=O-S,U=y-g;for(a=0;a<z.SEGNUM;a++){var G=w*B+U*b,W=-w*b+U*B;if(n=G+S,s=W+g,.1<Math.abs(x-n)||.1<Math.abs(N-s)){var X=n,k=s;n=this._curMat.a*X+this._curMat.c*k+this._curMat.tx,s=this._curMat.b*X+this._curMat.d*k+this._curMat.ty,this._path.addPoint(n,s),x=n,N=s}w=G,U=W}}}}},e.arc=function(t,e,i,_,r,a,n){void 0===a&&(a=!1),void 0===n&&(n=!0);var s,o,h=0,u=0,l=0,c=0,f=0,d=0,E=0;if(u=r-_,a)if(Math.abs(u)>=2*Math.PI)u=2*-Math.PI;else for(;0<u;)u-=2*Math.PI;else if(Math.abs(u)>=2*Math.PI)u=2*Math.PI;else for(;u<0;)u+=2*Math.PI;var A=this.getMatScaleX(),D=this.getMatScaleY(),R=i*(D<A?A:D),m=2*Math.PI*R;s=u/(o=0|Math.max(m/10,10))/2,l=Math.abs(4/3*(1-Math.cos(s))/Math.sin(s)),a&&(l=-l);var T=this._getPath();for(E=0;E<=o;E++)if(h=_+u*(E/o),c=Math.cos(h),d=e+Math.sin(h)*i,(f=t+c*i)!=this._path._lastOriX||d!=this._path._lastOriY){var v=f,P=d;f=this._curMat.a*v+this._curMat.c*P+this._curMat.tx,d=this._curMat.b*v+this._curMat.d*P+this._curMat.ty,T.addPoint(f,d)}if(c=Math.cos(r),d=e+Math.sin(r)*i,(f=t+c*i)!=this._path._lastOriX||d!=this._path._lastOriY){var p=f,C=d;f=this._curMat.a*p+this._curMat.c*C+this._curMat.tx,d=this._curMat.b*p+this._curMat.d*C+this._curMat.ty,T.addPoint(f,d)}},e.quadraticCurveTo=function(t,e,i,_){for(var r=o.I.getBezierPoints([this._path._lastOriX,this._path._lastOriY,t,e,i,_],30,2),a=0,n=r.length/2;a<n;a++)this.lineTo(r[2*a],r[2*a+1]);this.lineTo(i,_)},e.rect=function(t,e,i,_){this._other=this._other.make(),this._other.path||(this._other.path=new At),this._other.path.rect(t,e,i,_)},e.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},e._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},e.strokeRect=function(t,e,i,_,r){if(0<this.lineWidth){var a=this.mixRGBandAlpha(this.strokeStyle._color.numColor),n=this.lineWidth/2;this._fillRect(t-n,e-n,i+this.lineWidth,this.lineWidth,a),this._fillRect(t-n,e-n+_,i+this.lineWidth,this.lineWidth,a),this._fillRect(t-n,e+n,this.lineWidth,_-this.lineWidth,a),this._fillRect(t-n+i,e+n,this.lineWidth,_-this.lineWidth,a)}},e.clip=function(){},e.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},e._getPath=function(){return this._path||(this._path=new At)},E(0,e,"globalCompositeOperation",function(){return Et.NAMES[this._nBlendType]},function(t){var e=Et.TOINT[t];null==e||this._nBlendType===e||(Y.save(this,65536,this,!0),this._curSubmit=ct.RENDERBASE,this._nBlendType=e)}),E(0,e,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(Y.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=K.create(t),this._submitKey.other=-this._shader2D.strokeStyle.toInt())}),E(0,e,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(Y.save(this,1,this._shader2D,!1),this._shader2D.ALPHA=t)}),E(0,e,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new te(this._width,this._height,1,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets&&this._targets.destroy(),this._targets=null}),E(0,e,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(Y.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=K.create(t),this._submitKey.other=-this._shader2D.fillStyle.toInt())}),E(0,e,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),Y.save(this,32768,this._other,!1),this._other.textAlign=t)}),E(0,e,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),Y.save(this,256,this._other,!1),this._other.lineWidth=t)}),E(0,e,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),Y.save(this,16384,this._other,!1),this._other.textBaseline=t)}),E(0,e,"font",null,function(t){this._other=this._other.make(),Y.save(this,8,this._other,!1)}),E(0,e,"canvas",function(){return this._canvas}),z.__init__=function(){i.DEFAULT=new i},z._tempPoint=new C,z._SUBMITVBSIZE=32e3,z._MAXSIZE=99999999,z._MAXVERTNUM=65535,z.MAXCLIPRECT=new M(0,0,99999999,99999999),z._COUNT=0,z._tmpMatrix=new S,z.SEGNUM=32,z._contextcount=0,z._clipID_Gen=0,z.defTexture=null,n(z,["_drawStyleTemp",function(){return this._drawStyleTemp=new K(null)},"_keyMap",function(){return this._keyMap=new N},"_drawTexToDrawTri_Vert",function(){return this._drawTexToDrawTri_Vert=new Float32Array(8)},"_drawTexToDrawTri_Index",function(){return this._drawTexToDrawTri_Index=new Uint16Array([0,1,2,0,2,3])},"_charBook",function(){return this._charBook=new gt}]),z.__init$=function(){i=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null}v(t,"");var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,t}()},z}(),xt=function(t){function i(t){this.texcoord=null,this.position=null,this.offsetX=300,this.offsetY=0,i.__super.call(this,512,0);var e=8*ft.BYTES_PE;this.position=[2,5126,!1,e,0],this.texcoord=[2,5126,!1,e,2*ft.BYTES_PE],this.color=[4,5126,!1,e,4*ft.BYTES_PE]}return v(i,"laya.webgl.shader.d2.skinAnishader.SkinSV",H),i}(),Nt=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,void 0===t&&(t=0),e.__super.call(this,1,t),this._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2]}return v(e,"laya.webgl.shader.d2.value.TextureSV",H),e.prototype.clear=function(){this.texture=null,this.shader=null,this.defines._value=this.subID+(dt.shaderHighPrecision?1024:0)},e}(),Ft=function(t){function e(t){e.__super.call(this,4,0),this._attribLocation=["position",0,"attribColor",1]}return v(e,"laya.webgl.shader.d2.value.PrimitiveSV",H),e}(),Vt=function(t){function e(){e.__super.call(this,laya.webgl.utils.MeshQuadTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshQuadTexture._fixattriInfo),laya.webgl.utils.MeshQuadTexture._fixib?(this._ib=laya.webgl.utils.MeshQuadTexture._fixib,this._quadNum=e._maxIB):(this.createQuadIB(e._maxIB),laya.webgl.utils.MeshQuadTexture._fixib=this._ib)}v(e,"laya.webgl.utils.MeshQuadTexture",Q);var i=e.prototype;return i.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshQuadTexture._POOL.push(this)},i.destroy=function(){this._vb.destroy(),this._vb.deleteBuffer()},i.addQuad=function(t,e,i,_){var r=this._vb,a=r._byteLength>>2;r.setByteLength(a+laya.webgl.utils.MeshQuadTexture.const_stride<<2);var n=r._floatArray32||r.getFloat32Array(),s=r._uint32Array,o=a,h=_?255:0;n[o++]=t[0],n[o++]=t[1],n[o++]=e[0],n[o++]=e[1],s[o++]=i,s[o++]=h,n[o++]=t[2],n[o++]=t[3],n[o++]=e[2],n[o++]=e[3],s[o++]=i,s[o++]=h,n[o++]=t[4],n[o++]=t[5],n[o++]=e[4],n[o++]=e[5],s[o++]=i,s[o++]=h,n[o++]=t[6],n[o++]=t[7],n[o++]=e[6],n[o++]=e[7],s[o++]=i,s[o++]=h,r._upload=!0},e.getAMesh=function(){return laya.webgl.utils.MeshQuadTexture._POOL.length?laya.webgl.utils.MeshQuadTexture._POOL.pop():new e},e.const_stride=24,e._fixib=null,e._maxIB=16384,e._POOL=[],n(e,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]),e}(),wt=function(t){function u(){u.__super.call(this,laya.webgl.utils.MeshVG.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshVG._fixattriInfo)}v(u,"laya.webgl.utils.MeshVG",Q);var e=u.prototype;return e.addVertAndIBToMesh=function(t,e,i,_){for(var r=this._vb.needSize(e.length/2*u.const_stride)>>2,a=this._vb._floatArray32||this._vb.getFloat32Array(),n=this._vb._uint32Array,s=0,o=e.length/2,h=0;h<o;h++)a[r++]=e[s],a[r++]=e[s+1],s+=2,n[r++]=i;this._vb.setNeedUpload(),this._ib.append(new Uint16Array(_)),this._ib.setNeedUpload(),this.vertNum+=o,this.indexNum+=_.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshVG._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},u.getAMesh=function(){return laya.webgl.utils.MeshVG._POOL.length?laya.webgl.utils.MeshVG._POOL.pop():new u},u.const_stride=12,u._POOL=[],n(u,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5121,4,8]}]),u}(),Ut=function(t){function m(){m.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}v(m,"laya.webgl.utils.MeshTexture",Q);var e=m.prototype;return e.addData=function(t,e,i,_,r,a){for(var n=t.length/2,s=this._vb.needSize(n*m.const_stride)>>2,o=this._vb._floatArray32||this._vb.getFloat32Array(),h=this._vb._uint32Array,u=0,l=0;l<n;l++){var c=t[u],f=t[u+1],d=c*_.a+f*_.c+_.tx,E=c*_.b+f*_.d+_.ty;o[s++]=d,o[s++]=E,o[s++]=e[u],o[s++]=e[u+1],u+=2,h[s++]=r,h[s++]=255}this._vb.setNeedUpload();var A=this.vertNum;if(0<A){var D=i.length;D>m.tmpIdx.length&&(m.tmpIdx=new Uint16Array(D));for(var R=0;R<D;R++)m.tmpIdx[R]=i[R]+A;this._ib.appendU16Array(m.tmpIdx,i.length)}else this._ib.append(i);this._ib.setNeedUpload(),this.vertNum+=n,this.indexNum+=i.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},m.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new m},m.const_stride=24,m._POOL=[],n(m,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),m}(),Gt=function(t){function i(){i.__super.call(this,i.__name2int,i.__int2name,i.__int2nameMap)}return v(i,"laya.webgl.shader.d2.ShaderDefines2D",J),i.__init__=function(){i.reg("TEXTURE2D",1),i.reg("PRIMITIVE",4),i.reg("GLOW_FILTER",8),i.reg("BLUR_FILTER",16),i.reg("COLOR_FILTER",32),i.reg("COLOR_ADD",64),i.reg("WORLDMAT",128),i.reg("FILLTEXTURE",256),i.reg("FSHIGHPRECISION",1024)},i.reg=function(t,e){J._reg(t,e,i.__name2int,i.__int2name)},i.toText=function(t,e,i){return J._toText(t,e,i)},i.toInt=function(t){return J._toInt(t,i.__name2int)},i.TEXTURE2D=1,i.PRIMITIVE=4,i.FILTERGLOW=8,i.FILTERBLUR=16,i.FILTERCOLOR=32,i.COLORADD=64,i.WORLDMAT=128,i.FILLTEXTURE=256,i.SKINMESH=512,i.SHADERDEFINE_FSHIGHPRECISION=1024,i.NOOPTMASK=312,i.__name2int={},i.__int2name=[],i.__int2nameMap=[],i}(),Wt=function(t){function c(){this.lastScaleX=1,this.lastScaleY=1,this.needResetScale=!1,c.__super.call(this),c.canvas||((c.canvas=f.document.createElement("canvas")).width=512,c.canvas.height=512,c.canvas.style.left="-1000px",c.canvas.style.position="absolute",i.body.appendChild(c.canvas),c.ctx=c.canvas.getContext("2d"))}v(c,"laya.webgl.resource.CharRender_Canvas",tt);var e=c.prototype;return e.getWidth=function(t){return c.ctx?(c.ctx._lastFont!=gt._curFont&&(c.ctx.font=gt._curFont,c.ctx._lastFont=gt._curFont),c.ctx.measureText(t).width):0},e.scale=function(t,e){this.lastScaleX==t&&this.lastScaleY==e||(this.needResetScale&&(c.ctx.restore(),this.lastScaleX=this.lastScaleY=1),c.ctx.save(),this.needResetScale=!0,gt.isWan1Wan||c.ctx.scale(t,e),this.lastScaleX=t,this.lastScaleY=e)},e.getCharBmp=function(t,e,i,_,r,a,n,s,o,h){if(gt.isWan1Wan)return this.getCharCanvas(t,e,i,_,r,a,n,s,o,h);c.ctx.font!=e&&(c.ctx.font=e,c.ctx._lastFont=e),a.width=c.ctx.measureText(t).width;var u=a.width*this.lastScaleX,l=a.height*this.lastScaleY;return u+=(n+o)*this.lastScaleX,l+=(s+h)*this.lastScaleY,c.ctx.clearRect(0,0,u+1,l+1),c.ctx.textBaseline="top",0<i&&(c.ctx.strokeStyle=r,c.ctx.lineWidth=i,c.ctx.strokeText(t,n,s)),c.ctx.fillStyle=_,c.ctx.fillText(t,n,s),gt.debug&&(c.ctx.strokeStyle="#ff0000",c.ctx.strokeRect(0,0,u,l),c.ctx.strokeStyle="#00ff00",c.ctx.strokeRect(n,s,a.width,a.height)),c.ctx.getImageData(0,0,0|u,0|l)},e.getCharCanvas=function(t,e,i,_,r,a,n,s,o,h){c.ctx.font!=e&&(c.ctx.font=e,c.ctx._lastFont=e),a.width=c.ctx.measureText(t).width;var u=a.width*this.lastScaleX,l=a.height*this.lastScaleY;return u+=(n+o)*this.lastScaleX,l+=(s+h)*this.lastScaleY,c.canvas.width=u+1,c.canvas.height=l+1,c.ctx.font=e,this.needResetScale=!1,c.ctx.clearRect(0,0,u+1,l+1),c.ctx.save(),c.ctx.translate(n,s),gt.scaleFontWithCtx&&c.ctx.scale(this.lastScaleX,this.lastScaleY),c.ctx.textAlign="left",c.ctx.textBaseline="top",0<i?(c.ctx.strokeStyle=r,c.ctx.fillStyle=_,c.ctx.lineWidth=i,c.ctx.strokeText(t,0,0)):c.ctx.fillStyle=_,c.ctx.fillText(t,0,0),gt.debug&&(c.ctx.strokeStyle="#ff0000",c.ctx.strokeRect(0,0,u,l),c.ctx.strokeStyle="#00ff00",c.ctx.strokeRect(0,0,a.width,a.height)),c.ctx.restore(),c.canvas},c.canvas=null,c.ctx=null,c}(),Xt=function(t){function e(){e.__super.call(this)}return v(e,"laya.webgl.BufferState2D",_t),e}(),kt=function(t){function e(){this.lastFont="",e.__super.call(this)}v(e,"laya.webgl.resource.CharRender_Native",tt);var i=e.prototype;return i.getWidth=function(t){return f.conchTextCanvas?(this.lastFont!=gt._curFont&&(f.conchTextCanvas.font=gt._curFont,this.lastFont=gt._curFont),f.conchTextCanvas.measureText(t).width):0},i.scale=function(t,e){},i.getCharBmp=function(t,e,i,_,r,a,n,s,o,h){if(!f.conchTextCanvas)return null;this.lastFont!=e&&(f.conchTextCanvas.font=gt._curFont,this.lastFont=gt._curFont);a.width=f.conchTextCanvas.measureText(t).width,a.height;var u=W.create(r).numColor,l=W.create(_).numColor;return f.conchTextCanvas.getTextBitmapData(t,l,2<i?2:i,u)},e}(),zt=(function(t){function i(t){i.__super.call(this,laya.webgl.utils.MeshParticle2D.const_stride,4*t*i.const_stride,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshParticle2D._fixattriInfo),this.createQuadIB(t),this._quadNum=t}v(i,"laya.webgl.utils.MeshParticle2D",Q);var e=i.prototype;e.setMaxParticleNum=function(t){this._vb._resizeBuffer(4*t*i.const_stride,!1),this.createQuadIB(t)},e.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshParticle2D._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._vb.deleteBuffer()},i.getAMesh=function(t){if(laya.webgl.utils.MeshParticle2D._POOL.length){var e=laya.webgl.utils.MeshParticle2D._POOL.pop();return e.setMaxParticleNum(t),e}return new i(t)},i.const_stride=116,i._POOL=[],n(i,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5126,3,16,5126,3,28,5126,4,40,5126,4,56,5126,3,72,5126,2,84,5126,4,92,5126,1,108,5126,1,112]}])}(),function(t){function a(){this._matrix=new S,this._matrix4=ft.defaultMatrix4.concat(),a.__super.call(this,1e4),this.shaderValue=new H(0,0)}v(a,"laya.webgl.submit.SubmitCanvas",ct);var e=a.prototype;return e.renderSubmit=function(){if(this._ctx_src._targets)return alert("nimei"),1;var t=Ct.worldAlpha,e=Ct.worldMatrix4,i=Ct.worldMatrix,_=Ct.worldFilters,r=Ct.worldShaderDefines,a=this.shaderValue,n=this._matrix,s=this._matrix4,o=S.TEMP;return S.mul(n,i,o),s[0]=o.a,s[1]=o.b,s[4]=o.c,s[5]=o.d,s[12]=o.tx,s[13]=o.ty,Ct.worldMatrix=o.clone(),Ct.worldMatrix4=s,Ct.worldAlpha=Ct.worldAlpha*a.alpha,a.filters&&a.filters.length&&(Ct.worldFilters=a.filters,Ct.worldShaderDefines=a.defines),this._ctx_src.flush(),Ct.worldAlpha=t,Ct.worldMatrix4=e,Ct.worldMatrix.destroy(),Ct.worldMatrix=i,Ct.worldFilters=_,Ct.worldShaderDefines=r,1},e.releaseRender=function(){if(--this._ref<1){var t=a.POOL;this._ctx_src=null,this._mesh=null,t[t._length++]=this}},e.clone=function(t,e,i){return null},e.getRenderType=function(){return 10003},a.create=function(t,e,i){var _=a.POOL._length?a.POOL[--a.POOL._length]:new a;_._ctx_src=t,_._ref=1,_._numEle=0;var r=_.shaderValue;return r.alpha=e,r.defines.setValue(0),i&&i.length&&r.setFilters(i),_},a.POOL=((a.POOL=[])._length=0,a.POOL),a}()),Yt=function(t){function n(t){void 0===t&&(t=1e4),n.__super.call(this,t)}v(n,"laya.webgl.submit.SubmitTexture",ct);var e=n.prototype;return e.clone=function(t,e,i){var _=n._poolSize?n.POOL[--n._poolSize]:new n;return this._cloneInit(_,t,e,i),_},e.releaseRender=function(){--this._ref<1&&((n.POOL[n._poolSize++]=this).shaderValue.release(),this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},e.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t?t._getSource():null;if(!e)return 1}var i=dt.mainContext;this._mesh.useMesh(i);var _=ct.preRender,r=ct.preRender._key;return 0===this._key.blendShader&&this._key.submitType===r.submitType&&this._key.blendShader===r.blendShader&&Ht.activeShader&&ct.preRender.clipInfoID==this.clipInfoID&&_.shaderValue.defines._value===this.shaderValue.defines._value&&0==(this.shaderValue.defines._value&Gt.NOOPTMASK)?Ht.activeShader.uploadTexture2D(e):(Et.activeBlendFunction!==this._blendFn&&(at.setBlend(i,!0),this._blendFn(i),Et.activeBlendFunction=this._blendFn),this.shaderValue.texture=e,this.shaderValue.upload()),i.drawElements(4,this._numEle,5123,this._startIdx),x.drawCall++,x.trianglesFaces+=this._numEle/3,1},n.create=function(t,e,i){var _=n._poolSize?n.POOL[--n._poolSize]:new n(10016);_._mesh=e,_._key.clear(),_._key.submitType=2,_._ref=1,_._startIdx=e.indexNum*ft.BYTES_PIDX,_._numEle=0;var r=t._nBlendType;if(_._key.blendShader=r,_._blendFn=t._targets?Et.targetFns[r]:Et.fns[r],_.shaderValue=i,t._colorFiler){var a=t._colorFiler;i.defines.add(a.type),i.colorMat=a._mat,i.colorAlpha=a._alpha}return _},n._poolSize=0,n.POOL=[],n}(),Ht=function(t){function e(){e.__super.call(this)}return v(e,"laya.webgl.shader.BaseShader",R),e.activeShader=null,e.bindShader=null,e}(),Zt=function(t){function _(t,e,i){this.texture=null,this._source=null,this._used=null,this._startFindPos=0,this._texW=0,this._texH=0,this._gridNum=0,this.charMaps=[],this._score=0,this._scoreTick=0,this.__destroyed=!1,this._discardTm=0,_.__super.call(this),this._texW=t,this._texH=e,this._gridNum=i,this.texture=new yt(this),this.setGridNum(i),this.lock=!0}v(_,"laya.webgl.resource.CharPageTexture",R);var e=_.prototype;return e.findAGrid=function(){for(var t=this._startFindPos;t<this._gridNum;t++)if(0==this._used[t])return this._startFindPos=t+1,this._used[t]=1,t;return-1},e.removeGrid=function(t){this._used[t]=0,t<this._startFindPos&&(this._startFindPos=t)},e.removeOld=function(_){for(var r=0,t=null,e=0,i=this.charMaps.length;e<i;e++)if(t=this.charMaps[e]){var a=this;t.forEach(function(t,e,i){t&&t.touchTick<_&&(console.log("remove char "+e),a.removeGrid(t.pos),i.delete(e),r++)})}return r},e.reset=function(){this._discardTm=P.stage.getFrameTm(),this._startFindPos=0,this.charMaps=[],this._score=0,this._scoreTick=0,this.__destroyed=!0},e.setGridNum=function(t){if(this._used&&this._used.length==this._gridNum)if(this._used.fill)this._used.fill(0);else for(var e=0;e<this._used.length;e++)this._used[e]=0;else this._used=new Uint8Array(t)},e.recreateResource=function(){if(!this._source){var t=c.isConchApp?z.instance.getDefaultCommandEncoder():dt.mainContext,e=this._source=t.createTexture();this.texture.bitmap._glTexture=this._source,at.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._texW,this._texH,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)}},e.addChar=function(t,e,i){if(gt.isWan1Wan)this.addCharCanvas(t,e,i);else{!this._source&&this.recreateResource();var _=c.isConchApp?z.instance.getDefaultCommandEncoder():dt.mainContext;at.bindTexture(_,3553,this._source),!c.isConchApp&&_.pixelStorei(37441,!0);var r=t.data;t.data instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer)),_.texSubImage2D(3553,0,e,i,t.width,t.height,6408,5121,r),!c.isConchApp&&_.pixelStorei(37441,!1)}},e.addCharCanvas=function(t,e,i){!this._source&&this.recreateResource();var _=c.isConchApp?z.instance.getDefaultCommandEncoder():dt.mainContext;at.bindTexture(_,3553,this._source),!c.isConchApp&&_.pixelStorei(37441,!0),_.texSubImage2D(3553,0,e,i,6408,5121,t),!c.isConchApp&&_.pixelStorei(37441,!1)},e.destroy=function(){console.log("destroy CharPageTexture"),this.__destroyed=!0;var t=c.isConchApp?z.instance.getDefaultCommandEncoder():dt.mainContext;this._source&&t.deleteTexture(this._source),this._source=null},_}(),jt=function(t){function e(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,e.__super.call(this),this._glBuffer=z.instance.createBuffer()}v(e,"laya.webgl.utils.Buffer",R);var i=e.prototype;return i._bindForVAO=function(){},i.bind=function(){return!1},i._disposeResource=function(){this._glBuffer&&(z.instance.deleteBuffer(this._glBuffer),this._glBuffer=null),this._setGPUMemory(0)},E(0,i,"bufferUsage",function(){return this._bufferUsage}),e._bindedVertexBuffer=null,e._bindedIndexBuffer=null,e}(),Qt=function(t){function c(){this._customRenderCmd=null,this._customCmds=null,this._x=0,this._y=0,this._renderType=0,this._bRepaintCanvas=!1,this._lastContext=null,c.__super.call(this)}v(c,"laya.layagl.ConchSpriteAdpt",d);var e=c.prototype;return e.createData=function(){this._conchData=new ParamData(308,!1),this._datai32=this._conchData._int32Data,this._dataf32=this._conchData._float32Data,this._dataf32[4]=1,this._datai32[3]=-1,this._datai32[1]=0,this._datai32[2]=0,this._datai32[22]=4294967295,this._datai32[5]=1,this._dataf32[8]=0,this._dataf32[9]=0,this._dataf32[10]=1,this._dataf32[11]=1,this._dataf32[16]=1,this._dataf32[17]=0,this._dataf32[18]=0,this._dataf32[19]=1,this._dataf32[20]=0,this._dataf32[21]=0,this._datai32[24]=-1,this._datai32[25]=-1,this._datai32[27]=-1,this._datai32[28]=0,this._datai32[29]=0,this._datai32[30]=1e6,this._datai32[31]=1e6,this._datai32[63]=0,this._datai32[71]=1,this._datai32[72]=771,this._datai32[68]=-1},e._createTransform=function(){return Ot.create(new Float32Array(6))},e._setTransform=function(t){var e=this._conchData._float32Data;e[15]=0,e[16]=t.a,e[17]=t.b,e[18]=t.c,e[19]=t.d,e[20]=t.tx,e[21]=t.ty},e._setGraphics=function(t){this._datai32[23]=t._commandEncoder.getPtrID()},e._setGraphicsCallBack=function(){this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(5,this.updateParticleFromNative.bind(this)),this._datai32[68]=5},e._setCacheAs=function(t){st.createCommandEncoder(),this._drawCanvasParamData||(this._drawCanvasParamData=new ParamData(132,!0)),this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._canvasBeginCmd||(this._canvasBeginCmd=z.instance.createCommandEncoder(128,64,!1)),this._canvasEndCmd||(this._canvasEndCmd=z.instance.createCommandEncoder(128,64,!1)),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(1,this.canvasBeginRenderFromNative.bind(this)),this._callbackFuncObj.addCallbackFunc(2,this.canvasEndRenderFromNative.bind(this)),this._datai32[56]=1,this._datai32[57]=2,this._datai32[58]=this._canvasBeginCmd.getPtrID(),this._datai32[59]=this._canvasEndCmd.getPtrID(),this._datai32[60]=st._DRAW_CANVAS_CMD_ENCODER_.getPtrID(),this._datai32[61]=this._drawCanvasParamData.getPtrID()},e._setX=function(t){this._x=this._dataf32[6]=t,this._renderType|=2,this._setRenderType(this._renderType),this._dataf32[15]=1},e._setY=function(t){this._y=this._dataf32[7]=t,this._renderType|=2,this._setRenderType(this._renderType),this._dataf32[15]=1},e._setPivotX=function(t){this._renderType|=2,this._dataf32[8]=t,this._dataf32[15]=1},e._getPivotX=function(){return this._dataf32[8]},e._setPivotY=function(t){this._renderType|=2,this._dataf32[9]=t,this._dataf32[15]=1},e._getPivotY=function(){return this._dataf32[9]},e._setAlpha=function(t){t=(t=1<(this.getStyle().alpha=t)?1:t)<0?0:t;var e=this._datai32[22];e=16777215&e|255*t<<24,this._datai32[22]=e,1!==t?this._renderType|=1:this._renderType&=-2,this._setRenderType(this._renderType),this.parentRepaint()},e._setRenderType=function(t){this._datai32[0]=t,St.GLS[t]||St.createByRenderType(t),St.GLSE[t]||St.createByRenderTypeEnd(t)},e.parentRepaint=function(){},e._getAlpha=function(){return(this._datai32[22]>>>24)/255},e._setScaleX=function(t){this._style.scaleX=this._dataf32[10]=t,this._dataf32[15]=1},e._setScaleY=function(t){this._style.scaleY=this._dataf32[11]=t,this._dataf32[15]=1},e._setSkewX=function(t){this._style.skewX=this._dataf32[12]=t,this._dataf32[15]=1},e._setSkewY=function(t){this._style.skewY=this._dataf32[13]=t,this._dataf32[15]=1},e._setRotation=function(t){this._style.rotation=this._dataf32[14]=t,this._dataf32[15]=1},e._setBgStyleColor=function(t,e,i,_,r){var a=null,n=null;this._drawSimpleRectParamData||(this._drawSimpleRectParamData=new ParamData(104,!0)),a=this._drawSimpleRectParamData._float32Data,n=this._drawSimpleRectParamData._int32Data;var s=W.create(r).numColor;n[0]=1,n[1]=96;var o=2;a[o++]=t,a[o++]=e,a[o++]=0,a[o++]=0,n[o++]=s,a[o++]=4294967295,a[o++]=t+i,a[o++]=e,a[o++]=0,a[o++]=0,n[o++]=s,a[o++]=4294967295,a[o++]=t+i,a[o++]=e+_,a[o++]=0,a[o++]=0,n[o++]=s,a[o++]=4294967295,a[o++]=t,a[o++]=e+_,a[o++]=0,a[o++]=0,n[o++]=s,a[o++]=4294967295,this._datai32[74]=this._drawSimpleRectParamData.getPtrID(),z.syncBufferToRenderThread(this._drawSimpleRectParamData),this._datai32[73]=Lt._SIMPLE_RECT_CMDENCODER_.getPtrID()},e._setBorderStyleColor=function(t,e,i,_,r,a){var n=null,s=null;this._drawRectBorderParamData||(this._drawRectBorderParamData=new ParamData(236,!0)),n=this._drawRectBorderParamData._float32Data,s=this._drawRectBorderParamData._int32Data;var o=[],h=[],u=[];o.push(t),o.push(e),o.push(t+i),o.push(e),o.push(t+i),o.push(e+_),o.push(t),o.push(e+_),o.push(t),o.push(e-a/2),Pt.createLine2(o,h,a,0,u,!1);var l=o.length;n=this._drawRectBorderParamData._float32Data,s=this._drawRectBorderParamData._int32Data;var c=this._drawRectBorderParamData._int16Data,f=W.create(r).numColor;s[0]=0,s[1]=120,s[2]=0,s[3]=2*h.length;for(var d=5,E=s[4]=0;E<l;E++)n[d++]=u[2*E],n[d++]=u[2*E+1],s[d++]=f;d=70;for(var A=0;A<h.length;A++)c[d++]=h[A];this._datai32[76]=this._drawRectBorderParamData.getPtrID(),z.syncBufferToRenderThread(this._drawRectBorderParamData),this._datai32[75]=Lt._RECT_BORDER_CMD_ENCODER_.getPtrID()},e._setTextureEx=function(t,e){var i=null,_=null;if(!this._drawSimpleImageData){this._drawSimpleImageData=new ParamData(116,!0),i=this._drawSimpleImageData._float32Data,(_=this._drawSimpleImageData._int32Data)[0]=3,_[1]=33984,_[2]=e?t.bitmap._glTexture.id:0,_[3]=1,_[4]=96;var r=t.uv;i[5]=0,i[6]=0,i[7]=r[0],i[8]=r[1],_[9]=4294967295,_[10]=4294967295,i[11]=0,i[12]=0,i[13]=r[2],i[14]=r[3],_[15]=4294967295,_[16]=4294967295,i[17]=0,i[18]=0,i[19]=r[4],i[20]=r[5],_[21]=4294967295,_[22]=4294967295,i[23]=0,i[24]=0,i[25]=r[6],i[26]=r[7],_[27]=4294967295,_[28]=4294967295}i=this._drawSimpleImageData._float32Data,(_=this._drawSimpleImageData._int32Data)[2]=e?t.bitmap._glTexture.id:0;var a=e?t.width:0,n=e?t.height:0;i[11]=i[17]=a,i[18]=i[24]=n;var s=this._drawSimpleImageData.getPtrID();this._datai32[25]=s,z.syncBufferToRenderThread(this._drawSimpleImageData),this._datai32[24]=Lt._SIMPLE_TEXTURE_CMDENCODER_.getPtrID()},e._setTexture=function(t){t&&(t.getIsReady()?this._setTextureEx(t,!0):(this._setTextureEx(t,!1),t.on("ready",this,this._setTextureEx,[t,!0])))},e._setCustomRender=function(){this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._customCmds=[],this._callbackFuncObj.addCallbackFunc(0,this.customRenderFromNative.bind(this)),this._customRenderCmd=z.instance.createCommandEncoder(128,64,!0),this._datai32[54]=this._callbackFuncObj.id,this._datai32[55]=0,this._datai32[27]=this._customRenderCmd.getPtrID()},e._setScrollRect=function(t){this._dataf32[28]=0,this._dataf32[29]=0,this._dataf32[30]=t.width,this._dataf32[31]=t.height,this._dataf32[32]=-t.x,this._dataf32[33]=-t.y},e._setColorFilter=function(t){this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._filterBeginCmd||(this._filterBeginCmd=z.instance.createCommandEncoder(128,64,!1)),this._filterEndCmd||(this._filterEndCmd=z.instance.createCommandEncoder(128,64,!0)),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(3,this.filterBeginRenderFromNative.bind(this)),this._callbackFuncObj.addCallbackFunc(4,this.filterEndRenderFromNative.bind(this)),this._datai32[65]=3,this._datai32[64]=this._filterBeginCmd.getPtrID(),this._datai32[67]=4,this._datai32[66]=this._filterEndCmd.getPtrID()},e._setMask=function(t){t.cacheAs="bitmap",this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._maskCmd||(this._maskCmd=z.instance.createCommandEncoder(128,64,!1)),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(6,this.maskRenderFromNative.bind(this)),this._datai32[69]=6,this._datai32[70]=this._maskCmd.getPtrID()},e._adjustTransform=function(){var t=this._transform||(this._transform=this._createTransform());t._bTransform=!0,z.instance.calcMatrixFromScaleSkewRotation(this._conchData._data._ptrID,60,64,24,28,32,36,40,44,48,52,56);var e=this._conchData._float32Data;return t.a=e[16],t.b=e[17],t.c=e[18],t.d=e[19],t.tx=0,t.ty=0,t},e._setBlendMode=function(t){switch(t){case"normal":this._datai32[71]=1,this._datai32[72]=771;break;case"add":case"lighter":this._datai32[71]=1,this._datai32[72]=772;break;case"multiply":this._datai32[71]=774,this._datai32[72]=771;break;case"screen":this._datai32[71]=1,this._datai32[72]=1;break;case"overlay":this._datai32[71]=1,this._datai32[72]=769;break;case"light":this._datai32[71]=1,this._datai32[72]=1;break;case"mask":this._datai32[71]=0,this._datai32[72]=770;break;case"destination-out":this._datai32[71]=0,this._datai32[72]=0;break;default:alert("_setBlendMode Unknown type")}},e.customRenderFromNative=function(){var t=z.instance.getCurrentContext();this._customRenderCmd.beginEncoding(),this._customRenderCmd.clearEncoding(),t._commandEncoder=this._customRenderCmd,t._customCmds=this._customCmds;for(var e=0,i=this._customCmds.length;e<i;e++)this._customCmds[e].recover();this._customCmds.length=0,this.customRender(t,0,0),this._customRenderCmd.endEncoding()},e.canvasBeginRenderFromNative=function(){var t=z.instance,e=null,i=null,_=this._cacheStyle;if(_.canvas&&0==this._datai32[4])e=_.canvas,0!=this._bRepaintCanvas&&(this.setChildrenNativeVisible(!1),this._bRepaintCanvas=!1),this._datai32[63]=1;else{if(this._canvasBeginCmd.beginEncoding(),this._canvasBeginCmd.clearEncoding(),e=laya.layagl.ConchSpriteAdpt.buildCanvas(this,0,0)){this._datai32[63]=0,this._lastContext=t.getCurrentContext();var r=(i=e.context)._targets;st.setParamData(this._drawCanvasParamData,r,-16,-16,r.width,r.height),t.setCurrentContext(i),i.beginRT(),t.save(),c._tempFloatArrayMatrix[0]=1,c._tempFloatArrayMatrix[1]=0,c._tempFloatArrayMatrix[2]=0,c._tempFloatArrayMatrix[3]=1,c._tempFloatArrayMatrix[4]=16,c._tempFloatArrayMatrix[5]=16,t.setGlobalValue(Lt.GLOBALVALUE_MATRIX32,8,c._tempFloatArrayMatrix),1!=this._bRepaintCanvas&&(this.setChildrenNativeVisible(!0),this._bRepaintCanvas=!0)}this._canvasBeginCmd.endEncoding()}},e.setChildrenNativeVisible=function(t){for(var e,i=this._children,_=i.length,r=0;r<_;++r)(e=i[r])._datai32[5]=t?1:0,e.setChildrenNativeVisible(t)},e.canvasEndRenderFromNative=function(){var t=z.instance;if(this._canvasEndCmd.beginEncoding(),this._canvasEndCmd.clearEncoding(),this._bRepaintCanvas){var e=z.instance.getCurrentContext();t.restore(),t.setCurrentContext(this._lastContext),t.commitContextToGPU(e),e.endRT(),t.blendFunc(1,771)}this._canvasEndCmd.endEncoding()},e.filterBeginRenderFromNative=function(){var t=this,e=z.instance;this._filterBeginCmd.beginEncoding(),this._filterBeginCmd.clearEncoding();var i=this._getCacheStyle().filters;i.length;if(i[0]instanceof laya.filters.ColorFilter){e.addShaderMacro(Lt.SHADER_MACRO_COLOR_FILTER);var _=i[0];e.setGlobalValue(Lt.GLOBALVALUE_COLORFILTER_COLOR,8,_._mat),e.setGlobalValue(Lt.GLOBALVALUE_COLORFILTER_ALPHA,8,_._alpha)}else{var r=C.TEMP,a=S.create(),n=0,s=0;t._isHaveGlowFilter()&&(n=50,s=25);var o=new M;o.copyFrom(t.getSelfBounds()),o.x+=t.x,o.y+=t.y,o.x-=t.pivotX+4,o.y-=t.pivotY+4;var h=o.x,u=o.y;if(o.width+=n+8,o.height+=n+8,r.x=o.x*a.a+o.y*a.c,r.y=o.y*a.d+o.x*a.b,o.x=r.x,o.y=r.y,r.x=o.width*a.a+o.height*a.c,r.y=o.height*a.d+o.width*a.b,o.width=r.x,o.height=r.y,o.width<=0||o.height<=0)return;var l=t._getCacheStyle().filterCache;l&&pt.releaseRT(l),l=pt.getRT(o.width,o.height),t._getCacheStyle().filterCache=l,c.useRenderTarget(l),c._tempFloatArrayMatrix[0]=1,c._tempFloatArrayMatrix[1]=0,c._tempFloatArrayMatrix[2]=0,c._tempFloatArrayMatrix[3]=1,c._tempFloatArrayMatrix[4]=t.x-h+s,c._tempFloatArrayMatrix[5]=t.y-u+s,e.setGlobalValue(Lt.GLOBALVALUE_MATRIX32,8,c._tempFloatArrayMatrix)}this._filterBeginCmd.endEncoding()},e.filterEndRenderFromNative=function(){this._filterEndCmd.beginEncoding(),this._filterEndCmd.clearEncoding();var t=z.instance,e=this._getCacheStyle().filters;if(e[0]instanceof laya.filters.ColorFilter);else{t.restore();var i=z.instance.getCurrentContext(),_=te.currentActive;if(te.popRT(),e[0]instanceof P.BlurFilter){t.addShaderMacro(Lt.SHADER_MACRO_BLUR_FILTER);var r=e[0];c._tempFloatArrayBuffer2[0]=_.width,c._tempFloatArrayBuffer2[1]=_.height,t.setGlobalValue(Lt.GLOBALVALUE_BLURFILTER_BLURINFO,8,c._tempFloatArrayBuffer2),t.setGlobalValue(Lt.GLOBALVALUE_BLURFILTER_STRENGTH,8,r.getStrenth_sig2_2sig2_native()),i.drawTarget(this._filterEndCmd,_,-4,-4,0,0)}else if(e[0]instanceof P.GlowFilter){var a=_.width,n=_.height,s=pt.getRT(a,n);c.useRenderTarget(s),t.addShaderMacro(Lt.SHADER_MACRO_GLOW_FILTER);var o=e[0],h=o.getBlurInfo2Native();h[0]=a,h[1]=n,t.setGlobalValue(Lt.GLOBALVALUE_GLOWFILTER_COLOR,8,o.getColorNative()),t.setGlobalValue(Lt.GLOBALVALUE_GLOWFILTER_BLURINFO1,8,o.getBlurInfo1Native()),t.setGlobalValue(Lt.GLOBALVALUE_GLOWFILTER_BLURINFO2,8,h),i.drawTarget(this._filterEndCmd,_,-16,-16,0,0),t.restore(),te.popRT(),i.drawTarget(this._filterEndCmd,s,-29,-29,0,0),i.drawTarget(this._filterEndCmd,_,-29,-29,0,0)}}this._filterEndCmd.endEncoding(),z.syncBufferToRenderThread(this._filterEndCmd)},e.maskRenderFromNative=function(){this._maskCmd.beginEncoding(),this._maskCmd.clearEncoding();var t=z.instance,e=t.getCurrentContext(),i=this.mask;i&&(0<i._children.length?(t.blockStart(i._conchData),i._renderChilds(e),t.blockEnd(i._conchData)):t.block(i._conchData)),c._tempInt1[0]=772,t.setGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_SRC,8,c._tempInt1),c._tempInt1[0]=0,t.setGlobalValue(Lt.GLOBALVALUE_BLENDFUNC_DEST,8,c._tempInt1),this._maskCmd.endEncoding()},e.updateParticleFromNative=function(){this.tempCmd.updateParticle()},c.createMatrix=function(t,e,i,_,r,a,n){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===_&&(_=1),void 0===r&&(r=0),void 0===a&&(a=0),new Ot(t,e,i,_,r,a,n)},c.init=function(){ht.__init__(),q.__init__();var t,e,i=B.prototype,_=c.prototype,r=["_createTransform","_setTransform","_setGraphics","_setGraphicsCallBack","_setCacheAs","_setX","_setY","_setPivotX","_getPivotX","_setPivotY","_getPivotY","_setAlpha","_getAlpha","_setScaleX","_setScaleY","_setSkewX","_setSkewY","_setRotation","_adjustTransform","_setRenderType","_setTexture","_setTextureEx","_setCustomRender","_setScrollRect","_setColorFilter","customRenderFromNative","canvasBeginRenderFromNative","canvasEndRenderFromNative","setChildrenNativeVisible","filterBeginRenderFromNative","filterEndRenderFromNative","updateParticleFromNative","_setMask","maskRenderFromNative","_setBlendMode","_setBgStyleColor","_setBorderStyleColor"],a=0;for(t=r.length,a=0;a<t;a++)i[e=r[a]]=_[e];i.createGLBuffer=_.createData,S._createFun=c.createMatrix;i.render=i.renderToNative=qt.prototype.renderToNative,i.repaint=i.repaintForNative=qt.prototype.repaintForNative,i.parentRepaint=i.parentRepaintForNative=qt.prototype.parentRepaintForNative,i._renderChilds=qt.prototype._renderChilds,i.writeBlockToNative=qt.prototype.writeBlockToNative,i._writeBlockChilds=qt.prototype._writeBlockChilds},c.useRenderTarget=function(t){var e=z.instance;te.pushRT(),t.start(),e.clearColor(0,0,0,0),e.clear(17664),e.save(),c._tempFloatArrayBuffer2[0]=t.width,c._tempFloatArrayBuffer2[1]=t.height,e.setGlobalValue(Lt.GLOBALVALUE_VIEWS,8,c._tempFloatArrayBuffer2)},c.buildCanvas=function(t,e,i){var _,r,a,n,s,o,h,u=t._cacheStyle,l=u.canvas,c=u.cacheAs;return s=(h=u._calculateCacheRect(t,c,e,i)).x,o=h.y,a=(r=u.cacheRect).width*s,n=r.height*o,r.x,r.y,"bitmap"===c&&(2048<a||2048<n)?(alert("cache bitmap size larger than 2048,cache ignored"),u.releaseContext(),null):(l||(u.createContext(),l=u.canvas),_=l.context,l.context.sprite=t,l.width==a&&l.height==n||(l.size(a,n),_._targets&&(_._targets.destroy(),_._targets=null)),"bitmap"===c?l.context.asBitmap=!0:"normal"===c&&(l.context.asBitmap=!1),"normal"===c&&(_.touches=[]),l)},n(c,["_tempFloatArrayBuffer2",function(){return this._tempFloatArrayBuffer2=new Float32Array(2)},"_tempFloatArrayMatrix",function(){return this._tempFloatArrayMatrix=new Float32Array(6)},"_tempInt1",function(){return this._tempInt1=new Int32Array(1)}]),c}(),Kt=function(t){function i(t,e){i.__super.call(this),this._wrapModeU=0,this._wrapModeV=0,this._filterMode=1,this._readyed=!1,this._width=-1,this._height=-1,this._format=t,this._mipmap=e,this._anisoLevel=1,this._glTexture=z.instance.createTexture()}v(i,"laya.webgl.resource.BaseTexture",_);var e=i.prototype;return e._isPot=function(t){return 0==(t&t-1)},e._getGLFormat=function(){var t=0;switch(this._format){case 0:t=6407;break;case 1:t=6408;break;case 2:t=6406;break;case 3:if(!at._compressedTextureS3tc)throw"BaseTexture: not support DXT1 format.";t=at._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case 4:if(!at._compressedTextureS3tc)throw"BaseTexture: not support DXT5 format.";t=at._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 5:if(!at._compressedTextureEtc1)throw"BaseTexture: not support ETC1RGB format.";t=at._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;break;case 9:if(!at._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_2BPPV format.";t=at._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 10:if(!at._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";t=at._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case 11:if(!at._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_4BPPV format.";t=at._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 12:if(!at._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";t=at._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:throw"BaseTexture: unknown texture format."}return t},e._setFilterMode=function(t){var e=z.instance;switch(at.bindTexture(e,this._glTextureType,this._glTexture),t){case 0:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9984):e.texParameteri(this._glTextureType,10241,9728),e.texParameteri(this._glTextureType,10240,9728);break;case 1:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9985):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;case 2:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9987):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;default:throw new Error("BaseTexture:unknown filterMode value.")}},e._setWarpMode=function(t,e){var i=z.instance;if(at.bindTexture(i,this._glTextureType,this._glTexture),this._isPot(this._width)&&this._isPot(this._height))switch(e){case 0:i.texParameteri(this._glTextureType,t,10497);break;case 1:i.texParameteri(this._glTextureType,t,33071)}else i.texParameteri(this._glTextureType,t,33071)},e._setAnisotropy=function(t){t=Math.max(t,1);var e=z.instance;at.bindTexture(e,this._glTextureType,this._glTexture);var i=at._extTextureFilterAnisotropic;i&&(t=Math.min(e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT),t),e.texParameterf(this._glTextureType,i.TEXTURE_MAX_ANISOTROPY_EXT,t))},e._disposeResource=function(){this._glTexture&&(z.instance.deleteTexture(this._glTexture),this._glTexture=null,this._setGPUMemory(0))},e._getSource=function(){return this._readyed?this._glTexture:null},E(0,e,"wrapModeU",function(){return this._wrapModeU},function(t){this._wrapModeU!==t&&(this._wrapModeU=t,-1!==this._width&&this._setWarpMode(10242,t))}),E(0,e,"mipmap",function(){return this._mipmap}),E(0,e,"format",function(){return this._format}),E(0,e,"wrapModeV",function(){return this._wrapModeV},function(t){this._wrapModeV!==t&&(this._wrapModeV=t,-1!==this._height&&this._setWarpMode(10243,t))}),E(0,e,"defaulteTexture",function(){throw"BaseTexture:must override it."}),E(0,e,"filterMode",function(){return this._filterMode},function(t){t!==this._filterMode&&(this._filterMode=t,-1!==this._width&&-1!==this._height&&this._setFilterMode(t))}),E(0,e,"anisoLevel",function(){return this._anisoLevel},function(t){t!==this._anisoLevel&&(this._anisoLevel=Math.max(1,Math.min(16,t)),-1!==this._width&&-1!==this._height&&this._setAnisotropy(t))}),i.WARPMODE_REPEAT=0,i.WARPMODE_CLAMP=1,i.FILTERMODE_POINT=0,i.FILTERMODE_BILINEAR=1,i.FILTERMODE_TRILINEAR=2,i.FORMAT_R8G8B8=0,i.FORMAT_R8G8B8A8=1,i.FORMAT_ALPHA8=2,i.FORMAT_DXT1=3,i.FORMAT_DXT5=4,i.FORMAT_ETC1RGB=5,i.FORMAT_PVRTCRGB_2BPPV=9,i.FORMAT_PVRTCRGBA_2BPPV=10,i.FORMAT_PVRTCRGB_4BPPV=11,i.FORMAT_PVRTCRGBA_4BPPV=12,i.FORMAT_DEPTH_16=0,i.FORMAT_STENCIL_8=1,i.FORMAT_DEPTHSTENCIL_16_8=2,i.FORMAT_DEPTHSTENCIL_NONE=3,i}(),qt=function(t){function e(){e.__super.call(this)}v(e,"laya.layagl.ConchSprite",B);var i=e.prototype;return i.parentRepaintForNative=function(t){void 0===t&&(t=2);var e=this._parent;e&&(e._conchData._int32Data[4]&t)!=t&&(e._conchData._int32Data[4]|=t,e.parentRepaintForNative(t))},i.renderToNative=function(t,e,i){var _=t.gl,r=z.getFrameCount()-1,a=this._conchData._int32Data,n=a[4];0<this._children.length?r!=a[3]||0<n&&1==(1&n)?(_.blockStart(this._conchData),this._renderChilds(t),_.blockEnd(this._conchData)):_.copyCmdBuffer(this._conchData._int32Data[1],this._conchData._int32Data[2]):_.block(this._conchData)},i.writeBlockToNative=function(){var t=z.instance;0<this._children.length?(t.blockStart(this._conchData),this._writeBlockChilds(),t.blockEnd(this._conchData)):t.block(this._conchData)},i._renderChilds=function(t){var e,i=this._children,_=0,r=i.length,a=this._style;if(a.viewport)for(var n=a.viewport,s=n.x,o=n.y,h=n.right,u=n.bottom,l=NaN,c=NaN;_<r;++_)(e=i[_])._visible&&(l=e._x)<h&&l+e.width>s&&(c=e._y)<u&&c+e.height>o&&e.renderToNative(t);else for(;_<r;++_)(e=i[_])._visible&&e.renderToNative(t)},i._writeBlockChilds=function(){var t,e=this._children,i=0,_=e.length,r=this._style;if(r.viewport)for(var a=r.viewport,n=a.x,s=a.y,o=a.right,h=a.bottom,u=NaN,l=NaN;i<_;++i)(t=e[i])._visible&&(u=t._x)<o&&u+t.width>n&&(l=t._y)<h&&l+t.height>s&&t.writeBlockToNative();else for(;i<_;++i)(t=e[i])._visible&&t.writeBlockToNative()},i.repaintForNative=function(t){void 0===t&&(t=2),(this._conchData._int32Data[4]&t)!=t&&(this._conchData._int32Data[4]|=t,this.parentRepaintForNative(t))},e}(),$t=function(t){function o(t,e,i,_,r){if(this._attribInfo=null,this.customCompile=!1,this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},o.__super.call(this),!t||!e)throw"Shader Error";this._attribInfo=r,c.isConchApp&&(this.customCompile=!0),this._id=++o._count,this._vs=t,this._ps=e,this._nameMap=_||{},null!=i&&(o.sharders[i]=this),this.recreateResource(),this.lock=!0}v(o,"laya.webgl.shader.Shader",Ht);var e=o.prototype;return e.recreateResource=function(){this._compile(),this._setGPUMemory(0)},e._disposeResource=function(){dt.mainContext.deleteShader(this._vshader),dt.mainContext.deleteShader(this._pshader),dt.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this._setGPUMemory(0),this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){var t;this._reCompile=!0,this._params=[],this.customCompile&&(t=rt.preGetParams(this._vs,this._ps));var e=dt.mainContext;this._program=e.createProgram(),this._vshader=o._createShader(e,this._vs,35633),this._pshader=o._createShader(e,this._ps,35632),e.attachShader(this._program,this._vshader),e.attachShader(this._program,this._pshader);var i,_,r=0,a=this._attribInfo?this._attribInfo.length:0;for(r=0;r<a;r+=2)e.bindAttribLocation(this._program,this._attribInfo[r+1],this._attribInfo[r]);if(e.linkProgram(this._program),!this.customCompile&&!e.getProgramParameter(this._program,35714))throw e.getProgramInfoLog(this._program);var n=this.customCompile?t.uniforms.length:e.getProgramParameter(this._program,35718);for(r=0;r<n;r++){var s=this.customCompile?t.uniforms[r]:e.getActiveUniform(this._program,r);0<(i={vartype:"uniform",glfun:null,ivartype:1,location:e.getUniformLocation(this._program,s.name),name:s.name,type:s.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(i.name=i.name.substr(0,i.name.length-3),i.isArray=!0,i.location=e.getUniformLocation(this._program,i.name)),this._params.push(i)}for(r=0,_=this._params.length;r<_;r++)switch((i=this._params[r]).indexOfParams=r,i.index=1,i.value=[i.location,null],i.codename=i.name,i.name=this._nameMap[i.codename]?this._nameMap[i.codename]:i.codename,(this._paramsMap[i.name]=i)._this=this,i.uploadedValue=[],i.type){case 5124:i.fun=i.isArray?this._uniform1iv:this._uniform1i;break;case 5126:i.fun=i.isArray?this._uniform1fv:this._uniform1f;break;case 35664:i.fun=i.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:i.fun=i.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:i.fun=i.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:i.fun=this._uniform_sampler2D;break;case 35680:i.fun=this._uniform_samplerCube;break;case 35676:i.glfun=e.uniformMatrix4fv,i.fun=this._uniformMatrix4fv;break;case 35670:i.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}}},e.getUniform=function(t){return this._paramsMap[t]},e._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(dt.mainContext.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(dt.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return dt.mainContext.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(dt.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(dt.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return dt.mainContext.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(dt.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return dt.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(dt.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return dt.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return dt.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return dt.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return dt.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(dt.mainContext.uniform1i(t.location,i[0]=e),1):0},e._uniform1iv=function(t,e){return dt.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(dt.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return dt.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(dt.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return dt.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(dt.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return dt.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var i=dt.mainContext,_=t.uploadedValue;return null==_[0]?(_[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),at.activeTexture(i,33984+this._curActTexIndex),at.bindTexture(i,3553,e),this._curActTexIndex++,1):(at.activeTexture(i,33984+_[0]),at.bindTexture(i,3553,e),0)},e._uniform_samplerCube=function(t,e){var i=dt.mainContext,_=t.uploadedValue;return null==_[0]?(_[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),at.activeTexture(i,33984+this._curActTexIndex),at.bindTexture(i,34067,e),this._curActTexIndex++,1):(at.activeTexture(i,33984+_[0]),at.bindTexture(i,34067,e),0)},e._noSetValue=function(t){console.log("no....:"+t.name)},e.uploadOne=function(t,e){at.useProgram(dt.mainContext,this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},e.uploadTexture2D=function(t){var e=at;e._activeTextures[0]!==t&&(e.bindTexture(dt.mainContext,e.TEXTURE_2D,t),e._activeTextures[0]=t)},e.upload=function(t,e){Ht.activeShader=Ht.bindShader=this;var i=dt.mainContext;at.useProgram(i,this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;for(var _,r,a=e.length,n=0,s=0;s<a;s++)null!==(r=t[(_=e[s]).name])&&(n+=_.fun.call(this,_,r));x.shaderCall+=n},e.uploadArray=function(t,e,i){Ht.activeShader=this,Ht.bindShader=this,at.useProgram(dt.mainContext,this._program);this._params;for(var _,r,a=0,n=e-2;0<=n;n-=2)(r=this._paramsMap[t[n]])&&null!=(_=t[n+1])&&(i&&i[r.name]&&i[r.name].bind(),a+=r.fun.call(this,r,_));x.shaderCall+=a},e.getParams=function(){return this._params},e.setAttributesLocation=function(t){this._attribInfo=t},o.getShader=function(t){return o.sharders[t]},o.create=function(t,e,i,_,r){return new o(t,e,i,_,r)},o.withCompile=function(t,e,i,_){if(i&&o.sharders[i])return o.sharders[i];var r=o._preCompileShader[2e-4*t];if(!r)throw new Error("withCompile shader err!"+t);return r.createShader(e,i,_,null)},o.withCompile2D=function(t,e,i,_,r,a){if(_&&o.sharders[_])return o.sharders[_];var n=o._preCompileShader[2e-4*t+e];if(!n)throw new Error("withCompile shader err!"+t+" "+e);return n.createShader(i,_,r,a)},o.addInclude=function(t,e){rt.addInclude(t,e)},o.preCompile=function(t,e,i,_){o._preCompileShader[2e-4*t]=new rt(e,i,_)},o.preCompile2D=function(t,e,i,_,r){o._preCompileShader[2e-4*t+e]=new rt(i,_,r)},o._createShader=function(t,e,i){var _=t.createShader(i);return t.shaderSource(_,e),t.compileShader(_),t.getShaderParameter(_,35713)?_:(console.log(t.getShaderInfoLog(_)),null)},o._count=0,o._preCompileShader={},o.SHADERNAME2ID=2e-4,o.sharders=new Array(32),n(o,["nameKey",function(){return this.nameKey=new N}]),o}(),Jt=function(t){function e(){this._maxsize=0,this._upload=!0,this._uploadSize=0,this._bufferSize=0,this._u8Array=null,e.__super.call(this),this.lock=!0}v(e,"laya.webgl.utils.Buffer2D",t);var i=e.prototype;return i.setByteLength=function(t){this._byteLength!==t&&(t<=this._bufferSize||this._resizeBuffer(2*t+256,!0),this._byteLength=t)},i.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._bufferSize||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),x.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._setGPUMemory(this._buffer.byteLength),this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,z.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this._setGPUMemory(this._uploadSize)),z.instance.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),x.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._setGPUMemory(this._buffer.byteLength),this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,z.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this._setGPUMemory(this._uploadSize)),e||i){var _=this._buffer.slice(e,i);z.instance.bufferSubData(this._bufferType,t,_)}else z.instance.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_uploadForVAO=function(){return!!this._upload&&(this._upload=!1,this._bindForVAO(),this._bufferData(),!0)},i._bind_upload=function(){return!!this._upload&&(this._upload=!1,this.bind(),this._bufferData(),!0)},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this.bind(),this._bufferSubData(t,e,i),!0)},i._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(this._setGPUMemory(t),e&&this._buffer&&0<this._buffer.byteLength){var i=new ArrayBuffer(t),_=this._u8Array&&this._u8Array.buffer==this._buffer?this._u8Array:new Uint8Array(this._buffer);this._u8Array=new Uint8Array(i),this._u8Array.set(_,0),this._buffer=i}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this._bufferSize=this._buffer.byteLength,this},i.append=function(t){this._upload=!0;var e,i;e=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+e,!0),i=new Float32Array(this._buffer,this._byteLength)),i.set(t,0),this._byteLength+=e,this._checkArrayUse()},i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var i=new Uint16Array(this._buffer,this._byteLength,e),_=0;_<e;_++)i[_]=t[_];this._byteLength+=2*e,this._checkArrayUse()},i.appendEx=function(t,e){this._upload=!0;var i;i=t.byteLength,this._resizeBuffer(this._byteLength+i,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendEx2=function(t,e,i,_){void 0===_&&(_=1),this._upload=!0;var r,a;r=i*_,this._resizeBuffer(this._byteLength+r,!0),a=new e(this._buffer,this._byteLength);var n=0;for(n=0;n<i;n++)a[n]=t[n];this._byteLength+=r,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();return z.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(jt._bindedVertexBuffer=null),34963==this._bufferType&&(jt._bindedIndexBuffer=null),Ht.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var _=this._bind_subUpload();return z.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(jt._bindedVertexBuffer=null),34963==this._bufferType&&(jt._bindedIndexBuffer=null),Ht.activeShader=null,_},i._disposeResource=function(){t.prototype._disposeResource.call(this),this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},E(0,i,"bufferLength",function(){return this._buffer.byteLength}),E(0,i,"byteLength",null,function(t){this.setByteLength(t)}),e.__int__=function(t){},e.FLOAT32=4,e.SHORT=2,e}(jt),te=function(t){function r(t,e,i,_){void(this._mgrKey=0)===i&&(i=0),void 0===_&&(_=0),r.__super.call(this,i,!1),this._glTextureType=3553,this._width=t,this._height=e,this._depthStencilFormat=_,this._create(t,e)}v(r,"laya.webgl.resource.RenderTexture2D",Kt);var e=r.prototype;return e.getIsReady=function(){return!0},e._create=function(t,e){var i=z.instance;this._frameBuffer=i.createFramebuffer(),at.bindTexture(i,this._glTextureType,this._glTexture);var _=this._getGLFormat();if(i.texImage2D(this._glTextureType,0,_,t,e,0,_,5121,null),this._setGPUMemory(t*e*4),i.bindFramebuffer(36160,this._frameBuffer),i.framebufferTexture2D(36160,36064,3553,this._glTexture,0),3!==this._depthStencilFormat)switch(this._depthStencilBuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,this._depthStencilBuffer),this._depthStencilFormat){case 0:i.renderbufferStorage(36161,33189,t,e),i.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 1:i.renderbufferStorage(36161,36168,t,e),i.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 2:i.renderbufferStorage(36161,34041,t,e),i.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);break;default:console.log("RenderTexture: unkonw depth format.")}i.bindFramebuffer(36160,null),i.bindRenderbuffer(36161,null),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()},e.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,z.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4))},e.start=function(){var t=z.instance;z.instance.bindFramebuffer(36160,this._frameBuffer),(r._currentActive=this)._readyed=!0,t.viewport(0,0,this._width,this._height),this._lastWidth=Ct.width,this._lastHeight=Ct.height,Ct.width=this._width,Ct.height=this._height,Ht.activeShader=null},e.end=function(){z.instance.bindFramebuffer(36160,null),r._currentActive=null,this._readyed=!0},e.restore=function(){var t=z.instance;this._lastRT!=r._currentActive&&(z.instance.bindFramebuffer(36160,this._lastRT?this._lastRT._frameBuffer:null),r._currentActive=this._lastRT),this._readyed=!0,t.viewport(0,0,this._lastWidth,this._lastHeight),Ct.width=this._lastWidth,Ct.height=this._lastHeight,Ht.activeShader=null},e.clear=function(t,e,i,_){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===_&&(_=1);var r=z.instance;r.clearColor(t,e,i,_);var a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=256,a|=1024}r.clear(a)},e.getData=function(t,e,i,_){var r=z.instance;if(r.bindFramebuffer(36160,this._frameBuffer),!(36053===r.checkFramebufferStatus(36160)))return r.bindFramebuffer(36160,null),null;var a=new Uint8Array(this._width*this._height*4),n=this._getGLFormat();return r.readPixels(t,e,i,_,n,5121,a),r.bindFramebuffer(36160,null),a},e._disposeResource=function(){if(this._frameBuffer){var t=z.instance;t.deleteTexture(this._glTexture),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}},E(0,e,"depthStencilFormat",function(){return this._depthStencilFormat}),E(0,e,"defaulteTexture",function(){return ee.grayTexture}),E(0,e,"sourceWidth",function(){return this._width}),E(0,e,"sourceHeight",function(){return this._height}),E(0,e,"offsetX",function(){return 0}),E(0,e,"offsetY",function(){return 0}),E(1,r,"currentActive",function(){return r._currentActive},laya.webgl.resource.BaseTexture._$SET_currentActive),r.pushRT=function(){r.rtStack.push({rt:r._currentActive,w:Ct.width,h:Ct.height})},r.popRT=function(){var t=z.instance,e=r.rtStack.pop();e&&(r._currentActive!=e.rt&&(z.instance.bindFramebuffer(36160,e.rt?e.rt._frameBuffer:null),r._currentActive=e.rt),t.viewport(0,0,e.w,e.h),Ct.width=e.w,Ct.height=e.h)},r._currentActive=null,r.rtStack=[],n(r,["defuv",function(){return this.defuv=[0,0,1,0,1,1,0,1]},"flipyuv",function(){return this.flipyuv=[0,1,1,1,1,0,0,0]}]),r}(),ee=function(t){function a(t,e,i,_,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===_&&(_=!0),void 0===r&&(r=!1),a.__super.call(this,i,_),this._glTextureType=3553,this._width=t,this._height=e,this._canRead=r,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),h.is2DPixelArtGame&&(this._filterMode=0),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel)}v(a,"laya.webgl.resource.Texture2D",Kt);var e=a.prototype;return e._calcualatesCompressedDataSize=function(t,e,i){switch(t){case 3:case 5:return(e+3>>2)*(i+3>>2)*8;case 4:return(e+3>>2)*(i+3>>2)*16;case 11:case 12:return Math.floor((Math.max(e,8)*Math.max(i,8)*4+7)/8);case 9:case 10:return Math.floor((Math.max(e,16)*Math.max(i,8)*2+7)/8);default:return 0}},e._pharseDDS=function(t){var e=new Int32Array(t,0,31);if(542327876!=e[0])throw"Invalid magic number in DDS header";if(!(4&e[20]))throw"Unsupported format, must contain a FourCC code";var i=e[21];switch(this._format){case 3:if(827611204!==i)throw"the FourCC code is not same with texture format.";break;case 4:if(894720068!==i)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format."}var _=1;if(131072&e[2]){if(_=Math.max(1,e[7]),!this._mipmap)throw"the mipmap is not same with Texture2D."}else if(this._mipmap)throw"the mipmap is not same with Texture2D.";var r=e[4],a=e[3];if(this._width!==r||this._height!==a)throw"the width or height is not same with Texture2D.";var n=e[1]+4;this._upLoadCompressedTexImage2D(t,r,a,_,n,0)},e._pharseKTX=function(t){var e=new Uint8Array(t,0,12);if(171!=e[0]||75!=e[1]||84!=e[2]||88!=e[3]||32!=e[4]||49!=e[5]||49!=e[6]||187!=e[7]||13!=e[8]||10!=e[9]||26!=e[10]||10!=e[11])throw"Invalid fileIdentifier in KTX header";var i=new Int32Array(e.buffer,e.length,13),_=i[4],r=this._getGLFormat();switch(this._format){case 5:if(_!==r)throw"the format  is not same with texture format FORMAT_ETC1RGB.";break;default:throw"unknown texture format."}var a=i[11],n=i[6],s=i[7];if(this._width!==n||this._height!==s)throw"the width or height is not same with Texture2D.";var o=64+i[12];this._upLoadCompressedTexImage2D(t,n,s,a,o,4)},e._pharsePVR=function(t){var e=new Int32Array(t,0,13);if(55727696!=e[0])throw"Invalid magic number in PVR header";var i=e[2];switch(this._format){case 5:if(6!==i)throw"the format  is not same with texture format FORMAT_ETC1RGB.";break;case 9:if(0!==i)throw"the format  is not same with texture format FORMAT_PVRTCRGB_2BPPV.";break;case 11:if(2!==i)throw"the format  is not same with texture format FORMAT_PVRTCRGB_4BPPV.";break;case 10:if(1!==i)throw"the format  is not same with texture format FORMAT_PVRTCRGBA_2BPPV.";break;case 12:if(3!==i)throw"the format  is not same with texture format FORMAT_PVRTCRGBA_4BPPV.";break;default:throw"unknown texture format."}var _=e[11],r=e[7],a=e[6];if(this._width!==r||this._height!==a)throw"the width or height is not same with Texture2D.";var n=e[12]+52;this._upLoadCompressedTexImage2D(t,r,a,_,n,0)},e._upLoadCompressedTexImage2D=function(t,e,i,_,r,a){var n=z.instance,s=this._glTextureType;at.bindTexture(n,s,this._glTexture);for(var o=this._getGLFormat(),h=r,u=0;u<_;u++){h+=a;var l=this._calcualatesCompressedDataSize(this._format,e,i),c=new Uint8Array(t,h,l);n.compressedTexImage2D(s,u,o,e,i,0,c),e>>=1,i>>=1,h+=l}var f=h;this._setGPUMemory(f),this._readyed=!0,this._activeResource()},e.loadImageSource=function(t,e){void 0===e&&(e=!1);var i=t.width,_=t.height;this._width=i,this._height=_,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode);var r=z.instance;at.bindTexture(r,this._glTextureType,this._glTexture);var a=this._getGLFormat();c.isConchApp?(t.setPremultiplyAlpha(e),r.texImage2D(this._glTextureType,0,6408,6408,5121,t)):(e&&r.pixelStorei(37441,!0),r.texImage2D(this._glTextureType,0,a,a,5121,t),e&&r.pixelStorei(37441,!1)),this._mipmap&&this._isPot(i)&&this._isPot(_)?(r.generateMipmap(this._glTextureType),this._setGPUMemory(i*_*4*(1+1/3))):this._setGPUMemory(i*_*4),this._canRead&&(c.isConchApp?this._pixels=new Uint8Array(t._nativeObj.getImageData(0,0,i,_)):(s.canvas.size(i,_),s.canvas.clear(),s.context.drawImage(t,0,0,i,_),this._pixels=new Uint8Array(s.context.getImageData(0,0,i,_).data.buffer))),this._readyed=!0,this._activeResource()},e.setPixels=function(t,e){if(void 0===e&&(e=0),!t)throw"Texture2D:pixels can't be null.";var i=this._width,_=this._height,r=z.instance,a=this._glTextureType;at.bindTexture(r,a,this._glTexture);var n=this._getGLFormat();r.texImage2D(a,e,n,i,_,0,n,5121,t),this._mipmap&&this._isPot(i)&&this._isPot(_)?(r.generateMipmap(a),this._setGPUMemory(i*_*4*(1+1/3))):this._setGPUMemory(i*_*4),this._canRead&&(this._pixels=t),this._readyed=!0,this._activeResource()},e.setCompressData=function(t){switch(this._format){case 3:case 4:this._pharseDDS(t);break;case 5:this._pharseKTX(t);break;case 9:case 10:case 11:case 12:this._pharsePVR(t);break;default:throw"Texture2D:unkonwn format."}},e._recoverResource=function(){},e.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},E(0,e,"defaulteTexture",function(){return laya.webgl.resource.Texture2D.grayTexture}),a.__init__=function(){var t=new Uint8Array(3);t[0]=128,t[1]=128,t[2]=128,(a.grayTexture=new a(1,1,0,!1,!1)).setPixels(t),a.grayTexture.lock=!0},a._parse=function(t,e,i){var _=i?new a(i[0],i[1],i[2],i[3],i[4]):new a(0,0);switch(e&&(_.wrapModeU=e.wrapModeU,_.wrapModeV=e.wrapModeV,_.filterMode=e.filterMode,_.anisoLevel=e.anisoLevel),_._format){case 0:case 1:_.loadImageSource(t);break;case 3:case 4:case 5:case 9:case 10:case 11:case 12:_.setCompressData(t);break;default:throw"Texture2D:unkonwn format."}return _},a.load=function(t,e){P.loader.create(t,e,null,"TEXTURE2D")},a.grayTexture=null,a}(),ie=function(t){function a(t,e,i,_,r){this._params2dQuick2=null,this._shaderValueWidth=0,this._shaderValueHeight=0,a.__super.call(this,t,e,i,_,r)}v(a,"laya.webgl.shader.d2.Shader2X",t);var e=a.prototype;return e._disposeResource=function(){t.prototype._disposeResource.call(this),this._params2dQuick2=null},e.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},e._make2dQuick2=function(){if(!this._params2dQuick2){this._params2dQuick2=[];for(var t,e=this._params,i=0,_=e.length;i<_;i++)"size"!==(t=e[i]).name&&this._params2dQuick2.push(t)}return this._params2dQuick2},a.create=function(t,e,i,_,r){return new a(t,e,i,_,r)},a}($t),_e=function(t){function e(t){this._uint16Array=null,void 0===t&&(t=35044),e.__super.call(this),this._bufferUsage=t,this._bufferType=34963,this._buffer=new ArrayBuffer(8)}v(e,"laya.webgl.utils.IndexBuffer2D",Jt);var i=e.prototype;return i._checkArrayUse=function(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},i._bindForVAO=function(){z.instance.bindBuffer(34963,this._glBuffer)},i.bind=function(){return jt._bindedIndexBuffer!==this._glBuffer&&(z.instance.bindBuffer(34963,this._glBuffer),jt._bindedIndexBuffer=this._glBuffer,!0)},i.destory=function(){this._uint16Array=null,this._buffer=null},i.disposeResource=function(){this._disposeResource()},e.create=function(t){return void 0===t&&(t=35044),new e(t)},e}(),re=function(t){function i(t,e){this._floatArray32=null,this._uint32Array=null,this._vertexStride=0,i.__super.call(this),this._vertexStride=t,this._bufferUsage=e,this._bufferType=34962,this._buffer=new ArrayBuffer(8),this._floatArray32=new Float32Array(this._buffer),this._uint32Array=new Uint32Array(this._buffer)}v(i,"laya.webgl.utils.VertexBuffer2D",Jt);var e=i.prototype;return e.getFloat32Array=function(){return this._floatArray32},e.appendArray=function(t){var e=this._byteLength>>2;this.setByteLength(this._byteLength+4*t.length),this.getFloat32Array().set(t,e),this._upload=!0},e._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer)),this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))},e.deleteBuffer=function(){this._disposeResource()},e._bindForVAO=function(){z.instance.bindBuffer(34962,this._glBuffer)},e.bind=function(){return jt._bindedVertexBuffer!==this._glBuffer&&(z.instance.bindBuffer(34962,this._glBuffer),jt._bindedVertexBuffer=this._glBuffer,!0)},e.destroy=function(){laya.resource.Resource.prototype.destroy.call(this),this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},E(0,e,"vertexStride",function(){return this._vertexStride}),i.create=function(t,e){return void 0===e&&(e=35048),new i(t,e)},i}();P.__init([gt,At,It,rt])}(window,document,Laya);